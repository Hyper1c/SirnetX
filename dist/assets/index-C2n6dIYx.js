(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();function Uy(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var $y={exports:{}},Ku={},Vy={exports:{}},Qe={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yl=Symbol.for("react.element"),nA=Symbol.for("react.portal"),iA=Symbol.for("react.fragment"),rA=Symbol.for("react.strict_mode"),sA=Symbol.for("react.profiler"),aA=Symbol.for("react.provider"),oA=Symbol.for("react.context"),lA=Symbol.for("react.forward_ref"),cA=Symbol.for("react.suspense"),uA=Symbol.for("react.memo"),dA=Symbol.for("react.lazy"),mg=Symbol.iterator;function hA(n){return n===null||typeof n!="object"?null:(n=mg&&n[mg]||n["@@iterator"],typeof n=="function"?n:null)}var jy={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Gy=Object.assign,Hy={};function Ga(n,e,t){this.props=n,this.context=e,this.refs=Hy,this.updater=t||jy}Ga.prototype.isReactComponent={};Ga.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};Ga.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function zy(){}zy.prototype=Ga.prototype;function ap(n,e,t){this.props=n,this.context=e,this.refs=Hy,this.updater=t||jy}var op=ap.prototype=new zy;op.constructor=ap;Gy(op,Ga.prototype);op.isPureReactComponent=!0;var gg=Array.isArray,Ky=Object.prototype.hasOwnProperty,lp={current:null},Wy={key:!0,ref:!0,__self:!0,__source:!0};function qy(n,e,t){var i,r={},s=null,a=null;if(e!=null)for(i in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(s=""+e.key),e)Ky.call(e,i)&&!Wy.hasOwnProperty(i)&&(r[i]=e[i]);var o=arguments.length-2;if(o===1)r.children=t;else if(1<o){for(var l=Array(o),c=0;c<o;c++)l[c]=arguments[c+2];r.children=l}if(n&&n.defaultProps)for(i in o=n.defaultProps,o)r[i]===void 0&&(r[i]=o[i]);return{$$typeof:yl,type:n,key:s,ref:a,props:r,_owner:lp.current}}function fA(n,e){return{$$typeof:yl,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function cp(n){return typeof n=="object"&&n!==null&&n.$$typeof===yl}function pA(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var _g=/\/+/g;function Cd(n,e){return typeof n=="object"&&n!==null&&n.key!=null?pA(""+n.key):e.toString(36)}function wc(n,e,t,i,r){var s=typeof n;(s==="undefined"||s==="boolean")&&(n=null);var a=!1;if(n===null)a=!0;else switch(s){case"string":case"number":a=!0;break;case"object":switch(n.$$typeof){case yl:case nA:a=!0}}if(a)return a=n,r=r(a),n=i===""?"."+Cd(a,0):i,gg(r)?(t="",n!=null&&(t=n.replace(_g,"$&/")+"/"),wc(r,e,t,"",function(c){return c})):r!=null&&(cp(r)&&(r=fA(r,t+(!r.key||a&&a.key===r.key?"":(""+r.key).replace(_g,"$&/")+"/")+n)),e.push(r)),1;if(a=0,i=i===""?".":i+":",gg(n))for(var o=0;o<n.length;o++){s=n[o];var l=i+Cd(s,o);a+=wc(s,e,t,l,r)}else if(l=hA(n),typeof l=="function")for(n=l.call(n),o=0;!(s=n.next()).done;)s=s.value,l=i+Cd(s,o++),a+=wc(s,e,t,l,r);else if(s==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function Wl(n,e,t){if(n==null)return n;var i=[],r=0;return wc(n,i,"","",function(s){return e.call(t,s,r++)}),i}function mA(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var vn={current:null},Cc={transition:null},gA={ReactCurrentDispatcher:vn,ReactCurrentBatchConfig:Cc,ReactCurrentOwner:lp};function Yy(){throw Error("act(...) is not supported in production builds of React.")}Qe.Children={map:Wl,forEach:function(n,e,t){Wl(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return Wl(n,function(){e++}),e},toArray:function(n){return Wl(n,function(e){return e})||[]},only:function(n){if(!cp(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};Qe.Component=Ga;Qe.Fragment=iA;Qe.Profiler=sA;Qe.PureComponent=ap;Qe.StrictMode=rA;Qe.Suspense=cA;Qe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=gA;Qe.act=Yy;Qe.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var i=Gy({},n.props),r=n.key,s=n.ref,a=n._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,a=lp.current),e.key!==void 0&&(r=""+e.key),n.type&&n.type.defaultProps)var o=n.type.defaultProps;for(l in e)Ky.call(e,l)&&!Wy.hasOwnProperty(l)&&(i[l]=e[l]===void 0&&o!==void 0?o[l]:e[l])}var l=arguments.length-2;if(l===1)i.children=t;else if(1<l){o=Array(l);for(var c=0;c<l;c++)o[c]=arguments[c+2];i.children=o}return{$$typeof:yl,type:n.type,key:r,ref:s,props:i,_owner:a}};Qe.createContext=function(n){return n={$$typeof:oA,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:aA,_context:n},n.Consumer=n};Qe.createElement=qy;Qe.createFactory=function(n){var e=qy.bind(null,n);return e.type=n,e};Qe.createRef=function(){return{current:null}};Qe.forwardRef=function(n){return{$$typeof:lA,render:n}};Qe.isValidElement=cp;Qe.lazy=function(n){return{$$typeof:dA,_payload:{_status:-1,_result:n},_init:mA}};Qe.memo=function(n,e){return{$$typeof:uA,type:n,compare:e===void 0?null:e}};Qe.startTransition=function(n){var e=Cc.transition;Cc.transition={};try{n()}finally{Cc.transition=e}};Qe.unstable_act=Yy;Qe.useCallback=function(n,e){return vn.current.useCallback(n,e)};Qe.useContext=function(n){return vn.current.useContext(n)};Qe.useDebugValue=function(){};Qe.useDeferredValue=function(n){return vn.current.useDeferredValue(n)};Qe.useEffect=function(n,e){return vn.current.useEffect(n,e)};Qe.useId=function(){return vn.current.useId()};Qe.useImperativeHandle=function(n,e,t){return vn.current.useImperativeHandle(n,e,t)};Qe.useInsertionEffect=function(n,e){return vn.current.useInsertionEffect(n,e)};Qe.useLayoutEffect=function(n,e){return vn.current.useLayoutEffect(n,e)};Qe.useMemo=function(n,e){return vn.current.useMemo(n,e)};Qe.useReducer=function(n,e,t){return vn.current.useReducer(n,e,t)};Qe.useRef=function(n){return vn.current.useRef(n)};Qe.useState=function(n){return vn.current.useState(n)};Qe.useSyncExternalStore=function(n,e,t){return vn.current.useSyncExternalStore(n,e,t)};Qe.useTransition=function(){return vn.current.useTransition()};Qe.version="18.3.1";Vy.exports=Qe;var ae=Vy.exports;const Xy=Uy(ae);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _A=ae,yA=Symbol.for("react.element"),vA=Symbol.for("react.fragment"),EA=Object.prototype.hasOwnProperty,SA=_A.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,TA={key:!0,ref:!0,__self:!0,__source:!0};function Qy(n,e,t){var i,r={},s=null,a=null;t!==void 0&&(s=""+t),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(a=e.ref);for(i in e)EA.call(e,i)&&!TA.hasOwnProperty(i)&&(r[i]=e[i]);if(n&&n.defaultProps)for(i in e=n.defaultProps,e)r[i]===void 0&&(r[i]=e[i]);return{$$typeof:yA,type:n,key:s,ref:a,props:r,_owner:SA.current}}Ku.Fragment=vA;Ku.jsx=Qy;Ku.jsxs=Qy;$y.exports=Ku;var z=$y.exports,Nh={},Jy={exports:{}},Nn={},Zy={exports:{}},ev={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(te,j){var $=te.length;te.push(j);e:for(;0<$;){var q=$-1>>>1,Q=te[q];if(0<r(Q,j))te[q]=j,te[$]=Q,$=q;else break e}}function t(te){return te.length===0?null:te[0]}function i(te){if(te.length===0)return null;var j=te[0],$=te.pop();if($!==j){te[0]=$;e:for(var q=0,Q=te.length,fe=Q>>>1;q<fe;){var ve=2*(q+1)-1,be=te[ve],xe=ve+1,ce=te[xe];if(0>r(be,$))xe<Q&&0>r(ce,be)?(te[q]=ce,te[xe]=$,q=xe):(te[q]=be,te[ve]=$,q=ve);else if(xe<Q&&0>r(ce,$))te[q]=ce,te[xe]=$,q=xe;else break e}}return j}function r(te,j){var $=te.sortIndex-j.sortIndex;return $!==0?$:te.id-j.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();n.unstable_now=function(){return a.now()-o}}var l=[],c=[],u=1,d=null,h=3,m=!1,g=!1,v=!1,x=typeof setTimeout=="function"?setTimeout:null,E=typeof clearTimeout=="function"?clearTimeout:null,R=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function k(te){for(var j=t(c);j!==null;){if(j.callback===null)i(c);else if(j.startTime<=te)i(c),j.sortIndex=j.expirationTime,e(l,j);else break;j=t(c)}}function D(te){if(v=!1,k(te),!g)if(t(l)!==null)g=!0,le(V);else{var j=t(c);j!==null&&ge(D,j.startTime-te)}}function V(te,j){g=!1,v&&(v=!1,E(S),S=-1),m=!0;var $=h;try{for(k(j),d=t(l);d!==null&&(!(d.expirationTime>j)||te&&!L());){var q=d.callback;if(typeof q=="function"){d.callback=null,h=d.priorityLevel;var Q=q(d.expirationTime<=j);j=n.unstable_now(),typeof Q=="function"?d.callback=Q:d===t(l)&&i(l),k(j)}else i(l);d=t(l)}if(d!==null)var fe=!0;else{var ve=t(c);ve!==null&&ge(D,ve.startTime-j),fe=!1}return fe}finally{d=null,h=$,m=!1}}var H=!1,C=null,S=-1,b=5,T=-1;function L(){return!(n.unstable_now()-T<b)}function F(){if(C!==null){var te=n.unstable_now();T=te;var j=!0;try{j=C(!0,te)}finally{j?U():(H=!1,C=null)}}else H=!1}var U;if(typeof R=="function")U=function(){R(F)};else if(typeof MessageChannel<"u"){var Z=new MessageChannel,ie=Z.port2;Z.port1.onmessage=F,U=function(){ie.postMessage(null)}}else U=function(){x(F,0)};function le(te){C=te,H||(H=!0,U())}function ge(te,j){S=x(function(){te(n.unstable_now())},j)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(te){te.callback=null},n.unstable_continueExecution=function(){g||m||(g=!0,le(V))},n.unstable_forceFrameRate=function(te){0>te||125<te?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):b=0<te?Math.floor(1e3/te):5},n.unstable_getCurrentPriorityLevel=function(){return h},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(te){switch(h){case 1:case 2:case 3:var j=3;break;default:j=h}var $=h;h=j;try{return te()}finally{h=$}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(te,j){switch(te){case 1:case 2:case 3:case 4:case 5:break;default:te=3}var $=h;h=te;try{return j()}finally{h=$}},n.unstable_scheduleCallback=function(te,j,$){var q=n.unstable_now();switch(typeof $=="object"&&$!==null?($=$.delay,$=typeof $=="number"&&0<$?q+$:q):$=q,te){case 1:var Q=-1;break;case 2:Q=250;break;case 5:Q=1073741823;break;case 4:Q=1e4;break;default:Q=5e3}return Q=$+Q,te={id:u++,callback:j,priorityLevel:te,startTime:$,expirationTime:Q,sortIndex:-1},$>q?(te.sortIndex=$,e(c,te),t(l)===null&&te===t(c)&&(v?(E(S),S=-1):v=!0,ge(D,$-q))):(te.sortIndex=Q,e(l,te),g||m||(g=!0,le(V))),te},n.unstable_shouldYield=L,n.unstable_wrapCallback=function(te){var j=h;return function(){var $=h;h=j;try{return te.apply(this,arguments)}finally{h=$}}}})(ev);Zy.exports=ev;var AA=Zy.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xA=ae,Mn=AA;function ye(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var tv=new Set,Go={};function js(n,e){ka(n,e),ka(n+"Capture",e)}function ka(n,e){for(Go[n]=e,n=0;n<e.length;n++)tv.add(e[n])}var nr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Bh=Object.prototype.hasOwnProperty,bA=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,yg={},vg={};function IA(n){return Bh.call(vg,n)?!0:Bh.call(yg,n)?!1:bA.test(n)?vg[n]=!0:(yg[n]=!0,!1)}function RA(n,e,t,i){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function LA(n,e,t,i){if(e===null||typeof e>"u"||RA(n,e,t,i))return!0;if(i)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function En(n,e,t,i,r,s,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=s,this.removeEmptyString=a}var nn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){nn[n]=new En(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];nn[e]=new En(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){nn[n]=new En(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){nn[n]=new En(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){nn[n]=new En(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){nn[n]=new En(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){nn[n]=new En(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){nn[n]=new En(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){nn[n]=new En(n,5,!1,n.toLowerCase(),null,!1,!1)});var up=/[\-:]([a-z])/g;function dp(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(up,dp);nn[e]=new En(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(up,dp);nn[e]=new En(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(up,dp);nn[e]=new En(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){nn[n]=new En(n,1,!1,n.toLowerCase(),null,!1,!1)});nn.xlinkHref=new En("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){nn[n]=new En(n,1,!1,n.toLowerCase(),null,!0,!0)});function hp(n,e,t,i){var r=nn.hasOwnProperty(e)?nn[e]:null;(r!==null?r.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(LA(e,t,r,i)&&(t=null),i||r===null?IA(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):r.mustUseProperty?n[r.propertyName]=t===null?r.type===3?!1:"":t:(e=r.attributeName,i=r.attributeNamespace,t===null?n.removeAttribute(e):(r=r.type,t=r===3||r===4&&t===!0?"":""+t,i?n.setAttributeNS(i,e,t):n.setAttribute(e,t))))}var cr=xA.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ql=Symbol.for("react.element"),ra=Symbol.for("react.portal"),sa=Symbol.for("react.fragment"),fp=Symbol.for("react.strict_mode"),Fh=Symbol.for("react.profiler"),nv=Symbol.for("react.provider"),iv=Symbol.for("react.context"),pp=Symbol.for("react.forward_ref"),Uh=Symbol.for("react.suspense"),$h=Symbol.for("react.suspense_list"),mp=Symbol.for("react.memo"),Ir=Symbol.for("react.lazy"),rv=Symbol.for("react.offscreen"),Eg=Symbol.iterator;function lo(n){return n===null||typeof n!="object"?null:(n=Eg&&n[Eg]||n["@@iterator"],typeof n=="function"?n:null)}var It=Object.assign,kd;function vo(n){if(kd===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);kd=e&&e[1]||""}return`
`+kd+n}var Dd=!1;function Pd(n,e){if(!n||Dd)return"";Dd=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var i=c}Reflect.construct(n,[],e)}else{try{e.call()}catch(c){i=c}n.call(e.prototype)}else{try{throw Error()}catch(c){i=c}n()}}catch(c){if(c&&i&&typeof c.stack=="string"){for(var r=c.stack.split(`
`),s=i.stack.split(`
`),a=r.length-1,o=s.length-1;1<=a&&0<=o&&r[a]!==s[o];)o--;for(;1<=a&&0<=o;a--,o--)if(r[a]!==s[o]){if(a!==1||o!==1)do if(a--,o--,0>o||r[a]!==s[o]){var l=`
`+r[a].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=a&&0<=o);break}}}finally{Dd=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?vo(n):""}function wA(n){switch(n.tag){case 5:return vo(n.type);case 16:return vo("Lazy");case 13:return vo("Suspense");case 19:return vo("SuspenseList");case 0:case 2:case 15:return n=Pd(n.type,!1),n;case 11:return n=Pd(n.type.render,!1),n;case 1:return n=Pd(n.type,!0),n;default:return""}}function Vh(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case sa:return"Fragment";case ra:return"Portal";case Fh:return"Profiler";case fp:return"StrictMode";case Uh:return"Suspense";case $h:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case iv:return(n.displayName||"Context")+".Consumer";case nv:return(n._context.displayName||"Context")+".Provider";case pp:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case mp:return e=n.displayName||null,e!==null?e:Vh(n.type)||"Memo";case Ir:e=n._payload,n=n._init;try{return Vh(n(e))}catch{}}return null}function CA(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Vh(e);case 8:return e===fp?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Xr(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function sv(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function kA(n){var e=sv(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),i=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var r=t.get,s=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return r.call(this)},set:function(a){i=""+a,s.call(this,a)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return i},setValue:function(a){i=""+a},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function Yl(n){n._valueTracker||(n._valueTracker=kA(n))}function av(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),i="";return n&&(i=sv(n)?n.checked?"true":"false":n.value),n=i,n!==t?(e.setValue(n),!0):!1}function nu(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function jh(n,e){var t=e.checked;return It({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function Sg(n,e){var t=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;t=Xr(e.value!=null?e.value:t),n._wrapperState={initialChecked:i,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function ov(n,e){e=e.checked,e!=null&&hp(n,"checked",e,!1)}function Gh(n,e){ov(n,e);var t=Xr(e.value),i=e.type;if(t!=null)i==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(i==="submit"||i==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?Hh(n,e.type,t):e.hasOwnProperty("defaultValue")&&Hh(n,e.type,Xr(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function Tg(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function Hh(n,e,t){(e!=="number"||nu(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var Eo=Array.isArray;function ya(n,e,t,i){if(n=n.options,e){e={};for(var r=0;r<t.length;r++)e["$"+t[r]]=!0;for(t=0;t<n.length;t++)r=e.hasOwnProperty("$"+n[t].value),n[t].selected!==r&&(n[t].selected=r),r&&i&&(n[t].defaultSelected=!0)}else{for(t=""+Xr(t),e=null,r=0;r<n.length;r++){if(n[r].value===t){n[r].selected=!0,i&&(n[r].defaultSelected=!0);return}e!==null||n[r].disabled||(e=n[r])}e!==null&&(e.selected=!0)}}function zh(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(ye(91));return It({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function Ag(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(ye(92));if(Eo(t)){if(1<t.length)throw Error(ye(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:Xr(t)}}function lv(n,e){var t=Xr(e.value),i=Xr(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),i!=null&&(n.defaultValue=""+i)}function xg(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function cv(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Kh(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?cv(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var Xl,uv=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,i,r){MSApp.execUnsafeLocalFunction(function(){return n(e,t,i,r)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(Xl=Xl||document.createElement("div"),Xl.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Xl.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function Ho(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var Io={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},DA=["Webkit","ms","Moz","O"];Object.keys(Io).forEach(function(n){DA.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),Io[e]=Io[n]})});function dv(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||Io.hasOwnProperty(n)&&Io[n]?(""+e).trim():e+"px"}function hv(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var i=t.indexOf("--")===0,r=dv(t,e[t],i);t==="float"&&(t="cssFloat"),i?n.setProperty(t,r):n[t]=r}}var PA=It({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Wh(n,e){if(e){if(PA[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(ye(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(ye(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(ye(61))}if(e.style!=null&&typeof e.style!="object")throw Error(ye(62))}}function qh(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Yh=null;function gp(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Xh=null,va=null,Ea=null;function bg(n){if(n=Sl(n)){if(typeof Xh!="function")throw Error(ye(280));var e=n.stateNode;e&&(e=Qu(e),Xh(n.stateNode,n.type,e))}}function fv(n){va?Ea?Ea.push(n):Ea=[n]:va=n}function pv(){if(va){var n=va,e=Ea;if(Ea=va=null,bg(n),e)for(n=0;n<e.length;n++)bg(e[n])}}function mv(n,e){return n(e)}function gv(){}var Od=!1;function _v(n,e,t){if(Od)return n(e,t);Od=!0;try{return mv(n,e,t)}finally{Od=!1,(va!==null||Ea!==null)&&(gv(),pv())}}function zo(n,e){var t=n.stateNode;if(t===null)return null;var i=Qu(t);if(i===null)return null;t=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(n=n.type,i=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!i;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(ye(231,e,typeof t));return t}var Qh=!1;if(nr)try{var co={};Object.defineProperty(co,"passive",{get:function(){Qh=!0}}),window.addEventListener("test",co,co),window.removeEventListener("test",co,co)}catch{Qh=!1}function OA(n,e,t,i,r,s,a,o,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(t,c)}catch(u){this.onError(u)}}var Ro=!1,iu=null,ru=!1,Jh=null,MA={onError:function(n){Ro=!0,iu=n}};function NA(n,e,t,i,r,s,a,o,l){Ro=!1,iu=null,OA.apply(MA,arguments)}function BA(n,e,t,i,r,s,a,o,l){if(NA.apply(this,arguments),Ro){if(Ro){var c=iu;Ro=!1,iu=null}else throw Error(ye(198));ru||(ru=!0,Jh=c)}}function Gs(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function yv(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function Ig(n){if(Gs(n)!==n)throw Error(ye(188))}function FA(n){var e=n.alternate;if(!e){if(e=Gs(n),e===null)throw Error(ye(188));return e!==n?null:n}for(var t=n,i=e;;){var r=t.return;if(r===null)break;var s=r.alternate;if(s===null){if(i=r.return,i!==null){t=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===t)return Ig(r),n;if(s===i)return Ig(r),e;s=s.sibling}throw Error(ye(188))}if(t.return!==i.return)t=r,i=s;else{for(var a=!1,o=r.child;o;){if(o===t){a=!0,t=r,i=s;break}if(o===i){a=!0,i=r,t=s;break}o=o.sibling}if(!a){for(o=s.child;o;){if(o===t){a=!0,t=s,i=r;break}if(o===i){a=!0,i=s,t=r;break}o=o.sibling}if(!a)throw Error(ye(189))}}if(t.alternate!==i)throw Error(ye(190))}if(t.tag!==3)throw Error(ye(188));return t.stateNode.current===t?n:e}function vv(n){return n=FA(n),n!==null?Ev(n):null}function Ev(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=Ev(n);if(e!==null)return e;n=n.sibling}return null}var Sv=Mn.unstable_scheduleCallback,Rg=Mn.unstable_cancelCallback,UA=Mn.unstable_shouldYield,$A=Mn.unstable_requestPaint,Ot=Mn.unstable_now,VA=Mn.unstable_getCurrentPriorityLevel,_p=Mn.unstable_ImmediatePriority,Tv=Mn.unstable_UserBlockingPriority,su=Mn.unstable_NormalPriority,jA=Mn.unstable_LowPriority,Av=Mn.unstable_IdlePriority,Wu=null,ki=null;function GA(n){if(ki&&typeof ki.onCommitFiberRoot=="function")try{ki.onCommitFiberRoot(Wu,n,void 0,(n.current.flags&128)===128)}catch{}}var di=Math.clz32?Math.clz32:KA,HA=Math.log,zA=Math.LN2;function KA(n){return n>>>=0,n===0?32:31-(HA(n)/zA|0)|0}var Ql=64,Jl=4194304;function So(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function au(n,e){var t=n.pendingLanes;if(t===0)return 0;var i=0,r=n.suspendedLanes,s=n.pingedLanes,a=t&268435455;if(a!==0){var o=a&~r;o!==0?i=So(o):(s&=a,s!==0&&(i=So(s)))}else a=t&~r,a!==0?i=So(a):s!==0&&(i=So(s));if(i===0)return 0;if(e!==0&&e!==i&&!(e&r)&&(r=i&-i,s=e&-e,r>=s||r===16&&(s&4194240)!==0))return e;if(i&4&&(i|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=i;0<e;)t=31-di(e),r=1<<t,i|=n[t],e&=~r;return i}function WA(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function qA(n,e){for(var t=n.suspendedLanes,i=n.pingedLanes,r=n.expirationTimes,s=n.pendingLanes;0<s;){var a=31-di(s),o=1<<a,l=r[a];l===-1?(!(o&t)||o&i)&&(r[a]=WA(o,e)):l<=e&&(n.expiredLanes|=o),s&=~o}}function Zh(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function xv(){var n=Ql;return Ql<<=1,!(Ql&4194240)&&(Ql=64),n}function Md(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function vl(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-di(e),n[e]=t}function YA(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var i=n.eventTimes;for(n=n.expirationTimes;0<t;){var r=31-di(t),s=1<<r;e[r]=0,i[r]=-1,n[r]=-1,t&=~s}}function yp(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var i=31-di(t),r=1<<i;r&e|n[i]&e&&(n[i]|=e),t&=~r}}var lt=0;function bv(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var Iv,vp,Rv,Lv,wv,ef=!1,Zl=[],Fr=null,Ur=null,$r=null,Ko=new Map,Wo=new Map,Cr=[],XA="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Lg(n,e){switch(n){case"focusin":case"focusout":Fr=null;break;case"dragenter":case"dragleave":Ur=null;break;case"mouseover":case"mouseout":$r=null;break;case"pointerover":case"pointerout":Ko.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Wo.delete(e.pointerId)}}function uo(n,e,t,i,r,s){return n===null||n.nativeEvent!==s?(n={blockedOn:e,domEventName:t,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},e!==null&&(e=Sl(e),e!==null&&vp(e)),n):(n.eventSystemFlags|=i,e=n.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),n)}function QA(n,e,t,i,r){switch(e){case"focusin":return Fr=uo(Fr,n,e,t,i,r),!0;case"dragenter":return Ur=uo(Ur,n,e,t,i,r),!0;case"mouseover":return $r=uo($r,n,e,t,i,r),!0;case"pointerover":var s=r.pointerId;return Ko.set(s,uo(Ko.get(s)||null,n,e,t,i,r)),!0;case"gotpointercapture":return s=r.pointerId,Wo.set(s,uo(Wo.get(s)||null,n,e,t,i,r)),!0}return!1}function Cv(n){var e=As(n.target);if(e!==null){var t=Gs(e);if(t!==null){if(e=t.tag,e===13){if(e=yv(t),e!==null){n.blockedOn=e,wv(n.priority,function(){Rv(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function kc(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=tf(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var i=new t.constructor(t.type,t);Yh=i,t.target.dispatchEvent(i),Yh=null}else return e=Sl(t),e!==null&&vp(e),n.blockedOn=t,!1;e.shift()}return!0}function wg(n,e,t){kc(n)&&t.delete(e)}function JA(){ef=!1,Fr!==null&&kc(Fr)&&(Fr=null),Ur!==null&&kc(Ur)&&(Ur=null),$r!==null&&kc($r)&&($r=null),Ko.forEach(wg),Wo.forEach(wg)}function ho(n,e){n.blockedOn===e&&(n.blockedOn=null,ef||(ef=!0,Mn.unstable_scheduleCallback(Mn.unstable_NormalPriority,JA)))}function qo(n){function e(r){return ho(r,n)}if(0<Zl.length){ho(Zl[0],n);for(var t=1;t<Zl.length;t++){var i=Zl[t];i.blockedOn===n&&(i.blockedOn=null)}}for(Fr!==null&&ho(Fr,n),Ur!==null&&ho(Ur,n),$r!==null&&ho($r,n),Ko.forEach(e),Wo.forEach(e),t=0;t<Cr.length;t++)i=Cr[t],i.blockedOn===n&&(i.blockedOn=null);for(;0<Cr.length&&(t=Cr[0],t.blockedOn===null);)Cv(t),t.blockedOn===null&&Cr.shift()}var Sa=cr.ReactCurrentBatchConfig,ou=!0;function ZA(n,e,t,i){var r=lt,s=Sa.transition;Sa.transition=null;try{lt=1,Ep(n,e,t,i)}finally{lt=r,Sa.transition=s}}function ex(n,e,t,i){var r=lt,s=Sa.transition;Sa.transition=null;try{lt=4,Ep(n,e,t,i)}finally{lt=r,Sa.transition=s}}function Ep(n,e,t,i){if(ou){var r=tf(n,e,t,i);if(r===null)zd(n,e,i,lu,t),Lg(n,i);else if(QA(r,n,e,t,i))i.stopPropagation();else if(Lg(n,i),e&4&&-1<XA.indexOf(n)){for(;r!==null;){var s=Sl(r);if(s!==null&&Iv(s),s=tf(n,e,t,i),s===null&&zd(n,e,i,lu,t),s===r)break;r=s}r!==null&&i.stopPropagation()}else zd(n,e,i,null,t)}}var lu=null;function tf(n,e,t,i){if(lu=null,n=gp(i),n=As(n),n!==null)if(e=Gs(n),e===null)n=null;else if(t=e.tag,t===13){if(n=yv(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return lu=n,null}function kv(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(VA()){case _p:return 1;case Tv:return 4;case su:case jA:return 16;case Av:return 536870912;default:return 16}default:return 16}}var Nr=null,Sp=null,Dc=null;function Dv(){if(Dc)return Dc;var n,e=Sp,t=e.length,i,r="value"in Nr?Nr.value:Nr.textContent,s=r.length;for(n=0;n<t&&e[n]===r[n];n++);var a=t-n;for(i=1;i<=a&&e[t-i]===r[s-i];i++);return Dc=r.slice(n,1<i?1-i:void 0)}function Pc(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function ec(){return!0}function Cg(){return!1}function Bn(n){function e(t,i,r,s,a){this._reactName=t,this._targetInst=r,this.type=i,this.nativeEvent=s,this.target=a,this.currentTarget=null;for(var o in n)n.hasOwnProperty(o)&&(t=n[o],this[o]=t?t(s):s[o]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?ec:Cg,this.isPropagationStopped=Cg,this}return It(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=ec)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=ec)},persist:function(){},isPersistent:ec}),e}var Ha={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Tp=Bn(Ha),El=It({},Ha,{view:0,detail:0}),tx=Bn(El),Nd,Bd,fo,qu=It({},El,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ap,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==fo&&(fo&&n.type==="mousemove"?(Nd=n.screenX-fo.screenX,Bd=n.screenY-fo.screenY):Bd=Nd=0,fo=n),Nd)},movementY:function(n){return"movementY"in n?n.movementY:Bd}}),kg=Bn(qu),nx=It({},qu,{dataTransfer:0}),ix=Bn(nx),rx=It({},El,{relatedTarget:0}),Fd=Bn(rx),sx=It({},Ha,{animationName:0,elapsedTime:0,pseudoElement:0}),ax=Bn(sx),ox=It({},Ha,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),lx=Bn(ox),cx=It({},Ha,{data:0}),Dg=Bn(cx),ux={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},dx={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},hx={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function fx(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=hx[n])?!!e[n]:!1}function Ap(){return fx}var px=It({},El,{key:function(n){if(n.key){var e=ux[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=Pc(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?dx[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ap,charCode:function(n){return n.type==="keypress"?Pc(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Pc(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),mx=Bn(px),gx=It({},qu,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Pg=Bn(gx),_x=It({},El,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ap}),yx=Bn(_x),vx=It({},Ha,{propertyName:0,elapsedTime:0,pseudoElement:0}),Ex=Bn(vx),Sx=It({},qu,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),Tx=Bn(Sx),Ax=[9,13,27,32],xp=nr&&"CompositionEvent"in window,Lo=null;nr&&"documentMode"in document&&(Lo=document.documentMode);var xx=nr&&"TextEvent"in window&&!Lo,Pv=nr&&(!xp||Lo&&8<Lo&&11>=Lo),Og=" ",Mg=!1;function Ov(n,e){switch(n){case"keyup":return Ax.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Mv(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var aa=!1;function bx(n,e){switch(n){case"compositionend":return Mv(e);case"keypress":return e.which!==32?null:(Mg=!0,Og);case"textInput":return n=e.data,n===Og&&Mg?null:n;default:return null}}function Ix(n,e){if(aa)return n==="compositionend"||!xp&&Ov(n,e)?(n=Dv(),Dc=Sp=Nr=null,aa=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Pv&&e.locale!=="ko"?null:e.data;default:return null}}var Rx={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ng(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!Rx[n.type]:e==="textarea"}function Nv(n,e,t,i){fv(i),e=cu(e,"onChange"),0<e.length&&(t=new Tp("onChange","change",null,t,i),n.push({event:t,listeners:e}))}var wo=null,Yo=null;function Lx(n){Wv(n,0)}function Yu(n){var e=ca(n);if(av(e))return n}function wx(n,e){if(n==="change")return e}var Bv=!1;if(nr){var Ud;if(nr){var $d="oninput"in document;if(!$d){var Bg=document.createElement("div");Bg.setAttribute("oninput","return;"),$d=typeof Bg.oninput=="function"}Ud=$d}else Ud=!1;Bv=Ud&&(!document.documentMode||9<document.documentMode)}function Fg(){wo&&(wo.detachEvent("onpropertychange",Fv),Yo=wo=null)}function Fv(n){if(n.propertyName==="value"&&Yu(Yo)){var e=[];Nv(e,Yo,n,gp(n)),_v(Lx,e)}}function Cx(n,e,t){n==="focusin"?(Fg(),wo=e,Yo=t,wo.attachEvent("onpropertychange",Fv)):n==="focusout"&&Fg()}function kx(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Yu(Yo)}function Dx(n,e){if(n==="click")return Yu(e)}function Px(n,e){if(n==="input"||n==="change")return Yu(e)}function Ox(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var fi=typeof Object.is=="function"?Object.is:Ox;function Xo(n,e){if(fi(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),i=Object.keys(e);if(t.length!==i.length)return!1;for(i=0;i<t.length;i++){var r=t[i];if(!Bh.call(e,r)||!fi(n[r],e[r]))return!1}return!0}function Ug(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function $g(n,e){var t=Ug(n);n=0;for(var i;t;){if(t.nodeType===3){if(i=n+t.textContent.length,n<=e&&i>=e)return{node:t,offset:e-n};n=i}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=Ug(t)}}function Uv(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?Uv(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function $v(){for(var n=window,e=nu();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=nu(n.document)}return e}function bp(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function Mx(n){var e=$v(),t=n.focusedElem,i=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&Uv(t.ownerDocument.documentElement,t)){if(i!==null&&bp(t)){if(e=i.start,n=i.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var r=t.textContent.length,s=Math.min(i.start,r);i=i.end===void 0?s:Math.min(i.end,r),!n.extend&&s>i&&(r=i,i=s,s=r),r=$g(t,s);var a=$g(t,i);r&&a&&(n.rangeCount!==1||n.anchorNode!==r.node||n.anchorOffset!==r.offset||n.focusNode!==a.node||n.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),n.removeAllRanges(),s>i?(n.addRange(e),n.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var Nx=nr&&"documentMode"in document&&11>=document.documentMode,oa=null,nf=null,Co=null,rf=!1;function Vg(n,e,t){var i=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;rf||oa==null||oa!==nu(i)||(i=oa,"selectionStart"in i&&bp(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),Co&&Xo(Co,i)||(Co=i,i=cu(nf,"onSelect"),0<i.length&&(e=new Tp("onSelect","select",null,e,t),n.push({event:e,listeners:i}),e.target=oa)))}function tc(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var la={animationend:tc("Animation","AnimationEnd"),animationiteration:tc("Animation","AnimationIteration"),animationstart:tc("Animation","AnimationStart"),transitionend:tc("Transition","TransitionEnd")},Vd={},Vv={};nr&&(Vv=document.createElement("div").style,"AnimationEvent"in window||(delete la.animationend.animation,delete la.animationiteration.animation,delete la.animationstart.animation),"TransitionEvent"in window||delete la.transitionend.transition);function Xu(n){if(Vd[n])return Vd[n];if(!la[n])return n;var e=la[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in Vv)return Vd[n]=e[t];return n}var jv=Xu("animationend"),Gv=Xu("animationiteration"),Hv=Xu("animationstart"),zv=Xu("transitionend"),Kv=new Map,jg="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ts(n,e){Kv.set(n,e),js(e,[n])}for(var jd=0;jd<jg.length;jd++){var Gd=jg[jd],Bx=Gd.toLowerCase(),Fx=Gd[0].toUpperCase()+Gd.slice(1);ts(Bx,"on"+Fx)}ts(jv,"onAnimationEnd");ts(Gv,"onAnimationIteration");ts(Hv,"onAnimationStart");ts("dblclick","onDoubleClick");ts("focusin","onFocus");ts("focusout","onBlur");ts(zv,"onTransitionEnd");ka("onMouseEnter",["mouseout","mouseover"]);ka("onMouseLeave",["mouseout","mouseover"]);ka("onPointerEnter",["pointerout","pointerover"]);ka("onPointerLeave",["pointerout","pointerover"]);js("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));js("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));js("onBeforeInput",["compositionend","keypress","textInput","paste"]);js("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));js("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));js("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var To="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ux=new Set("cancel close invalid load scroll toggle".split(" ").concat(To));function Gg(n,e,t){var i=n.type||"unknown-event";n.currentTarget=t,BA(i,e,void 0,n),n.currentTarget=null}function Wv(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var i=n[t],r=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var a=i.length-1;0<=a;a--){var o=i[a],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==s&&r.isPropagationStopped())break e;Gg(r,o,c),s=l}else for(a=0;a<i.length;a++){if(o=i[a],l=o.instance,c=o.currentTarget,o=o.listener,l!==s&&r.isPropagationStopped())break e;Gg(r,o,c),s=l}}}if(ru)throw n=Jh,ru=!1,Jh=null,n}function _t(n,e){var t=e[cf];t===void 0&&(t=e[cf]=new Set);var i=n+"__bubble";t.has(i)||(qv(e,n,2,!1),t.add(i))}function Hd(n,e,t){var i=0;e&&(i|=4),qv(t,n,i,e)}var nc="_reactListening"+Math.random().toString(36).slice(2);function Qo(n){if(!n[nc]){n[nc]=!0,tv.forEach(function(t){t!=="selectionchange"&&(Ux.has(t)||Hd(t,!1,n),Hd(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[nc]||(e[nc]=!0,Hd("selectionchange",!1,e))}}function qv(n,e,t,i){switch(kv(e)){case 1:var r=ZA;break;case 4:r=ex;break;default:r=Ep}t=r.bind(null,e,t,n),r=void 0,!Qh||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?n.addEventListener(e,t,{capture:!0,passive:r}):n.addEventListener(e,t,!0):r!==void 0?n.addEventListener(e,t,{passive:r}):n.addEventListener(e,t,!1)}function zd(n,e,t,i,r){var s=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var a=i.tag;if(a===3||a===4){var o=i.stateNode.containerInfo;if(o===r||o.nodeType===8&&o.parentNode===r)break;if(a===4)for(a=i.return;a!==null;){var l=a.tag;if((l===3||l===4)&&(l=a.stateNode.containerInfo,l===r||l.nodeType===8&&l.parentNode===r))return;a=a.return}for(;o!==null;){if(a=As(o),a===null)return;if(l=a.tag,l===5||l===6){i=s=a;continue e}o=o.parentNode}}i=i.return}_v(function(){var c=s,u=gp(t),d=[];e:{var h=Kv.get(n);if(h!==void 0){var m=Tp,g=n;switch(n){case"keypress":if(Pc(t)===0)break e;case"keydown":case"keyup":m=mx;break;case"focusin":g="focus",m=Fd;break;case"focusout":g="blur",m=Fd;break;case"beforeblur":case"afterblur":m=Fd;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":m=kg;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":m=ix;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":m=yx;break;case jv:case Gv:case Hv:m=ax;break;case zv:m=Ex;break;case"scroll":m=tx;break;case"wheel":m=Tx;break;case"copy":case"cut":case"paste":m=lx;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":m=Pg}var v=(e&4)!==0,x=!v&&n==="scroll",E=v?h!==null?h+"Capture":null:h;v=[];for(var R=c,k;R!==null;){k=R;var D=k.stateNode;if(k.tag===5&&D!==null&&(k=D,E!==null&&(D=zo(R,E),D!=null&&v.push(Jo(R,D,k)))),x)break;R=R.return}0<v.length&&(h=new m(h,g,null,t,u),d.push({event:h,listeners:v}))}}if(!(e&7)){e:{if(h=n==="mouseover"||n==="pointerover",m=n==="mouseout"||n==="pointerout",h&&t!==Yh&&(g=t.relatedTarget||t.fromElement)&&(As(g)||g[ir]))break e;if((m||h)&&(h=u.window===u?u:(h=u.ownerDocument)?h.defaultView||h.parentWindow:window,m?(g=t.relatedTarget||t.toElement,m=c,g=g?As(g):null,g!==null&&(x=Gs(g),g!==x||g.tag!==5&&g.tag!==6)&&(g=null)):(m=null,g=c),m!==g)){if(v=kg,D="onMouseLeave",E="onMouseEnter",R="mouse",(n==="pointerout"||n==="pointerover")&&(v=Pg,D="onPointerLeave",E="onPointerEnter",R="pointer"),x=m==null?h:ca(m),k=g==null?h:ca(g),h=new v(D,R+"leave",m,t,u),h.target=x,h.relatedTarget=k,D=null,As(u)===c&&(v=new v(E,R+"enter",g,t,u),v.target=k,v.relatedTarget=x,D=v),x=D,m&&g)t:{for(v=m,E=g,R=0,k=v;k;k=Js(k))R++;for(k=0,D=E;D;D=Js(D))k++;for(;0<R-k;)v=Js(v),R--;for(;0<k-R;)E=Js(E),k--;for(;R--;){if(v===E||E!==null&&v===E.alternate)break t;v=Js(v),E=Js(E)}v=null}else v=null;m!==null&&Hg(d,h,m,v,!1),g!==null&&x!==null&&Hg(d,x,g,v,!0)}}e:{if(h=c?ca(c):window,m=h.nodeName&&h.nodeName.toLowerCase(),m==="select"||m==="input"&&h.type==="file")var V=wx;else if(Ng(h))if(Bv)V=Px;else{V=kx;var H=Cx}else(m=h.nodeName)&&m.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(V=Dx);if(V&&(V=V(n,c))){Nv(d,V,t,u);break e}H&&H(n,h,c),n==="focusout"&&(H=h._wrapperState)&&H.controlled&&h.type==="number"&&Hh(h,"number",h.value)}switch(H=c?ca(c):window,n){case"focusin":(Ng(H)||H.contentEditable==="true")&&(oa=H,nf=c,Co=null);break;case"focusout":Co=nf=oa=null;break;case"mousedown":rf=!0;break;case"contextmenu":case"mouseup":case"dragend":rf=!1,Vg(d,t,u);break;case"selectionchange":if(Nx)break;case"keydown":case"keyup":Vg(d,t,u)}var C;if(xp)e:{switch(n){case"compositionstart":var S="onCompositionStart";break e;case"compositionend":S="onCompositionEnd";break e;case"compositionupdate":S="onCompositionUpdate";break e}S=void 0}else aa?Ov(n,t)&&(S="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(S="onCompositionStart");S&&(Pv&&t.locale!=="ko"&&(aa||S!=="onCompositionStart"?S==="onCompositionEnd"&&aa&&(C=Dv()):(Nr=u,Sp="value"in Nr?Nr.value:Nr.textContent,aa=!0)),H=cu(c,S),0<H.length&&(S=new Dg(S,n,null,t,u),d.push({event:S,listeners:H}),C?S.data=C:(C=Mv(t),C!==null&&(S.data=C)))),(C=xx?bx(n,t):Ix(n,t))&&(c=cu(c,"onBeforeInput"),0<c.length&&(u=new Dg("onBeforeInput","beforeinput",null,t,u),d.push({event:u,listeners:c}),u.data=C))}Wv(d,e)})}function Jo(n,e,t){return{instance:n,listener:e,currentTarget:t}}function cu(n,e){for(var t=e+"Capture",i=[];n!==null;){var r=n,s=r.stateNode;r.tag===5&&s!==null&&(r=s,s=zo(n,t),s!=null&&i.unshift(Jo(n,s,r)),s=zo(n,e),s!=null&&i.push(Jo(n,s,r))),n=n.return}return i}function Js(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function Hg(n,e,t,i,r){for(var s=e._reactName,a=[];t!==null&&t!==i;){var o=t,l=o.alternate,c=o.stateNode;if(l!==null&&l===i)break;o.tag===5&&c!==null&&(o=c,r?(l=zo(t,s),l!=null&&a.unshift(Jo(t,l,o))):r||(l=zo(t,s),l!=null&&a.push(Jo(t,l,o)))),t=t.return}a.length!==0&&n.push({event:e,listeners:a})}var $x=/\r\n?/g,Vx=/\u0000|\uFFFD/g;function zg(n){return(typeof n=="string"?n:""+n).replace($x,`
`).replace(Vx,"")}function ic(n,e,t){if(e=zg(e),zg(n)!==e&&t)throw Error(ye(425))}function uu(){}var sf=null,af=null;function of(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var lf=typeof setTimeout=="function"?setTimeout:void 0,jx=typeof clearTimeout=="function"?clearTimeout:void 0,Kg=typeof Promise=="function"?Promise:void 0,Gx=typeof queueMicrotask=="function"?queueMicrotask:typeof Kg<"u"?function(n){return Kg.resolve(null).then(n).catch(Hx)}:lf;function Hx(n){setTimeout(function(){throw n})}function Kd(n,e){var t=e,i=0;do{var r=t.nextSibling;if(n.removeChild(t),r&&r.nodeType===8)if(t=r.data,t==="/$"){if(i===0){n.removeChild(r),qo(e);return}i--}else t!=="$"&&t!=="$?"&&t!=="$!"||i++;t=r}while(t);qo(e)}function Vr(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function Wg(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var za=Math.random().toString(36).slice(2),Ii="__reactFiber$"+za,Zo="__reactProps$"+za,ir="__reactContainer$"+za,cf="__reactEvents$"+za,zx="__reactListeners$"+za,Kx="__reactHandles$"+za;function As(n){var e=n[Ii];if(e)return e;for(var t=n.parentNode;t;){if(e=t[ir]||t[Ii]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=Wg(n);n!==null;){if(t=n[Ii])return t;n=Wg(n)}return e}n=t,t=n.parentNode}return null}function Sl(n){return n=n[Ii]||n[ir],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function ca(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(ye(33))}function Qu(n){return n[Zo]||null}var uf=[],ua=-1;function ns(n){return{current:n}}function yt(n){0>ua||(n.current=uf[ua],uf[ua]=null,ua--)}function mt(n,e){ua++,uf[ua]=n.current,n.current=e}var Qr={},un=ns(Qr),In=ns(!1),Ds=Qr;function Da(n,e){var t=n.type.contextTypes;if(!t)return Qr;var i=n.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r={},s;for(s in t)r[s]=e[s];return i&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=r),r}function Rn(n){return n=n.childContextTypes,n!=null}function du(){yt(In),yt(un)}function qg(n,e,t){if(un.current!==Qr)throw Error(ye(168));mt(un,e),mt(In,t)}function Yv(n,e,t){var i=n.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return t;i=i.getChildContext();for(var r in i)if(!(r in e))throw Error(ye(108,CA(n)||"Unknown",r));return It({},t,i)}function hu(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Qr,Ds=un.current,mt(un,n),mt(In,In.current),!0}function Yg(n,e,t){var i=n.stateNode;if(!i)throw Error(ye(169));t?(n=Yv(n,e,Ds),i.__reactInternalMemoizedMergedChildContext=n,yt(In),yt(un),mt(un,n)):yt(In),mt(In,t)}var qi=null,Ju=!1,Wd=!1;function Xv(n){qi===null?qi=[n]:qi.push(n)}function Wx(n){Ju=!0,Xv(n)}function is(){if(!Wd&&qi!==null){Wd=!0;var n=0,e=lt;try{var t=qi;for(lt=1;n<t.length;n++){var i=t[n];do i=i(!0);while(i!==null)}qi=null,Ju=!1}catch(r){throw qi!==null&&(qi=qi.slice(n+1)),Sv(_p,is),r}finally{lt=e,Wd=!1}}return null}var da=[],ha=0,fu=null,pu=0,Gn=[],Hn=0,Ps=null,Xi=1,Qi="";function ys(n,e){da[ha++]=pu,da[ha++]=fu,fu=n,pu=e}function Qv(n,e,t){Gn[Hn++]=Xi,Gn[Hn++]=Qi,Gn[Hn++]=Ps,Ps=n;var i=Xi;n=Qi;var r=32-di(i)-1;i&=~(1<<r),t+=1;var s=32-di(e)+r;if(30<s){var a=r-r%5;s=(i&(1<<a)-1).toString(32),i>>=a,r-=a,Xi=1<<32-di(e)+r|t<<r|i,Qi=s+n}else Xi=1<<s|t<<r|i,Qi=n}function Ip(n){n.return!==null&&(ys(n,1),Qv(n,1,0))}function Rp(n){for(;n===fu;)fu=da[--ha],da[ha]=null,pu=da[--ha],da[ha]=null;for(;n===Ps;)Ps=Gn[--Hn],Gn[Hn]=null,Qi=Gn[--Hn],Gn[Hn]=null,Xi=Gn[--Hn],Gn[Hn]=null}var Pn=null,kn=null,Tt=!1,ai=null;function Jv(n,e){var t=zn(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function Xg(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,Pn=n,kn=Vr(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,Pn=n,kn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Ps!==null?{id:Xi,overflow:Qi}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=zn(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,Pn=n,kn=null,!0):!1;default:return!1}}function df(n){return(n.mode&1)!==0&&(n.flags&128)===0}function hf(n){if(Tt){var e=kn;if(e){var t=e;if(!Xg(n,e)){if(df(n))throw Error(ye(418));e=Vr(t.nextSibling);var i=Pn;e&&Xg(n,e)?Jv(i,t):(n.flags=n.flags&-4097|2,Tt=!1,Pn=n)}}else{if(df(n))throw Error(ye(418));n.flags=n.flags&-4097|2,Tt=!1,Pn=n}}}function Qg(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;Pn=n}function rc(n){if(n!==Pn)return!1;if(!Tt)return Qg(n),Tt=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!of(n.type,n.memoizedProps)),e&&(e=kn)){if(df(n))throw Zv(),Error(ye(418));for(;e;)Jv(n,e),e=Vr(e.nextSibling)}if(Qg(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(ye(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){kn=Vr(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}kn=null}}else kn=Pn?Vr(n.stateNode.nextSibling):null;return!0}function Zv(){for(var n=kn;n;)n=Vr(n.nextSibling)}function Pa(){kn=Pn=null,Tt=!1}function Lp(n){ai===null?ai=[n]:ai.push(n)}var qx=cr.ReactCurrentBatchConfig;function po(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(ye(309));var i=t.stateNode}if(!i)throw Error(ye(147,n));var r=i,s=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(a){var o=r.refs;a===null?delete o[s]:o[s]=a},e._stringRef=s,e)}if(typeof n!="string")throw Error(ye(284));if(!t._owner)throw Error(ye(290,n))}return n}function sc(n,e){throw n=Object.prototype.toString.call(e),Error(ye(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function Jg(n){var e=n._init;return e(n._payload)}function e1(n){function e(E,R){if(n){var k=E.deletions;k===null?(E.deletions=[R],E.flags|=16):k.push(R)}}function t(E,R){if(!n)return null;for(;R!==null;)e(E,R),R=R.sibling;return null}function i(E,R){for(E=new Map;R!==null;)R.key!==null?E.set(R.key,R):E.set(R.index,R),R=R.sibling;return E}function r(E,R){return E=zr(E,R),E.index=0,E.sibling=null,E}function s(E,R,k){return E.index=k,n?(k=E.alternate,k!==null?(k=k.index,k<R?(E.flags|=2,R):k):(E.flags|=2,R)):(E.flags|=1048576,R)}function a(E){return n&&E.alternate===null&&(E.flags|=2),E}function o(E,R,k,D){return R===null||R.tag!==6?(R=eh(k,E.mode,D),R.return=E,R):(R=r(R,k),R.return=E,R)}function l(E,R,k,D){var V=k.type;return V===sa?u(E,R,k.props.children,D,k.key):R!==null&&(R.elementType===V||typeof V=="object"&&V!==null&&V.$$typeof===Ir&&Jg(V)===R.type)?(D=r(R,k.props),D.ref=po(E,R,k),D.return=E,D):(D=$c(k.type,k.key,k.props,null,E.mode,D),D.ref=po(E,R,k),D.return=E,D)}function c(E,R,k,D){return R===null||R.tag!==4||R.stateNode.containerInfo!==k.containerInfo||R.stateNode.implementation!==k.implementation?(R=th(k,E.mode,D),R.return=E,R):(R=r(R,k.children||[]),R.return=E,R)}function u(E,R,k,D,V){return R===null||R.tag!==7?(R=Ls(k,E.mode,D,V),R.return=E,R):(R=r(R,k),R.return=E,R)}function d(E,R,k){if(typeof R=="string"&&R!==""||typeof R=="number")return R=eh(""+R,E.mode,k),R.return=E,R;if(typeof R=="object"&&R!==null){switch(R.$$typeof){case ql:return k=$c(R.type,R.key,R.props,null,E.mode,k),k.ref=po(E,null,R),k.return=E,k;case ra:return R=th(R,E.mode,k),R.return=E,R;case Ir:var D=R._init;return d(E,D(R._payload),k)}if(Eo(R)||lo(R))return R=Ls(R,E.mode,k,null),R.return=E,R;sc(E,R)}return null}function h(E,R,k,D){var V=R!==null?R.key:null;if(typeof k=="string"&&k!==""||typeof k=="number")return V!==null?null:o(E,R,""+k,D);if(typeof k=="object"&&k!==null){switch(k.$$typeof){case ql:return k.key===V?l(E,R,k,D):null;case ra:return k.key===V?c(E,R,k,D):null;case Ir:return V=k._init,h(E,R,V(k._payload),D)}if(Eo(k)||lo(k))return V!==null?null:u(E,R,k,D,null);sc(E,k)}return null}function m(E,R,k,D,V){if(typeof D=="string"&&D!==""||typeof D=="number")return E=E.get(k)||null,o(R,E,""+D,V);if(typeof D=="object"&&D!==null){switch(D.$$typeof){case ql:return E=E.get(D.key===null?k:D.key)||null,l(R,E,D,V);case ra:return E=E.get(D.key===null?k:D.key)||null,c(R,E,D,V);case Ir:var H=D._init;return m(E,R,k,H(D._payload),V)}if(Eo(D)||lo(D))return E=E.get(k)||null,u(R,E,D,V,null);sc(R,D)}return null}function g(E,R,k,D){for(var V=null,H=null,C=R,S=R=0,b=null;C!==null&&S<k.length;S++){C.index>S?(b=C,C=null):b=C.sibling;var T=h(E,C,k[S],D);if(T===null){C===null&&(C=b);break}n&&C&&T.alternate===null&&e(E,C),R=s(T,R,S),H===null?V=T:H.sibling=T,H=T,C=b}if(S===k.length)return t(E,C),Tt&&ys(E,S),V;if(C===null){for(;S<k.length;S++)C=d(E,k[S],D),C!==null&&(R=s(C,R,S),H===null?V=C:H.sibling=C,H=C);return Tt&&ys(E,S),V}for(C=i(E,C);S<k.length;S++)b=m(C,E,S,k[S],D),b!==null&&(n&&b.alternate!==null&&C.delete(b.key===null?S:b.key),R=s(b,R,S),H===null?V=b:H.sibling=b,H=b);return n&&C.forEach(function(L){return e(E,L)}),Tt&&ys(E,S),V}function v(E,R,k,D){var V=lo(k);if(typeof V!="function")throw Error(ye(150));if(k=V.call(k),k==null)throw Error(ye(151));for(var H=V=null,C=R,S=R=0,b=null,T=k.next();C!==null&&!T.done;S++,T=k.next()){C.index>S?(b=C,C=null):b=C.sibling;var L=h(E,C,T.value,D);if(L===null){C===null&&(C=b);break}n&&C&&L.alternate===null&&e(E,C),R=s(L,R,S),H===null?V=L:H.sibling=L,H=L,C=b}if(T.done)return t(E,C),Tt&&ys(E,S),V;if(C===null){for(;!T.done;S++,T=k.next())T=d(E,T.value,D),T!==null&&(R=s(T,R,S),H===null?V=T:H.sibling=T,H=T);return Tt&&ys(E,S),V}for(C=i(E,C);!T.done;S++,T=k.next())T=m(C,E,S,T.value,D),T!==null&&(n&&T.alternate!==null&&C.delete(T.key===null?S:T.key),R=s(T,R,S),H===null?V=T:H.sibling=T,H=T);return n&&C.forEach(function(F){return e(E,F)}),Tt&&ys(E,S),V}function x(E,R,k,D){if(typeof k=="object"&&k!==null&&k.type===sa&&k.key===null&&(k=k.props.children),typeof k=="object"&&k!==null){switch(k.$$typeof){case ql:e:{for(var V=k.key,H=R;H!==null;){if(H.key===V){if(V=k.type,V===sa){if(H.tag===7){t(E,H.sibling),R=r(H,k.props.children),R.return=E,E=R;break e}}else if(H.elementType===V||typeof V=="object"&&V!==null&&V.$$typeof===Ir&&Jg(V)===H.type){t(E,H.sibling),R=r(H,k.props),R.ref=po(E,H,k),R.return=E,E=R;break e}t(E,H);break}else e(E,H);H=H.sibling}k.type===sa?(R=Ls(k.props.children,E.mode,D,k.key),R.return=E,E=R):(D=$c(k.type,k.key,k.props,null,E.mode,D),D.ref=po(E,R,k),D.return=E,E=D)}return a(E);case ra:e:{for(H=k.key;R!==null;){if(R.key===H)if(R.tag===4&&R.stateNode.containerInfo===k.containerInfo&&R.stateNode.implementation===k.implementation){t(E,R.sibling),R=r(R,k.children||[]),R.return=E,E=R;break e}else{t(E,R);break}else e(E,R);R=R.sibling}R=th(k,E.mode,D),R.return=E,E=R}return a(E);case Ir:return H=k._init,x(E,R,H(k._payload),D)}if(Eo(k))return g(E,R,k,D);if(lo(k))return v(E,R,k,D);sc(E,k)}return typeof k=="string"&&k!==""||typeof k=="number"?(k=""+k,R!==null&&R.tag===6?(t(E,R.sibling),R=r(R,k),R.return=E,E=R):(t(E,R),R=eh(k,E.mode,D),R.return=E,E=R),a(E)):t(E,R)}return x}var Oa=e1(!0),t1=e1(!1),mu=ns(null),gu=null,fa=null,wp=null;function Cp(){wp=fa=gu=null}function kp(n){var e=mu.current;yt(mu),n._currentValue=e}function ff(n,e,t){for(;n!==null;){var i=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),n===t)break;n=n.return}}function Ta(n,e){gu=n,wp=fa=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(bn=!0),n.firstContext=null)}function qn(n){var e=n._currentValue;if(wp!==n)if(n={context:n,memoizedValue:e,next:null},fa===null){if(gu===null)throw Error(ye(308));fa=n,gu.dependencies={lanes:0,firstContext:n}}else fa=fa.next=n;return e}var xs=null;function Dp(n){xs===null?xs=[n]:xs.push(n)}function n1(n,e,t,i){var r=e.interleaved;return r===null?(t.next=t,Dp(e)):(t.next=r.next,r.next=t),e.interleaved=t,rr(n,i)}function rr(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var Rr=!1;function Pp(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function i1(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function er(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function jr(n,e,t){var i=n.updateQueue;if(i===null)return null;if(i=i.shared,tt&2){var r=i.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),i.pending=e,rr(n,t)}return r=i.interleaved,r===null?(e.next=e,Dp(i)):(e.next=r.next,r.next=e),i.interleaved=e,rr(n,t)}function Oc(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var i=e.lanes;i&=n.pendingLanes,t|=i,e.lanes=t,yp(n,t)}}function Zg(n,e){var t=n.updateQueue,i=n.alternate;if(i!==null&&(i=i.updateQueue,t===i)){var r=null,s=null;if(t=t.firstBaseUpdate,t!==null){do{var a={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};s===null?r=s=a:s=s.next=a,t=t.next}while(t!==null);s===null?r=s=e:s=s.next=e}else r=s=e;t={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function _u(n,e,t,i){var r=n.updateQueue;Rr=!1;var s=r.firstBaseUpdate,a=r.lastBaseUpdate,o=r.shared.pending;if(o!==null){r.shared.pending=null;var l=o,c=l.next;l.next=null,a===null?s=c:a.next=c,a=l;var u=n.alternate;u!==null&&(u=u.updateQueue,o=u.lastBaseUpdate,o!==a&&(o===null?u.firstBaseUpdate=c:o.next=c,u.lastBaseUpdate=l))}if(s!==null){var d=r.baseState;a=0,u=c=l=null,o=s;do{var h=o.lane,m=o.eventTime;if((i&h)===h){u!==null&&(u=u.next={eventTime:m,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var g=n,v=o;switch(h=e,m=t,v.tag){case 1:if(g=v.payload,typeof g=="function"){d=g.call(m,d,h);break e}d=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=v.payload,h=typeof g=="function"?g.call(m,d,h):g,h==null)break e;d=It({},d,h);break e;case 2:Rr=!0}}o.callback!==null&&o.lane!==0&&(n.flags|=64,h=r.effects,h===null?r.effects=[o]:h.push(o))}else m={eventTime:m,lane:h,tag:o.tag,payload:o.payload,callback:o.callback,next:null},u===null?(c=u=m,l=d):u=u.next=m,a|=h;if(o=o.next,o===null){if(o=r.shared.pending,o===null)break;h=o,o=h.next,h.next=null,r.lastBaseUpdate=h,r.shared.pending=null}}while(!0);if(u===null&&(l=d),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=u,e=r.shared.interleaved,e!==null){r=e;do a|=r.lane,r=r.next;while(r!==e)}else s===null&&(r.shared.lanes=0);Ms|=a,n.lanes=a,n.memoizedState=d}}function e0(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var i=n[e],r=i.callback;if(r!==null){if(i.callback=null,i=t,typeof r!="function")throw Error(ye(191,r));r.call(i)}}}var Tl={},Di=ns(Tl),el=ns(Tl),tl=ns(Tl);function bs(n){if(n===Tl)throw Error(ye(174));return n}function Op(n,e){switch(mt(tl,e),mt(el,n),mt(Di,Tl),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Kh(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=Kh(e,n)}yt(Di),mt(Di,e)}function Ma(){yt(Di),yt(el),yt(tl)}function r1(n){bs(tl.current);var e=bs(Di.current),t=Kh(e,n.type);e!==t&&(mt(el,n),mt(Di,t))}function Mp(n){el.current===n&&(yt(Di),yt(el))}var xt=ns(0);function yu(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var qd=[];function Np(){for(var n=0;n<qd.length;n++)qd[n]._workInProgressVersionPrimary=null;qd.length=0}var Mc=cr.ReactCurrentDispatcher,Yd=cr.ReactCurrentBatchConfig,Os=0,bt=null,zt=null,Qt=null,vu=!1,ko=!1,nl=0,Yx=0;function an(){throw Error(ye(321))}function Bp(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!fi(n[t],e[t]))return!1;return!0}function Fp(n,e,t,i,r,s){if(Os=s,bt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Mc.current=n===null||n.memoizedState===null?Zx:eb,n=t(i,r),ko){s=0;do{if(ko=!1,nl=0,25<=s)throw Error(ye(301));s+=1,Qt=zt=null,e.updateQueue=null,Mc.current=tb,n=t(i,r)}while(ko)}if(Mc.current=Eu,e=zt!==null&&zt.next!==null,Os=0,Qt=zt=bt=null,vu=!1,e)throw Error(ye(300));return n}function Up(){var n=nl!==0;return nl=0,n}function Si(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Qt===null?bt.memoizedState=Qt=n:Qt=Qt.next=n,Qt}function Yn(){if(zt===null){var n=bt.alternate;n=n!==null?n.memoizedState:null}else n=zt.next;var e=Qt===null?bt.memoizedState:Qt.next;if(e!==null)Qt=e,zt=n;else{if(n===null)throw Error(ye(310));zt=n,n={memoizedState:zt.memoizedState,baseState:zt.baseState,baseQueue:zt.baseQueue,queue:zt.queue,next:null},Qt===null?bt.memoizedState=Qt=n:Qt=Qt.next=n}return Qt}function il(n,e){return typeof e=="function"?e(n):e}function Xd(n){var e=Yn(),t=e.queue;if(t===null)throw Error(ye(311));t.lastRenderedReducer=n;var i=zt,r=i.baseQueue,s=t.pending;if(s!==null){if(r!==null){var a=r.next;r.next=s.next,s.next=a}i.baseQueue=r=s,t.pending=null}if(r!==null){s=r.next,i=i.baseState;var o=a=null,l=null,c=s;do{var u=c.lane;if((Os&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),i=c.hasEagerState?c.eagerState:n(i,c.action);else{var d={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(o=l=d,a=i):l=l.next=d,bt.lanes|=u,Ms|=u}c=c.next}while(c!==null&&c!==s);l===null?a=i:l.next=o,fi(i,e.memoizedState)||(bn=!0),e.memoizedState=i,e.baseState=a,e.baseQueue=l,t.lastRenderedState=i}if(n=t.interleaved,n!==null){r=n;do s=r.lane,bt.lanes|=s,Ms|=s,r=r.next;while(r!==n)}else r===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function Qd(n){var e=Yn(),t=e.queue;if(t===null)throw Error(ye(311));t.lastRenderedReducer=n;var i=t.dispatch,r=t.pending,s=e.memoizedState;if(r!==null){t.pending=null;var a=r=r.next;do s=n(s,a.action),a=a.next;while(a!==r);fi(s,e.memoizedState)||(bn=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),t.lastRenderedState=s}return[s,i]}function s1(){}function a1(n,e){var t=bt,i=Yn(),r=e(),s=!fi(i.memoizedState,r);if(s&&(i.memoizedState=r,bn=!0),i=i.queue,$p(c1.bind(null,t,i,n),[n]),i.getSnapshot!==e||s||Qt!==null&&Qt.memoizedState.tag&1){if(t.flags|=2048,rl(9,l1.bind(null,t,i,r,e),void 0,null),Jt===null)throw Error(ye(349));Os&30||o1(t,e,r)}return r}function o1(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=bt.updateQueue,e===null?(e={lastEffect:null,stores:null},bt.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function l1(n,e,t,i){e.value=t,e.getSnapshot=i,u1(e)&&d1(n)}function c1(n,e,t){return t(function(){u1(e)&&d1(n)})}function u1(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!fi(n,t)}catch{return!0}}function d1(n){var e=rr(n,1);e!==null&&hi(e,n,1,-1)}function t0(n){var e=Si();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:il,lastRenderedState:n},e.queue=n,n=n.dispatch=Jx.bind(null,bt,n),[e.memoizedState,n]}function rl(n,e,t,i){return n={tag:n,create:e,destroy:t,deps:i,next:null},e=bt.updateQueue,e===null?(e={lastEffect:null,stores:null},bt.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(i=t.next,t.next=n,n.next=i,e.lastEffect=n)),n}function h1(){return Yn().memoizedState}function Nc(n,e,t,i){var r=Si();bt.flags|=n,r.memoizedState=rl(1|e,t,void 0,i===void 0?null:i)}function Zu(n,e,t,i){var r=Yn();i=i===void 0?null:i;var s=void 0;if(zt!==null){var a=zt.memoizedState;if(s=a.destroy,i!==null&&Bp(i,a.deps)){r.memoizedState=rl(e,t,s,i);return}}bt.flags|=n,r.memoizedState=rl(1|e,t,s,i)}function n0(n,e){return Nc(8390656,8,n,e)}function $p(n,e){return Zu(2048,8,n,e)}function f1(n,e){return Zu(4,2,n,e)}function p1(n,e){return Zu(4,4,n,e)}function m1(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function g1(n,e,t){return t=t!=null?t.concat([n]):null,Zu(4,4,m1.bind(null,e,n),t)}function Vp(){}function _1(n,e){var t=Yn();e=e===void 0?null:e;var i=t.memoizedState;return i!==null&&e!==null&&Bp(e,i[1])?i[0]:(t.memoizedState=[n,e],n)}function y1(n,e){var t=Yn();e=e===void 0?null:e;var i=t.memoizedState;return i!==null&&e!==null&&Bp(e,i[1])?i[0]:(n=n(),t.memoizedState=[n,e],n)}function v1(n,e,t){return Os&21?(fi(t,e)||(t=xv(),bt.lanes|=t,Ms|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,bn=!0),n.memoizedState=t)}function Xx(n,e){var t=lt;lt=t!==0&&4>t?t:4,n(!0);var i=Yd.transition;Yd.transition={};try{n(!1),e()}finally{lt=t,Yd.transition=i}}function E1(){return Yn().memoizedState}function Qx(n,e,t){var i=Hr(n);if(t={lane:i,action:t,hasEagerState:!1,eagerState:null,next:null},S1(n))T1(e,t);else if(t=n1(n,e,t,i),t!==null){var r=_n();hi(t,n,i,r),A1(t,e,i)}}function Jx(n,e,t){var i=Hr(n),r={lane:i,action:t,hasEagerState:!1,eagerState:null,next:null};if(S1(n))T1(e,r);else{var s=n.alternate;if(n.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var a=e.lastRenderedState,o=s(a,t);if(r.hasEagerState=!0,r.eagerState=o,fi(o,a)){var l=e.interleaved;l===null?(r.next=r,Dp(e)):(r.next=l.next,l.next=r),e.interleaved=r;return}}catch{}finally{}t=n1(n,e,r,i),t!==null&&(r=_n(),hi(t,n,i,r),A1(t,e,i))}}function S1(n){var e=n.alternate;return n===bt||e!==null&&e===bt}function T1(n,e){ko=vu=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function A1(n,e,t){if(t&4194240){var i=e.lanes;i&=n.pendingLanes,t|=i,e.lanes=t,yp(n,t)}}var Eu={readContext:qn,useCallback:an,useContext:an,useEffect:an,useImperativeHandle:an,useInsertionEffect:an,useLayoutEffect:an,useMemo:an,useReducer:an,useRef:an,useState:an,useDebugValue:an,useDeferredValue:an,useTransition:an,useMutableSource:an,useSyncExternalStore:an,useId:an,unstable_isNewReconciler:!1},Zx={readContext:qn,useCallback:function(n,e){return Si().memoizedState=[n,e===void 0?null:e],n},useContext:qn,useEffect:n0,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,Nc(4194308,4,m1.bind(null,e,n),t)},useLayoutEffect:function(n,e){return Nc(4194308,4,n,e)},useInsertionEffect:function(n,e){return Nc(4,2,n,e)},useMemo:function(n,e){var t=Si();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var i=Si();return e=t!==void 0?t(e):e,i.memoizedState=i.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},i.queue=n,n=n.dispatch=Qx.bind(null,bt,n),[i.memoizedState,n]},useRef:function(n){var e=Si();return n={current:n},e.memoizedState=n},useState:t0,useDebugValue:Vp,useDeferredValue:function(n){return Si().memoizedState=n},useTransition:function(){var n=t0(!1),e=n[0];return n=Xx.bind(null,n[1]),Si().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var i=bt,r=Si();if(Tt){if(t===void 0)throw Error(ye(407));t=t()}else{if(t=e(),Jt===null)throw Error(ye(349));Os&30||o1(i,e,t)}r.memoizedState=t;var s={value:t,getSnapshot:e};return r.queue=s,n0(c1.bind(null,i,s,n),[n]),i.flags|=2048,rl(9,l1.bind(null,i,s,t,e),void 0,null),t},useId:function(){var n=Si(),e=Jt.identifierPrefix;if(Tt){var t=Qi,i=Xi;t=(i&~(1<<32-di(i)-1)).toString(32)+t,e=":"+e+"R"+t,t=nl++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=Yx++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},eb={readContext:qn,useCallback:_1,useContext:qn,useEffect:$p,useImperativeHandle:g1,useInsertionEffect:f1,useLayoutEffect:p1,useMemo:y1,useReducer:Xd,useRef:h1,useState:function(){return Xd(il)},useDebugValue:Vp,useDeferredValue:function(n){var e=Yn();return v1(e,zt.memoizedState,n)},useTransition:function(){var n=Xd(il)[0],e=Yn().memoizedState;return[n,e]},useMutableSource:s1,useSyncExternalStore:a1,useId:E1,unstable_isNewReconciler:!1},tb={readContext:qn,useCallback:_1,useContext:qn,useEffect:$p,useImperativeHandle:g1,useInsertionEffect:f1,useLayoutEffect:p1,useMemo:y1,useReducer:Qd,useRef:h1,useState:function(){return Qd(il)},useDebugValue:Vp,useDeferredValue:function(n){var e=Yn();return zt===null?e.memoizedState=n:v1(e,zt.memoizedState,n)},useTransition:function(){var n=Qd(il)[0],e=Yn().memoizedState;return[n,e]},useMutableSource:s1,useSyncExternalStore:a1,useId:E1,unstable_isNewReconciler:!1};function ii(n,e){if(n&&n.defaultProps){e=It({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function pf(n,e,t,i){e=n.memoizedState,t=t(i,e),t=t==null?e:It({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var ed={isMounted:function(n){return(n=n._reactInternals)?Gs(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var i=_n(),r=Hr(n),s=er(i,r);s.payload=e,t!=null&&(s.callback=t),e=jr(n,s,r),e!==null&&(hi(e,n,r,i),Oc(e,n,r))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var i=_n(),r=Hr(n),s=er(i,r);s.tag=1,s.payload=e,t!=null&&(s.callback=t),e=jr(n,s,r),e!==null&&(hi(e,n,r,i),Oc(e,n,r))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=_n(),i=Hr(n),r=er(t,i);r.tag=2,e!=null&&(r.callback=e),e=jr(n,r,i),e!==null&&(hi(e,n,i,t),Oc(e,n,i))}};function i0(n,e,t,i,r,s,a){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(i,s,a):e.prototype&&e.prototype.isPureReactComponent?!Xo(t,i)||!Xo(r,s):!0}function x1(n,e,t){var i=!1,r=Qr,s=e.contextType;return typeof s=="object"&&s!==null?s=qn(s):(r=Rn(e)?Ds:un.current,i=e.contextTypes,s=(i=i!=null)?Da(n,r):Qr),e=new e(t,s),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=ed,n.stateNode=e,e._reactInternals=n,i&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=r,n.__reactInternalMemoizedMaskedChildContext=s),e}function r0(n,e,t,i){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,i),e.state!==n&&ed.enqueueReplaceState(e,e.state,null)}function mf(n,e,t,i){var r=n.stateNode;r.props=t,r.state=n.memoizedState,r.refs={},Pp(n);var s=e.contextType;typeof s=="object"&&s!==null?r.context=qn(s):(s=Rn(e)?Ds:un.current,r.context=Da(n,s)),r.state=n.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(pf(n,e,s,t),r.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&ed.enqueueReplaceState(r,r.state,null),_u(n,t,r,i),r.state=n.memoizedState),typeof r.componentDidMount=="function"&&(n.flags|=4194308)}function Na(n,e){try{var t="",i=e;do t+=wA(i),i=i.return;while(i);var r=t}catch(s){r=`
Error generating stack: `+s.message+`
`+s.stack}return{value:n,source:e,stack:r,digest:null}}function Jd(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function gf(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var nb=typeof WeakMap=="function"?WeakMap:Map;function b1(n,e,t){t=er(-1,t),t.tag=3,t.payload={element:null};var i=e.value;return t.callback=function(){Tu||(Tu=!0,If=i),gf(n,e)},t}function I1(n,e,t){t=er(-1,t),t.tag=3;var i=n.type.getDerivedStateFromError;if(typeof i=="function"){var r=e.value;t.payload=function(){return i(r)},t.callback=function(){gf(n,e)}}var s=n.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(t.callback=function(){gf(n,e),typeof i!="function"&&(Gr===null?Gr=new Set([this]):Gr.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),t}function s0(n,e,t){var i=n.pingCache;if(i===null){i=n.pingCache=new nb;var r=new Set;i.set(e,r)}else r=i.get(e),r===void 0&&(r=new Set,i.set(e,r));r.has(t)||(r.add(t),n=gb.bind(null,n,e,t),e.then(n,n))}function a0(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function o0(n,e,t,i,r){return n.mode&1?(n.flags|=65536,n.lanes=r,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=er(-1,1),e.tag=2,jr(t,e,1))),t.lanes|=1),n)}var ib=cr.ReactCurrentOwner,bn=!1;function mn(n,e,t,i){e.child=n===null?t1(e,null,t,i):Oa(e,n.child,t,i)}function l0(n,e,t,i,r){t=t.render;var s=e.ref;return Ta(e,r),i=Fp(n,e,t,i,s,r),t=Up(),n!==null&&!bn?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~r,sr(n,e,r)):(Tt&&t&&Ip(e),e.flags|=1,mn(n,e,i,r),e.child)}function c0(n,e,t,i,r){if(n===null){var s=t.type;return typeof s=="function"&&!Yp(s)&&s.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=s,R1(n,e,s,i,r)):(n=$c(t.type,null,i,e,e.mode,r),n.ref=e.ref,n.return=e,e.child=n)}if(s=n.child,!(n.lanes&r)){var a=s.memoizedProps;if(t=t.compare,t=t!==null?t:Xo,t(a,i)&&n.ref===e.ref)return sr(n,e,r)}return e.flags|=1,n=zr(s,i),n.ref=e.ref,n.return=e,e.child=n}function R1(n,e,t,i,r){if(n!==null){var s=n.memoizedProps;if(Xo(s,i)&&n.ref===e.ref)if(bn=!1,e.pendingProps=i=s,(n.lanes&r)!==0)n.flags&131072&&(bn=!0);else return e.lanes=n.lanes,sr(n,e,r)}return _f(n,e,t,i,r)}function L1(n,e,t){var i=e.pendingProps,r=i.children,s=n!==null?n.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},mt(ma,wn),wn|=t;else{if(!(t&1073741824))return n=s!==null?s.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,mt(ma,wn),wn|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:t,mt(ma,wn),wn|=i}else s!==null?(i=s.baseLanes|t,e.memoizedState=null):i=t,mt(ma,wn),wn|=i;return mn(n,e,r,t),e.child}function w1(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function _f(n,e,t,i,r){var s=Rn(t)?Ds:un.current;return s=Da(e,s),Ta(e,r),t=Fp(n,e,t,i,s,r),i=Up(),n!==null&&!bn?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~r,sr(n,e,r)):(Tt&&i&&Ip(e),e.flags|=1,mn(n,e,t,r),e.child)}function u0(n,e,t,i,r){if(Rn(t)){var s=!0;hu(e)}else s=!1;if(Ta(e,r),e.stateNode===null)Bc(n,e),x1(e,t,i),mf(e,t,i,r),i=!0;else if(n===null){var a=e.stateNode,o=e.memoizedProps;a.props=o;var l=a.context,c=t.contextType;typeof c=="object"&&c!==null?c=qn(c):(c=Rn(t)?Ds:un.current,c=Da(e,c));var u=t.getDerivedStateFromProps,d=typeof u=="function"||typeof a.getSnapshotBeforeUpdate=="function";d||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==i||l!==c)&&r0(e,a,i,c),Rr=!1;var h=e.memoizedState;a.state=h,_u(e,i,a,r),l=e.memoizedState,o!==i||h!==l||In.current||Rr?(typeof u=="function"&&(pf(e,t,u,i),l=e.memoizedState),(o=Rr||i0(e,t,o,i,h,l,c))?(d||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=l),a.props=i,a.state=l,a.context=c,i=o):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{a=e.stateNode,i1(n,e),o=e.memoizedProps,c=e.type===e.elementType?o:ii(e.type,o),a.props=c,d=e.pendingProps,h=a.context,l=t.contextType,typeof l=="object"&&l!==null?l=qn(l):(l=Rn(t)?Ds:un.current,l=Da(e,l));var m=t.getDerivedStateFromProps;(u=typeof m=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==d||h!==l)&&r0(e,a,i,l),Rr=!1,h=e.memoizedState,a.state=h,_u(e,i,a,r);var g=e.memoizedState;o!==d||h!==g||In.current||Rr?(typeof m=="function"&&(pf(e,t,m,i),g=e.memoizedState),(c=Rr||i0(e,t,c,i,h,g,l)||!1)?(u||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(i,g,l),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(i,g,l)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||o===n.memoizedProps&&h===n.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===n.memoizedProps&&h===n.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=g),a.props=i,a.state=g,a.context=l,i=c):(typeof a.componentDidUpdate!="function"||o===n.memoizedProps&&h===n.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===n.memoizedProps&&h===n.memoizedState||(e.flags|=1024),i=!1)}return yf(n,e,t,i,s,r)}function yf(n,e,t,i,r,s){w1(n,e);var a=(e.flags&128)!==0;if(!i&&!a)return r&&Yg(e,t,!1),sr(n,e,s);i=e.stateNode,ib.current=e;var o=a&&typeof t.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,n!==null&&a?(e.child=Oa(e,n.child,null,s),e.child=Oa(e,null,o,s)):mn(n,e,o,s),e.memoizedState=i.state,r&&Yg(e,t,!0),e.child}function C1(n){var e=n.stateNode;e.pendingContext?qg(n,e.pendingContext,e.pendingContext!==e.context):e.context&&qg(n,e.context,!1),Op(n,e.containerInfo)}function d0(n,e,t,i,r){return Pa(),Lp(r),e.flags|=256,mn(n,e,t,i),e.child}var vf={dehydrated:null,treeContext:null,retryLane:0};function Ef(n){return{baseLanes:n,cachePool:null,transitions:null}}function k1(n,e,t){var i=e.pendingProps,r=xt.current,s=!1,a=(e.flags&128)!==0,o;if((o=a)||(o=n!==null&&n.memoizedState===null?!1:(r&2)!==0),o?(s=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(r|=1),mt(xt,r&1),n===null)return hf(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=i.children,n=i.fallback,s?(i=e.mode,s=e.child,a={mode:"hidden",children:a},!(i&1)&&s!==null?(s.childLanes=0,s.pendingProps=a):s=id(a,i,0,null),n=Ls(n,i,t,null),s.return=e,n.return=e,s.sibling=n,e.child=s,e.child.memoizedState=Ef(t),e.memoizedState=vf,n):jp(e,a));if(r=n.memoizedState,r!==null&&(o=r.dehydrated,o!==null))return rb(n,e,a,i,o,r,t);if(s){s=i.fallback,a=e.mode,r=n.child,o=r.sibling;var l={mode:"hidden",children:i.children};return!(a&1)&&e.child!==r?(i=e.child,i.childLanes=0,i.pendingProps=l,e.deletions=null):(i=zr(r,l),i.subtreeFlags=r.subtreeFlags&14680064),o!==null?s=zr(o,s):(s=Ls(s,a,t,null),s.flags|=2),s.return=e,i.return=e,i.sibling=s,e.child=i,i=s,s=e.child,a=n.child.memoizedState,a=a===null?Ef(t):{baseLanes:a.baseLanes|t,cachePool:null,transitions:a.transitions},s.memoizedState=a,s.childLanes=n.childLanes&~t,e.memoizedState=vf,i}return s=n.child,n=s.sibling,i=zr(s,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=t),i.return=e,i.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=i,e.memoizedState=null,i}function jp(n,e){return e=id({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function ac(n,e,t,i){return i!==null&&Lp(i),Oa(e,n.child,null,t),n=jp(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function rb(n,e,t,i,r,s,a){if(t)return e.flags&256?(e.flags&=-257,i=Jd(Error(ye(422))),ac(n,e,a,i)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(s=i.fallback,r=e.mode,i=id({mode:"visible",children:i.children},r,0,null),s=Ls(s,r,a,null),s.flags|=2,i.return=e,s.return=e,i.sibling=s,e.child=i,e.mode&1&&Oa(e,n.child,null,a),e.child.memoizedState=Ef(a),e.memoizedState=vf,s);if(!(e.mode&1))return ac(n,e,a,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var o=i.dgst;return i=o,s=Error(ye(419)),i=Jd(s,i,void 0),ac(n,e,a,i)}if(o=(a&n.childLanes)!==0,bn||o){if(i=Jt,i!==null){switch(a&-a){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(i.suspendedLanes|a)?0:r,r!==0&&r!==s.retryLane&&(s.retryLane=r,rr(n,r),hi(i,n,r,-1))}return qp(),i=Jd(Error(ye(421))),ac(n,e,a,i)}return r.data==="$?"?(e.flags|=128,e.child=n.child,e=_b.bind(null,n),r._reactRetry=e,null):(n=s.treeContext,kn=Vr(r.nextSibling),Pn=e,Tt=!0,ai=null,n!==null&&(Gn[Hn++]=Xi,Gn[Hn++]=Qi,Gn[Hn++]=Ps,Xi=n.id,Qi=n.overflow,Ps=e),e=jp(e,i.children),e.flags|=4096,e)}function h0(n,e,t){n.lanes|=e;var i=n.alternate;i!==null&&(i.lanes|=e),ff(n.return,e,t)}function Zd(n,e,t,i,r){var s=n.memoizedState;s===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:t,tailMode:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=t,s.tailMode=r)}function D1(n,e,t){var i=e.pendingProps,r=i.revealOrder,s=i.tail;if(mn(n,e,i.children,t),i=xt.current,i&2)i=i&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&h0(n,t,e);else if(n.tag===19)h0(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}i&=1}if(mt(xt,i),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(t=e.child,r=null;t!==null;)n=t.alternate,n!==null&&yu(n)===null&&(r=t),t=t.sibling;t=r,t===null?(r=e.child,e.child=null):(r=t.sibling,t.sibling=null),Zd(e,!1,r,t,s);break;case"backwards":for(t=null,r=e.child,e.child=null;r!==null;){if(n=r.alternate,n!==null&&yu(n)===null){e.child=r;break}n=r.sibling,r.sibling=t,t=r,r=n}Zd(e,!0,t,null,s);break;case"together":Zd(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Bc(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function sr(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),Ms|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(ye(153));if(e.child!==null){for(n=e.child,t=zr(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=zr(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function sb(n,e,t){switch(e.tag){case 3:C1(e),Pa();break;case 5:r1(e);break;case 1:Rn(e.type)&&hu(e);break;case 4:Op(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;mt(mu,i._currentValue),i._currentValue=r;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(mt(xt,xt.current&1),e.flags|=128,null):t&e.child.childLanes?k1(n,e,t):(mt(xt,xt.current&1),n=sr(n,e,t),n!==null?n.sibling:null);mt(xt,xt.current&1);break;case 19:if(i=(t&e.childLanes)!==0,n.flags&128){if(i)return D1(n,e,t);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),mt(xt,xt.current),i)break;return null;case 22:case 23:return e.lanes=0,L1(n,e,t)}return sr(n,e,t)}var P1,Sf,O1,M1;P1=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};Sf=function(){};O1=function(n,e,t,i){var r=n.memoizedProps;if(r!==i){n=e.stateNode,bs(Di.current);var s=null;switch(t){case"input":r=jh(n,r),i=jh(n,i),s=[];break;case"select":r=It({},r,{value:void 0}),i=It({},i,{value:void 0}),s=[];break;case"textarea":r=zh(n,r),i=zh(n,i),s=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(n.onclick=uu)}Wh(t,i);var a;t=null;for(c in r)if(!i.hasOwnProperty(c)&&r.hasOwnProperty(c)&&r[c]!=null)if(c==="style"){var o=r[c];for(a in o)o.hasOwnProperty(a)&&(t||(t={}),t[a]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(Go.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in i){var l=i[c];if(o=r!=null?r[c]:void 0,i.hasOwnProperty(c)&&l!==o&&(l!=null||o!=null))if(c==="style")if(o){for(a in o)!o.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(t||(t={}),t[a]="");for(a in l)l.hasOwnProperty(a)&&o[a]!==l[a]&&(t||(t={}),t[a]=l[a])}else t||(s||(s=[]),s.push(c,t)),t=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,o=o?o.__html:void 0,l!=null&&o!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(Go.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&_t("scroll",n),s||o===l||(s=[])):(s=s||[]).push(c,l))}t&&(s=s||[]).push("style",t);var c=s;(e.updateQueue=c)&&(e.flags|=4)}};M1=function(n,e,t,i){t!==i&&(e.flags|=4)};function mo(n,e){if(!Tt)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:i.sibling=null}}function on(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,i=0;if(e)for(var r=n.child;r!==null;)t|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=n,r=r.sibling;else for(r=n.child;r!==null;)t|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=n,r=r.sibling;return n.subtreeFlags|=i,n.childLanes=t,e}function ab(n,e,t){var i=e.pendingProps;switch(Rp(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return on(e),null;case 1:return Rn(e.type)&&du(),on(e),null;case 3:return i=e.stateNode,Ma(),yt(In),yt(un),Np(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(n===null||n.child===null)&&(rc(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,ai!==null&&(wf(ai),ai=null))),Sf(n,e),on(e),null;case 5:Mp(e);var r=bs(tl.current);if(t=e.type,n!==null&&e.stateNode!=null)O1(n,e,t,i,r),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(ye(166));return on(e),null}if(n=bs(Di.current),rc(e)){i=e.stateNode,t=e.type;var s=e.memoizedProps;switch(i[Ii]=e,i[Zo]=s,n=(e.mode&1)!==0,t){case"dialog":_t("cancel",i),_t("close",i);break;case"iframe":case"object":case"embed":_t("load",i);break;case"video":case"audio":for(r=0;r<To.length;r++)_t(To[r],i);break;case"source":_t("error",i);break;case"img":case"image":case"link":_t("error",i),_t("load",i);break;case"details":_t("toggle",i);break;case"input":Sg(i,s),_t("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},_t("invalid",i);break;case"textarea":Ag(i,s),_t("invalid",i)}Wh(t,s),r=null;for(var a in s)if(s.hasOwnProperty(a)){var o=s[a];a==="children"?typeof o=="string"?i.textContent!==o&&(s.suppressHydrationWarning!==!0&&ic(i.textContent,o,n),r=["children",o]):typeof o=="number"&&i.textContent!==""+o&&(s.suppressHydrationWarning!==!0&&ic(i.textContent,o,n),r=["children",""+o]):Go.hasOwnProperty(a)&&o!=null&&a==="onScroll"&&_t("scroll",i)}switch(t){case"input":Yl(i),Tg(i,s,!0);break;case"textarea":Yl(i),xg(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=uu)}i=r,e.updateQueue=i,i!==null&&(e.flags|=4)}else{a=r.nodeType===9?r:r.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=cv(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=a.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof i.is=="string"?n=a.createElement(t,{is:i.is}):(n=a.createElement(t),t==="select"&&(a=n,i.multiple?a.multiple=!0:i.size&&(a.size=i.size))):n=a.createElementNS(n,t),n[Ii]=e,n[Zo]=i,P1(n,e,!1,!1),e.stateNode=n;e:{switch(a=qh(t,i),t){case"dialog":_t("cancel",n),_t("close",n),r=i;break;case"iframe":case"object":case"embed":_t("load",n),r=i;break;case"video":case"audio":for(r=0;r<To.length;r++)_t(To[r],n);r=i;break;case"source":_t("error",n),r=i;break;case"img":case"image":case"link":_t("error",n),_t("load",n),r=i;break;case"details":_t("toggle",n),r=i;break;case"input":Sg(n,i),r=jh(n,i),_t("invalid",n);break;case"option":r=i;break;case"select":n._wrapperState={wasMultiple:!!i.multiple},r=It({},i,{value:void 0}),_t("invalid",n);break;case"textarea":Ag(n,i),r=zh(n,i),_t("invalid",n);break;default:r=i}Wh(t,r),o=r;for(s in o)if(o.hasOwnProperty(s)){var l=o[s];s==="style"?hv(n,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&uv(n,l)):s==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&Ho(n,l):typeof l=="number"&&Ho(n,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Go.hasOwnProperty(s)?l!=null&&s==="onScroll"&&_t("scroll",n):l!=null&&hp(n,s,l,a))}switch(t){case"input":Yl(n),Tg(n,i,!1);break;case"textarea":Yl(n),xg(n);break;case"option":i.value!=null&&n.setAttribute("value",""+Xr(i.value));break;case"select":n.multiple=!!i.multiple,s=i.value,s!=null?ya(n,!!i.multiple,s,!1):i.defaultValue!=null&&ya(n,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(n.onclick=uu)}switch(t){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return on(e),null;case 6:if(n&&e.stateNode!=null)M1(n,e,n.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(ye(166));if(t=bs(tl.current),bs(Di.current),rc(e)){if(i=e.stateNode,t=e.memoizedProps,i[Ii]=e,(s=i.nodeValue!==t)&&(n=Pn,n!==null))switch(n.tag){case 3:ic(i.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&ic(i.nodeValue,t,(n.mode&1)!==0)}s&&(e.flags|=4)}else i=(t.nodeType===9?t:t.ownerDocument).createTextNode(i),i[Ii]=e,e.stateNode=i}return on(e),null;case 13:if(yt(xt),i=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(Tt&&kn!==null&&e.mode&1&&!(e.flags&128))Zv(),Pa(),e.flags|=98560,s=!1;else if(s=rc(e),i!==null&&i.dehydrated!==null){if(n===null){if(!s)throw Error(ye(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(ye(317));s[Ii]=e}else Pa(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;on(e),s=!1}else ai!==null&&(wf(ai),ai=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(i=i!==null,i!==(n!==null&&n.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(n===null||xt.current&1?Wt===0&&(Wt=3):qp())),e.updateQueue!==null&&(e.flags|=4),on(e),null);case 4:return Ma(),Sf(n,e),n===null&&Qo(e.stateNode.containerInfo),on(e),null;case 10:return kp(e.type._context),on(e),null;case 17:return Rn(e.type)&&du(),on(e),null;case 19:if(yt(xt),s=e.memoizedState,s===null)return on(e),null;if(i=(e.flags&128)!==0,a=s.rendering,a===null)if(i)mo(s,!1);else{if(Wt!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(a=yu(n),a!==null){for(e.flags|=128,mo(s,!1),i=a.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=t,t=e.child;t!==null;)s=t,n=i,s.flags&=14680066,a=s.alternate,a===null?(s.childLanes=0,s.lanes=n,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=a.childLanes,s.lanes=a.lanes,s.child=a.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=a.memoizedProps,s.memoizedState=a.memoizedState,s.updateQueue=a.updateQueue,s.type=a.type,n=a.dependencies,s.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return mt(xt,xt.current&1|2),e.child}n=n.sibling}s.tail!==null&&Ot()>Ba&&(e.flags|=128,i=!0,mo(s,!1),e.lanes=4194304)}else{if(!i)if(n=yu(a),n!==null){if(e.flags|=128,i=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),mo(s,!0),s.tail===null&&s.tailMode==="hidden"&&!a.alternate&&!Tt)return on(e),null}else 2*Ot()-s.renderingStartTime>Ba&&t!==1073741824&&(e.flags|=128,i=!0,mo(s,!1),e.lanes=4194304);s.isBackwards?(a.sibling=e.child,e.child=a):(t=s.last,t!==null?t.sibling=a:e.child=a,s.last=a)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=Ot(),e.sibling=null,t=xt.current,mt(xt,i?t&1|2:t&1),e):(on(e),null);case 22:case 23:return Wp(),i=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?wn&1073741824&&(on(e),e.subtreeFlags&6&&(e.flags|=8192)):on(e),null;case 24:return null;case 25:return null}throw Error(ye(156,e.tag))}function ob(n,e){switch(Rp(e),e.tag){case 1:return Rn(e.type)&&du(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return Ma(),yt(In),yt(un),Np(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return Mp(e),null;case 13:if(yt(xt),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(ye(340));Pa()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return yt(xt),null;case 4:return Ma(),null;case 10:return kp(e.type._context),null;case 22:case 23:return Wp(),null;case 24:return null;default:return null}}var oc=!1,cn=!1,lb=typeof WeakSet=="function"?WeakSet:Set,we=null;function pa(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(i){Ct(n,e,i)}else t.current=null}function Tf(n,e,t){try{t()}catch(i){Ct(n,e,i)}}var f0=!1;function cb(n,e){if(sf=ou,n=$v(),bp(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var i=t.getSelection&&t.getSelection();if(i&&i.rangeCount!==0){t=i.anchorNode;var r=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{t.nodeType,s.nodeType}catch{t=null;break e}var a=0,o=-1,l=-1,c=0,u=0,d=n,h=null;t:for(;;){for(var m;d!==t||r!==0&&d.nodeType!==3||(o=a+r),d!==s||i!==0&&d.nodeType!==3||(l=a+i),d.nodeType===3&&(a+=d.nodeValue.length),(m=d.firstChild)!==null;)h=d,d=m;for(;;){if(d===n)break t;if(h===t&&++c===r&&(o=a),h===s&&++u===i&&(l=a),(m=d.nextSibling)!==null)break;d=h,h=d.parentNode}d=m}t=o===-1||l===-1?null:{start:o,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(af={focusedElem:n,selectionRange:t},ou=!1,we=e;we!==null;)if(e=we,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,we=n;else for(;we!==null;){e=we;try{var g=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var v=g.memoizedProps,x=g.memoizedState,E=e.stateNode,R=E.getSnapshotBeforeUpdate(e.elementType===e.type?v:ii(e.type,v),x);E.__reactInternalSnapshotBeforeUpdate=R}break;case 3:var k=e.stateNode.containerInfo;k.nodeType===1?k.textContent="":k.nodeType===9&&k.documentElement&&k.removeChild(k.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ye(163))}}catch(D){Ct(e,e.return,D)}if(n=e.sibling,n!==null){n.return=e.return,we=n;break}we=e.return}return g=f0,f0=!1,g}function Do(n,e,t){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&n)===n){var s=r.destroy;r.destroy=void 0,s!==void 0&&Tf(e,t,s)}r=r.next}while(r!==i)}}function td(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var i=t.create;t.destroy=i()}t=t.next}while(t!==e)}}function Af(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function N1(n){var e=n.alternate;e!==null&&(n.alternate=null,N1(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[Ii],delete e[Zo],delete e[cf],delete e[zx],delete e[Kx])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function B1(n){return n.tag===5||n.tag===3||n.tag===4}function p0(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||B1(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function xf(n,e,t){var i=n.tag;if(i===5||i===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=uu));else if(i!==4&&(n=n.child,n!==null))for(xf(n,e,t),n=n.sibling;n!==null;)xf(n,e,t),n=n.sibling}function bf(n,e,t){var i=n.tag;if(i===5||i===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(i!==4&&(n=n.child,n!==null))for(bf(n,e,t),n=n.sibling;n!==null;)bf(n,e,t),n=n.sibling}var en=null,si=!1;function Tr(n,e,t){for(t=t.child;t!==null;)F1(n,e,t),t=t.sibling}function F1(n,e,t){if(ki&&typeof ki.onCommitFiberUnmount=="function")try{ki.onCommitFiberUnmount(Wu,t)}catch{}switch(t.tag){case 5:cn||pa(t,e);case 6:var i=en,r=si;en=null,Tr(n,e,t),en=i,si=r,en!==null&&(si?(n=en,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):en.removeChild(t.stateNode));break;case 18:en!==null&&(si?(n=en,t=t.stateNode,n.nodeType===8?Kd(n.parentNode,t):n.nodeType===1&&Kd(n,t),qo(n)):Kd(en,t.stateNode));break;case 4:i=en,r=si,en=t.stateNode.containerInfo,si=!0,Tr(n,e,t),en=i,si=r;break;case 0:case 11:case 14:case 15:if(!cn&&(i=t.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var s=r,a=s.destroy;s=s.tag,a!==void 0&&(s&2||s&4)&&Tf(t,e,a),r=r.next}while(r!==i)}Tr(n,e,t);break;case 1:if(!cn&&(pa(t,e),i=t.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=t.memoizedProps,i.state=t.memoizedState,i.componentWillUnmount()}catch(o){Ct(t,e,o)}Tr(n,e,t);break;case 21:Tr(n,e,t);break;case 22:t.mode&1?(cn=(i=cn)||t.memoizedState!==null,Tr(n,e,t),cn=i):Tr(n,e,t);break;default:Tr(n,e,t)}}function m0(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new lb),e.forEach(function(i){var r=yb.bind(null,n,i);t.has(i)||(t.add(i),i.then(r,r))})}}function ti(n,e){var t=e.deletions;if(t!==null)for(var i=0;i<t.length;i++){var r=t[i];try{var s=n,a=e,o=a;e:for(;o!==null;){switch(o.tag){case 5:en=o.stateNode,si=!1;break e;case 3:en=o.stateNode.containerInfo,si=!0;break e;case 4:en=o.stateNode.containerInfo,si=!0;break e}o=o.return}if(en===null)throw Error(ye(160));F1(s,a,r),en=null,si=!1;var l=r.alternate;l!==null&&(l.return=null),r.return=null}catch(c){Ct(r,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)U1(e,n),e=e.sibling}function U1(n,e){var t=n.alternate,i=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(ti(e,n),yi(n),i&4){try{Do(3,n,n.return),td(3,n)}catch(v){Ct(n,n.return,v)}try{Do(5,n,n.return)}catch(v){Ct(n,n.return,v)}}break;case 1:ti(e,n),yi(n),i&512&&t!==null&&pa(t,t.return);break;case 5:if(ti(e,n),yi(n),i&512&&t!==null&&pa(t,t.return),n.flags&32){var r=n.stateNode;try{Ho(r,"")}catch(v){Ct(n,n.return,v)}}if(i&4&&(r=n.stateNode,r!=null)){var s=n.memoizedProps,a=t!==null?t.memoizedProps:s,o=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{o==="input"&&s.type==="radio"&&s.name!=null&&ov(r,s),qh(o,a);var c=qh(o,s);for(a=0;a<l.length;a+=2){var u=l[a],d=l[a+1];u==="style"?hv(r,d):u==="dangerouslySetInnerHTML"?uv(r,d):u==="children"?Ho(r,d):hp(r,u,d,c)}switch(o){case"input":Gh(r,s);break;case"textarea":lv(r,s);break;case"select":var h=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var m=s.value;m!=null?ya(r,!!s.multiple,m,!1):h!==!!s.multiple&&(s.defaultValue!=null?ya(r,!!s.multiple,s.defaultValue,!0):ya(r,!!s.multiple,s.multiple?[]:"",!1))}r[Zo]=s}catch(v){Ct(n,n.return,v)}}break;case 6:if(ti(e,n),yi(n),i&4){if(n.stateNode===null)throw Error(ye(162));r=n.stateNode,s=n.memoizedProps;try{r.nodeValue=s}catch(v){Ct(n,n.return,v)}}break;case 3:if(ti(e,n),yi(n),i&4&&t!==null&&t.memoizedState.isDehydrated)try{qo(e.containerInfo)}catch(v){Ct(n,n.return,v)}break;case 4:ti(e,n),yi(n);break;case 13:ti(e,n),yi(n),r=n.child,r.flags&8192&&(s=r.memoizedState!==null,r.stateNode.isHidden=s,!s||r.alternate!==null&&r.alternate.memoizedState!==null||(zp=Ot())),i&4&&m0(n);break;case 22:if(u=t!==null&&t.memoizedState!==null,n.mode&1?(cn=(c=cn)||u,ti(e,n),cn=c):ti(e,n),yi(n),i&8192){if(c=n.memoizedState!==null,(n.stateNode.isHidden=c)&&!u&&n.mode&1)for(we=n,u=n.child;u!==null;){for(d=we=u;we!==null;){switch(h=we,m=h.child,h.tag){case 0:case 11:case 14:case 15:Do(4,h,h.return);break;case 1:pa(h,h.return);var g=h.stateNode;if(typeof g.componentWillUnmount=="function"){i=h,t=h.return;try{e=i,g.props=e.memoizedProps,g.state=e.memoizedState,g.componentWillUnmount()}catch(v){Ct(i,t,v)}}break;case 5:pa(h,h.return);break;case 22:if(h.memoizedState!==null){_0(d);continue}}m!==null?(m.return=h,we=m):_0(d)}u=u.sibling}e:for(u=null,d=n;;){if(d.tag===5){if(u===null){u=d;try{r=d.stateNode,c?(s=r.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(o=d.stateNode,l=d.memoizedProps.style,a=l!=null&&l.hasOwnProperty("display")?l.display:null,o.style.display=dv("display",a))}catch(v){Ct(n,n.return,v)}}}else if(d.tag===6){if(u===null)try{d.stateNode.nodeValue=c?"":d.memoizedProps}catch(v){Ct(n,n.return,v)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===n)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===n)break e;for(;d.sibling===null;){if(d.return===null||d.return===n)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:ti(e,n),yi(n),i&4&&m0(n);break;case 21:break;default:ti(e,n),yi(n)}}function yi(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(B1(t)){var i=t;break e}t=t.return}throw Error(ye(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(Ho(r,""),i.flags&=-33);var s=p0(n);bf(n,s,r);break;case 3:case 4:var a=i.stateNode.containerInfo,o=p0(n);xf(n,o,a);break;default:throw Error(ye(161))}}catch(l){Ct(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function ub(n,e,t){we=n,$1(n)}function $1(n,e,t){for(var i=(n.mode&1)!==0;we!==null;){var r=we,s=r.child;if(r.tag===22&&i){var a=r.memoizedState!==null||oc;if(!a){var o=r.alternate,l=o!==null&&o.memoizedState!==null||cn;o=oc;var c=cn;if(oc=a,(cn=l)&&!c)for(we=r;we!==null;)a=we,l=a.child,a.tag===22&&a.memoizedState!==null?y0(r):l!==null?(l.return=a,we=l):y0(r);for(;s!==null;)we=s,$1(s),s=s.sibling;we=r,oc=o,cn=c}g0(n)}else r.subtreeFlags&8772&&s!==null?(s.return=r,we=s):g0(n)}}function g0(n){for(;we!==null;){var e=we;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:cn||td(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!cn)if(t===null)i.componentDidMount();else{var r=e.elementType===e.type?t.memoizedProps:ii(e.type,t.memoizedProps);i.componentDidUpdate(r,t.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&e0(e,s,i);break;case 3:var a=e.updateQueue;if(a!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}e0(e,a,t)}break;case 5:var o=e.stateNode;if(t===null&&e.flags&4){t=o;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var d=u.dehydrated;d!==null&&qo(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ye(163))}cn||e.flags&512&&Af(e)}catch(h){Ct(e,e.return,h)}}if(e===n){we=null;break}if(t=e.sibling,t!==null){t.return=e.return,we=t;break}we=e.return}}function _0(n){for(;we!==null;){var e=we;if(e===n){we=null;break}var t=e.sibling;if(t!==null){t.return=e.return,we=t;break}we=e.return}}function y0(n){for(;we!==null;){var e=we;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{td(4,e)}catch(l){Ct(e,t,l)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var r=e.return;try{i.componentDidMount()}catch(l){Ct(e,r,l)}}var s=e.return;try{Af(e)}catch(l){Ct(e,s,l)}break;case 5:var a=e.return;try{Af(e)}catch(l){Ct(e,a,l)}}}catch(l){Ct(e,e.return,l)}if(e===n){we=null;break}var o=e.sibling;if(o!==null){o.return=e.return,we=o;break}we=e.return}}var db=Math.ceil,Su=cr.ReactCurrentDispatcher,Gp=cr.ReactCurrentOwner,Wn=cr.ReactCurrentBatchConfig,tt=0,Jt=null,Ft=null,tn=0,wn=0,ma=ns(0),Wt=0,sl=null,Ms=0,nd=0,Hp=0,Po=null,An=null,zp=0,Ba=1/0,Hi=null,Tu=!1,If=null,Gr=null,lc=!1,Br=null,Au=0,Oo=0,Rf=null,Fc=-1,Uc=0;function _n(){return tt&6?Ot():Fc!==-1?Fc:Fc=Ot()}function Hr(n){return n.mode&1?tt&2&&tn!==0?tn&-tn:qx.transition!==null?(Uc===0&&(Uc=xv()),Uc):(n=lt,n!==0||(n=window.event,n=n===void 0?16:kv(n.type)),n):1}function hi(n,e,t,i){if(50<Oo)throw Oo=0,Rf=null,Error(ye(185));vl(n,t,i),(!(tt&2)||n!==Jt)&&(n===Jt&&(!(tt&2)&&(nd|=t),Wt===4&&kr(n,tn)),Ln(n,i),t===1&&tt===0&&!(e.mode&1)&&(Ba=Ot()+500,Ju&&is()))}function Ln(n,e){var t=n.callbackNode;qA(n,e);var i=au(n,n===Jt?tn:0);if(i===0)t!==null&&Rg(t),n.callbackNode=null,n.callbackPriority=0;else if(e=i&-i,n.callbackPriority!==e){if(t!=null&&Rg(t),e===1)n.tag===0?Wx(v0.bind(null,n)):Xv(v0.bind(null,n)),Gx(function(){!(tt&6)&&is()}),t=null;else{switch(bv(i)){case 1:t=_p;break;case 4:t=Tv;break;case 16:t=su;break;case 536870912:t=Av;break;default:t=su}t=q1(t,V1.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function V1(n,e){if(Fc=-1,Uc=0,tt&6)throw Error(ye(327));var t=n.callbackNode;if(Aa()&&n.callbackNode!==t)return null;var i=au(n,n===Jt?tn:0);if(i===0)return null;if(i&30||i&n.expiredLanes||e)e=xu(n,i);else{e=i;var r=tt;tt|=2;var s=G1();(Jt!==n||tn!==e)&&(Hi=null,Ba=Ot()+500,Rs(n,e));do try{pb();break}catch(o){j1(n,o)}while(!0);Cp(),Su.current=s,tt=r,Ft!==null?e=0:(Jt=null,tn=0,e=Wt)}if(e!==0){if(e===2&&(r=Zh(n),r!==0&&(i=r,e=Lf(n,r))),e===1)throw t=sl,Rs(n,0),kr(n,i),Ln(n,Ot()),t;if(e===6)kr(n,i);else{if(r=n.current.alternate,!(i&30)&&!hb(r)&&(e=xu(n,i),e===2&&(s=Zh(n),s!==0&&(i=s,e=Lf(n,s))),e===1))throw t=sl,Rs(n,0),kr(n,i),Ln(n,Ot()),t;switch(n.finishedWork=r,n.finishedLanes=i,e){case 0:case 1:throw Error(ye(345));case 2:vs(n,An,Hi);break;case 3:if(kr(n,i),(i&130023424)===i&&(e=zp+500-Ot(),10<e)){if(au(n,0)!==0)break;if(r=n.suspendedLanes,(r&i)!==i){_n(),n.pingedLanes|=n.suspendedLanes&r;break}n.timeoutHandle=lf(vs.bind(null,n,An,Hi),e);break}vs(n,An,Hi);break;case 4:if(kr(n,i),(i&4194240)===i)break;for(e=n.eventTimes,r=-1;0<i;){var a=31-di(i);s=1<<a,a=e[a],a>r&&(r=a),i&=~s}if(i=r,i=Ot()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*db(i/1960))-i,10<i){n.timeoutHandle=lf(vs.bind(null,n,An,Hi),i);break}vs(n,An,Hi);break;case 5:vs(n,An,Hi);break;default:throw Error(ye(329))}}}return Ln(n,Ot()),n.callbackNode===t?V1.bind(null,n):null}function Lf(n,e){var t=Po;return n.current.memoizedState.isDehydrated&&(Rs(n,e).flags|=256),n=xu(n,e),n!==2&&(e=An,An=t,e!==null&&wf(e)),n}function wf(n){An===null?An=n:An.push.apply(An,n)}function hb(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var i=0;i<t.length;i++){var r=t[i],s=r.getSnapshot;r=r.value;try{if(!fi(s(),r))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function kr(n,e){for(e&=~Hp,e&=~nd,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-di(e),i=1<<t;n[t]=-1,e&=~i}}function v0(n){if(tt&6)throw Error(ye(327));Aa();var e=au(n,0);if(!(e&1))return Ln(n,Ot()),null;var t=xu(n,e);if(n.tag!==0&&t===2){var i=Zh(n);i!==0&&(e=i,t=Lf(n,i))}if(t===1)throw t=sl,Rs(n,0),kr(n,e),Ln(n,Ot()),t;if(t===6)throw Error(ye(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,vs(n,An,Hi),Ln(n,Ot()),null}function Kp(n,e){var t=tt;tt|=1;try{return n(e)}finally{tt=t,tt===0&&(Ba=Ot()+500,Ju&&is())}}function Ns(n){Br!==null&&Br.tag===0&&!(tt&6)&&Aa();var e=tt;tt|=1;var t=Wn.transition,i=lt;try{if(Wn.transition=null,lt=1,n)return n()}finally{lt=i,Wn.transition=t,tt=e,!(tt&6)&&is()}}function Wp(){wn=ma.current,yt(ma)}function Rs(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,jx(t)),Ft!==null)for(t=Ft.return;t!==null;){var i=t;switch(Rp(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&du();break;case 3:Ma(),yt(In),yt(un),Np();break;case 5:Mp(i);break;case 4:Ma();break;case 13:yt(xt);break;case 19:yt(xt);break;case 10:kp(i.type._context);break;case 22:case 23:Wp()}t=t.return}if(Jt=n,Ft=n=zr(n.current,null),tn=wn=e,Wt=0,sl=null,Hp=nd=Ms=0,An=Po=null,xs!==null){for(e=0;e<xs.length;e++)if(t=xs[e],i=t.interleaved,i!==null){t.interleaved=null;var r=i.next,s=t.pending;if(s!==null){var a=s.next;s.next=r,i.next=a}t.pending=i}xs=null}return n}function j1(n,e){do{var t=Ft;try{if(Cp(),Mc.current=Eu,vu){for(var i=bt.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}vu=!1}if(Os=0,Qt=zt=bt=null,ko=!1,nl=0,Gp.current=null,t===null||t.return===null){Wt=1,sl=e,Ft=null;break}e:{var s=n,a=t.return,o=t,l=e;if(e=tn,o.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=o,d=u.tag;if(!(u.mode&1)&&(d===0||d===11||d===15)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var m=a0(a);if(m!==null){m.flags&=-257,o0(m,a,o,s,e),m.mode&1&&s0(s,c,e),e=m,l=c;var g=e.updateQueue;if(g===null){var v=new Set;v.add(l),e.updateQueue=v}else g.add(l);break e}else{if(!(e&1)){s0(s,c,e),qp();break e}l=Error(ye(426))}}else if(Tt&&o.mode&1){var x=a0(a);if(x!==null){!(x.flags&65536)&&(x.flags|=256),o0(x,a,o,s,e),Lp(Na(l,o));break e}}s=l=Na(l,o),Wt!==4&&(Wt=2),Po===null?Po=[s]:Po.push(s),s=a;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var E=b1(s,l,e);Zg(s,E);break e;case 1:o=l;var R=s.type,k=s.stateNode;if(!(s.flags&128)&&(typeof R.getDerivedStateFromError=="function"||k!==null&&typeof k.componentDidCatch=="function"&&(Gr===null||!Gr.has(k)))){s.flags|=65536,e&=-e,s.lanes|=e;var D=I1(s,o,e);Zg(s,D);break e}}s=s.return}while(s!==null)}z1(t)}catch(V){e=V,Ft===t&&t!==null&&(Ft=t=t.return);continue}break}while(!0)}function G1(){var n=Su.current;return Su.current=Eu,n===null?Eu:n}function qp(){(Wt===0||Wt===3||Wt===2)&&(Wt=4),Jt===null||!(Ms&268435455)&&!(nd&268435455)||kr(Jt,tn)}function xu(n,e){var t=tt;tt|=2;var i=G1();(Jt!==n||tn!==e)&&(Hi=null,Rs(n,e));do try{fb();break}catch(r){j1(n,r)}while(!0);if(Cp(),tt=t,Su.current=i,Ft!==null)throw Error(ye(261));return Jt=null,tn=0,Wt}function fb(){for(;Ft!==null;)H1(Ft)}function pb(){for(;Ft!==null&&!UA();)H1(Ft)}function H1(n){var e=W1(n.alternate,n,wn);n.memoizedProps=n.pendingProps,e===null?z1(n):Ft=e,Gp.current=null}function z1(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=ob(t,e),t!==null){t.flags&=32767,Ft=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{Wt=6,Ft=null;return}}else if(t=ab(t,e,wn),t!==null){Ft=t;return}if(e=e.sibling,e!==null){Ft=e;return}Ft=e=n}while(e!==null);Wt===0&&(Wt=5)}function vs(n,e,t){var i=lt,r=Wn.transition;try{Wn.transition=null,lt=1,mb(n,e,t,i)}finally{Wn.transition=r,lt=i}return null}function mb(n,e,t,i){do Aa();while(Br!==null);if(tt&6)throw Error(ye(327));t=n.finishedWork;var r=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(ye(177));n.callbackNode=null,n.callbackPriority=0;var s=t.lanes|t.childLanes;if(YA(n,s),n===Jt&&(Ft=Jt=null,tn=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||lc||(lc=!0,q1(su,function(){return Aa(),null})),s=(t.flags&15990)!==0,t.subtreeFlags&15990||s){s=Wn.transition,Wn.transition=null;var a=lt;lt=1;var o=tt;tt|=4,Gp.current=null,cb(n,t),U1(t,n),Mx(af),ou=!!sf,af=sf=null,n.current=t,ub(t),$A(),tt=o,lt=a,Wn.transition=s}else n.current=t;if(lc&&(lc=!1,Br=n,Au=r),s=n.pendingLanes,s===0&&(Gr=null),GA(t.stateNode),Ln(n,Ot()),e!==null)for(i=n.onRecoverableError,t=0;t<e.length;t++)r=e[t],i(r.value,{componentStack:r.stack,digest:r.digest});if(Tu)throw Tu=!1,n=If,If=null,n;return Au&1&&n.tag!==0&&Aa(),s=n.pendingLanes,s&1?n===Rf?Oo++:(Oo=0,Rf=n):Oo=0,is(),null}function Aa(){if(Br!==null){var n=bv(Au),e=Wn.transition,t=lt;try{if(Wn.transition=null,lt=16>n?16:n,Br===null)var i=!1;else{if(n=Br,Br=null,Au=0,tt&6)throw Error(ye(331));var r=tt;for(tt|=4,we=n.current;we!==null;){var s=we,a=s.child;if(we.flags&16){var o=s.deletions;if(o!==null){for(var l=0;l<o.length;l++){var c=o[l];for(we=c;we!==null;){var u=we;switch(u.tag){case 0:case 11:case 15:Do(8,u,s)}var d=u.child;if(d!==null)d.return=u,we=d;else for(;we!==null;){u=we;var h=u.sibling,m=u.return;if(N1(u),u===c){we=null;break}if(h!==null){h.return=m,we=h;break}we=m}}}var g=s.alternate;if(g!==null){var v=g.child;if(v!==null){g.child=null;do{var x=v.sibling;v.sibling=null,v=x}while(v!==null)}}we=s}}if(s.subtreeFlags&2064&&a!==null)a.return=s,we=a;else e:for(;we!==null;){if(s=we,s.flags&2048)switch(s.tag){case 0:case 11:case 15:Do(9,s,s.return)}var E=s.sibling;if(E!==null){E.return=s.return,we=E;break e}we=s.return}}var R=n.current;for(we=R;we!==null;){a=we;var k=a.child;if(a.subtreeFlags&2064&&k!==null)k.return=a,we=k;else e:for(a=R;we!==null;){if(o=we,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:td(9,o)}}catch(V){Ct(o,o.return,V)}if(o===a){we=null;break e}var D=o.sibling;if(D!==null){D.return=o.return,we=D;break e}we=o.return}}if(tt=r,is(),ki&&typeof ki.onPostCommitFiberRoot=="function")try{ki.onPostCommitFiberRoot(Wu,n)}catch{}i=!0}return i}finally{lt=t,Wn.transition=e}}return!1}function E0(n,e,t){e=Na(t,e),e=b1(n,e,1),n=jr(n,e,1),e=_n(),n!==null&&(vl(n,1,e),Ln(n,e))}function Ct(n,e,t){if(n.tag===3)E0(n,n,t);else for(;e!==null;){if(e.tag===3){E0(e,n,t);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(Gr===null||!Gr.has(i))){n=Na(t,n),n=I1(e,n,1),e=jr(e,n,1),n=_n(),e!==null&&(vl(e,1,n),Ln(e,n));break}}e=e.return}}function gb(n,e,t){var i=n.pingCache;i!==null&&i.delete(e),e=_n(),n.pingedLanes|=n.suspendedLanes&t,Jt===n&&(tn&t)===t&&(Wt===4||Wt===3&&(tn&130023424)===tn&&500>Ot()-zp?Rs(n,0):Hp|=t),Ln(n,e)}function K1(n,e){e===0&&(n.mode&1?(e=Jl,Jl<<=1,!(Jl&130023424)&&(Jl=4194304)):e=1);var t=_n();n=rr(n,e),n!==null&&(vl(n,e,t),Ln(n,t))}function _b(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),K1(n,t)}function yb(n,e){var t=0;switch(n.tag){case 13:var i=n.stateNode,r=n.memoizedState;r!==null&&(t=r.retryLane);break;case 19:i=n.stateNode;break;default:throw Error(ye(314))}i!==null&&i.delete(e),K1(n,t)}var W1;W1=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||In.current)bn=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return bn=!1,sb(n,e,t);bn=!!(n.flags&131072)}else bn=!1,Tt&&e.flags&1048576&&Qv(e,pu,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;Bc(n,e),n=e.pendingProps;var r=Da(e,un.current);Ta(e,t),r=Fp(null,e,i,n,r,t);var s=Up();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Rn(i)?(s=!0,hu(e)):s=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,Pp(e),r.updater=ed,e.stateNode=r,r._reactInternals=e,mf(e,i,n,t),e=yf(null,e,i,!0,s,t)):(e.tag=0,Tt&&s&&Ip(e),mn(null,e,r,t),e=e.child),e;case 16:i=e.elementType;e:{switch(Bc(n,e),n=e.pendingProps,r=i._init,i=r(i._payload),e.type=i,r=e.tag=Eb(i),n=ii(i,n),r){case 0:e=_f(null,e,i,n,t);break e;case 1:e=u0(null,e,i,n,t);break e;case 11:e=l0(null,e,i,n,t);break e;case 14:e=c0(null,e,i,ii(i.type,n),t);break e}throw Error(ye(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:ii(i,r),_f(n,e,i,r,t);case 1:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:ii(i,r),u0(n,e,i,r,t);case 3:e:{if(C1(e),n===null)throw Error(ye(387));i=e.pendingProps,s=e.memoizedState,r=s.element,i1(n,e),_u(e,i,null,t);var a=e.memoizedState;if(i=a.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){r=Na(Error(ye(423)),e),e=d0(n,e,i,t,r);break e}else if(i!==r){r=Na(Error(ye(424)),e),e=d0(n,e,i,t,r);break e}else for(kn=Vr(e.stateNode.containerInfo.firstChild),Pn=e,Tt=!0,ai=null,t=t1(e,null,i,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(Pa(),i===r){e=sr(n,e,t);break e}mn(n,e,i,t)}e=e.child}return e;case 5:return r1(e),n===null&&hf(e),i=e.type,r=e.pendingProps,s=n!==null?n.memoizedProps:null,a=r.children,of(i,r)?a=null:s!==null&&of(i,s)&&(e.flags|=32),w1(n,e),mn(n,e,a,t),e.child;case 6:return n===null&&hf(e),null;case 13:return k1(n,e,t);case 4:return Op(e,e.stateNode.containerInfo),i=e.pendingProps,n===null?e.child=Oa(e,null,i,t):mn(n,e,i,t),e.child;case 11:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:ii(i,r),l0(n,e,i,r,t);case 7:return mn(n,e,e.pendingProps,t),e.child;case 8:return mn(n,e,e.pendingProps.children,t),e.child;case 12:return mn(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(i=e.type._context,r=e.pendingProps,s=e.memoizedProps,a=r.value,mt(mu,i._currentValue),i._currentValue=a,s!==null)if(fi(s.value,a)){if(s.children===r.children&&!In.current){e=sr(n,e,t);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var o=s.dependencies;if(o!==null){a=s.child;for(var l=o.firstContext;l!==null;){if(l.context===i){if(s.tag===1){l=er(-1,t&-t),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}s.lanes|=t,l=s.alternate,l!==null&&(l.lanes|=t),ff(s.return,t,e),o.lanes|=t;break}l=l.next}}else if(s.tag===10)a=s.type===e.type?null:s.child;else if(s.tag===18){if(a=s.return,a===null)throw Error(ye(341));a.lanes|=t,o=a.alternate,o!==null&&(o.lanes|=t),ff(a,t,e),a=s.sibling}else a=s.child;if(a!==null)a.return=s;else for(a=s;a!==null;){if(a===e){a=null;break}if(s=a.sibling,s!==null){s.return=a.return,a=s;break}a=a.return}s=a}mn(n,e,r.children,t),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,Ta(e,t),r=qn(r),i=i(r),e.flags|=1,mn(n,e,i,t),e.child;case 14:return i=e.type,r=ii(i,e.pendingProps),r=ii(i.type,r),c0(n,e,i,r,t);case 15:return R1(n,e,e.type,e.pendingProps,t);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:ii(i,r),Bc(n,e),e.tag=1,Rn(i)?(n=!0,hu(e)):n=!1,Ta(e,t),x1(e,i,r),mf(e,i,r,t),yf(null,e,i,!0,n,t);case 19:return D1(n,e,t);case 22:return L1(n,e,t)}throw Error(ye(156,e.tag))};function q1(n,e){return Sv(n,e)}function vb(n,e,t,i){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function zn(n,e,t,i){return new vb(n,e,t,i)}function Yp(n){return n=n.prototype,!(!n||!n.isReactComponent)}function Eb(n){if(typeof n=="function")return Yp(n)?1:0;if(n!=null){if(n=n.$$typeof,n===pp)return 11;if(n===mp)return 14}return 2}function zr(n,e){var t=n.alternate;return t===null?(t=zn(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function $c(n,e,t,i,r,s){var a=2;if(i=n,typeof n=="function")Yp(n)&&(a=1);else if(typeof n=="string")a=5;else e:switch(n){case sa:return Ls(t.children,r,s,e);case fp:a=8,r|=8;break;case Fh:return n=zn(12,t,e,r|2),n.elementType=Fh,n.lanes=s,n;case Uh:return n=zn(13,t,e,r),n.elementType=Uh,n.lanes=s,n;case $h:return n=zn(19,t,e,r),n.elementType=$h,n.lanes=s,n;case rv:return id(t,r,s,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case nv:a=10;break e;case iv:a=9;break e;case pp:a=11;break e;case mp:a=14;break e;case Ir:a=16,i=null;break e}throw Error(ye(130,n==null?n:typeof n,""))}return e=zn(a,t,e,r),e.elementType=n,e.type=i,e.lanes=s,e}function Ls(n,e,t,i){return n=zn(7,n,i,e),n.lanes=t,n}function id(n,e,t,i){return n=zn(22,n,i,e),n.elementType=rv,n.lanes=t,n.stateNode={isHidden:!1},n}function eh(n,e,t){return n=zn(6,n,null,e),n.lanes=t,n}function th(n,e,t){return e=zn(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function Sb(n,e,t,i,r){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Md(0),this.expirationTimes=Md(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Md(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Xp(n,e,t,i,r,s,a,o,l){return n=new Sb(n,e,t,o,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=zn(3,null,null,e),n.current=s,s.stateNode=n,s.memoizedState={element:i,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},Pp(s),n}function Tb(n,e,t){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ra,key:i==null?null:""+i,children:n,containerInfo:e,implementation:t}}function Y1(n){if(!n)return Qr;n=n._reactInternals;e:{if(Gs(n)!==n||n.tag!==1)throw Error(ye(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Rn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(ye(171))}if(n.tag===1){var t=n.type;if(Rn(t))return Yv(n,t,e)}return e}function X1(n,e,t,i,r,s,a,o,l){return n=Xp(t,i,!0,n,r,s,a,o,l),n.context=Y1(null),t=n.current,i=_n(),r=Hr(t),s=er(i,r),s.callback=e??null,jr(t,s,r),n.current.lanes=r,vl(n,r,i),Ln(n,i),n}function rd(n,e,t,i){var r=e.current,s=_n(),a=Hr(r);return t=Y1(t),e.context===null?e.context=t:e.pendingContext=t,e=er(s,a),e.payload={element:n},i=i===void 0?null:i,i!==null&&(e.callback=i),n=jr(r,e,a),n!==null&&(hi(n,r,a,s),Oc(n,r,a)),a}function bu(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function S0(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function Qp(n,e){S0(n,e),(n=n.alternate)&&S0(n,e)}function Ab(){return null}var Q1=typeof reportError=="function"?reportError:function(n){console.error(n)};function Jp(n){this._internalRoot=n}sd.prototype.render=Jp.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(ye(409));rd(n,e,null,null)};sd.prototype.unmount=Jp.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;Ns(function(){rd(null,n,null,null)}),e[ir]=null}};function sd(n){this._internalRoot=n}sd.prototype.unstable_scheduleHydration=function(n){if(n){var e=Lv();n={blockedOn:null,target:n,priority:e};for(var t=0;t<Cr.length&&e!==0&&e<Cr[t].priority;t++);Cr.splice(t,0,n),t===0&&Cv(n)}};function Zp(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function ad(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function T0(){}function xb(n,e,t,i,r){if(r){if(typeof i=="function"){var s=i;i=function(){var c=bu(a);s.call(c)}}var a=X1(e,i,n,0,null,!1,!1,"",T0);return n._reactRootContainer=a,n[ir]=a.current,Qo(n.nodeType===8?n.parentNode:n),Ns(),a}for(;r=n.lastChild;)n.removeChild(r);if(typeof i=="function"){var o=i;i=function(){var c=bu(l);o.call(c)}}var l=Xp(n,0,!1,null,null,!1,!1,"",T0);return n._reactRootContainer=l,n[ir]=l.current,Qo(n.nodeType===8?n.parentNode:n),Ns(function(){rd(e,l,t,i)}),l}function od(n,e,t,i,r){var s=t._reactRootContainer;if(s){var a=s;if(typeof r=="function"){var o=r;r=function(){var l=bu(a);o.call(l)}}rd(e,a,n,r)}else a=xb(t,e,n,r,i);return bu(a)}Iv=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=So(e.pendingLanes);t!==0&&(yp(e,t|1),Ln(e,Ot()),!(tt&6)&&(Ba=Ot()+500,is()))}break;case 13:Ns(function(){var i=rr(n,1);if(i!==null){var r=_n();hi(i,n,1,r)}}),Qp(n,1)}};vp=function(n){if(n.tag===13){var e=rr(n,134217728);if(e!==null){var t=_n();hi(e,n,134217728,t)}Qp(n,134217728)}};Rv=function(n){if(n.tag===13){var e=Hr(n),t=rr(n,e);if(t!==null){var i=_n();hi(t,n,e,i)}Qp(n,e)}};Lv=function(){return lt};wv=function(n,e){var t=lt;try{return lt=n,e()}finally{lt=t}};Xh=function(n,e,t){switch(e){case"input":if(Gh(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var i=t[e];if(i!==n&&i.form===n.form){var r=Qu(i);if(!r)throw Error(ye(90));av(i),Gh(i,r)}}}break;case"textarea":lv(n,t);break;case"select":e=t.value,e!=null&&ya(n,!!t.multiple,e,!1)}};mv=Kp;gv=Ns;var bb={usingClientEntryPoint:!1,Events:[Sl,ca,Qu,fv,pv,Kp]},go={findFiberByHostInstance:As,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Ib={bundleType:go.bundleType,version:go.version,rendererPackageName:go.rendererPackageName,rendererConfig:go.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:cr.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=vv(n),n===null?null:n.stateNode},findFiberByHostInstance:go.findFiberByHostInstance||Ab,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var cc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!cc.isDisabled&&cc.supportsFiber)try{Wu=cc.inject(Ib),ki=cc}catch{}}Nn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=bb;Nn.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Zp(e))throw Error(ye(200));return Tb(n,e,null,t)};Nn.createRoot=function(n,e){if(!Zp(n))throw Error(ye(299));var t=!1,i="",r=Q1;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=Xp(n,1,!1,null,null,t,!1,i,r),n[ir]=e.current,Qo(n.nodeType===8?n.parentNode:n),new Jp(e)};Nn.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(ye(188)):(n=Object.keys(n).join(","),Error(ye(268,n)));return n=vv(e),n=n===null?null:n.stateNode,n};Nn.flushSync=function(n){return Ns(n)};Nn.hydrate=function(n,e,t){if(!ad(e))throw Error(ye(200));return od(null,n,e,!0,t)};Nn.hydrateRoot=function(n,e,t){if(!Zp(n))throw Error(ye(405));var i=t!=null&&t.hydratedSources||null,r=!1,s="",a=Q1;if(t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),e=X1(e,null,n,1,t??null,r,!1,s,a),n[ir]=e.current,Qo(n),i)for(n=0;n<i.length;n++)t=i[n],r=t._getVersion,r=r(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,r]:e.mutableSourceEagerHydrationData.push(t,r);return new sd(e)};Nn.render=function(n,e,t){if(!ad(e))throw Error(ye(200));return od(null,n,e,!1,t)};Nn.unmountComponentAtNode=function(n){if(!ad(n))throw Error(ye(40));return n._reactRootContainer?(Ns(function(){od(null,null,n,!1,function(){n._reactRootContainer=null,n[ir]=null})}),!0):!1};Nn.unstable_batchedUpdates=Kp;Nn.unstable_renderSubtreeIntoContainer=function(n,e,t,i){if(!ad(t))throw Error(ye(200));if(n==null||n._reactInternals===void 0)throw Error(ye(38));return od(n,e,t,!1,i)};Nn.version="18.3.1-next-f1338f8080-20240426";function J1(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(J1)}catch(n){console.error(n)}}J1(),Jy.exports=Nn;var Rb=Jy.exports,A0=Rb;Nh.createRoot=A0.createRoot,Nh.hydrateRoot=A0.hydrateRoot;/**
 * react-router v7.8.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var x0="popstate";function Lb(n={}){function e(i,r){let{pathname:s,search:a,hash:o}=i.location;return Cf("",{pathname:s,search:a,hash:o},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function t(i,r){return typeof r=="string"?r:al(r)}return Cb(e,t,null,n)}function qt(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function Mi(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function wb(){return Math.random().toString(36).substring(2,10)}function b0(n,e){return{usr:n.state,key:n.key,idx:e}}function Cf(n,e,t=null,i){return{pathname:typeof n=="string"?n:n.pathname,search:"",hash:"",...typeof e=="string"?Al(e):e,state:t,key:e&&e.key||i||wb()}}function al({pathname:n="/",search:e="",hash:t=""}){return e&&e!=="?"&&(n+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(n+=t.charAt(0)==="#"?t:"#"+t),n}function Al(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substring(t),n=n.substring(0,t));let i=n.indexOf("?");i>=0&&(e.search=n.substring(i),n=n.substring(0,i)),n&&(e.pathname=n)}return e}function Cb(n,e,t,i={}){let{window:r=document.defaultView,v5Compat:s=!1}=i,a=r.history,o="POP",l=null,c=u();c==null&&(c=0,a.replaceState({...a.state,idx:c},""));function u(){return(a.state||{idx:null}).idx}function d(){o="POP";let x=u(),E=x==null?null:x-c;c=x,l&&l({action:o,location:v.location,delta:E})}function h(x,E){o="PUSH";let R=Cf(v.location,x,E);c=u()+1;let k=b0(R,c),D=v.createHref(R);try{a.pushState(k,"",D)}catch(V){if(V instanceof DOMException&&V.name==="DataCloneError")throw V;r.location.assign(D)}s&&l&&l({action:o,location:v.location,delta:1})}function m(x,E){o="REPLACE";let R=Cf(v.location,x,E);c=u();let k=b0(R,c),D=v.createHref(R);a.replaceState(k,"",D),s&&l&&l({action:o,location:v.location,delta:0})}function g(x){return kb(x)}let v={get action(){return o},get location(){return n(r,a)},listen(x){if(l)throw new Error("A history only accepts one active listener");return r.addEventListener(x0,d),l=x,()=>{r.removeEventListener(x0,d),l=null}},createHref(x){return e(r,x)},createURL:g,encodeLocation(x){let E=g(x);return{pathname:E.pathname,search:E.search,hash:E.hash}},push:h,replace:m,go(x){return a.go(x)}};return v}function kb(n,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),qt(t,"No window.location.(origin|href) available to create URL");let i=typeof n=="string"?n:al(n);return i=i.replace(/ $/,"%20"),!e&&i.startsWith("//")&&(i=t+i),new URL(i,t)}function Z1(n,e,t="/"){return Db(n,e,t,!1)}function Db(n,e,t,i){let r=typeof e=="string"?Al(e):e,s=ar(r.pathname||"/",t);if(s==null)return null;let a=eE(n);Pb(a);let o=null;for(let l=0;o==null&&l<a.length;++l){let c=Hb(s);o=jb(a[l],c,i)}return o}function eE(n,e=[],t=[],i=""){let r=(s,a,o)=>{let l={relativePath:o===void 0?s.path||"":o,caseSensitive:s.caseSensitive===!0,childrenIndex:a,route:s};l.relativePath.startsWith("/")&&(qt(l.relativePath.startsWith(i),`Absolute route path "${l.relativePath}" nested under path "${i}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),l.relativePath=l.relativePath.slice(i.length));let c=tr([i,l.relativePath]),u=t.concat(l);s.children&&s.children.length>0&&(qt(s.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${c}".`),eE(s.children,e,u,c)),!(s.path==null&&!s.index)&&e.push({path:c,score:$b(c,s.index),routesMeta:u})};return n.forEach((s,a)=>{var o;if(s.path===""||!((o=s.path)!=null&&o.includes("?")))r(s,a);else for(let l of tE(s.path))r(s,a,l)}),e}function tE(n){let e=n.split("/");if(e.length===0)return[];let[t,...i]=e,r=t.endsWith("?"),s=t.replace(/\?$/,"");if(i.length===0)return r?[s,""]:[s];let a=tE(i.join("/")),o=[];return o.push(...a.map(l=>l===""?s:[s,l].join("/"))),r&&o.push(...a),o.map(l=>n.startsWith("/")&&l===""?"/":l)}function Pb(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:Vb(e.routesMeta.map(i=>i.childrenIndex),t.routesMeta.map(i=>i.childrenIndex)))}var Ob=/^:[\w-]+$/,Mb=3,Nb=2,Bb=1,Fb=10,Ub=-2,I0=n=>n==="*";function $b(n,e){let t=n.split("/"),i=t.length;return t.some(I0)&&(i+=Ub),e&&(i+=Nb),t.filter(r=>!I0(r)).reduce((r,s)=>r+(Ob.test(s)?Mb:s===""?Bb:Fb),i)}function Vb(n,e){return n.length===e.length&&n.slice(0,-1).every((i,r)=>i===e[r])?n[n.length-1]-e[e.length-1]:0}function jb(n,e,t=!1){let{routesMeta:i}=n,r={},s="/",a=[];for(let o=0;o<i.length;++o){let l=i[o],c=o===i.length-1,u=s==="/"?e:e.slice(s.length)||"/",d=Iu({path:l.relativePath,caseSensitive:l.caseSensitive,end:c},u),h=l.route;if(!d&&c&&t&&!i[i.length-1].route.index&&(d=Iu({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},u)),!d)return null;Object.assign(r,d.params),a.push({params:r,pathname:tr([s,d.pathname]),pathnameBase:qb(tr([s,d.pathnameBase])),route:h}),d.pathnameBase!=="/"&&(s=tr([s,d.pathnameBase]))}return a}function Iu(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,i]=Gb(n.path,n.caseSensitive,n.end),r=e.match(t);if(!r)return null;let s=r[0],a=s.replace(/(.)\/+$/,"$1"),o=r.slice(1);return{params:i.reduce((c,{paramName:u,isOptional:d},h)=>{if(u==="*"){let g=o[h]||"";a=s.slice(0,s.length-g.length).replace(/(.)\/+$/,"$1")}const m=o[h];return d&&!m?c[u]=void 0:c[u]=(m||"").replace(/%2F/g,"/"),c},{}),pathname:s,pathnameBase:a,pattern:n}}function Gb(n,e=!1,t=!0){Mi(n==="*"||!n.endsWith("*")||n.endsWith("/*"),`Route path "${n}" will be treated as if it were "${n.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${n.replace(/\*$/,"/*")}".`);let i=[],r="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,o,l)=>(i.push({paramName:o,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(i.push({paramName:"*"}),r+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?r+="\\/*$":n!==""&&n!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,e?void 0:"i"),i]}function Hb(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Mi(!1,`The URL path "${n}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),n}}function ar(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,i=n.charAt(t);return i&&i!=="/"?null:n.slice(t)||"/"}function zb(n,e="/"){let{pathname:t,search:i="",hash:r=""}=typeof n=="string"?Al(n):n;return{pathname:t?t.startsWith("/")?t:Kb(t,e):e,search:Yb(i),hash:Xb(r)}}function Kb(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(r=>{r===".."?t.length>1&&t.pop():r!=="."&&t.push(r)}),t.length>1?t.join("/"):"/"}function nh(n,e,t,i){return`Cannot include a '${n}' character in a manually specified \`to.${e}\` field [${JSON.stringify(i)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function Wb(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function nE(n){let e=Wb(n);return e.map((t,i)=>i===e.length-1?t.pathname:t.pathnameBase)}function iE(n,e,t,i=!1){let r;typeof n=="string"?r=Al(n):(r={...n},qt(!r.pathname||!r.pathname.includes("?"),nh("?","pathname","search",r)),qt(!r.pathname||!r.pathname.includes("#"),nh("#","pathname","hash",r)),qt(!r.search||!r.search.includes("#"),nh("#","search","hash",r)));let s=n===""||r.pathname==="",a=s?"/":r.pathname,o;if(a==null)o=t;else{let d=e.length-1;if(!i&&a.startsWith("..")){let h=a.split("/");for(;h[0]==="..";)h.shift(),d-=1;r.pathname=h.join("/")}o=d>=0?e[d]:"/"}let l=zb(r,o),c=a&&a!=="/"&&a.endsWith("/"),u=(s||a===".")&&t.endsWith("/");return!l.pathname.endsWith("/")&&(c||u)&&(l.pathname+="/"),l}var tr=n=>n.join("/").replace(/\/\/+/g,"/"),qb=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),Yb=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,Xb=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function Qb(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}var rE=["POST","PUT","PATCH","DELETE"];new Set(rE);var Jb=["GET",...rE];new Set(Jb);var Ka=ae.createContext(null);Ka.displayName="DataRouter";var ld=ae.createContext(null);ld.displayName="DataRouterState";ae.createContext(!1);var sE=ae.createContext({isTransitioning:!1});sE.displayName="ViewTransition";var Zb=ae.createContext(new Map);Zb.displayName="Fetchers";var eI=ae.createContext(null);eI.displayName="Await";var Fi=ae.createContext(null);Fi.displayName="Navigation";var cd=ae.createContext(null);cd.displayName="Location";var ur=ae.createContext({outlet:null,matches:[],isDataRoute:!1});ur.displayName="Route";var em=ae.createContext(null);em.displayName="RouteError";function tI(n,{relative:e}={}){qt(xl(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:i}=ae.useContext(Fi),{hash:r,pathname:s,search:a}=bl(n,{relative:e}),o=s;return t!=="/"&&(o=s==="/"?t:tr([t,s])),i.createHref({pathname:o,search:a,hash:r})}function xl(){return ae.useContext(cd)!=null}function Hs(){return qt(xl(),"useLocation() may be used only in the context of a <Router> component."),ae.useContext(cd).location}var aE="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function oE(n){ae.useContext(Fi).static||ae.useLayoutEffect(n)}function nI(){let{isDataRoute:n}=ae.useContext(ur);return n?mI():iI()}function iI(){qt(xl(),"useNavigate() may be used only in the context of a <Router> component.");let n=ae.useContext(Ka),{basename:e,navigator:t}=ae.useContext(Fi),{matches:i}=ae.useContext(ur),{pathname:r}=Hs(),s=JSON.stringify(nE(i)),a=ae.useRef(!1);return oE(()=>{a.current=!0}),ae.useCallback((l,c={})=>{if(Mi(a.current,aE),!a.current)return;if(typeof l=="number"){t.go(l);return}let u=iE(l,JSON.parse(s),r,c.relative==="path");n==null&&e!=="/"&&(u.pathname=u.pathname==="/"?e:tr([e,u.pathname])),(c.replace?t.replace:t.push)(u,c.state,c)},[e,t,s,r,n])}ae.createContext(null);function bl(n,{relative:e}={}){let{matches:t}=ae.useContext(ur),{pathname:i}=Hs(),r=JSON.stringify(nE(t));return ae.useMemo(()=>iE(n,JSON.parse(r),i,e==="path"),[n,r,i,e])}function rI(n,e,t,i){qt(xl(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:r}=ae.useContext(Fi),{matches:s}=ae.useContext(ur),a=s[s.length-1],o=a?a.params:{},l=a?a.pathname:"/",c=a?a.pathnameBase:"/",u=a&&a.route;{let E=u&&u.path||"";lE(l,!u||E.endsWith("*")||E.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${l}" (under <Route path="${E}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${E}"> to <Route path="${E==="/"?"*":`${E}/*`}">.`)}let d=Hs(),h;h=d;let m=h.pathname||"/",g=m;if(c!=="/"){let E=c.replace(/^\//,"").split("/");g="/"+m.replace(/^\//,"").split("/").slice(E.length).join("/")}let v=Z1(n,{pathname:g});return Mi(u||v!=null,`No routes matched location "${h.pathname}${h.search}${h.hash}" `),Mi(v==null||v[v.length-1].route.element!==void 0||v[v.length-1].route.Component!==void 0||v[v.length-1].route.lazy!==void 0,`Matched leaf route at location "${h.pathname}${h.search}${h.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`),cI(v&&v.map(E=>Object.assign({},E,{params:Object.assign({},o,E.params),pathname:tr([c,r.encodeLocation?r.encodeLocation(E.pathname).pathname:E.pathname]),pathnameBase:E.pathnameBase==="/"?c:tr([c,r.encodeLocation?r.encodeLocation(E.pathnameBase).pathname:E.pathnameBase])})),s,t,i)}function sI(){let n=pI(),e=Qb(n)?`${n.status} ${n.statusText}`:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,i="rgba(200,200,200, 0.5)",r={padding:"0.5rem",backgroundColor:i},s={padding:"2px 4px",backgroundColor:i},a=null;return console.error("Error handled by React Router default ErrorBoundary:",n),a=ae.createElement(ae.Fragment,null,ae.createElement("p",null,"💿 Hey developer 👋"),ae.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",ae.createElement("code",{style:s},"ErrorBoundary")," or"," ",ae.createElement("code",{style:s},"errorElement")," prop on your route.")),ae.createElement(ae.Fragment,null,ae.createElement("h2",null,"Unexpected Application Error!"),ae.createElement("h3",{style:{fontStyle:"italic"}},e),t?ae.createElement("pre",{style:r},t):null,a)}var aI=ae.createElement(sI,null),oI=class extends ae.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,e){return e.location!==n.location||e.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:e.error,location:e.location,revalidation:n.revalidation||e.revalidation}}componentDidCatch(n,e){console.error("React Router caught the following error during render",n,e)}render(){return this.state.error!==void 0?ae.createElement(ur.Provider,{value:this.props.routeContext},ae.createElement(em.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function lI({routeContext:n,match:e,children:t}){let i=ae.useContext(Ka);return i&&i.static&&i.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=e.route.id),ae.createElement(ur.Provider,{value:n},t)}function cI(n,e=[],t=null,i=null){if(n==null){if(!t)return null;if(t.errors)n=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let r=n,s=t==null?void 0:t.errors;if(s!=null){let l=r.findIndex(c=>c.route.id&&(s==null?void 0:s[c.route.id])!==void 0);qt(l>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(s).join(",")}`),r=r.slice(0,Math.min(r.length,l+1))}let a=!1,o=-1;if(t)for(let l=0;l<r.length;l++){let c=r[l];if((c.route.HydrateFallback||c.route.hydrateFallbackElement)&&(o=l),c.route.id){let{loaderData:u,errors:d}=t,h=c.route.loader&&!u.hasOwnProperty(c.route.id)&&(!d||d[c.route.id]===void 0);if(c.route.lazy||h){a=!0,o>=0?r=r.slice(0,o+1):r=[r[0]];break}}}return r.reduceRight((l,c,u)=>{let d,h=!1,m=null,g=null;t&&(d=s&&c.route.id?s[c.route.id]:void 0,m=c.route.errorElement||aI,a&&(o<0&&u===0?(lE("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),h=!0,g=null):o===u&&(h=!0,g=c.route.hydrateFallbackElement||null)));let v=e.concat(r.slice(0,u+1)),x=()=>{let E;return d?E=m:h?E=g:c.route.Component?E=ae.createElement(c.route.Component,null):c.route.element?E=c.route.element:E=l,ae.createElement(lI,{match:c,routeContext:{outlet:l,matches:v,isDataRoute:t!=null},children:E})};return t&&(c.route.ErrorBoundary||c.route.errorElement||u===0)?ae.createElement(oI,{location:t.location,revalidation:t.revalidation,component:m,error:d,children:x(),routeContext:{outlet:null,matches:v,isDataRoute:!0}}):x()},null)}function tm(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function uI(n){let e=ae.useContext(Ka);return qt(e,tm(n)),e}function dI(n){let e=ae.useContext(ld);return qt(e,tm(n)),e}function hI(n){let e=ae.useContext(ur);return qt(e,tm(n)),e}function nm(n){let e=hI(n),t=e.matches[e.matches.length-1];return qt(t.route.id,`${n} can only be used on routes that contain a unique "id"`),t.route.id}function fI(){return nm("useRouteId")}function pI(){var i;let n=ae.useContext(em),e=dI("useRouteError"),t=nm("useRouteError");return n!==void 0?n:(i=e.errors)==null?void 0:i[t]}function mI(){let{router:n}=uI("useNavigate"),e=nm("useNavigate"),t=ae.useRef(!1);return oE(()=>{t.current=!0}),ae.useCallback(async(r,s={})=>{Mi(t.current,aE),t.current&&(typeof r=="number"?n.navigate(r):await n.navigate(r,{fromRouteId:e,...s}))},[n,e])}var R0={};function lE(n,e,t){!e&&!R0[n]&&(R0[n]=!0,Mi(!1,t))}ae.memo(gI);function gI({routes:n,future:e,state:t}){return rI(n,void 0,t,e)}function _I({basename:n="/",children:e=null,location:t,navigationType:i="POP",navigator:r,static:s=!1}){qt(!xl(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let a=n.replace(/^\/*/,"/"),o=ae.useMemo(()=>({basename:a,navigator:r,static:s,future:{}}),[a,r,s]);typeof t=="string"&&(t=Al(t));let{pathname:l="/",search:c="",hash:u="",state:d=null,key:h="default"}=t,m=ae.useMemo(()=>{let g=ar(l,a);return g==null?null:{location:{pathname:g,search:c,hash:u,state:d,key:h},navigationType:i}},[a,l,c,u,d,h,i]);return Mi(m!=null,`<Router basename="${a}"> is not able to match the URL "${l}${c}${u}" because it does not start with the basename, so the <Router> won't render anything.`),m==null?null:ae.createElement(Fi.Provider,{value:o},ae.createElement(cd.Provider,{children:e,value:m}))}var Vc="get",jc="application/x-www-form-urlencoded";function ud(n){return n!=null&&typeof n.tagName=="string"}function yI(n){return ud(n)&&n.tagName.toLowerCase()==="button"}function vI(n){return ud(n)&&n.tagName.toLowerCase()==="form"}function EI(n){return ud(n)&&n.tagName.toLowerCase()==="input"}function SI(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function TI(n,e){return n.button===0&&(!e||e==="_self")&&!SI(n)}var uc=null;function AI(){if(uc===null)try{new FormData(document.createElement("form"),0),uc=!1}catch{uc=!0}return uc}var xI=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function ih(n){return n!=null&&!xI.has(n)?(Mi(!1,`"${n}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${jc}"`),null):n}function bI(n,e){let t,i,r,s,a;if(vI(n)){let o=n.getAttribute("action");i=o?ar(o,e):null,t=n.getAttribute("method")||Vc,r=ih(n.getAttribute("enctype"))||jc,s=new FormData(n)}else if(yI(n)||EI(n)&&(n.type==="submit"||n.type==="image")){let o=n.form;if(o==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let l=n.getAttribute("formaction")||o.getAttribute("action");if(i=l?ar(l,e):null,t=n.getAttribute("formmethod")||o.getAttribute("method")||Vc,r=ih(n.getAttribute("formenctype"))||ih(o.getAttribute("enctype"))||jc,s=new FormData(o,n),!AI()){let{name:c,type:u,value:d}=n;if(u==="image"){let h=c?`${c}.`:"";s.append(`${h}x`,"0"),s.append(`${h}y`,"0")}else c&&s.append(c,d)}}else{if(ud(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=Vc,i=null,r=jc,a=n}return s&&r==="text/plain"&&(a=s,s=void 0),{action:i,method:t.toLowerCase(),encType:r,formData:s,body:a}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function im(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function II(n,e,t){let i=typeof n=="string"?new URL(n,typeof window>"u"?"server://singlefetch/":window.location.origin):n;return i.pathname==="/"?i.pathname=`_root.${t}`:e&&ar(i.pathname,e)==="/"?i.pathname=`${e.replace(/\/$/,"")}/_root.${t}`:i.pathname=`${i.pathname.replace(/\/$/,"")}.${t}`,i}async function RI(n,e){if(n.id in e)return e[n.id];try{let t=await import(n.module);return e[n.id]=t,t}catch(t){return console.error(`Error loading route module \`${n.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function LI(n){return n==null?!1:n.href==null?n.rel==="preload"&&typeof n.imageSrcSet=="string"&&typeof n.imageSizes=="string":typeof n.rel=="string"&&typeof n.href=="string"}async function wI(n,e,t){let i=await Promise.all(n.map(async r=>{let s=e.routes[r.route.id];if(s){let a=await RI(s,t);return a.links?a.links():[]}return[]}));return PI(i.flat(1).filter(LI).filter(r=>r.rel==="stylesheet"||r.rel==="preload").map(r=>r.rel==="stylesheet"?{...r,rel:"prefetch",as:"style"}:{...r,rel:"prefetch"}))}function L0(n,e,t,i,r,s){let a=(l,c)=>t[c]?l.route.id!==t[c].route.id:!0,o=(l,c)=>{var u;return t[c].pathname!==l.pathname||((u=t[c].route.path)==null?void 0:u.endsWith("*"))&&t[c].params["*"]!==l.params["*"]};return s==="assets"?e.filter((l,c)=>a(l,c)||o(l,c)):s==="data"?e.filter((l,c)=>{var d;let u=i.routes[l.route.id];if(!u||!u.hasLoader)return!1;if(a(l,c)||o(l,c))return!0;if(l.route.shouldRevalidate){let h=l.route.shouldRevalidate({currentUrl:new URL(r.pathname+r.search+r.hash,window.origin),currentParams:((d=t[0])==null?void 0:d.params)||{},nextUrl:new URL(n,window.origin),nextParams:l.params,defaultShouldRevalidate:!0});if(typeof h=="boolean")return h}return!0}):[]}function CI(n,e,{includeHydrateFallback:t}={}){return kI(n.map(i=>{let r=e.routes[i.route.id];if(!r)return[];let s=[r.module];return r.clientActionModule&&(s=s.concat(r.clientActionModule)),r.clientLoaderModule&&(s=s.concat(r.clientLoaderModule)),t&&r.hydrateFallbackModule&&(s=s.concat(r.hydrateFallbackModule)),r.imports&&(s=s.concat(r.imports)),s}).flat(1))}function kI(n){return[...new Set(n)]}function DI(n){let e={},t=Object.keys(n).sort();for(let i of t)e[i]=n[i];return e}function PI(n,e){let t=new Set;return new Set(e),n.reduce((i,r)=>{let s=JSON.stringify(DI(r));return t.has(s)||(t.add(s),i.push({key:s,link:r})),i},[])}function cE(){let n=ae.useContext(Ka);return im(n,"You must render this element inside a <DataRouterContext.Provider> element"),n}function OI(){let n=ae.useContext(ld);return im(n,"You must render this element inside a <DataRouterStateContext.Provider> element"),n}var rm=ae.createContext(void 0);rm.displayName="FrameworkContext";function uE(){let n=ae.useContext(rm);return im(n,"You must render this element inside a <HydratedRouter> element"),n}function MI(n,e){let t=ae.useContext(rm),[i,r]=ae.useState(!1),[s,a]=ae.useState(!1),{onFocus:o,onBlur:l,onMouseEnter:c,onMouseLeave:u,onTouchStart:d}=e,h=ae.useRef(null);ae.useEffect(()=>{if(n==="render"&&a(!0),n==="viewport"){let v=E=>{E.forEach(R=>{a(R.isIntersecting)})},x=new IntersectionObserver(v,{threshold:.5});return h.current&&x.observe(h.current),()=>{x.disconnect()}}},[n]),ae.useEffect(()=>{if(i){let v=setTimeout(()=>{a(!0)},100);return()=>{clearTimeout(v)}}},[i]);let m=()=>{r(!0)},g=()=>{r(!1),a(!1)};return t?n!=="intent"?[s,h,{}]:[s,h,{onFocus:_o(o,m),onBlur:_o(l,g),onMouseEnter:_o(c,m),onMouseLeave:_o(u,g),onTouchStart:_o(d,m)}]:[!1,h,{}]}function _o(n,e){return t=>{n&&n(t),t.defaultPrevented||e(t)}}function NI({page:n,...e}){let{router:t}=cE(),i=ae.useMemo(()=>Z1(t.routes,n,t.basename),[t.routes,n,t.basename]);return i?ae.createElement(FI,{page:n,matches:i,...e}):null}function BI(n){let{manifest:e,routeModules:t}=uE(),[i,r]=ae.useState([]);return ae.useEffect(()=>{let s=!1;return wI(n,e,t).then(a=>{s||r(a)}),()=>{s=!0}},[n,e,t]),i}function FI({page:n,matches:e,...t}){let i=Hs(),{manifest:r,routeModules:s}=uE(),{basename:a}=cE(),{loaderData:o,matches:l}=OI(),c=ae.useMemo(()=>L0(n,e,l,r,i,"data"),[n,e,l,r,i]),u=ae.useMemo(()=>L0(n,e,l,r,i,"assets"),[n,e,l,r,i]),d=ae.useMemo(()=>{if(n===i.pathname+i.search+i.hash)return[];let g=new Set,v=!1;if(e.forEach(E=>{var k;let R=r.routes[E.route.id];!R||!R.hasLoader||(!c.some(D=>D.route.id===E.route.id)&&E.route.id in o&&((k=s[E.route.id])!=null&&k.shouldRevalidate)||R.hasClientLoader?v=!0:g.add(E.route.id))}),g.size===0)return[];let x=II(n,a,"data");return v&&g.size>0&&x.searchParams.set("_routes",e.filter(E=>g.has(E.route.id)).map(E=>E.route.id).join(",")),[x.pathname+x.search]},[a,o,i,r,c,e,n,s]),h=ae.useMemo(()=>CI(u,r),[u,r]),m=BI(u);return ae.createElement(ae.Fragment,null,d.map(g=>ae.createElement("link",{key:g,rel:"prefetch",as:"fetch",href:g,...t})),h.map(g=>ae.createElement("link",{key:g,rel:"modulepreload",href:g,...t})),m.map(({key:g,link:v})=>ae.createElement("link",{key:g,nonce:t.nonce,...v})))}function UI(...n){return e=>{n.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var dE=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{dE&&(window.__reactRouterVersion="7.8.0")}catch{}function $I({basename:n,children:e,window:t}){let i=ae.useRef();i.current==null&&(i.current=Lb({window:t,v5Compat:!0}));let r=i.current,[s,a]=ae.useState({action:r.action,location:r.location}),o=ae.useCallback(l=>{ae.startTransition(()=>a(l))},[a]);return ae.useLayoutEffect(()=>r.listen(o),[r,o]),ae.createElement(_I,{basename:n,children:e,location:s.location,navigationType:s.action,navigator:r})}var hE=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,fE=ae.forwardRef(function({onClick:e,discover:t="render",prefetch:i="none",relative:r,reloadDocument:s,replace:a,state:o,target:l,to:c,preventScrollReset:u,viewTransition:d,...h},m){let{basename:g}=ae.useContext(Fi),v=typeof c=="string"&&hE.test(c),x,E=!1;if(typeof c=="string"&&v&&(x=c,dE))try{let b=new URL(window.location.href),T=c.startsWith("//")?new URL(b.protocol+c):new URL(c),L=ar(T.pathname,g);T.origin===b.origin&&L!=null?c=L+T.search+T.hash:E=!0}catch{Mi(!1,`<Link to="${c}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let R=tI(c,{relative:r}),[k,D,V]=MI(i,h),H=HI(c,{replace:a,state:o,target:l,preventScrollReset:u,relative:r,viewTransition:d});function C(b){e&&e(b),b.defaultPrevented||H(b)}let S=ae.createElement("a",{...h,...V,href:x||R,onClick:E||s?e:C,ref:UI(m,D),target:l,"data-discover":!v&&t==="render"?"true":void 0});return k&&!v?ae.createElement(ae.Fragment,null,S,ae.createElement(NI,{page:R})):S});fE.displayName="Link";var VI=ae.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:i="",end:r=!1,style:s,to:a,viewTransition:o,children:l,...c},u){let d=bl(a,{relative:c.relative}),h=Hs(),m=ae.useContext(ld),{navigator:g,basename:v}=ae.useContext(Fi),x=m!=null&&YI(d)&&o===!0,E=g.encodeLocation?g.encodeLocation(d).pathname:d.pathname,R=h.pathname,k=m&&m.navigation&&m.navigation.location?m.navigation.location.pathname:null;t||(R=R.toLowerCase(),k=k?k.toLowerCase():null,E=E.toLowerCase()),k&&v&&(k=ar(k,v)||k);const D=E!=="/"&&E.endsWith("/")?E.length-1:E.length;let V=R===E||!r&&R.startsWith(E)&&R.charAt(D)==="/",H=k!=null&&(k===E||!r&&k.startsWith(E)&&k.charAt(E.length)==="/"),C={isActive:V,isPending:H,isTransitioning:x},S=V?e:void 0,b;typeof i=="function"?b=i(C):b=[i,V?"active":null,H?"pending":null,x?"transitioning":null].filter(Boolean).join(" ");let T=typeof s=="function"?s(C):s;return ae.createElement(fE,{...c,"aria-current":S,className:b,ref:u,style:T,to:a,viewTransition:o},typeof l=="function"?l(C):l)});VI.displayName="NavLink";var jI=ae.forwardRef(({discover:n="render",fetcherKey:e,navigate:t,reloadDocument:i,replace:r,state:s,method:a=Vc,action:o,onSubmit:l,relative:c,preventScrollReset:u,viewTransition:d,...h},m)=>{let g=WI(),v=qI(o,{relative:c}),x=a.toLowerCase()==="get"?"get":"post",E=typeof o=="string"&&hE.test(o),R=k=>{if(l&&l(k),k.defaultPrevented)return;k.preventDefault();let D=k.nativeEvent.submitter,V=(D==null?void 0:D.getAttribute("formmethod"))||a;g(D||k.currentTarget,{fetcherKey:e,method:V,navigate:t,replace:r,state:s,relative:c,preventScrollReset:u,viewTransition:d})};return ae.createElement("form",{ref:m,method:x,action:v,onSubmit:i?l:R,...h,"data-discover":!E&&n==="render"?"true":void 0})});jI.displayName="Form";function GI(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function pE(n){let e=ae.useContext(Ka);return qt(e,GI(n)),e}function HI(n,{target:e,replace:t,state:i,preventScrollReset:r,relative:s,viewTransition:a}={}){let o=nI(),l=Hs(),c=bl(n,{relative:s});return ae.useCallback(u=>{if(TI(u,e)){u.preventDefault();let d=t!==void 0?t:al(l)===al(c);o(n,{replace:d,state:i,preventScrollReset:r,relative:s,viewTransition:a})}},[l,o,c,t,i,e,n,r,s,a])}var zI=0,KI=()=>`__${String(++zI)}__`;function WI(){let{router:n}=pE("useSubmit"),{basename:e}=ae.useContext(Fi),t=fI();return ae.useCallback(async(i,r={})=>{let{action:s,method:a,encType:o,formData:l,body:c}=bI(i,e);if(r.navigate===!1){let u=r.fetcherKey||KI();await n.fetch(u,t,r.action||s,{preventScrollReset:r.preventScrollReset,formData:l,body:c,formMethod:r.method||a,formEncType:r.encType||o,flushSync:r.flushSync})}else await n.navigate(r.action||s,{preventScrollReset:r.preventScrollReset,formData:l,body:c,formMethod:r.method||a,formEncType:r.encType||o,replace:r.replace,state:r.state,fromRouteId:t,flushSync:r.flushSync,viewTransition:r.viewTransition})},[n,e,t])}function qI(n,{relative:e}={}){let{basename:t}=ae.useContext(Fi),i=ae.useContext(ur);qt(i,"useFormAction must be used inside a RouteContext");let[r]=i.matches.slice(-1),s={...bl(n||".",{relative:e})},a=Hs();if(n==null){s.search=a.search;let o=new URLSearchParams(s.search),l=o.getAll("index");if(l.some(u=>u==="")){o.delete("index"),l.filter(d=>d).forEach(d=>o.append("index",d));let u=o.toString();s.search=u?`?${u}`:""}}return(!n||n===".")&&r.route.index&&(s.search=s.search?s.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(s.pathname=s.pathname==="/"?t:tr([t,s.pathname])),al(s)}function YI(n,{relative:e}={}){let t=ae.useContext(sE);qt(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:i}=pE("useViewTransitionState"),r=bl(n,{relative:e});if(!t.isTransitioning)return!1;let s=ar(t.currentLocation.pathname,i)||t.currentLocation.pathname,a=ar(t.nextLocation.pathname,i)||t.nextLocation.pathname;return Iu(r.pathname,a)!=null||Iu(r.pathname,s)!=null}const mE=ae.createContext(void 0),XI={es:{home:"Inicio",movies:"Películas",series:"Series",kids:"Infantil",comedy:"Comedia","live-tv":"TV en Vivo","select-channel":"Selecciona un canal","select-channel-desc":"Elige un canal de la lista para comenzar a ver","loading-channel":"Cargando canal...","channel-count":"Mostrando {count} de {total} canales","no-channels-found":"No se encontraron canales","no-channels-desc":"Intenta con otros términos de búsqueda o cambia la categoría","search-channels":"Buscar canales...",refresh:"Refrescar",system:"Sistema",diagnostics:"Información de diagnóstico","system-info":"Información del Sistema","all-channels":"Todos los Canales","movies-category":"Películas","kids-category":"Infantil",national:"Nacional",sports:"Deportes",entertainment:"Entretenimiento",music:"Música",news:"Noticias",mute:"Silenciar",unmute:"Activar sonido",fullscreen:"Pantalla completa",play:"Reproducir",pause:"Pausar","error-loading":"Error al cargar","error-playing":"Error al reproducir","server-down":"El servidor puede estar caído","check-connection":"Verifica tu conexión a internet","format-not-supported":"Formato de video no soportado","network-error":"Error de red",timeout:"Timeout","server-slow":"El servidor puede estar lento o caído",profiles:"Perfiles","add-profile":"Agregar Perfil","edit-profile":"Editar Perfil","delete-profile":"Eliminar Perfil","profile-name":"Nombre del Perfil","profile-avatar":"Avatar del Perfil","save-profile":"Guardar Perfil",cancel:"Cancelar",delete:"Eliminar","are-you-sure":"¿Estás seguro?","delete-profile-confirm":"¿Estás seguro de que quieres eliminar este perfil?","profile-deleted":"Perfil eliminado","profile-saved":"Perfil guardado","select-profile":"Seleccionar Perfil","manage-profiles":"Administrar Perfiles","popular-movies":"Películas Populares","trending-series":"Series Trending","for-kids":"Para Niños","section-development":"Sección en desarrollo","coming-soon":"Esta sección estará disponible pronto",login:"Iniciar Sesión",logout:"Cerrar Sesión",email:"Correo Electrónico",password:"Contraseña","sign-in":"Iniciar Sesión",welcome:"Bienvenido",search:"Buscar",filter:"Filtrar",close:"Cerrar",save:"Guardar",edit:"Editar",loading:"Cargando..."},en:{home:"Home",movies:"Movies",series:"Series",kids:"Kids",comedy:"Comedy","live-tv":"Live TV","select-channel":"Select a channel","select-channel-desc":"Choose a channel from the list to start watching","loading-channel":"Loading channel...","channel-count":"Showing {count} of {total} channels","no-channels-found":"No channels found","no-channels-desc":"Try different search terms or change the category","search-channels":"Search channels...",refresh:"Refresh",system:"System",diagnostics:"Diagnostic Information","system-info":"System Information","all-channels":"All Channels","movies-category":"Movies","kids-category":"Kids",national:"National",sports:"Sports",entertainment:"Entertainment",music:"Music",news:"News",mute:"Mute",unmute:"Unmute",fullscreen:"Fullscreen",play:"Play",pause:"Pause","error-loading":"Error loading","error-playing":"Error playing","server-down":"The server may be down","check-connection":"Check your internet connection","format-not-supported":"Video format not supported","network-error":"Network error",timeout:"Timeout","server-slow":"The server may be slow or down",profiles:"Profiles","add-profile":"Add Profile","edit-profile":"Edit Profile","delete-profile":"Delete Profile","profile-name":"Profile Name","profile-avatar":"Profile Avatar","save-profile":"Save Profile",cancel:"Cancel",delete:"Delete","are-you-sure":"Are you sure?","delete-profile-confirm":"Are you sure you want to delete this profile?","profile-deleted":"Profile deleted","profile-saved":"Profile saved","select-profile":"Select Profile","manage-profiles":"Manage Profiles","popular-movies":"Popular Movies","trending-series":"Trending Series","for-kids":"For Kids","section-development":"Section in development","coming-soon":"This section will be available soon",login:"Login",logout:"Logout",email:"Email",password:"Password","sign-in":"Sign In",welcome:"Welcome",search:"Search",filter:"Filter",close:"Close",save:"Save",edit:"Edit",loading:"Loading..."}},QI=({children:n})=>{const[e,t]=ae.useState(()=>localStorage.getItem("language")||"es");ae.useEffect(()=>{localStorage.setItem("language",e)},[e]);const i=r=>XI[e][r]||r;return z.jsx(mE.Provider,{value:{language:e,setLanguage:t,t:i},children:n})},sm=()=>{const n=ae.useContext(mE);if(n===void 0)throw new Error("useLanguage must be used within a LanguageProvider");return n},gE=ae.createContext(void 0),JI=[{name:"Usuario 1",avatar:"👤",isAdult:!0,isActive:!0,preferences:{language:"es",autoplay:!0,subtitles:!1,quality:"high"}},{name:"Niños",avatar:"👶",isAdult:!1,isActive:!1,preferences:{language:"es",autoplay:!0,subtitles:!0,quality:"medium"}},{name:"Familiar",avatar:"👨‍👩‍👧‍👦",isAdult:!0,isActive:!1,preferences:{language:"es",autoplay:!1,subtitles:!0,quality:"high"}}],ZI=({children:n})=>{const[e,t]=ae.useState(()=>{const u=localStorage.getItem("profiles");return u?JSON.parse(u):[]}),[i,r]=ae.useState(()=>{const u=localStorage.getItem("currentProfile");return u?JSON.parse(u):null});ae.useEffect(()=>{localStorage.setItem("profiles",JSON.stringify(e))},[e]),ae.useEffect(()=>{i&&localStorage.setItem("currentProfile",JSON.stringify(i))},[i]);const s=u=>{const d={...u,id:Date.now().toString()};t(h=>[...h,d])},a=(u,d)=>{t(h=>h.map(m=>m.id===u?{...m,...d}:m)),(i==null?void 0:i.id)===u&&r(h=>h?{...h,...d}:null)},o=u=>{t(d=>d.filter(h=>h.id!==u)),(i==null?void 0:i.id)===u&&r(null)},l=u=>{r(u)},c=()=>{if(e.length===0){const u=JI.map((d,h)=>({...d,id:`default-${h}`}));t(u),r(u[0])}};return z.jsx(gE.Provider,{value:{profiles:e,currentProfile:i,addProfile:s,updateProfile:a,deleteProfile:o,selectProfile:l,createDefaultProfiles:c},children:n})},_E=()=>{const n=ae.useContext(gE);if(n===void 0)throw new Error("useProfiles must be used within a ProfileProvider");return n};/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eR=()=>{};var w0={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yE=function(n){const e=[];let t=0;for(let i=0;i<n.length;i++){let r=n.charCodeAt(i);r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):(r&64512)===55296&&i+1<n.length&&(n.charCodeAt(i+1)&64512)===56320?(r=65536+((r&1023)<<10)+(n.charCodeAt(++i)&1023),e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},tR=function(n){const e=[];let t=0,i=0;for(;t<n.length;){const r=n[t++];if(r<128)e[i++]=String.fromCharCode(r);else if(r>191&&r<224){const s=n[t++];e[i++]=String.fromCharCode((r&31)<<6|s&63)}else if(r>239&&r<365){const s=n[t++],a=n[t++],o=n[t++],l=((r&7)<<18|(s&63)<<12|(a&63)<<6|o&63)-65536;e[i++]=String.fromCharCode(55296+(l>>10)),e[i++]=String.fromCharCode(56320+(l&1023))}else{const s=n[t++],a=n[t++];e[i++]=String.fromCharCode((r&15)<<12|(s&63)<<6|a&63)}}return e.join("")},vE={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let r=0;r<n.length;r+=3){const s=n[r],a=r+1<n.length,o=a?n[r+1]:0,l=r+2<n.length,c=l?n[r+2]:0,u=s>>2,d=(s&3)<<4|o>>4;let h=(o&15)<<2|c>>6,m=c&63;l||(m=64,a||(h=64)),i.push(t[u],t[d],t[h],t[m])}return i.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(yE(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):tR(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let r=0;r<n.length;){const s=t[n.charAt(r++)],o=r<n.length?t[n.charAt(r)]:0;++r;const c=r<n.length?t[n.charAt(r)]:64;++r;const d=r<n.length?t[n.charAt(r)]:64;if(++r,s==null||o==null||c==null||d==null)throw new nR;const h=s<<2|o>>4;if(i.push(h),c!==64){const m=o<<4&240|c>>2;if(i.push(m),d!==64){const g=c<<6&192|d;i.push(g)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class nR extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const iR=function(n){const e=yE(n);return vE.encodeByteArray(e,!0)},Ru=function(n){return iR(n).replace(/\./g,"")},EE=function(n){try{return vE.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rR(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sR=()=>rR().__FIREBASE_DEFAULTS__,aR=()=>{if(typeof process>"u"||typeof w0>"u")return;const n=w0.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},oR=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&EE(n[1]);return e&&JSON.parse(e)},am=()=>{try{return eR()||sR()||aR()||oR()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},SE=n=>{var e,t;return(t=(e=am())==null?void 0:e.emulatorHosts)==null?void 0:t[n]},lR=n=>{const e=SE(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const i=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),i]:[e.substring(0,t),i]},TE=()=>{var n;return(n=am())==null?void 0:n.config},AE=n=>{var e;return(e=am())==null?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cR{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,i)=>{t?this.reject(t):this.resolve(i),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,i))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Il(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function xE(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uR(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},i=e||"demo-project",r=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${i}`,aud:i,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}},...n};return[Ru(JSON.stringify(t)),Ru(JSON.stringify(a)),""].join(".")}const Mo={};function dR(){const n={prod:[],emulator:[]};for(const e of Object.keys(Mo))Mo[e]?n.emulator.push(e):n.prod.push(e);return n}function hR(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let C0=!1;function bE(n,e){if(typeof window>"u"||typeof document>"u"||!Il(window.location.host)||Mo[n]===e||Mo[n]||C0)return;Mo[n]=e;function t(h){return`__firebase__banner__${h}`}const i="__firebase__banner",s=dR().prod.length>0;function a(){const h=document.getElementById(i);h&&h.remove()}function o(h){h.style.display="flex",h.style.background="#7faaf0",h.style.position="fixed",h.style.bottom="5px",h.style.left="5px",h.style.padding=".5em",h.style.borderRadius="5px",h.style.alignItems="center"}function l(h,m){h.setAttribute("width","24"),h.setAttribute("id",m),h.setAttribute("height","24"),h.setAttribute("viewBox","0 0 24 24"),h.setAttribute("fill","none"),h.style.marginLeft="-6px"}function c(){const h=document.createElement("span");return h.style.cursor="pointer",h.style.marginLeft="16px",h.style.fontSize="24px",h.innerHTML=" &times;",h.onclick=()=>{C0=!0,a()},h}function u(h,m){h.setAttribute("id",m),h.innerText="Learn more",h.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",h.setAttribute("target","__blank"),h.style.paddingLeft="5px",h.style.textDecoration="underline"}function d(){const h=hR(i),m=t("text"),g=document.getElementById(m)||document.createElement("span"),v=t("learnmore"),x=document.getElementById(v)||document.createElement("a"),E=t("preprendIcon"),R=document.getElementById(E)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(h.created){const k=h.element;o(k),u(x,v);const D=c();l(R,E),k.append(R,g,x,D),document.body.appendChild(k)}s?(g.innerText="Preview backend disconnected.",R.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(R.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,g.innerText="Preview backend running in this workspace."),g.setAttribute("id",m)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",d):d()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function fR(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(yn())}function pR(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function mR(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function gR(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function _R(){const n=yn();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function yR(){try{return typeof indexedDB=="object"}catch{return!1}}function vR(){return new Promise((n,e)=>{try{let t=!0;const i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),t||self.indexedDB.deleteDatabase(i),n(!0)},r.onupgradeneeded=()=>{t=!1},r.onerror=()=>{var s;e(((s=r.error)==null?void 0:s.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ER="FirebaseError";class dr extends Error{constructor(e,t,i){super(t),this.code=e,this.customData=i,this.name=ER,Object.setPrototypeOf(this,dr.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Rl.prototype.create)}}class Rl{constructor(e,t,i){this.service=e,this.serviceName=t,this.errors=i}create(e,...t){const i=t[0]||{},r=`${this.service}/${e}`,s=this.errors[e],a=s?SR(s,i):"Error",o=`${this.serviceName}: ${a} (${r}).`;return new dr(r,o,i)}}function SR(n,e){return n.replace(TR,(t,i)=>{const r=e[i];return r!=null?String(r):`<${i}?>`})}const TR=/\{\$([^}]+)}/g;function AR(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Bs(n,e){if(n===e)return!0;const t=Object.keys(n),i=Object.keys(e);for(const r of t){if(!i.includes(r))return!1;const s=n[r],a=e[r];if(k0(s)&&k0(a)){if(!Bs(s,a))return!1}else if(s!==a)return!1}for(const r of i)if(!t.includes(r))return!1;return!0}function k0(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ll(n){const e=[];for(const[t,i]of Object.entries(n))Array.isArray(i)?i.forEach(r=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(r))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}function Ao(n){const e={};return n.replace(/^\?/,"").split("&").forEach(i=>{if(i){const[r,s]=i.split("=");e[decodeURIComponent(r)]=decodeURIComponent(s)}}),e}function xo(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function xR(n,e){const t=new bR(n,e);return t.subscribe.bind(t)}class bR{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(i=>{this.error(i)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,i){let r;if(e===void 0&&t===void 0&&i===void 0)throw new Error("Missing Observer.");IR(e,["next","error","complete"])?r=e:r={next:e,error:t,complete:i},r.next===void 0&&(r.next=rh),r.error===void 0&&(r.error=rh),r.complete===void 0&&(r.complete=rh);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch{}}),this.observers.push(r),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(i){typeof console<"u"&&console.error&&console.error(i)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function IR(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function rh(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hr(n){return n&&n._delegate?n._delegate:n}class Fs{constructor(e,t,i){this.name=e,this.instanceFactory=t,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Es="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RR{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const i=new cR;if(this.instancesDeferred.set(t,i),this.isInitialized(t)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:t});r&&i.resolve(r)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),i=(e==null?void 0:e.optional)??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(r){if(i)return null;throw r}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(wR(e))try{this.getOrInitializeService({instanceIdentifier:Es})}catch{}for(const[t,i]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(t);try{const s=this.getOrInitializeService({instanceIdentifier:r});i.resolve(s)}catch{}}}}clearInstance(e=Es){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Es){return this.instances.has(e)}getOptions(e=Es){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:i,options:t});for(const[s,a]of this.instancesDeferred.entries()){const o=this.normalizeInstanceIdentifier(s);i===o&&a.resolve(r)}return r}onInit(e,t){const i=this.normalizeInstanceIdentifier(t),r=this.onInitCallbacks.get(i)??new Set;r.add(e),this.onInitCallbacks.set(i,r);const s=this.instances.get(i);return s&&e(s,i),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const i=this.onInitCallbacks.get(t);if(i)for(const r of i)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:LR(e),options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=Es){return this.component?this.component.multipleInstances?e:Es:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function LR(n){return n===Es?void 0:n}function wR(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CR{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new RR(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var st;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(st||(st={}));const kR={debug:st.DEBUG,verbose:st.VERBOSE,info:st.INFO,warn:st.WARN,error:st.ERROR,silent:st.SILENT},DR=st.INFO,PR={[st.DEBUG]:"log",[st.VERBOSE]:"log",[st.INFO]:"info",[st.WARN]:"warn",[st.ERROR]:"error"},OR=(n,e,...t)=>{if(e<n.logLevel)return;const i=new Date().toISOString(),r=PR[e];if(r)console[r](`[${i}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};let om=class{constructor(e){this.name=e,this._logLevel=DR,this._logHandler=OR,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in st))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?kR[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,st.DEBUG,...e),this._logHandler(this,st.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,st.VERBOSE,...e),this._logHandler(this,st.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,st.INFO,...e),this._logHandler(this,st.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,st.WARN,...e),this._logHandler(this,st.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,st.ERROR,...e),this._logHandler(this,st.ERROR,...e)}};const MR=(n,e)=>e.some(t=>n instanceof t);let D0,P0;function NR(){return D0||(D0=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function BR(){return P0||(P0=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const IE=new WeakMap,kf=new WeakMap,RE=new WeakMap,sh=new WeakMap,lm=new WeakMap;function FR(n){const e=new Promise((t,i)=>{const r=()=>{n.removeEventListener("success",s),n.removeEventListener("error",a)},s=()=>{t(Kr(n.result)),r()},a=()=>{i(n.error),r()};n.addEventListener("success",s),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&IE.set(t,n)}).catch(()=>{}),lm.set(e,n),e}function UR(n){if(kf.has(n))return;const e=new Promise((t,i)=>{const r=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",a),n.removeEventListener("abort",a)},s=()=>{t(),r()},a=()=>{i(n.error||new DOMException("AbortError","AbortError")),r()};n.addEventListener("complete",s),n.addEventListener("error",a),n.addEventListener("abort",a)});kf.set(n,e)}let Df={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return kf.get(n);if(e==="objectStoreNames")return n.objectStoreNames||RE.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Kr(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function $R(n){Df=n(Df)}function VR(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const i=n.call(ah(this),e,...t);return RE.set(i,e.sort?e.sort():[e]),Kr(i)}:BR().includes(n)?function(...e){return n.apply(ah(this),e),Kr(IE.get(this))}:function(...e){return Kr(n.apply(ah(this),e))}}function jR(n){return typeof n=="function"?VR(n):(n instanceof IDBTransaction&&UR(n),MR(n,NR())?new Proxy(n,Df):n)}function Kr(n){if(n instanceof IDBRequest)return FR(n);if(sh.has(n))return sh.get(n);const e=jR(n);return e!==n&&(sh.set(n,e),lm.set(e,n)),e}const ah=n=>lm.get(n);function GR(n,e,{blocked:t,upgrade:i,blocking:r,terminated:s}={}){const a=indexedDB.open(n,e),o=Kr(a);return i&&a.addEventListener("upgradeneeded",l=>{i(Kr(a.result),l.oldVersion,l.newVersion,Kr(a.transaction),l)}),t&&a.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),o.then(l=>{s&&l.addEventListener("close",()=>s()),r&&l.addEventListener("versionchange",c=>r(c.oldVersion,c.newVersion,c))}).catch(()=>{}),o}const HR=["get","getKey","getAll","getAllKeys","count"],zR=["put","add","delete","clear"],oh=new Map;function O0(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(oh.get(e))return oh.get(e);const t=e.replace(/FromIndex$/,""),i=e!==t,r=zR.includes(t);if(!(t in(i?IDBIndex:IDBObjectStore).prototype)||!(r||HR.includes(t)))return;const s=async function(a,...o){const l=this.transaction(a,r?"readwrite":"readonly");let c=l.store;return i&&(c=c.index(o.shift())),(await Promise.all([c[t](...o),r&&l.done]))[0]};return oh.set(e,s),s}$R(n=>({...n,get:(e,t,i)=>O0(e,t)||n.get(e,t,i),has:(e,t)=>!!O0(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KR{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(WR(t)){const i=t.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(t=>t).join(" ")}}function WR(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Pf="@firebase/app",M0="0.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const or=new om("@firebase/app"),qR="@firebase/app-compat",YR="@firebase/analytics-compat",XR="@firebase/analytics",QR="@firebase/app-check-compat",JR="@firebase/app-check",ZR="@firebase/auth",eL="@firebase/auth-compat",tL="@firebase/database",nL="@firebase/data-connect",iL="@firebase/database-compat",rL="@firebase/functions",sL="@firebase/functions-compat",aL="@firebase/installations",oL="@firebase/installations-compat",lL="@firebase/messaging",cL="@firebase/messaging-compat",uL="@firebase/performance",dL="@firebase/performance-compat",hL="@firebase/remote-config",fL="@firebase/remote-config-compat",pL="@firebase/storage",mL="@firebase/storage-compat",gL="@firebase/firestore",_L="@firebase/ai",yL="@firebase/firestore-compat",vL="firebase",EL="12.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Of="[DEFAULT]",SL={[Pf]:"fire-core",[qR]:"fire-core-compat",[XR]:"fire-analytics",[YR]:"fire-analytics-compat",[JR]:"fire-app-check",[QR]:"fire-app-check-compat",[ZR]:"fire-auth",[eL]:"fire-auth-compat",[tL]:"fire-rtdb",[nL]:"fire-data-connect",[iL]:"fire-rtdb-compat",[rL]:"fire-fn",[sL]:"fire-fn-compat",[aL]:"fire-iid",[oL]:"fire-iid-compat",[lL]:"fire-fcm",[cL]:"fire-fcm-compat",[uL]:"fire-perf",[dL]:"fire-perf-compat",[hL]:"fire-rc",[fL]:"fire-rc-compat",[pL]:"fire-gcs",[mL]:"fire-gcs-compat",[gL]:"fire-fst",[yL]:"fire-fst-compat",[_L]:"fire-vertex","fire-js":"fire-js",[vL]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lu=new Map,TL=new Map,Mf=new Map;function N0(n,e){try{n.container.addComponent(e)}catch(t){or.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Fa(n){const e=n.name;if(Mf.has(e))return or.debug(`There were multiple attempts to register component ${e}.`),!1;Mf.set(e,n);for(const t of Lu.values())N0(t,n);for(const t of TL.values())N0(t,n);return!0}function cm(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function li(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AL={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Wr=new Rl("app","Firebase",AL);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xL{constructor(e,t,i){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new Fs("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Wr.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wa=EL;function LE(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const i={name:Of,automaticDataCollectionEnabled:!0,...e},r=i.name;if(typeof r!="string"||!r)throw Wr.create("bad-app-name",{appName:String(r)});if(t||(t=TE()),!t)throw Wr.create("no-options");const s=Lu.get(r);if(s){if(Bs(t,s.options)&&Bs(i,s.config))return s;throw Wr.create("duplicate-app",{appName:r})}const a=new CR(r);for(const l of Mf.values())a.addComponent(l);const o=new xL(t,i,a);return Lu.set(r,o),o}function wE(n=Of){const e=Lu.get(n);if(!e&&n===Of&&TE())return LE();if(!e)throw Wr.create("no-app",{appName:n});return e}function qr(n,e,t){let i=SL[n]??n;t&&(i+=`-${t}`);const r=i.match(/\s|\//),s=e.match(/\s|\//);if(r||s){const a=[`Unable to register library "${i}" with version "${e}":`];r&&a.push(`library name "${i}" contains illegal characters (whitespace or "/")`),r&&s&&a.push("and"),s&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),or.warn(a.join(" "));return}Fa(new Fs(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bL="firebase-heartbeat-database",IL=1,ol="firebase-heartbeat-store";let lh=null;function CE(){return lh||(lh=GR(bL,IL,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(ol)}catch(t){console.warn(t)}}}}).catch(n=>{throw Wr.create("idb-open",{originalErrorMessage:n.message})})),lh}async function RL(n){try{const t=(await CE()).transaction(ol),i=await t.objectStore(ol).get(kE(n));return await t.done,i}catch(e){if(e instanceof dr)or.warn(e.message);else{const t=Wr.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});or.warn(t.message)}}}async function B0(n,e){try{const i=(await CE()).transaction(ol,"readwrite");await i.objectStore(ol).put(e,kE(n)),await i.done}catch(t){if(t instanceof dr)or.warn(t.message);else{const i=Wr.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});or.warn(i.message)}}}function kE(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LL=1024,wL=30;class CL{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new DL(t),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){var e,t;try{const r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=F0();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(a=>a.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:r}),this._heartbeatsCache.heartbeats.length>wL){const a=PL(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(i){or.warn(i)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=F0(),{heartbeatsToSend:i,unsentEntries:r}=kL(this._heartbeatsCache.heartbeats),s=Ru(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return or.warn(t),""}}}function F0(){return new Date().toISOString().substring(0,10)}function kL(n,e=LL){const t=[];let i=n.slice();for(const r of n){const s=t.find(a=>a.agent===r.agent);if(s){if(s.dates.push(r.date),U0(t)>e){s.dates.pop();break}}else if(t.push({agent:r.agent,dates:[r.date]}),U0(t)>e){t.pop();break}i=i.slice(1)}return{heartbeatsToSend:t,unsentEntries:i}}class DL{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return yR()?vR().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await RL(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const i=await this.read();return B0(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const i=await this.read();return B0(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function U0(n){return Ru(JSON.stringify({version:2,heartbeats:n})).length}function PL(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let i=1;i<n.length;i++)n[i].date<t&&(t=n[i].date,e=i);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OL(n){Fa(new Fs("platform-logger",e=>new KR(e),"PRIVATE")),Fa(new Fs("heartbeat",e=>new CL(e),"PRIVATE")),qr(Pf,M0,n),qr(Pf,M0,"esm2020"),qr("fire-js","")}OL("");function DE(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const ML=DE,PE=new Rl("auth","Firebase",DE());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wu=new om("@firebase/auth");function NL(n,...e){wu.logLevel<=st.WARN&&wu.warn(`Auth (${Wa}): ${n}`,...e)}function Gc(n,...e){wu.logLevel<=st.ERROR&&wu.error(`Auth (${Wa}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pi(n,...e){throw um(n,...e)}function Pi(n,...e){return um(n,...e)}function OE(n,e,t){const i={...ML(),[e]:t};return new Rl("auth","Firebase",i).create(e,{appName:n.name})}function Yr(n){return OE(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function um(n,...e){if(typeof n!="string"){const t=e[0],i=[...e.slice(1)];return i[0]&&(i[0].appName=n.name),n._errorFactory.create(t,...i)}return PE.create(n,...e)}function Ue(n,e,...t){if(!n)throw um(e,...t)}function Ji(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Gc(e),new Error(e)}function lr(n,e){n||Ji(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nf(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.href)||""}function BL(){return $0()==="http:"||$0()==="https:"}function $0(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FL(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(BL()||mR()||"connection"in navigator)?navigator.onLine:!0}function UL(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wl{constructor(e,t){this.shortDelay=e,this.longDelay=t,lr(t>e,"Short delay should be less than long delay!"),this.isMobile=fR()||gR()}get(){return FL()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dm(n,e){lr(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ME{static initialize(e,t,i){this.fetchImpl=e,t&&(this.headersImpl=t),i&&(this.responseImpl=i)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Ji("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Ji("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Ji("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $L={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VL=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],jL=new wl(3e4,6e4);function rs(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function fr(n,e,t,i,r={}){return NE(n,r,async()=>{let s={},a={};i&&(e==="GET"?a=i:s={body:JSON.stringify(i)});const o=Ll({key:n.config.apiKey,...a}).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const c={method:e,headers:l,...s};return pR()||(c.referrerPolicy="no-referrer"),n.emulatorConfig&&Il(n.emulatorConfig.host)&&(c.credentials="include"),ME.fetch()(await BE(n,n.config.apiHost,t,o),c)})}async function NE(n,e,t){n._canInitEmulator=!1;const i={...$L,...e};try{const r=new HL(n),s=await Promise.race([t(),r.promise]);r.clearNetworkTimeout();const a=await s.json();if("needConfirmation"in a)throw dc(n,"account-exists-with-different-credential",a);if(s.ok&&!("errorMessage"in a))return a;{const o=s.ok?a.errorMessage:a.error.message,[l,c]=o.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw dc(n,"credential-already-in-use",a);if(l==="EMAIL_EXISTS")throw dc(n,"email-already-in-use",a);if(l==="USER_DISABLED")throw dc(n,"user-disabled",a);const u=i[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw OE(n,u,c);pi(n,u)}}catch(r){if(r instanceof dr)throw r;pi(n,"network-request-failed",{message:String(r)})}}async function dd(n,e,t,i,r={}){const s=await fr(n,e,t,i,r);return"mfaPendingCredential"in s&&pi(n,"multi-factor-auth-required",{_serverResponse:s}),s}async function BE(n,e,t,i){const r=`${e}${t}?${i}`,s=n,a=s.config.emulator?dm(n.config,r):`${n.config.apiScheme}://${r}`;return VL.includes(t)&&(await s._persistenceManagerAvailable,s._getPersistenceType()==="COOKIE")?s._getPersistence()._getFinalTarget(a).toString():a}function GL(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class HL{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,i)=>{this.timer=setTimeout(()=>i(Pi(this.auth,"network-request-failed")),jL.get())})}}function dc(n,e,t){const i={appName:n.name};t.email&&(i.email=t.email),t.phoneNumber&&(i.phoneNumber=t.phoneNumber);const r=Pi(n,e,i);return r.customData._tokenResponse=t,r}function V0(n){return n!==void 0&&n.enterprise!==void 0}class zL{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return GL(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function KL(n,e){return fr(n,"GET","/v2/recaptchaConfig",rs(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function WL(n,e){return fr(n,"POST","/v1/accounts:delete",e)}async function Cu(n,e){return fr(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function No(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function qL(n,e=!1){const t=hr(n),i=await t.getIdToken(e),r=hm(i);Ue(r&&r.exp&&r.auth_time&&r.iat,t.auth,"internal-error");const s=typeof r.firebase=="object"?r.firebase:void 0,a=s==null?void 0:s.sign_in_provider;return{claims:r,token:i,authTime:No(ch(r.auth_time)),issuedAtTime:No(ch(r.iat)),expirationTime:No(ch(r.exp)),signInProvider:a||null,signInSecondFactor:(s==null?void 0:s.sign_in_second_factor)||null}}function ch(n){return Number(n)*1e3}function hm(n){const[e,t,i]=n.split(".");if(e===void 0||t===void 0||i===void 0)return Gc("JWT malformed, contained fewer than 3 sections"),null;try{const r=EE(t);return r?JSON.parse(r):(Gc("Failed to decode base64 JWT payload"),null)}catch(r){return Gc("Caught error parsing JWT payload as JSON",r==null?void 0:r.toString()),null}}function j0(n){const e=hm(n);return Ue(e,"internal-error"),Ue(typeof e.exp<"u","internal-error"),Ue(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ll(n,e,t=!1){if(t)return e;try{return await e}catch(i){throw i instanceof dr&&YL(i)&&n.auth.currentUser===n&&await n.auth.signOut(),i}}function YL({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XL{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const i=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bf{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=No(this.lastLoginAt),this.creationTime=No(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ku(n){var d;const e=n.auth,t=await n.getIdToken(),i=await ll(n,Cu(e,{idToken:t}));Ue(i==null?void 0:i.users.length,e,"internal-error");const r=i.users[0];n._notifyReloadListener(r);const s=(d=r.providerUserInfo)!=null&&d.length?FE(r.providerUserInfo):[],a=JL(n.providerData,s),o=n.isAnonymous,l=!(n.email&&r.passwordHash)&&!(a!=null&&a.length),c=o?l:!1,u={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:a,metadata:new Bf(r.createdAt,r.lastLoginAt),isAnonymous:c};Object.assign(n,u)}async function QL(n){const e=hr(n);await ku(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function JL(n,e){return[...n.filter(i=>!e.some(r=>r.providerId===i.providerId)),...e]}function FE(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ZL(n,e){const t=await NE(n,{},async()=>{const i=Ll({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:r,apiKey:s}=n.config,a=await BE(n,r,"/v1/token",`key=${s}`),o=await n._getAdditionalHeaders();o["Content-Type"]="application/x-www-form-urlencoded";const l={method:"POST",headers:o,body:i};return n.emulatorConfig&&Il(n.emulatorConfig.host)&&(l.credentials="include"),ME.fetch()(a,l)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function ew(n,e){return fr(n,"POST","/v2/accounts:revokeToken",rs(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xa{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ue(e.idToken,"internal-error"),Ue(typeof e.idToken<"u","internal-error"),Ue(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):j0(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Ue(e.length!==0,"internal-error");const t=j0(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(Ue(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:i,refreshToken:r,expiresIn:s}=await ZL(e,t);this.updateTokensAndExpiration(i,r,Number(s))}updateTokensAndExpiration(e,t,i){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+i*1e3}static fromJSON(e,t){const{refreshToken:i,accessToken:r,expirationTime:s}=t,a=new xa;return i&&(Ue(typeof i=="string","internal-error",{appName:e}),a.refreshToken=i),r&&(Ue(typeof r=="string","internal-error",{appName:e}),a.accessToken=r),s&&(Ue(typeof s=="number","internal-error",{appName:e}),a.expirationTime=s),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new xa,this.toJSON())}_performRefresh(){return Ji("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ar(n,e){Ue(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class ci{constructor({uid:e,auth:t,stsTokenManager:i,...r}){this.providerId="firebase",this.proactiveRefresh=new XL(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new Bf(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const t=await ll(this,this.stsTokenManager.getToken(this.auth,e));return Ue(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return qL(this,e)}reload(){return QL(this)}_assign(e){this!==e&&(Ue(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new ci({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){Ue(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let i=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),i=!0),t&&await ku(this),await this.auth._persistUserIfCurrent(this),i&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(li(this.auth.app))return Promise.reject(Yr(this.auth));const e=await this.getIdToken();return await ll(this,WL(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const i=t.displayName??void 0,r=t.email??void 0,s=t.phoneNumber??void 0,a=t.photoURL??void 0,o=t.tenantId??void 0,l=t._redirectEventId??void 0,c=t.createdAt??void 0,u=t.lastLoginAt??void 0,{uid:d,emailVerified:h,isAnonymous:m,providerData:g,stsTokenManager:v}=t;Ue(d&&v,e,"internal-error");const x=xa.fromJSON(this.name,v);Ue(typeof d=="string",e,"internal-error"),Ar(i,e.name),Ar(r,e.name),Ue(typeof h=="boolean",e,"internal-error"),Ue(typeof m=="boolean",e,"internal-error"),Ar(s,e.name),Ar(a,e.name),Ar(o,e.name),Ar(l,e.name),Ar(c,e.name),Ar(u,e.name);const E=new ci({uid:d,auth:e,email:r,emailVerified:h,displayName:i,isAnonymous:m,photoURL:a,phoneNumber:s,tenantId:o,stsTokenManager:x,createdAt:c,lastLoginAt:u});return g&&Array.isArray(g)&&(E.providerData=g.map(R=>({...R}))),l&&(E._redirectEventId=l),E}static async _fromIdTokenResponse(e,t,i=!1){const r=new xa;r.updateFromServerResponse(t);const s=new ci({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:i});return await ku(s),s}static async _fromGetAccountInfoResponse(e,t,i){const r=t.users[0];Ue(r.localId!==void 0,"internal-error");const s=r.providerUserInfo!==void 0?FE(r.providerUserInfo):[],a=!(r.email&&r.passwordHash)&&!(s!=null&&s.length),o=new xa;o.updateFromIdToken(i);const l=new ci({uid:r.localId,auth:e,stsTokenManager:o,isAnonymous:a}),c={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:s,metadata:new Bf(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!(s!=null&&s.length)};return Object.assign(l,c),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G0=new Map;function Zi(n){lr(n instanceof Function,"Expected a class definition");let e=G0.get(n);return e?(lr(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,G0.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UE{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}UE.type="NONE";const H0=UE;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hc(n,e,t){return`firebase:${n}:${e}:${t}`}class ba{constructor(e,t,i){this.persistence=e,this.auth=t,this.userKey=i;const{config:r,name:s}=this.auth;this.fullUserKey=Hc(this.userKey,r.apiKey,s),this.fullPersistenceKey=Hc("persistence",r.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await Cu(this.auth,{idToken:e}).catch(()=>{});return t?ci._fromGetAccountInfoResponse(this.auth,t,e):null}return ci._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,i="authUser"){if(!t.length)return new ba(Zi(H0),e,i);const r=(await Promise.all(t.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let s=r[0]||Zi(H0);const a=Hc(i,e.config.apiKey,e.name);let o=null;for(const c of t)try{const u=await c._get(a);if(u){let d;if(typeof u=="string"){const h=await Cu(e,{idToken:u}).catch(()=>{});if(!h)break;d=await ci._fromGetAccountInfoResponse(e,h,u)}else d=ci._fromJSON(e,u);c!==s&&(o=d),s=c;break}}catch{}const l=r.filter(c=>c._shouldAllowMigration);return!s._shouldAllowMigration||!l.length?new ba(s,e,i):(s=l[0],o&&await s._set(a,o.toJSON()),await Promise.all(t.map(async c=>{if(c!==s)try{await c._remove(a)}catch{}})),new ba(s,e,i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function z0(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(GE(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if($E(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(zE(e))return"Blackberry";if(KE(e))return"Webos";if(VE(e))return"Safari";if((e.includes("chrome/")||jE(e))&&!e.includes("edge/"))return"Chrome";if(HE(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=n.match(t);if((i==null?void 0:i.length)===2)return i[1]}return"Other"}function $E(n=yn()){return/firefox\//i.test(n)}function VE(n=yn()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function jE(n=yn()){return/crios\//i.test(n)}function GE(n=yn()){return/iemobile/i.test(n)}function HE(n=yn()){return/android/i.test(n)}function zE(n=yn()){return/blackberry/i.test(n)}function KE(n=yn()){return/webos/i.test(n)}function fm(n=yn()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function tw(n=yn()){var e;return fm(n)&&!!((e=window.navigator)!=null&&e.standalone)}function nw(){return _R()&&document.documentMode===10}function WE(n=yn()){return fm(n)||HE(n)||KE(n)||zE(n)||/windows phone/i.test(n)||GE(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qE(n,e=[]){let t;switch(n){case"Browser":t=z0(yn());break;case"Worker":t=`${z0(yn())}-${n}`;break;default:t=n}const i=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Wa}/${i}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iw{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const i=s=>new Promise((a,o)=>{try{const l=e(s);a(l)}catch(l){o(l)}});i.onAbort=t,this.queue.push(i);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const i of this.queue)await i(e),i.onAbort&&t.push(i.onAbort)}catch(i){t.reverse();for(const r of t)try{r()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:i==null?void 0:i.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rw(n,e={}){return fr(n,"GET","/v2/passwordPolicy",rs(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sw=6;class aw{constructor(e){var i;const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??sw,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((i=e.allowedNonAlphanumericCharacters)==null?void 0:i.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const i=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;i&&(t.meetsMinPasswordLength=e.length>=i),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let i;for(let r=0;r<e.length;r++)i=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,i>="a"&&i<="z",i>="A"&&i<="Z",i>="0"&&i<="9",this.allowedNonAlphanumericCharacters.includes(i))}updatePasswordCharacterOptionsStatuses(e,t,i,r,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=i)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ow{constructor(e,t,i,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=i,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new K0(this),this.idTokenSubscription=new K0(this),this.beforeStateQueue=new iw(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=PE,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(s=>this._resolvePersistenceManagerAvailable=s)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Zi(t)),this._initializationPromise=this.queue(async()=>{var i,r,s;if(!this._deleted&&(this.persistenceManager=await ba.create(this,e),(i=this._resolvePersistenceManagerAvailable)==null||i.call(this),!this._deleted)){if((r=this._popupRedirectResolver)!=null&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)==null?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Cu(this,{idToken:e}),i=await ci._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(i)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var s;if(li(this.app)){const a=this.app.settings.authIdToken;return a?new Promise(o=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(o,o))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let i=t,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const a=(s=this.redirectUser)==null?void 0:s._redirectEventId,o=i==null?void 0:i._redirectEventId,l=await this.tryRedirectSignIn(e);(!a||a===o)&&(l!=null&&l.user)&&(i=l.user,r=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(i)}catch(a){i=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return Ue(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await ku(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=UL()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(li(this.app))return Promise.reject(Yr(this));const t=e?hr(e):null;return t&&Ue(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Ue(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return li(this.app)?Promise.reject(Yr(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return li(this.app)?Promise.reject(Yr(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Zi(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await rw(this),t=new aw(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Rl("auth","Firebase",e())}onAuthStateChanged(e,t,i){return this.registerStateListener(this.authStateSubscription,e,t,i)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,i){return this.registerStateListener(this.idTokenSubscription,e,t,i)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const i=this.onAuthStateChanged(()=>{i(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),i={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(i.tenantId=this.tenantId),await ew(this,i)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,t){const i=await this.getOrInitRedirectPersistenceManager(t);return e===null?i.removeCurrentUser():i.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Zi(e)||this._popupRedirectResolver;Ue(t,this,"argument-error"),this.redirectPersistenceManager=await ba.create(this,[Zi(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,i;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)==null?void 0:t._redirectEventId)===e?this._currentUser:((i=this.redirectUser)==null?void 0:i._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((t=this.currentUser)==null?void 0:t.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,i,r){if(this._deleted)return()=>{};const s=typeof t=="function"?t:t.next.bind(t);let a=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ue(o,this,"internal-error"),o.then(()=>{a||s(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,i,r);return()=>{a=!0,l()}}else{const l=e.addObserver(t);return()=>{a=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ue(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=qE(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var r;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await((r=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:r.getHeartbeatsHeader());t&&(e["X-Firebase-Client"]=t);const i=await this._getAppCheckToken();return i&&(e["X-Firebase-AppCheck"]=i),e}async _getAppCheckToken(){var t;if(li(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:t.getToken());return e!=null&&e.error&&NL(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function zs(n){return hr(n)}class K0{constructor(e){this.auth=e,this.observer=null,this.addObserver=xR(t=>this.observer=t)}get next(){return Ue(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let hd={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function lw(n){hd=n}function YE(n){return hd.loadJS(n)}function cw(){return hd.recaptchaEnterpriseScript}function uw(){return hd.gapiScript}function dw(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class hw{constructor(){this.enterprise=new fw}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class fw{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const pw="recaptcha-enterprise",XE="NO_RECAPTCHA";class mw{constructor(e){this.type=pw,this.auth=zs(e)}async verify(e="verify",t=!1){async function i(s){if(!t){if(s.tenantId==null&&s._agentRecaptchaConfig!=null)return s._agentRecaptchaConfig.siteKey;if(s.tenantId!=null&&s._tenantRecaptchaConfigs[s.tenantId]!==void 0)return s._tenantRecaptchaConfigs[s.tenantId].siteKey}return new Promise(async(a,o)=>{KL(s,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)o(new Error("recaptcha Enterprise site key undefined"));else{const c=new zL(l);return s.tenantId==null?s._agentRecaptchaConfig=c:s._tenantRecaptchaConfigs[s.tenantId]=c,a(c.siteKey)}}).catch(l=>{o(l)})})}function r(s,a,o){const l=window.grecaptcha;V0(l)?l.enterprise.ready(()=>{l.enterprise.execute(s,{action:e}).then(c=>{a(c)}).catch(()=>{a(XE)})}):o(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new hw().execute("siteKey",{action:"verify"}):new Promise((s,a)=>{i(this.auth).then(o=>{if(!t&&V0(window.grecaptcha))r(o,s,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let l=cw();l.length!==0&&(l+=o),YE(l).then(()=>{r(o,s,a)}).catch(c=>{a(c)})}}).catch(o=>{a(o)})})}}async function W0(n,e,t,i=!1,r=!1){const s=new mw(n);let a;if(r)a=XE;else try{a=await s.verify(t)}catch{a=await s.verify(t,!0)}const o={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in o){const l=o.phoneEnrollmentInfo.phoneNumber,c=o.phoneEnrollmentInfo.recaptchaToken;Object.assign(o,{phoneEnrollmentInfo:{phoneNumber:l,recaptchaToken:c,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in o){const l=o.phoneSignInInfo.recaptchaToken;Object.assign(o,{phoneSignInInfo:{recaptchaToken:l,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return o}return i?Object.assign(o,{captchaResp:a}):Object.assign(o,{captchaResponse:a}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function Ff(n,e,t,i,r){var s;if((s=n._getRecaptchaConfig())!=null&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const a=await W0(n,e,t,t==="getOobCode");return i(n,a)}else return i(n,e).catch(async a=>{if(a.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await W0(n,e,t,t==="getOobCode");return i(n,o)}else return Promise.reject(a)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gw(n,e){const t=cm(n,"auth");if(t.isInitialized()){const r=t.getImmediate(),s=t.getOptions();if(Bs(s,e??{}))return r;pi(r,"already-initialized")}return t.initialize({options:e})}function _w(n,e){const t=(e==null?void 0:e.persistence)||[],i=(Array.isArray(t)?t:[t]).map(Zi);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(i,e==null?void 0:e.popupRedirectResolver)}function yw(n,e,t){const i=zs(n);Ue(/^https?:\/\//.test(e),i,"invalid-emulator-scheme");const r=!!(t!=null&&t.disableWarnings),s=QE(e),{host:a,port:o}=vw(e),l=o===null?"":`:${o}`,c={url:`${s}//${a}${l}/`},u=Object.freeze({host:a,port:o,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:r})});if(!i._canInitEmulator){Ue(i.config.emulator&&i.emulatorConfig,i,"emulator-config-failed"),Ue(Bs(c,i.config.emulator)&&Bs(u,i.emulatorConfig),i,"emulator-config-failed");return}i.config.emulator=c,i.emulatorConfig=u,i.settings.appVerificationDisabledForTesting=!0,Il(a)?(xE(`${s}//${a}${l}`),bE("Auth",!0)):Ew()}function QE(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function vw(n){const e=QE(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const i=t[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(i);if(r){const s=r[1];return{host:s,port:q0(i.substr(s.length+1))}}else{const[s,a]=i.split(":");return{host:s,port:q0(a)}}}function q0(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function Ew(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pm{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Ji("not implemented")}_getIdTokenResponse(e){return Ji("not implemented")}_linkToIdToken(e,t){return Ji("not implemented")}_getReauthenticationResolver(e){return Ji("not implemented")}}async function Sw(n,e){return fr(n,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Tw(n,e){return dd(n,"POST","/v1/accounts:signInWithPassword",rs(n,e))}async function Aw(n,e){return fr(n,"POST","/v1/accounts:sendOobCode",rs(n,e))}async function xw(n,e){return Aw(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bw(n,e){return dd(n,"POST","/v1/accounts:signInWithEmailLink",rs(n,e))}async function Iw(n,e){return dd(n,"POST","/v1/accounts:signInWithEmailLink",rs(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cl extends pm{constructor(e,t,i,r=null){super("password",i),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new cl(e,t,"password")}static _fromEmailAndCode(e,t,i=null){return new cl(e,t,"emailLink",i)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Ff(e,t,"signInWithPassword",Tw);case"emailLink":return bw(e,{email:this._email,oobCode:this._password});default:pi(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const i={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Ff(e,i,"signUpPassword",Sw);case"emailLink":return Iw(e,{idToken:t,email:this._email,oobCode:this._password});default:pi(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ia(n,e){return dd(n,"POST","/v1/accounts:signInWithIdp",rs(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rw="http://localhost";class Us extends pm{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Us(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):pi("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:i,signInMethod:r,...s}=t;if(!i||!r)return null;const a=new Us(i,r);return a.idToken=s.idToken||void 0,a.accessToken=s.accessToken||void 0,a.secret=s.secret,a.nonce=s.nonce,a.pendingToken=s.pendingToken||null,a}_getIdTokenResponse(e){const t=this.buildRequest();return Ia(e,t)}_linkToIdToken(e,t){const i=this.buildRequest();return i.idToken=t,Ia(e,i)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Ia(e,t)}buildRequest(){const e={requestUri:Rw,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Ll(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lw(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function ww(n){const e=Ao(xo(n)).link,t=e?Ao(xo(e)).deep_link_id:null,i=Ao(xo(n)).deep_link_id;return(i?Ao(xo(i)).link:null)||i||t||e||n}class mm{constructor(e){const t=Ao(xo(e)),i=t.apiKey??null,r=t.oobCode??null,s=Lw(t.mode??null);Ue(i&&r&&s,"argument-error"),this.apiKey=i,this.operation=s,this.code=r,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=ww(e);try{return new mm(t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qa{constructor(){this.providerId=qa.PROVIDER_ID}static credential(e,t){return cl._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const i=mm.parseLink(t);return Ue(i,"argument-error"),cl._fromEmailAndCode(e,i.code,i.tenantId)}}qa.PROVIDER_ID="password";qa.EMAIL_PASSWORD_SIGN_IN_METHOD="password";qa.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JE{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cl extends JE{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dr extends Cl{constructor(){super("facebook.com")}static credential(e){return Us._fromParams({providerId:Dr.PROVIDER_ID,signInMethod:Dr.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Dr.credentialFromTaggedObject(e)}static credentialFromError(e){return Dr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Dr.credential(e.oauthAccessToken)}catch{return null}}}Dr.FACEBOOK_SIGN_IN_METHOD="facebook.com";Dr.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pr extends Cl{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Us._fromParams({providerId:Pr.PROVIDER_ID,signInMethod:Pr.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Pr.credentialFromTaggedObject(e)}static credentialFromError(e){return Pr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:i}=e;if(!t&&!i)return null;try{return Pr.credential(t,i)}catch{return null}}}Pr.GOOGLE_SIGN_IN_METHOD="google.com";Pr.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Or extends Cl{constructor(){super("github.com")}static credential(e){return Us._fromParams({providerId:Or.PROVIDER_ID,signInMethod:Or.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Or.credentialFromTaggedObject(e)}static credentialFromError(e){return Or.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Or.credential(e.oauthAccessToken)}catch{return null}}}Or.GITHUB_SIGN_IN_METHOD="github.com";Or.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mr extends Cl{constructor(){super("twitter.com")}static credential(e,t){return Us._fromParams({providerId:Mr.PROVIDER_ID,signInMethod:Mr.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Mr.credentialFromTaggedObject(e)}static credentialFromError(e){return Mr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:i}=e;if(!t||!i)return null;try{return Mr.credential(t,i)}catch{return null}}}Mr.TWITTER_SIGN_IN_METHOD="twitter.com";Mr.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ua{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,i,r=!1){const s=await ci._fromIdTokenResponse(e,i,r),a=Y0(i);return new Ua({user:s,providerId:a,_tokenResponse:i,operationType:t})}static async _forOperation(e,t,i){await e._updateTokensIfNecessary(i,!0);const r=Y0(i);return new Ua({user:e,providerId:r,_tokenResponse:i,operationType:t})}}function Y0(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Du extends dr{constructor(e,t,i,r){super(t.code,t.message),this.operationType=i,this.user=r,Object.setPrototypeOf(this,Du.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:i}}static _fromErrorAndOperation(e,t,i,r){return new Du(e,t,i,r)}}function ZE(n,e,t,i){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?Du._fromErrorAndOperation(n,s,e,i):s})}async function Cw(n,e,t=!1){const i=await ll(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Ua._forOperation(n,"link",i)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kw(n,e,t=!1){const{auth:i}=n;if(li(i.app))return Promise.reject(Yr(i));const r="reauthenticate";try{const s=await ll(n,ZE(i,r,e,n),t);Ue(s.idToken,i,"internal-error");const a=hm(s.idToken);Ue(a,i,"internal-error");const{sub:o}=a;return Ue(n.uid===o,i,"user-mismatch"),Ua._forOperation(n,r,s)}catch(s){throw(s==null?void 0:s.code)==="auth/user-not-found"&&pi(i,"user-mismatch"),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function eS(n,e,t=!1){if(li(n.app))return Promise.reject(Yr(n));const i="signIn",r=await ZE(n,i,e),s=await Ua._fromIdTokenResponse(n,i,r);return t||await n._updateCurrentUser(s.user),s}async function Dw(n,e){return eS(zs(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Pw(n){const e=zs(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function Ow(n,e,t){const i=zs(n);await Ff(i,{requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"},"getOobCode",xw)}function Mw(n,e,t){return li(n.app)?Promise.reject(Yr(n)):Dw(hr(n),qa.credential(e,t)).catch(async i=>{throw i.code==="auth/password-does-not-meet-requirements"&&Pw(n),i})}function Nw(n,e,t,i){return hr(n).onIdTokenChanged(e,t,i)}function Bw(n,e,t){return hr(n).beforeAuthStateChanged(e,t)}function Fw(n,e,t,i){return hr(n).onAuthStateChanged(e,t,i)}function Uw(n){return hr(n).signOut()}const Pu="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tS{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Pu,"1"),this.storage.removeItem(Pu),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $w=1e3,Vw=10;class nS extends tS{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=WE(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const i=this.storage.getItem(t),r=this.localCache[t];i!==r&&e(t,r,i)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((a,o,l)=>{this.notifyListeners(a,l)});return}const i=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const a=this.storage.getItem(i);!t&&this.localCache[i]===a||this.notifyListeners(i,a)},s=this.storage.getItem(i);nw()&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,Vw):r()}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const r of Array.from(i))r(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:i}),!0)})},$w)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}nS.type="LOCAL";const jw=nS;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iS extends tS{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}iS.type="SESSION";const rS=iS;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gw(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fd{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(r=>r.isListeningto(e));if(t)return t;const i=new fd(e);return this.receivers.push(i),i}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:i,eventType:r,data:s}=t.data,a=this.handlersMap[r];if(!(a!=null&&a.size))return;t.ports[0].postMessage({status:"ack",eventId:i,eventType:r});const o=Array.from(a).map(async c=>c(t.origin,s)),l=await Gw(o);t.ports[0].postMessage({status:"done",eventId:i,eventType:r,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}fd.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gm(n="",e=10){let t="";for(let i=0;i<e;i++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hw{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,i=50){const r=typeof MessageChannel<"u"?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let s,a;return new Promise((o,l)=>{const c=gm("",20);r.port1.start();const u=setTimeout(()=>{l(new Error("unsupported_event"))},i);a={messageChannel:r,onMessage(d){const h=d;if(h.data.eventId===c)switch(h.data.status){case"ack":clearTimeout(u),s=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),o(h.data.response);break;default:clearTimeout(u),clearTimeout(s),l(new Error("invalid_response"));break}}},this.handlers.add(a),r.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[r.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oi(){return window}function zw(n){Oi().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sS(){return typeof Oi().WorkerGlobalScope<"u"&&typeof Oi().importScripts=="function"}async function Kw(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Ww(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)==null?void 0:n.controller)||null}function qw(){return sS()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aS="firebaseLocalStorageDb",Yw=1,Ou="firebaseLocalStorage",oS="fbase_key";class kl{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function pd(n,e){return n.transaction([Ou],e?"readwrite":"readonly").objectStore(Ou)}function Xw(){const n=indexedDB.deleteDatabase(aS);return new kl(n).toPromise()}function Uf(){const n=indexedDB.open(aS,Yw);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const i=n.result;try{i.createObjectStore(Ou,{keyPath:oS})}catch(r){t(r)}}),n.addEventListener("success",async()=>{const i=n.result;i.objectStoreNames.contains(Ou)?e(i):(i.close(),await Xw(),e(await Uf()))})})}async function X0(n,e,t){const i=pd(n,!0).put({[oS]:e,value:t});return new kl(i).toPromise()}async function Qw(n,e){const t=pd(n,!1).get(e),i=await new kl(t).toPromise();return i===void 0?null:i.value}function Q0(n,e){const t=pd(n,!0).delete(e);return new kl(t).toPromise()}const Jw=800,Zw=3;class lS{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Uf(),this.db)}async _withRetries(e){let t=0;for(;;)try{const i=await this._openDb();return await e(i)}catch(i){if(t++>Zw)throw i;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return sS()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=fd._getInstance(qw()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var t,i;if(this.activeServiceWorker=await Kw(),!this.activeServiceWorker)return;this.sender=new Hw(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(t=e[0])!=null&&t.fulfilled&&(i=e[0])!=null&&i.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||Ww()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Uf();return await X0(e,Pu,"1"),await Q0(e,Pu),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(i=>X0(i,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(i=>Qw(i,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Q0(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(r=>{const s=pd(r,!1).getAll();return new kl(s).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],i=new Set;if(e.length!==0)for(const{fbase_key:r,value:s}of e)i.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(s)&&(this.notifyListeners(r,s),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!i.has(r)&&(this.notifyListeners(r,null),t.push(r));return t}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const r of Array.from(i))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Jw)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}lS.type="LOCAL";const e2=lS;new wl(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t2(n,e){return e?Zi(e):(Ue(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _m extends pm{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ia(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Ia(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Ia(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function n2(n){return eS(n.auth,new _m(n),n.bypassAuthState)}function i2(n){const{auth:e,user:t}=n;return Ue(t,e,"internal-error"),kw(t,new _m(n),n.bypassAuthState)}async function r2(n){const{auth:e,user:t}=n;return Ue(t,e,"internal-error"),Cw(t,new _m(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cS{constructor(e,t,i,r,s=!1){this.auth=e,this.resolver=i,this.user=r,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(i){this.reject(i)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:i,postBody:r,tenantId:s,error:a,type:o}=e;if(a){this.reject(a);return}const l={auth:this.auth,requestUri:t,sessionId:i,tenantId:s||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(l))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return n2;case"linkViaPopup":case"linkViaRedirect":return r2;case"reauthViaPopup":case"reauthViaRedirect":return i2;default:pi(this.auth,"internal-error")}}resolve(e){lr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){lr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const s2=new wl(2e3,1e4);class ga extends cS{constructor(e,t,i,r,s){super(e,t,r,s),this.provider=i,this.authWindow=null,this.pollId=null,ga.currentPopupAction&&ga.currentPopupAction.cancel(),ga.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ue(e,this.auth,"internal-error"),e}async onExecution(){lr(this.filter.length===1,"Popup operations only handle one event");const e=gm();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Pi(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(Pi(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,ga.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,i;if((i=(t=this.authWindow)==null?void 0:t.window)!=null&&i.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Pi(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,s2.get())};e()}}ga.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const a2="pendingRedirect",zc=new Map;class o2 extends cS{constructor(e,t,i=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,i),this.eventId=null}async execute(){let e=zc.get(this.auth._key());if(!e){try{const i=await l2(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(i)}catch(t){e=()=>Promise.reject(t)}zc.set(this.auth._key(),e)}return this.bypassAuthState||zc.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function l2(n,e){const t=d2(e),i=u2(n);if(!await i._isAvailable())return!1;const r=await i._get(t)==="true";return await i._remove(t),r}function c2(n,e){zc.set(n._key(),e)}function u2(n){return Zi(n._redirectPersistence)}function d2(n){return Hc(a2,n.config.apiKey,n.name)}async function h2(n,e,t=!1){if(li(n.app))return Promise.reject(Yr(n));const i=zs(n),r=t2(i,e),a=await new o2(i,r,t).execute();return a&&!t&&(delete a.user._redirectEventId,await i._persistUserIfCurrent(a.user),await i._setRedirectUser(null,e)),a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const f2=10*60*1e3;class p2{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(i=>{this.isEventForConsumer(e,i)&&(t=!0,this.sendToConsumer(e,i),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!m2(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var i;if(e.error&&!uS(e)){const r=((i=e.error.code)==null?void 0:i.split("auth/")[1])||"internal-error";t.onError(Pi(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const i=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&i}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=f2&&this.cachedEventUids.clear(),this.cachedEventUids.has(J0(e))}saveEventToCache(e){this.cachedEventUids.add(J0(e)),this.lastProcessedEventTime=Date.now()}}function J0(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function uS({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function m2(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return uS(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function g2(n,e={}){return fr(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _2=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,y2=/^https?/;async function v2(n){if(n.config.emulator)return;const{authorizedDomains:e}=await g2(n);for(const t of e)try{if(E2(t))return}catch{}pi(n,"unauthorized-domain")}function E2(n){const e=Nf(),{protocol:t,hostname:i}=new URL(e);if(n.startsWith("chrome-extension://")){const a=new URL(n);return a.hostname===""&&i===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===i}if(!y2.test(t))return!1;if(_2.test(n))return i===n;const r=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(i)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S2=new wl(3e4,6e4);function Z0(){const n=Oi().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function T2(n){return new Promise((e,t)=>{var r,s,a;function i(){Z0(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Z0(),t(Pi(n,"network-request-failed"))},timeout:S2.get()})}if((s=(r=Oi().gapi)==null?void 0:r.iframes)!=null&&s.Iframe)e(gapi.iframes.getContext());else if((a=Oi().gapi)!=null&&a.load)i();else{const o=dw("iframefcb");return Oi()[o]=()=>{gapi.load?i():t(Pi(n,"network-request-failed"))},YE(`${uw()}?onload=${o}`).catch(l=>t(l))}}).catch(e=>{throw Kc=null,e})}let Kc=null;function A2(n){return Kc=Kc||T2(n),Kc}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x2=new wl(5e3,15e3),b2="__/auth/iframe",I2="emulator/auth/iframe",R2={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},L2=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function w2(n){const e=n.config;Ue(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?dm(e,I2):`https://${n.config.authDomain}/${b2}`,i={apiKey:e.apiKey,appName:n.name,v:Wa},r=L2.get(n.config.apiHost);r&&(i.eid=r);const s=n._getFrameworks();return s.length&&(i.fw=s.join(",")),`${t}?${Ll(i).slice(1)}`}async function C2(n){const e=await A2(n),t=Oi().gapi;return Ue(t,n,"internal-error"),e.open({where:document.body,url:w2(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:R2,dontclear:!0},i=>new Promise(async(r,s)=>{await i.restyle({setHideOnLeave:!1});const a=Pi(n,"network-request-failed"),o=Oi().setTimeout(()=>{s(a)},x2.get());function l(){Oi().clearTimeout(o),r(i)}i.ping(l).then(l,()=>{s(a)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k2={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},D2=500,P2=600,O2="_blank",M2="http://localhost";class e_{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function N2(n,e,t,i=D2,r=P2){const s=Math.max((window.screen.availHeight-r)/2,0).toString(),a=Math.max((window.screen.availWidth-i)/2,0).toString();let o="";const l={...k2,width:i.toString(),height:r.toString(),top:s,left:a},c=yn().toLowerCase();t&&(o=jE(c)?O2:t),$E(c)&&(e=e||M2,l.scrollbars="yes");const u=Object.entries(l).reduce((h,[m,g])=>`${h}${m}=${g},`,"");if(tw(c)&&o!=="_self")return B2(e||"",o),new e_(null);const d=window.open(e||"",o,u);Ue(d,n,"popup-blocked");try{d.focus()}catch{}return new e_(d)}function B2(n,e){const t=document.createElement("a");t.href=n,t.target=e;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(i)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F2="__/auth/handler",U2="emulator/auth/handler",$2=encodeURIComponent("fac");async function t_(n,e,t,i,r,s){Ue(n.config.authDomain,n,"auth-domain-config-required"),Ue(n.config.apiKey,n,"invalid-api-key");const a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:i,v:Wa,eventId:r};if(e instanceof JE){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",AR(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[u,d]of Object.entries({}))a[u]=d}if(e instanceof Cl){const u=e.getScopes().filter(d=>d!=="");u.length>0&&(a.scopes=u.join(","))}n.tenantId&&(a.tid=n.tenantId);const o=a;for(const u of Object.keys(o))o[u]===void 0&&delete o[u];const l=await n._getAppCheckToken(),c=l?`#${$2}=${encodeURIComponent(l)}`:"";return`${V2(n)}?${Ll(o).slice(1)}${c}`}function V2({config:n}){return n.emulator?dm(n,U2):`https://${n.authDomain}/${F2}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uh="webStorageSupport";class j2{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=rS,this._completeRedirectFn=h2,this._overrideRedirectResult=c2}async _openPopup(e,t,i,r){var a;lr((a=this.eventManagers[e._key()])==null?void 0:a.manager,"_initialize() not called before _openPopup()");const s=await t_(e,t,i,Nf(),r);return N2(e,s,gm())}async _openRedirect(e,t,i,r){await this._originValidation(e);const s=await t_(e,t,i,Nf(),r);return zw(s),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:r,promise:s}=this.eventManagers[t];return r?Promise.resolve(r):(lr(s,"If manager is not set, promise should be"),s)}const i=this.initAndGetManager(e);return this.eventManagers[t]={promise:i},i.catch(()=>{delete this.eventManagers[t]}),i}async initAndGetManager(e){const t=await C2(e),i=new p2(e);return t.register("authEvent",r=>(Ue(r==null?void 0:r.authEvent,e,"invalid-auth-event"),{status:i.onEvent(r.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:i},this.iframes[e._key()]=t,i}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(uh,{type:uh},r=>{var a;const s=(a=r==null?void 0:r[0])==null?void 0:a[uh];s!==void 0&&t(!!s),pi(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=v2(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return WE()||VE()||fm()}}const G2=j2;var n_="@firebase/auth",i_="1.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H2{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(i=>{e((i==null?void 0:i.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Ue(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function z2(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function K2(n){Fa(new Fs("auth",(e,{options:t})=>{const i=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:a,authDomain:o}=i.options;Ue(a&&!a.includes(":"),"invalid-api-key",{appName:i.name});const l={apiKey:a,authDomain:o,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:qE(n)},c=new ow(i,r,s,l);return _w(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,i)=>{e.getProvider("auth-internal").initialize()})),Fa(new Fs("auth-internal",e=>{const t=zs(e.getProvider("auth").getImmediate());return(i=>new H2(i))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),qr(n_,i_,z2(n)),qr(n_,i_,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W2=5*60,q2=AE("authIdTokenMaxAge")||W2;let r_=null;const Y2=n=>async e=>{const t=e&&await e.getIdTokenResult(),i=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(i&&i>q2)return;const r=t==null?void 0:t.token;r_!==r&&(r_=r,await fetch(n,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))};function X2(n=wE()){const e=cm(n,"auth");if(e.isInitialized())return e.getImmediate();const t=gw(n,{popupRedirectResolver:G2,persistence:[e2,jw,rS]}),i=AE("authTokenSyncURL");if(i&&typeof isSecureContext=="boolean"&&isSecureContext){const s=new URL(i,location.origin);if(location.origin===s.origin){const a=Y2(s.toString());Bw(t,a,()=>a(t.currentUser)),Nw(t,o=>a(o))}}const r=SE("auth");return r&&yw(t,`http://${r}`),t}function Q2(){var n;return((n=document.getElementsByTagName("head"))==null?void 0:n[0])??document}lw({loadJS(n){return new Promise((e,t)=>{const i=document.createElement("script");i.setAttribute("src",n),i.onload=e,i.onerror=r=>{const s=Pi("internal-error");s.customData=r,t(s)},i.type="text/javascript",i.charset="UTF-8",Q2().appendChild(i)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});K2("Browser");var J2="firebase",Z2="12.1.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */qr(J2,Z2,"app");var s_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var ym;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(C,S){function b(){}b.prototype=S.prototype,C.D=S.prototype,C.prototype=new b,C.prototype.constructor=C,C.C=function(T,L,F){for(var U=Array(arguments.length-2),Z=2;Z<arguments.length;Z++)U[Z-2]=arguments[Z];return S.prototype[L].apply(T,U)}}function t(){this.blockSize=-1}function i(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(i,t),i.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function r(C,S,b){b||(b=0);var T=Array(16);if(typeof S=="string")for(var L=0;16>L;++L)T[L]=S.charCodeAt(b++)|S.charCodeAt(b++)<<8|S.charCodeAt(b++)<<16|S.charCodeAt(b++)<<24;else for(L=0;16>L;++L)T[L]=S[b++]|S[b++]<<8|S[b++]<<16|S[b++]<<24;S=C.g[0],b=C.g[1],L=C.g[2];var F=C.g[3],U=S+(F^b&(L^F))+T[0]+3614090360&4294967295;S=b+(U<<7&4294967295|U>>>25),U=F+(L^S&(b^L))+T[1]+3905402710&4294967295,F=S+(U<<12&4294967295|U>>>20),U=L+(b^F&(S^b))+T[2]+606105819&4294967295,L=F+(U<<17&4294967295|U>>>15),U=b+(S^L&(F^S))+T[3]+3250441966&4294967295,b=L+(U<<22&4294967295|U>>>10),U=S+(F^b&(L^F))+T[4]+4118548399&4294967295,S=b+(U<<7&4294967295|U>>>25),U=F+(L^S&(b^L))+T[5]+1200080426&4294967295,F=S+(U<<12&4294967295|U>>>20),U=L+(b^F&(S^b))+T[6]+2821735955&4294967295,L=F+(U<<17&4294967295|U>>>15),U=b+(S^L&(F^S))+T[7]+4249261313&4294967295,b=L+(U<<22&4294967295|U>>>10),U=S+(F^b&(L^F))+T[8]+1770035416&4294967295,S=b+(U<<7&4294967295|U>>>25),U=F+(L^S&(b^L))+T[9]+2336552879&4294967295,F=S+(U<<12&4294967295|U>>>20),U=L+(b^F&(S^b))+T[10]+4294925233&4294967295,L=F+(U<<17&4294967295|U>>>15),U=b+(S^L&(F^S))+T[11]+2304563134&4294967295,b=L+(U<<22&4294967295|U>>>10),U=S+(F^b&(L^F))+T[12]+1804603682&4294967295,S=b+(U<<7&4294967295|U>>>25),U=F+(L^S&(b^L))+T[13]+4254626195&4294967295,F=S+(U<<12&4294967295|U>>>20),U=L+(b^F&(S^b))+T[14]+2792965006&4294967295,L=F+(U<<17&4294967295|U>>>15),U=b+(S^L&(F^S))+T[15]+1236535329&4294967295,b=L+(U<<22&4294967295|U>>>10),U=S+(L^F&(b^L))+T[1]+4129170786&4294967295,S=b+(U<<5&4294967295|U>>>27),U=F+(b^L&(S^b))+T[6]+3225465664&4294967295,F=S+(U<<9&4294967295|U>>>23),U=L+(S^b&(F^S))+T[11]+643717713&4294967295,L=F+(U<<14&4294967295|U>>>18),U=b+(F^S&(L^F))+T[0]+3921069994&4294967295,b=L+(U<<20&4294967295|U>>>12),U=S+(L^F&(b^L))+T[5]+3593408605&4294967295,S=b+(U<<5&4294967295|U>>>27),U=F+(b^L&(S^b))+T[10]+38016083&4294967295,F=S+(U<<9&4294967295|U>>>23),U=L+(S^b&(F^S))+T[15]+3634488961&4294967295,L=F+(U<<14&4294967295|U>>>18),U=b+(F^S&(L^F))+T[4]+3889429448&4294967295,b=L+(U<<20&4294967295|U>>>12),U=S+(L^F&(b^L))+T[9]+568446438&4294967295,S=b+(U<<5&4294967295|U>>>27),U=F+(b^L&(S^b))+T[14]+3275163606&4294967295,F=S+(U<<9&4294967295|U>>>23),U=L+(S^b&(F^S))+T[3]+4107603335&4294967295,L=F+(U<<14&4294967295|U>>>18),U=b+(F^S&(L^F))+T[8]+1163531501&4294967295,b=L+(U<<20&4294967295|U>>>12),U=S+(L^F&(b^L))+T[13]+2850285829&4294967295,S=b+(U<<5&4294967295|U>>>27),U=F+(b^L&(S^b))+T[2]+4243563512&4294967295,F=S+(U<<9&4294967295|U>>>23),U=L+(S^b&(F^S))+T[7]+1735328473&4294967295,L=F+(U<<14&4294967295|U>>>18),U=b+(F^S&(L^F))+T[12]+2368359562&4294967295,b=L+(U<<20&4294967295|U>>>12),U=S+(b^L^F)+T[5]+4294588738&4294967295,S=b+(U<<4&4294967295|U>>>28),U=F+(S^b^L)+T[8]+2272392833&4294967295,F=S+(U<<11&4294967295|U>>>21),U=L+(F^S^b)+T[11]+1839030562&4294967295,L=F+(U<<16&4294967295|U>>>16),U=b+(L^F^S)+T[14]+4259657740&4294967295,b=L+(U<<23&4294967295|U>>>9),U=S+(b^L^F)+T[1]+2763975236&4294967295,S=b+(U<<4&4294967295|U>>>28),U=F+(S^b^L)+T[4]+1272893353&4294967295,F=S+(U<<11&4294967295|U>>>21),U=L+(F^S^b)+T[7]+4139469664&4294967295,L=F+(U<<16&4294967295|U>>>16),U=b+(L^F^S)+T[10]+3200236656&4294967295,b=L+(U<<23&4294967295|U>>>9),U=S+(b^L^F)+T[13]+681279174&4294967295,S=b+(U<<4&4294967295|U>>>28),U=F+(S^b^L)+T[0]+3936430074&4294967295,F=S+(U<<11&4294967295|U>>>21),U=L+(F^S^b)+T[3]+3572445317&4294967295,L=F+(U<<16&4294967295|U>>>16),U=b+(L^F^S)+T[6]+76029189&4294967295,b=L+(U<<23&4294967295|U>>>9),U=S+(b^L^F)+T[9]+3654602809&4294967295,S=b+(U<<4&4294967295|U>>>28),U=F+(S^b^L)+T[12]+3873151461&4294967295,F=S+(U<<11&4294967295|U>>>21),U=L+(F^S^b)+T[15]+530742520&4294967295,L=F+(U<<16&4294967295|U>>>16),U=b+(L^F^S)+T[2]+3299628645&4294967295,b=L+(U<<23&4294967295|U>>>9),U=S+(L^(b|~F))+T[0]+4096336452&4294967295,S=b+(U<<6&4294967295|U>>>26),U=F+(b^(S|~L))+T[7]+1126891415&4294967295,F=S+(U<<10&4294967295|U>>>22),U=L+(S^(F|~b))+T[14]+2878612391&4294967295,L=F+(U<<15&4294967295|U>>>17),U=b+(F^(L|~S))+T[5]+4237533241&4294967295,b=L+(U<<21&4294967295|U>>>11),U=S+(L^(b|~F))+T[12]+1700485571&4294967295,S=b+(U<<6&4294967295|U>>>26),U=F+(b^(S|~L))+T[3]+2399980690&4294967295,F=S+(U<<10&4294967295|U>>>22),U=L+(S^(F|~b))+T[10]+4293915773&4294967295,L=F+(U<<15&4294967295|U>>>17),U=b+(F^(L|~S))+T[1]+2240044497&4294967295,b=L+(U<<21&4294967295|U>>>11),U=S+(L^(b|~F))+T[8]+1873313359&4294967295,S=b+(U<<6&4294967295|U>>>26),U=F+(b^(S|~L))+T[15]+4264355552&4294967295,F=S+(U<<10&4294967295|U>>>22),U=L+(S^(F|~b))+T[6]+2734768916&4294967295,L=F+(U<<15&4294967295|U>>>17),U=b+(F^(L|~S))+T[13]+1309151649&4294967295,b=L+(U<<21&4294967295|U>>>11),U=S+(L^(b|~F))+T[4]+4149444226&4294967295,S=b+(U<<6&4294967295|U>>>26),U=F+(b^(S|~L))+T[11]+3174756917&4294967295,F=S+(U<<10&4294967295|U>>>22),U=L+(S^(F|~b))+T[2]+718787259&4294967295,L=F+(U<<15&4294967295|U>>>17),U=b+(F^(L|~S))+T[9]+3951481745&4294967295,C.g[0]=C.g[0]+S&4294967295,C.g[1]=C.g[1]+(L+(U<<21&4294967295|U>>>11))&4294967295,C.g[2]=C.g[2]+L&4294967295,C.g[3]=C.g[3]+F&4294967295}i.prototype.u=function(C,S){S===void 0&&(S=C.length);for(var b=S-this.blockSize,T=this.B,L=this.h,F=0;F<S;){if(L==0)for(;F<=b;)r(this,C,F),F+=this.blockSize;if(typeof C=="string"){for(;F<S;)if(T[L++]=C.charCodeAt(F++),L==this.blockSize){r(this,T),L=0;break}}else for(;F<S;)if(T[L++]=C[F++],L==this.blockSize){r(this,T),L=0;break}}this.h=L,this.o+=S},i.prototype.v=function(){var C=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);C[0]=128;for(var S=1;S<C.length-8;++S)C[S]=0;var b=8*this.o;for(S=C.length-8;S<C.length;++S)C[S]=b&255,b/=256;for(this.u(C),C=Array(16),S=b=0;4>S;++S)for(var T=0;32>T;T+=8)C[b++]=this.g[S]>>>T&255;return C};function s(C,S){var b=o;return Object.prototype.hasOwnProperty.call(b,C)?b[C]:b[C]=S(C)}function a(C,S){this.h=S;for(var b=[],T=!0,L=C.length-1;0<=L;L--){var F=C[L]|0;T&&F==S||(b[L]=F,T=!1)}this.g=b}var o={};function l(C){return-128<=C&&128>C?s(C,function(S){return new a([S|0],0>S?-1:0)}):new a([C|0],0>C?-1:0)}function c(C){if(isNaN(C)||!isFinite(C))return d;if(0>C)return x(c(-C));for(var S=[],b=1,T=0;C>=b;T++)S[T]=C/b|0,b*=4294967296;return new a(S,0)}function u(C,S){if(C.length==0)throw Error("number format error: empty string");if(S=S||10,2>S||36<S)throw Error("radix out of range: "+S);if(C.charAt(0)=="-")return x(u(C.substring(1),S));if(0<=C.indexOf("-"))throw Error('number format error: interior "-" character');for(var b=c(Math.pow(S,8)),T=d,L=0;L<C.length;L+=8){var F=Math.min(8,C.length-L),U=parseInt(C.substring(L,L+F),S);8>F?(F=c(Math.pow(S,F)),T=T.j(F).add(c(U))):(T=T.j(b),T=T.add(c(U)))}return T}var d=l(0),h=l(1),m=l(16777216);n=a.prototype,n.m=function(){if(v(this))return-x(this).m();for(var C=0,S=1,b=0;b<this.g.length;b++){var T=this.i(b);C+=(0<=T?T:4294967296+T)*S,S*=4294967296}return C},n.toString=function(C){if(C=C||10,2>C||36<C)throw Error("radix out of range: "+C);if(g(this))return"0";if(v(this))return"-"+x(this).toString(C);for(var S=c(Math.pow(C,6)),b=this,T="";;){var L=D(b,S).g;b=E(b,L.j(S));var F=((0<b.g.length?b.g[0]:b.h)>>>0).toString(C);if(b=L,g(b))return F+T;for(;6>F.length;)F="0"+F;T=F+T}},n.i=function(C){return 0>C?0:C<this.g.length?this.g[C]:this.h};function g(C){if(C.h!=0)return!1;for(var S=0;S<C.g.length;S++)if(C.g[S]!=0)return!1;return!0}function v(C){return C.h==-1}n.l=function(C){return C=E(this,C),v(C)?-1:g(C)?0:1};function x(C){for(var S=C.g.length,b=[],T=0;T<S;T++)b[T]=~C.g[T];return new a(b,~C.h).add(h)}n.abs=function(){return v(this)?x(this):this},n.add=function(C){for(var S=Math.max(this.g.length,C.g.length),b=[],T=0,L=0;L<=S;L++){var F=T+(this.i(L)&65535)+(C.i(L)&65535),U=(F>>>16)+(this.i(L)>>>16)+(C.i(L)>>>16);T=U>>>16,F&=65535,U&=65535,b[L]=U<<16|F}return new a(b,b[b.length-1]&-2147483648?-1:0)};function E(C,S){return C.add(x(S))}n.j=function(C){if(g(this)||g(C))return d;if(v(this))return v(C)?x(this).j(x(C)):x(x(this).j(C));if(v(C))return x(this.j(x(C)));if(0>this.l(m)&&0>C.l(m))return c(this.m()*C.m());for(var S=this.g.length+C.g.length,b=[],T=0;T<2*S;T++)b[T]=0;for(T=0;T<this.g.length;T++)for(var L=0;L<C.g.length;L++){var F=this.i(T)>>>16,U=this.i(T)&65535,Z=C.i(L)>>>16,ie=C.i(L)&65535;b[2*T+2*L]+=U*ie,R(b,2*T+2*L),b[2*T+2*L+1]+=F*ie,R(b,2*T+2*L+1),b[2*T+2*L+1]+=U*Z,R(b,2*T+2*L+1),b[2*T+2*L+2]+=F*Z,R(b,2*T+2*L+2)}for(T=0;T<S;T++)b[T]=b[2*T+1]<<16|b[2*T];for(T=S;T<2*S;T++)b[T]=0;return new a(b,0)};function R(C,S){for(;(C[S]&65535)!=C[S];)C[S+1]+=C[S]>>>16,C[S]&=65535,S++}function k(C,S){this.g=C,this.h=S}function D(C,S){if(g(S))throw Error("division by zero");if(g(C))return new k(d,d);if(v(C))return S=D(x(C),S),new k(x(S.g),x(S.h));if(v(S))return S=D(C,x(S)),new k(x(S.g),S.h);if(30<C.g.length){if(v(C)||v(S))throw Error("slowDivide_ only works with positive integers.");for(var b=h,T=S;0>=T.l(C);)b=V(b),T=V(T);var L=H(b,1),F=H(T,1);for(T=H(T,2),b=H(b,2);!g(T);){var U=F.add(T);0>=U.l(C)&&(L=L.add(b),F=U),T=H(T,1),b=H(b,1)}return S=E(C,L.j(S)),new k(L,S)}for(L=d;0<=C.l(S);){for(b=Math.max(1,Math.floor(C.m()/S.m())),T=Math.ceil(Math.log(b)/Math.LN2),T=48>=T?1:Math.pow(2,T-48),F=c(b),U=F.j(S);v(U)||0<U.l(C);)b-=T,F=c(b),U=F.j(S);g(F)&&(F=h),L=L.add(F),C=E(C,U)}return new k(L,C)}n.A=function(C){return D(this,C).h},n.and=function(C){for(var S=Math.max(this.g.length,C.g.length),b=[],T=0;T<S;T++)b[T]=this.i(T)&C.i(T);return new a(b,this.h&C.h)},n.or=function(C){for(var S=Math.max(this.g.length,C.g.length),b=[],T=0;T<S;T++)b[T]=this.i(T)|C.i(T);return new a(b,this.h|C.h)},n.xor=function(C){for(var S=Math.max(this.g.length,C.g.length),b=[],T=0;T<S;T++)b[T]=this.i(T)^C.i(T);return new a(b,this.h^C.h)};function V(C){for(var S=C.g.length+1,b=[],T=0;T<S;T++)b[T]=C.i(T)<<1|C.i(T-1)>>>31;return new a(b,C.h)}function H(C,S){var b=S>>5;S%=32;for(var T=C.g.length-b,L=[],F=0;F<T;F++)L[F]=0<S?C.i(F+b)>>>S|C.i(F+b+1)<<32-S:C.i(F+b);return new a(L,C.h)}i.prototype.digest=i.prototype.v,i.prototype.reset=i.prototype.s,i.prototype.update=i.prototype.u,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=c,a.fromString=u,ym=a}).apply(typeof s_<"u"?s_:typeof self<"u"?self:typeof window<"u"?window:{});var hc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(f,w,N){return f==Array.prototype||f==Object.prototype||(f[w]=N.value),f};function t(f){f=[typeof globalThis=="object"&&globalThis,f,typeof window=="object"&&window,typeof self=="object"&&self,typeof hc=="object"&&hc];for(var w=0;w<f.length;++w){var N=f[w];if(N&&N.Math==Math)return N}throw Error("Cannot find global object")}var i=t(this);function r(f,w){if(w)e:{var N=i;f=f.split(".");for(var G=0;G<f.length-1;G++){var re=f[G];if(!(re in N))break e;N=N[re]}f=f[f.length-1],G=N[f],w=w(G),w!=G&&w!=null&&e(N,f,{configurable:!0,writable:!0,value:w})}}function s(f,w){f instanceof String&&(f+="");var N=0,G=!1,re={next:function(){if(!G&&N<f.length){var ue=N++;return{value:w(ue,f[ue]),done:!1}}return G=!0,{done:!0,value:void 0}}};return re[Symbol.iterator]=function(){return re},re}r("Array.prototype.values",function(f){return f||function(){return s(this,function(w,N){return N})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var a=a||{},o=this||self;function l(f){var w=typeof f;return w=w!="object"?w:f?Array.isArray(f)?"array":w:"null",w=="array"||w=="object"&&typeof f.length=="number"}function c(f){var w=typeof f;return w=="object"&&f!=null||w=="function"}function u(f,w,N){return f.call.apply(f.bind,arguments)}function d(f,w,N){if(!f)throw Error();if(2<arguments.length){var G=Array.prototype.slice.call(arguments,2);return function(){var re=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(re,G),f.apply(w,re)}}return function(){return f.apply(w,arguments)}}function h(f,w,N){return h=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?u:d,h.apply(null,arguments)}function m(f,w){var N=Array.prototype.slice.call(arguments,1);return function(){var G=N.slice();return G.push.apply(G,arguments),f.apply(this,G)}}function g(f,w){function N(){}N.prototype=w.prototype,f.aa=w.prototype,f.prototype=new N,f.prototype.constructor=f,f.Qb=function(G,re,ue){for(var Se=Array(arguments.length-2),dt=2;dt<arguments.length;dt++)Se[dt-2]=arguments[dt];return w.prototype[re].apply(G,Se)}}function v(f){const w=f.length;if(0<w){const N=Array(w);for(let G=0;G<w;G++)N[G]=f[G];return N}return[]}function x(f,w){for(let N=1;N<arguments.length;N++){const G=arguments[N];if(l(G)){const re=f.length||0,ue=G.length||0;f.length=re+ue;for(let Se=0;Se<ue;Se++)f[re+Se]=G[Se]}else f.push(G)}}class E{constructor(w,N){this.i=w,this.j=N,this.h=0,this.g=null}get(){let w;return 0<this.h?(this.h--,w=this.g,this.g=w.next,w.next=null):w=this.i(),w}}function R(f){return/^[\s\xa0]*$/.test(f)}function k(){var f=o.navigator;return f&&(f=f.userAgent)?f:""}function D(f){return D[" "](f),f}D[" "]=function(){};var V=k().indexOf("Gecko")!=-1&&!(k().toLowerCase().indexOf("webkit")!=-1&&k().indexOf("Edge")==-1)&&!(k().indexOf("Trident")!=-1||k().indexOf("MSIE")!=-1)&&k().indexOf("Edge")==-1;function H(f,w,N){for(const G in f)w.call(N,f[G],G,f)}function C(f,w){for(const N in f)w.call(void 0,f[N],N,f)}function S(f){const w={};for(const N in f)w[N]=f[N];return w}const b="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function T(f,w){let N,G;for(let re=1;re<arguments.length;re++){G=arguments[re];for(N in G)f[N]=G[N];for(let ue=0;ue<b.length;ue++)N=b[ue],Object.prototype.hasOwnProperty.call(G,N)&&(f[N]=G[N])}}function L(f){var w=1;f=f.split(":");const N=[];for(;0<w&&f.length;)N.push(f.shift()),w--;return f.length&&N.push(f.join(":")),N}function F(f){o.setTimeout(()=>{throw f},0)}function U(){var f=j;let w=null;return f.g&&(w=f.g,f.g=f.g.next,f.g||(f.h=null),w.next=null),w}class Z{constructor(){this.h=this.g=null}add(w,N){const G=ie.get();G.set(w,N),this.h?this.h.next=G:this.g=G,this.h=G}}var ie=new E(()=>new le,f=>f.reset());class le{constructor(){this.next=this.g=this.h=null}set(w,N){this.h=w,this.g=N,this.next=null}reset(){this.next=this.g=this.h=null}}let ge,te=!1,j=new Z,$=()=>{const f=o.Promise.resolve(void 0);ge=()=>{f.then(q)}};var q=()=>{for(var f;f=U();){try{f.h.call(f.g)}catch(N){F(N)}var w=ie;w.j(f),100>w.h&&(w.h++,f.next=w.g,w.g=f)}te=!1};function Q(){this.s=this.s,this.C=this.C}Q.prototype.s=!1,Q.prototype.ma=function(){this.s||(this.s=!0,this.N())},Q.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function fe(f,w){this.type=f,this.g=this.target=w,this.defaultPrevented=!1}fe.prototype.h=function(){this.defaultPrevented=!0};var ve=function(){if(!o.addEventListener||!Object.defineProperty)return!1;var f=!1,w=Object.defineProperty({},"passive",{get:function(){f=!0}});try{const N=()=>{};o.addEventListener("test",N,w),o.removeEventListener("test",N,w)}catch{}return f}();function be(f,w){if(fe.call(this,f?f.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,f){var N=this.type=f.type,G=f.changedTouches&&f.changedTouches.length?f.changedTouches[0]:null;if(this.target=f.target||f.srcElement,this.g=w,w=f.relatedTarget){if(V){e:{try{D(w.nodeName);var re=!0;break e}catch{}re=!1}re||(w=null)}}else N=="mouseover"?w=f.fromElement:N=="mouseout"&&(w=f.toElement);this.relatedTarget=w,G?(this.clientX=G.clientX!==void 0?G.clientX:G.pageX,this.clientY=G.clientY!==void 0?G.clientY:G.pageY,this.screenX=G.screenX||0,this.screenY=G.screenY||0):(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0),this.button=f.button,this.key=f.key||"",this.ctrlKey=f.ctrlKey,this.altKey=f.altKey,this.shiftKey=f.shiftKey,this.metaKey=f.metaKey,this.pointerId=f.pointerId||0,this.pointerType=typeof f.pointerType=="string"?f.pointerType:xe[f.pointerType]||"",this.state=f.state,this.i=f,f.defaultPrevented&&be.aa.h.call(this)}}g(be,fe);var xe={2:"touch",3:"pen",4:"mouse"};be.prototype.h=function(){be.aa.h.call(this);var f=this.i;f.preventDefault?f.preventDefault():f.returnValue=!1};var ce="closure_listenable_"+(1e6*Math.random()|0),pe=0;function Ie(f,w,N,G,re){this.listener=f,this.proxy=null,this.src=w,this.type=N,this.capture=!!G,this.ha=re,this.key=++pe,this.da=this.fa=!1}function Le(f){f.da=!0,f.listener=null,f.proxy=null,f.src=null,f.ha=null}function ke(f){this.src=f,this.g={},this.h=0}ke.prototype.add=function(f,w,N,G,re){var ue=f.toString();f=this.g[ue],f||(f=this.g[ue]=[],this.h++);var Se=ft(f,w,G,re);return-1<Se?(w=f[Se],N||(w.fa=!1)):(w=new Ie(w,this.src,ue,!!G,re),w.fa=N,f.push(w)),w};function ze(f,w){var N=w.type;if(N in f.g){var G=f.g[N],re=Array.prototype.indexOf.call(G,w,void 0),ue;(ue=0<=re)&&Array.prototype.splice.call(G,re,1),ue&&(Le(w),f.g[N].length==0&&(delete f.g[N],f.h--))}}function ft(f,w,N,G){for(var re=0;re<f.length;++re){var ue=f[re];if(!ue.da&&ue.listener==w&&ue.capture==!!N&&ue.ha==G)return re}return-1}var gt="closure_lm_"+(1e6*Math.random()|0),dn={};function Oe(f,w,N,G,re){if(Array.isArray(w)){for(var ue=0;ue<w.length;ue++)Oe(f,w[ue],N,G,re);return null}return N=ss(N),f&&f[ce]?f.K(w,N,c(G)?!!G.capture:!!G,re):Et(f,w,N,!1,G,re)}function Et(f,w,N,G,re,ue){if(!w)throw Error("Invalid event type");var Se=c(re)?!!re.capture:!!re,dt=pr(f);if(dt||(f[gt]=dt=new ke(f)),N=dt.add(w,N,G,Se,ue),N.proxy)return N;if(G=$t(),N.proxy=G,G.src=f,G.listener=N,f.addEventListener)ve||(re=Se),re===void 0&&(re=!1),f.addEventListener(w.toString(),G,re);else if(f.attachEvent)f.attachEvent(Qn(w.toString()),G);else if(f.addListener&&f.removeListener)f.addListener(G);else throw Error("addEventListener and attachEvent are unavailable.");return N}function $t(){function f(N){return w.call(f.src,f.listener,N)}const w=Jn;return f}function Sn(f,w,N,G,re){if(Array.isArray(w))for(var ue=0;ue<w.length;ue++)Sn(f,w[ue],N,G,re);else G=c(G)?!!G.capture:!!G,N=ss(N),f&&f[ce]?(f=f.i,w=String(w).toString(),w in f.g&&(ue=f.g[w],N=ft(ue,N,G,re),-1<N&&(Le(ue[N]),Array.prototype.splice.call(ue,N,1),ue.length==0&&(delete f.g[w],f.h--)))):f&&(f=pr(f))&&(w=f.g[w.toString()],f=-1,w&&(f=ft(w,N,G,re)),(N=-1<f?w[f]:null)&&Vt(N))}function Vt(f){if(typeof f!="number"&&f&&!f.da){var w=f.src;if(w&&w[ce])ze(w.i,f);else{var N=f.type,G=f.proxy;w.removeEventListener?w.removeEventListener(N,G,f.capture):w.detachEvent?w.detachEvent(Qn(N),G):w.addListener&&w.removeListener&&w.removeListener(G),(N=pr(w))?(ze(N,f),N.h==0&&(N.src=null,w[gt]=null)):Le(f)}}}function Qn(f){return f in dn?dn[f]:dn[f]="on"+f}function Jn(f,w){if(f.da)f=!0;else{w=new be(w,this);var N=f.listener,G=f.ha||f.src;f.fa&&Vt(f),f=N.call(G,w)}return f}function pr(f){return f=f[gt],f instanceof ke?f:null}var gi="__closure_events_fn_"+(1e9*Math.random()>>>0);function ss(f){return typeof f=="function"?f:(f[gi]||(f[gi]=function(w){return f.handleEvent(w)}),f[gi])}function St(){Q.call(this),this.i=new ke(this),this.M=this,this.F=null}g(St,Q),St.prototype[ce]=!0,St.prototype.removeEventListener=function(f,w,N,G){Sn(this,f,w,N,G)};function Mt(f,w){var N,G=f.F;if(G)for(N=[];G;G=G.F)N.push(G);if(f=f.M,G=w.type||w,typeof w=="string")w=new fe(w,f);else if(w instanceof fe)w.target=w.target||f;else{var re=w;w=new fe(G,f),T(w,re)}if(re=!0,N)for(var ue=N.length-1;0<=ue;ue--){var Se=w.g=N[ue];re=mr(Se,G,!0,w)&&re}if(Se=w.g=f,re=mr(Se,G,!0,w)&&re,re=mr(Se,G,!1,w)&&re,N)for(ue=0;ue<N.length;ue++)Se=w.g=N[ue],re=mr(Se,G,!1,w)&&re}St.prototype.N=function(){if(St.aa.N.call(this),this.i){var f=this.i,w;for(w in f.g){for(var N=f.g[w],G=0;G<N.length;G++)Le(N[G]);delete f.g[w],f.h--}}this.F=null},St.prototype.K=function(f,w,N,G){return this.i.add(String(f),w,!1,N,G)},St.prototype.L=function(f,w,N,G){return this.i.add(String(f),w,!0,N,G)};function mr(f,w,N,G){if(w=f.i.g[String(w)],!w)return!0;w=w.concat();for(var re=!0,ue=0;ue<w.length;++ue){var Se=w[ue];if(Se&&!Se.da&&Se.capture==N){var dt=Se.listener,Zt=Se.ha||Se.src;Se.fa&&ze(f.i,Se),re=dt.call(Zt,G)!==!1&&re}}return re&&!G.defaultPrevented}function as(f,w,N){if(typeof f=="function")N&&(f=h(f,N));else if(f&&typeof f.handleEvent=="function")f=h(f.handleEvent,f);else throw Error("Invalid listener argument");return 2147483647<Number(w)?-1:o.setTimeout(f,w||0)}function os(f){f.g=as(()=>{f.g=null,f.i&&(f.i=!1,os(f))},f.l);const w=f.h;f.h=null,f.m.apply(null,w)}class Ui extends Q{constructor(w,N){super(),this.m=w,this.l=N,this.h=null,this.i=!1,this.g=null}j(w){this.h=arguments,this.g?this.i=!0:os(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ls(f){Q.call(this),this.h=f,this.g={}}g(ls,Q);var Ol=[];function Ml(f){H(f.g,function(w,N){this.g.hasOwnProperty(N)&&Vt(w)},f),f.g={}}ls.prototype.N=function(){ls.aa.N.call(this),Ml(this)},ls.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ya=o.JSON.stringify,vd=o.JSON.parse,Ed=class{stringify(f){return o.JSON.stringify(f,void 0)}parse(f){return o.JSON.parse(f,void 0)}};function Xa(){}Xa.prototype.h=null;function Nl(f){return f.h||(f.h=f.i())}function Sd(){}var cs={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Qa(){fe.call(this,"d")}g(Qa,fe);function Ja(){fe.call(this,"c")}g(Ja,fe);var gr={},Bl=null;function Zn(){return Bl=Bl||new St}gr.La="serverreachability";function Za(f){fe.call(this,gr.La,f)}g(Za,fe);function _r(f){const w=Zn();Mt(w,new Za(w))}gr.STAT_EVENT="statevent";function eo(f,w){fe.call(this,gr.STAT_EVENT,f),this.stat=w}g(eo,fe);function Rt(f){const w=Zn();Mt(w,new eo(w,f))}gr.Ma="timingevent";function to(f,w){fe.call(this,gr.Ma,f),this.size=w}g(to,fe);function hn(f,w){if(typeof f!="function")throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){f()},w)}function yr(){this.g=!0}yr.prototype.xa=function(){this.g=!1};function Td(f,w,N,G,re,ue){f.info(function(){if(f.g)if(ue)for(var Se="",dt=ue.split("&"),Zt=0;Zt<dt.length;Zt++){var nt=dt[Zt].split("=");if(1<nt.length){var rn=nt[0];nt=nt[1];var sn=rn.split("_");Se=2<=sn.length&&sn[1]=="type"?Se+(rn+"="+nt+"&"):Se+(rn+"=redacted&")}}else Se=null;else Se=ue;return"XMLHTTP REQ ("+G+") [attempt "+re+"]: "+w+`
`+N+`
`+Se})}function Dt(f,w,N,G,re,ue,Se){f.info(function(){return"XMLHTTP RESP ("+G+") [ attempt "+re+"]: "+w+`
`+N+`
`+ue+" "+Se})}function vr(f,w,N,G){f.info(function(){return"XMLHTTP TEXT ("+w+"): "+y(f,N)+(G?" "+G:"")})}function A(f,w){f.info(function(){return"TIMEOUT: "+w})}yr.prototype.info=function(){};function y(f,w){if(!f.g)return w;if(!w)return null;try{var N=JSON.parse(w);if(N){for(f=0;f<N.length;f++)if(Array.isArray(N[f])){var G=N[f];if(!(2>G.length)){var re=G[1];if(Array.isArray(re)&&!(1>re.length)){var ue=re[0];if(ue!="noop"&&ue!="stop"&&ue!="close")for(var Se=1;Se<re.length;Se++)re[Se]=""}}}}return Ya(N)}catch{return w}}var _={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},p={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},I;function M(){}g(M,Xa),M.prototype.g=function(){return new XMLHttpRequest},M.prototype.i=function(){return{}},I=new M;function P(f,w,N,G){this.j=f,this.i=w,this.l=N,this.R=G||1,this.U=new ls(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new B}function B(){this.i=null,this.g="",this.h=!1}var W={},K={};function Y(f,w,N){f.L=1,f.v=Xe(pt(w)),f.m=N,f.P=!0,J(f,null)}function J(f,w){f.F=Date.now(),oe(f),f.A=pt(f.v);var N=f.A,G=f.R;Array.isArray(G)||(G=[String(G)]),qs(N.i,"t",G),f.C=0,N=f.j.J,f.h=new B,f.g=dg(f.j,N?w:null,!f.m),0<f.O&&(f.M=new Ui(h(f.Y,f,f.g),f.O)),w=f.U,N=f.g,G=f.ca;var re="readystatechange";Array.isArray(re)||(re&&(Ol[0]=re.toString()),re=Ol);for(var ue=0;ue<re.length;ue++){var Se=Oe(N,re[ue],G||w.handleEvent,!1,w.h||w);if(!Se)break;w.g[Se.key]=Se}w=f.H?S(f.H):{},f.m?(f.u||(f.u="POST"),w["Content-Type"]="application/x-www-form-urlencoded",f.g.ea(f.A,f.u,f.m,w)):(f.u="GET",f.g.ea(f.A,f.u,null,w)),_r(),Td(f.i,f.u,f.A,f.l,f.R,f.m)}P.prototype.ca=function(f){f=f.target;const w=this.M;w&&$i(f)==3?w.j():this.Y(f)},P.prototype.Y=function(f){try{if(f==this.g)e:{const sn=$i(this.g);var w=this.g.Ba();const Qs=this.g.Z();if(!(3>sn)&&(sn!=3||this.g&&(this.h.h||this.g.oa()||eg(this.g)))){this.J||sn!=4||w==7||(w==8||0>=Qs?_r(3):_r(2)),de(this);var N=this.g.Z();this.X=N;t:if(X(this)){var G=eg(this.g);f="";var re=G.length,ue=$i(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Ee(this),Te(this);var Se="";break t}this.h.i=new o.TextDecoder}for(w=0;w<re;w++)this.h.h=!0,f+=this.h.i.decode(G[w],{stream:!(ue&&w==re-1)});G.length=0,this.h.g+=f,this.C=0,Se=this.h.g}else Se=this.g.oa();if(this.o=N==200,Dt(this.i,this.u,this.A,this.l,this.R,sn,N),this.o){if(this.T&&!this.K){t:{if(this.g){var dt,Zt=this.g;if((dt=Zt.g?Zt.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!R(dt)){var nt=dt;break t}}nt=null}if(N=nt)vr(this.i,this.l,N,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,_e(this,N);else{this.o=!1,this.s=3,Rt(12),Ee(this),Te(this);break e}}if(this.P){N=!0;let ei;for(;!this.J&&this.C<Se.length;)if(ei=ee(this,Se),ei==K){sn==4&&(this.s=4,Rt(14),N=!1),vr(this.i,this.l,null,"[Incomplete Response]");break}else if(ei==W){this.s=4,Rt(15),vr(this.i,this.l,Se,"[Invalid Chunk]"),N=!1;break}else vr(this.i,this.l,ei,null),_e(this,ei);if(X(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),sn!=4||Se.length!=0||this.h.h||(this.s=1,Rt(16),N=!1),this.o=this.o&&N,!N)vr(this.i,this.l,Se,"[Invalid Chunked Response]"),Ee(this),Te(this);else if(0<Se.length&&!this.W){this.W=!0;var rn=this.j;rn.g==this&&rn.ba&&!rn.M&&(rn.j.info("Great, no buffering proxy detected. Bytes received: "+Se.length),Ld(rn),rn.M=!0,Rt(11))}}else vr(this.i,this.l,Se,null),_e(this,Se);sn==4&&Ee(this),this.o&&!this.J&&(sn==4?og(this.j,this):(this.o=!1,oe(this)))}else eA(this.g),N==400&&0<Se.indexOf("Unknown SID")?(this.s=3,Rt(12)):(this.s=0,Rt(13)),Ee(this),Te(this)}}}catch{}finally{}};function X(f){return f.g?f.u=="GET"&&f.L!=2&&f.j.Ca:!1}function ee(f,w){var N=f.C,G=w.indexOf(`
`,N);return G==-1?K:(N=Number(w.substring(N,G)),isNaN(N)?W:(G+=1,G+N>w.length?K:(w=w.slice(G,G+N),f.C=G+N,w)))}P.prototype.cancel=function(){this.J=!0,Ee(this)};function oe(f){f.S=Date.now()+f.I,me(f,f.I)}function me(f,w){if(f.B!=null)throw Error("WatchDog timer not null");f.B=hn(h(f.ba,f),w)}function de(f){f.B&&(o.clearTimeout(f.B),f.B=null)}P.prototype.ba=function(){this.B=null;const f=Date.now();0<=f-this.S?(A(this.i,this.A),this.L!=2&&(_r(),Rt(17)),Ee(this),this.s=2,Te(this)):me(this,this.S-f)};function Te(f){f.j.G==0||f.J||og(f.j,f)}function Ee(f){de(f);var w=f.M;w&&typeof w.ma=="function"&&w.ma(),f.M=null,Ml(f.U),f.g&&(w=f.g,f.g=null,w.abort(),w.ma())}function _e(f,w){try{var N=f.j;if(N.G!=0&&(N.g==f||je(N.h,f))){if(!f.K&&je(N.h,f)&&N.G==3){try{var G=N.Da.g.parse(w)}catch{G=null}if(Array.isArray(G)&&G.length==3){var re=G;if(re[0]==0){e:if(!N.u){if(N.g)if(N.g.F+3e3<f.F)zl(N),Gl(N);else break e;Rd(N),Rt(18)}}else N.za=re[1],0<N.za-N.T&&37500>re[2]&&N.F&&N.v==0&&!N.C&&(N.C=hn(h(N.Za,N),6e3));if(1>=De(N.h)&&N.ca){try{N.ca()}catch{}N.ca=void 0}}else ps(N,11)}else if((f.K||N.g==f)&&zl(N),!R(w))for(re=N.Da.g.parse(w),w=0;w<re.length;w++){let nt=re[w];if(N.T=nt[0],nt=nt[1],N.G==2)if(nt[0]=="c"){N.K=nt[1],N.ia=nt[2];const rn=nt[3];rn!=null&&(N.la=rn,N.j.info("VER="+N.la));const sn=nt[4];sn!=null&&(N.Aa=sn,N.j.info("SVER="+N.Aa));const Qs=nt[5];Qs!=null&&typeof Qs=="number"&&0<Qs&&(G=1.5*Qs,N.L=G,N.j.info("backChannelRequestTimeoutMs_="+G)),G=N;const ei=f.g;if(ei){const Kl=ei.g?ei.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Kl){var ue=G.h;ue.g||Kl.indexOf("spdy")==-1&&Kl.indexOf("quic")==-1&&Kl.indexOf("h2")==-1||(ue.j=ue.l,ue.g=new Set,ue.h&&(Me(ue,ue.h),ue.h=null))}if(G.D){const wd=ei.g?ei.g.getResponseHeader("X-HTTP-Session-Id"):null;wd&&(G.ya=wd,Ke(G.I,G.D,wd))}}N.G=3,N.l&&N.l.ua(),N.ba&&(N.R=Date.now()-f.F,N.j.info("Handshake RTT: "+N.R+"ms")),G=N;var Se=f;if(G.qa=ug(G,G.J?G.ia:null,G.W),Se.K){Be(G.h,Se);var dt=Se,Zt=G.L;Zt&&(dt.I=Zt),dt.B&&(de(dt),oe(dt)),G.g=Se}else sg(G);0<N.i.length&&Hl(N)}else nt[0]!="stop"&&nt[0]!="close"||ps(N,7);else N.G==3&&(nt[0]=="stop"||nt[0]=="close"?nt[0]=="stop"?ps(N,7):Id(N):nt[0]!="noop"&&N.l&&N.l.ta(nt),N.v=0)}}_r(4)}catch{}}var Ne=class{constructor(f,w){this.g=f,this.map=w}};function Ve(f){this.l=f||10,o.PerformanceNavigationTiming?(f=o.performance.getEntriesByType("navigation"),f=0<f.length&&(f[0].nextHopProtocol=="hq"||f[0].nextHopProtocol=="h2")):f=!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=f?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Ae(f){return f.h?!0:f.g?f.g.size>=f.j:!1}function De(f){return f.h?1:f.g?f.g.size:0}function je(f,w){return f.h?f.h==w:f.g?f.g.has(w):!1}function Me(f,w){f.g?f.g.add(w):f.h=w}function Be(f,w){f.h&&f.h==w?f.h=null:f.g&&f.g.has(w)&&f.g.delete(w)}Ve.prototype.cancel=function(){if(this.i=Ye(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const f of this.g.values())f.cancel();this.g.clear()}};function Ye(f){if(f.h!=null)return f.i.concat(f.h.D);if(f.g!=null&&f.g.size!==0){let w=f.i;for(const N of f.g.values())w=w.concat(N.D);return w}return v(f.i)}function it(f){if(f.V&&typeof f.V=="function")return f.V();if(typeof Map<"u"&&f instanceof Map||typeof Set<"u"&&f instanceof Set)return Array.from(f.values());if(typeof f=="string")return f.split("");if(l(f)){for(var w=[],N=f.length,G=0;G<N;G++)w.push(f[G]);return w}w=[],N=0;for(G in f)w[N++]=f[G];return w}function Fe(f){if(f.na&&typeof f.na=="function")return f.na();if(!f.V||typeof f.V!="function"){if(typeof Map<"u"&&f instanceof Map)return Array.from(f.keys());if(!(typeof Set<"u"&&f instanceof Set)){if(l(f)||typeof f=="string"){var w=[];f=f.length;for(var N=0;N<f;N++)w.push(N);return w}w=[],N=0;for(const G in f)w[N++]=G;return w}}}function He(f,w){if(f.forEach&&typeof f.forEach=="function")f.forEach(w,void 0);else if(l(f)||typeof f=="string")Array.prototype.forEach.call(f,w,void 0);else for(var N=Fe(f),G=it(f),re=G.length,ue=0;ue<re;ue++)w.call(void 0,G[ue],N&&N[ue],f)}var rt=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Lt(f,w){if(f){f=f.split("&");for(var N=0;N<f.length;N++){var G=f[N].indexOf("="),re=null;if(0<=G){var ue=f[N].substring(0,G);re=f[N].substring(G+1)}else ue=f[N];w(ue,re?decodeURIComponent(re.replace(/\+/g," ")):"")}}}function jt(f){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,f instanceof jt){this.h=f.h,Yt(this,f.j),this.o=f.o,this.g=f.g,Nt(this,f.s),this.l=f.l;var w=f.i,N=new Er;N.i=w.i,w.g&&(N.g=new Map(w.g),N.h=w.h),Gt(this,N),this.m=f.m}else f&&(w=String(f).match(rt))?(this.h=!1,Yt(this,w[1]||"",!0),this.o=fn(w[2]||""),this.g=fn(w[3]||"",!0),Nt(this,w[4]),this.l=fn(w[5]||"",!0),Gt(this,w[6]||"",!0),this.m=fn(w[7]||"")):(this.h=!1,this.i=new Er(null,this.h))}jt.prototype.toString=function(){var f=[],w=this.j;w&&f.push(pn(w,no,!0),":");var N=this.g;return(N||w=="file")&&(f.push("//"),(w=this.o)&&f.push(pn(w,no,!0),"@"),f.push(encodeURIComponent(String(N)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),N=this.s,N!=null&&f.push(":",String(N))),(N=this.l)&&(this.g&&N.charAt(0)!="/"&&f.push("/"),f.push(pn(N,N.charAt(0)=="/"?Fl:Ad,!0))),(N=this.i.toString())&&f.push("?",N),(N=this.m)&&f.push("#",pn(N,ds)),f.join("")};function pt(f){return new jt(f)}function Yt(f,w,N){f.j=N?fn(w,!0):w,f.j&&(f.j=f.j.replace(/:$/,""))}function Nt(f,w){if(w){if(w=Number(w),isNaN(w)||0>w)throw Error("Bad port number "+w);f.s=w}else f.s=null}function Gt(f,w,N){w instanceof Er?(f.i=w,Ys(f.i,f.h)):(N||(w=pn(w,us)),f.i=new Er(w,f.h))}function Ke(f,w,N){f.i.set(w,N)}function Xe(f){return Ke(f,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),f}function fn(f,w){return f?w?decodeURI(f.replace(/%25/g,"%2525")):decodeURIComponent(f):""}function pn(f,w,N){return typeof f=="string"?(f=encodeURI(f).replace(w,Ks),N&&(f=f.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),f):null}function Ks(f){return f=f.charCodeAt(0),"%"+(f>>4&15).toString(16)+(f&15).toString(16)}var no=/[#\/\?@]/g,Ad=/[#\?:]/g,Fl=/[#\?]/g,us=/[#\?@]/g,ds=/#/g;function Er(f,w){this.h=this.g=null,this.i=f||null,this.j=!!w}function Fn(f){f.g||(f.g=new Map,f.h=0,f.i&&Lt(f.i,function(w,N){f.add(decodeURIComponent(w.replace(/\+/g," ")),N)}))}n=Er.prototype,n.add=function(f,w){Fn(this),this.i=null,f=_i(this,f);var N=this.g.get(f);return N||this.g.set(f,N=[]),N.push(w),this.h+=1,this};function Ws(f,w){Fn(f),w=_i(f,w),f.g.has(w)&&(f.i=null,f.h-=f.g.get(w).length,f.g.delete(w))}function Sr(f,w){return Fn(f),w=_i(f,w),f.g.has(w)}n.forEach=function(f,w){Fn(this),this.g.forEach(function(N,G){N.forEach(function(re){f.call(w,re,G,this)},this)},this)},n.na=function(){Fn(this);const f=Array.from(this.g.values()),w=Array.from(this.g.keys()),N=[];for(let G=0;G<w.length;G++){const re=f[G];for(let ue=0;ue<re.length;ue++)N.push(w[G])}return N},n.V=function(f){Fn(this);let w=[];if(typeof f=="string")Sr(this,f)&&(w=w.concat(this.g.get(_i(this,f))));else{f=Array.from(this.g.values());for(let N=0;N<f.length;N++)w=w.concat(f[N])}return w},n.set=function(f,w){return Fn(this),this.i=null,f=_i(this,f),Sr(this,f)&&(this.h-=this.g.get(f).length),this.g.set(f,[w]),this.h+=1,this},n.get=function(f,w){return f?(f=this.V(f),0<f.length?String(f[0]):w):w};function qs(f,w,N){Ws(f,w),0<N.length&&(f.i=null,f.g.set(_i(f,w),v(N)),f.h+=N.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const f=[],w=Array.from(this.g.keys());for(var N=0;N<w.length;N++){var G=w[N];const ue=encodeURIComponent(String(G)),Se=this.V(G);for(G=0;G<Se.length;G++){var re=ue;Se[G]!==""&&(re+="="+encodeURIComponent(String(Se[G]))),f.push(re)}}return this.i=f.join("&")};function _i(f,w){return w=String(w),f.j&&(w=w.toLowerCase()),w}function Ys(f,w){w&&!f.j&&(Fn(f),f.i=null,f.g.forEach(function(N,G){var re=G.toLowerCase();G!=re&&(Ws(this,G),qs(this,re,N))},f)),f.j=w}function Ul(f,w){const N=new yr;if(o.Image){const G=new Image;G.onload=m(Un,N,"TestLoadImage: loaded",!0,w,G),G.onerror=m(Un,N,"TestLoadImage: error",!1,w,G),G.onabort=m(Un,N,"TestLoadImage: abort",!1,w,G),G.ontimeout=m(Un,N,"TestLoadImage: timeout",!1,w,G),o.setTimeout(function(){G.ontimeout&&G.ontimeout()},1e4),G.src=f}else w(!1)}function $l(f,w){const N=new yr,G=new AbortController,re=setTimeout(()=>{G.abort(),Un(N,"TestPingServer: timeout",!1,w)},1e4);fetch(f,{signal:G.signal}).then(ue=>{clearTimeout(re),ue.ok?Un(N,"TestPingServer: ok",!0,w):Un(N,"TestPingServer: server error",!1,w)}).catch(()=>{clearTimeout(re),Un(N,"TestPingServer: error",!1,w)})}function Un(f,w,N,G,re){try{re&&(re.onload=null,re.onerror=null,re.onabort=null,re.ontimeout=null),G(N)}catch{}}function Vl(){this.g=new Ed}function xd(f,w,N){const G=N||"";try{He(f,function(re,ue){let Se=re;c(re)&&(Se=Ya(re)),w.push(G+ue+"="+encodeURIComponent(Se))})}catch(re){throw w.push(G+"type="+encodeURIComponent("_badmap")),re}}function hs(f){this.l=f.Ub||null,this.j=f.eb||!1}g(hs,Xa),hs.prototype.g=function(){return new fs(this.l,this.j)},hs.prototype.i=function(f){return function(){return f}}({});function fs(f,w){St.call(this),this.D=f,this.o=w,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}g(fs,St),n=fs.prototype,n.open=function(f,w){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=f,this.A=w,this.readyState=1,so(this)},n.send=function(f){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const w={headers:this.u,method:this.B,credentials:this.m,cache:void 0};f&&(w.body=f),(this.D||o).fetch(new Request(this.A,w)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,ro(this)),this.readyState=0},n.Sa=function(f){if(this.g&&(this.l=f,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=f.headers,this.readyState=2,so(this)),this.g&&(this.readyState=3,so(this),this.g)))if(this.responseType==="arraybuffer")f.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof o.ReadableStream<"u"&&"body"in f){if(this.j=f.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;io(this)}else f.text().then(this.Ra.bind(this),this.ga.bind(this))};function io(f){f.j.read().then(f.Pa.bind(f)).catch(f.ga.bind(f))}n.Pa=function(f){if(this.g){if(this.o&&f.value)this.response.push(f.value);else if(!this.o){var w=f.value?f.value:new Uint8Array(0);(w=this.v.decode(w,{stream:!f.done}))&&(this.response=this.responseText+=w)}f.done?ro(this):so(this),this.readyState==3&&io(this)}},n.Ra=function(f){this.g&&(this.response=this.responseText=f,ro(this))},n.Qa=function(f){this.g&&(this.response=f,ro(this))},n.ga=function(){this.g&&ro(this)};function ro(f){f.readyState=4,f.l=null,f.j=null,f.v=null,so(f)}n.setRequestHeader=function(f,w){this.u.append(f,w)},n.getResponseHeader=function(f){return this.h&&this.h.get(f.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const f=[],w=this.h.entries();for(var N=w.next();!N.done;)N=N.value,f.push(N[0]+": "+N[1]),N=w.next();return f.join(`\r
`)};function so(f){f.onreadystatechange&&f.onreadystatechange.call(f)}Object.defineProperty(fs.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(f){this.m=f?"include":"same-origin"}});function Ym(f){let w="";return H(f,function(N,G){w+=G,w+=":",w+=N,w+=`\r
`}),w}function bd(f,w,N){e:{for(G in N){var G=!1;break e}G=!0}G||(N=Ym(N),typeof f=="string"?N!=null&&encodeURIComponent(String(N)):Ke(f,w,N))}function Pt(f){St.call(this),this.headers=new Map,this.o=f||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}g(Pt,St);var JT=/^https?$/i,ZT=["POST","PUT"];n=Pt.prototype,n.Ha=function(f){this.J=f},n.ea=function(f,w,N,G){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+f);w=w?w.toUpperCase():"GET",this.D=f,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():I.g(),this.v=this.o?Nl(this.o):Nl(I),this.g.onreadystatechange=h(this.Ea,this);try{this.B=!0,this.g.open(w,String(f),!0),this.B=!1}catch(ue){Xm(this,ue);return}if(f=N||"",N=new Map(this.headers),G)if(Object.getPrototypeOf(G)===Object.prototype)for(var re in G)N.set(re,G[re]);else if(typeof G.keys=="function"&&typeof G.get=="function")for(const ue of G.keys())N.set(ue,G.get(ue));else throw Error("Unknown input type for opt_headers: "+String(G));G=Array.from(N.keys()).find(ue=>ue.toLowerCase()=="content-type"),re=o.FormData&&f instanceof o.FormData,!(0<=Array.prototype.indexOf.call(ZT,w,void 0))||G||re||N.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[ue,Se]of N)this.g.setRequestHeader(ue,Se);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Zm(this),this.u=!0,this.g.send(f),this.u=!1}catch(ue){Xm(this,ue)}};function Xm(f,w){f.h=!1,f.g&&(f.j=!0,f.g.abort(),f.j=!1),f.l=w,f.m=5,Qm(f),jl(f)}function Qm(f){f.A||(f.A=!0,Mt(f,"complete"),Mt(f,"error"))}n.abort=function(f){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=f||7,Mt(this,"complete"),Mt(this,"abort"),jl(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),jl(this,!0)),Pt.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Jm(this):this.bb())},n.bb=function(){Jm(this)};function Jm(f){if(f.h&&typeof a<"u"&&(!f.v[1]||$i(f)!=4||f.Z()!=2)){if(f.u&&$i(f)==4)as(f.Ea,0,f);else if(Mt(f,"readystatechange"),$i(f)==4){f.h=!1;try{const Se=f.Z();e:switch(Se){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var w=!0;break e;default:w=!1}var N;if(!(N=w)){var G;if(G=Se===0){var re=String(f.D).match(rt)[1]||null;!re&&o.self&&o.self.location&&(re=o.self.location.protocol.slice(0,-1)),G=!JT.test(re?re.toLowerCase():"")}N=G}if(N)Mt(f,"complete"),Mt(f,"success");else{f.m=6;try{var ue=2<$i(f)?f.g.statusText:""}catch{ue=""}f.l=ue+" ["+f.Z()+"]",Qm(f)}}finally{jl(f)}}}}function jl(f,w){if(f.g){Zm(f);const N=f.g,G=f.v[0]?()=>{}:null;f.g=null,f.v=null,w||Mt(f,"ready");try{N.onreadystatechange=G}catch{}}}function Zm(f){f.I&&(o.clearTimeout(f.I),f.I=null)}n.isActive=function(){return!!this.g};function $i(f){return f.g?f.g.readyState:0}n.Z=function(){try{return 2<$i(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(f){if(this.g){var w=this.g.responseText;return f&&w.indexOf(f)==0&&(w=w.substring(f.length)),vd(w)}};function eg(f){try{if(!f.g)return null;if("response"in f.g)return f.g.response;switch(f.H){case"":case"text":return f.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in f.g)return f.g.mozResponseArrayBuffer}return null}catch{return null}}function eA(f){const w={};f=(f.g&&2<=$i(f)&&f.g.getAllResponseHeaders()||"").split(`\r
`);for(let G=0;G<f.length;G++){if(R(f[G]))continue;var N=L(f[G]);const re=N[0];if(N=N[1],typeof N!="string")continue;N=N.trim();const ue=w[re]||[];w[re]=ue,ue.push(N)}C(w,function(G){return G.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function ao(f,w,N){return N&&N.internalChannelParams&&N.internalChannelParams[f]||w}function tg(f){this.Aa=0,this.i=[],this.j=new yr,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ao("failFast",!1,f),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ao("baseRetryDelayMs",5e3,f),this.cb=ao("retryDelaySeedMs",1e4,f),this.Wa=ao("forwardChannelMaxRetries",2,f),this.wa=ao("forwardChannelRequestTimeoutMs",2e4,f),this.pa=f&&f.xmlHttpFactory||void 0,this.Xa=f&&f.Tb||void 0,this.Ca=f&&f.useFetchStreams||!1,this.L=void 0,this.J=f&&f.supportsCrossDomainXhr||!1,this.K="",this.h=new Ve(f&&f.concurrentRequestLimit),this.Da=new Vl,this.P=f&&f.fastHandshake||!1,this.O=f&&f.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=f&&f.Rb||!1,f&&f.xa&&this.j.xa(),f&&f.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&f&&f.detectBufferingProxy||!1,this.ja=void 0,f&&f.longPollingTimeout&&0<f.longPollingTimeout&&(this.ja=f.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=tg.prototype,n.la=8,n.G=1,n.connect=function(f,w,N,G){Rt(0),this.W=f,this.H=w||{},N&&G!==void 0&&(this.H.OSID=N,this.H.OAID=G),this.F=this.X,this.I=ug(this,null,this.W),Hl(this)};function Id(f){if(ng(f),f.G==3){var w=f.U++,N=pt(f.I);if(Ke(N,"SID",f.K),Ke(N,"RID",w),Ke(N,"TYPE","terminate"),oo(f,N),w=new P(f,f.j,w),w.L=2,w.v=Xe(pt(N)),N=!1,o.navigator&&o.navigator.sendBeacon)try{N=o.navigator.sendBeacon(w.v.toString(),"")}catch{}!N&&o.Image&&(new Image().src=w.v,N=!0),N||(w.g=dg(w.j,null),w.g.ea(w.v)),w.F=Date.now(),oe(w)}cg(f)}function Gl(f){f.g&&(Ld(f),f.g.cancel(),f.g=null)}function ng(f){Gl(f),f.u&&(o.clearTimeout(f.u),f.u=null),zl(f),f.h.cancel(),f.s&&(typeof f.s=="number"&&o.clearTimeout(f.s),f.s=null)}function Hl(f){if(!Ae(f.h)&&!f.s){f.s=!0;var w=f.Ga;ge||$(),te||(ge(),te=!0),j.add(w,f),f.B=0}}function tA(f,w){return De(f.h)>=f.h.j-(f.s?1:0)?!1:f.s?(f.i=w.D.concat(f.i),!0):f.G==1||f.G==2||f.B>=(f.Va?0:f.Wa)?!1:(f.s=hn(h(f.Ga,f,w),lg(f,f.B)),f.B++,!0)}n.Ga=function(f){if(this.s)if(this.s=null,this.G==1){if(!f){this.U=Math.floor(1e5*Math.random()),f=this.U++;const re=new P(this,this.j,f);let ue=this.o;if(this.S&&(ue?(ue=S(ue),T(ue,this.S)):ue=this.S),this.m!==null||this.O||(re.H=ue,ue=null),this.P)e:{for(var w=0,N=0;N<this.i.length;N++){t:{var G=this.i[N];if("__data__"in G.map&&(G=G.map.__data__,typeof G=="string")){G=G.length;break t}G=void 0}if(G===void 0)break;if(w+=G,4096<w){w=N;break e}if(w===4096||N===this.i.length-1){w=N+1;break e}}w=1e3}else w=1e3;w=rg(this,re,w),N=pt(this.I),Ke(N,"RID",f),Ke(N,"CVER",22),this.D&&Ke(N,"X-HTTP-Session-Id",this.D),oo(this,N),ue&&(this.O?w="headers="+encodeURIComponent(String(Ym(ue)))+"&"+w:this.m&&bd(N,this.m,ue)),Me(this.h,re),this.Ua&&Ke(N,"TYPE","init"),this.P?(Ke(N,"$req",w),Ke(N,"SID","null"),re.T=!0,Y(re,N,null)):Y(re,N,w),this.G=2}}else this.G==3&&(f?ig(this,f):this.i.length==0||Ae(this.h)||ig(this))};function ig(f,w){var N;w?N=w.l:N=f.U++;const G=pt(f.I);Ke(G,"SID",f.K),Ke(G,"RID",N),Ke(G,"AID",f.T),oo(f,G),f.m&&f.o&&bd(G,f.m,f.o),N=new P(f,f.j,N,f.B+1),f.m===null&&(N.H=f.o),w&&(f.i=w.D.concat(f.i)),w=rg(f,N,1e3),N.I=Math.round(.5*f.wa)+Math.round(.5*f.wa*Math.random()),Me(f.h,N),Y(N,G,w)}function oo(f,w){f.H&&H(f.H,function(N,G){Ke(w,G,N)}),f.l&&He({},function(N,G){Ke(w,G,N)})}function rg(f,w,N){N=Math.min(f.i.length,N);var G=f.l?h(f.l.Na,f.l,f):null;e:{var re=f.i;let ue=-1;for(;;){const Se=["count="+N];ue==-1?0<N?(ue=re[0].g,Se.push("ofs="+ue)):ue=0:Se.push("ofs="+ue);let dt=!0;for(let Zt=0;Zt<N;Zt++){let nt=re[Zt].g;const rn=re[Zt].map;if(nt-=ue,0>nt)ue=Math.max(0,re[Zt].g-100),dt=!1;else try{xd(rn,Se,"req"+nt+"_")}catch{G&&G(rn)}}if(dt){G=Se.join("&");break e}}}return f=f.i.splice(0,N),w.D=f,G}function sg(f){if(!f.g&&!f.u){f.Y=1;var w=f.Fa;ge||$(),te||(ge(),te=!0),j.add(w,f),f.v=0}}function Rd(f){return f.g||f.u||3<=f.v?!1:(f.Y++,f.u=hn(h(f.Fa,f),lg(f,f.v)),f.v++,!0)}n.Fa=function(){if(this.u=null,ag(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var f=2*this.R;this.j.info("BP detection timer enabled: "+f),this.A=hn(h(this.ab,this),f)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Rt(10),Gl(this),ag(this))};function Ld(f){f.A!=null&&(o.clearTimeout(f.A),f.A=null)}function ag(f){f.g=new P(f,f.j,"rpc",f.Y),f.m===null&&(f.g.H=f.o),f.g.O=0;var w=pt(f.qa);Ke(w,"RID","rpc"),Ke(w,"SID",f.K),Ke(w,"AID",f.T),Ke(w,"CI",f.F?"0":"1"),!f.F&&f.ja&&Ke(w,"TO",f.ja),Ke(w,"TYPE","xmlhttp"),oo(f,w),f.m&&f.o&&bd(w,f.m,f.o),f.L&&(f.g.I=f.L);var N=f.g;f=f.ia,N.L=1,N.v=Xe(pt(w)),N.m=null,N.P=!0,J(N,f)}n.Za=function(){this.C!=null&&(this.C=null,Gl(this),Rd(this),Rt(19))};function zl(f){f.C!=null&&(o.clearTimeout(f.C),f.C=null)}function og(f,w){var N=null;if(f.g==w){zl(f),Ld(f),f.g=null;var G=2}else if(je(f.h,w))N=w.D,Be(f.h,w),G=1;else return;if(f.G!=0){if(w.o)if(G==1){N=w.m?w.m.length:0,w=Date.now()-w.F;var re=f.B;G=Zn(),Mt(G,new to(G,N)),Hl(f)}else sg(f);else if(re=w.s,re==3||re==0&&0<w.X||!(G==1&&tA(f,w)||G==2&&Rd(f)))switch(N&&0<N.length&&(w=f.h,w.i=w.i.concat(N)),re){case 1:ps(f,5);break;case 4:ps(f,10);break;case 3:ps(f,6);break;default:ps(f,2)}}}function lg(f,w){let N=f.Ta+Math.floor(Math.random()*f.cb);return f.isActive()||(N*=2),N*w}function ps(f,w){if(f.j.info("Error code "+w),w==2){var N=h(f.fb,f),G=f.Xa;const re=!G;G=new jt(G||"//www.google.com/images/cleardot.gif"),o.location&&o.location.protocol=="http"||Yt(G,"https"),Xe(G),re?Ul(G.toString(),N):$l(G.toString(),N)}else Rt(2);f.G=0,f.l&&f.l.sa(w),cg(f),ng(f)}n.fb=function(f){f?(this.j.info("Successfully pinged google.com"),Rt(2)):(this.j.info("Failed to ping google.com"),Rt(1))};function cg(f){if(f.G=0,f.ka=[],f.l){const w=Ye(f.h);(w.length!=0||f.i.length!=0)&&(x(f.ka,w),x(f.ka,f.i),f.h.i.length=0,v(f.i),f.i.length=0),f.l.ra()}}function ug(f,w,N){var G=N instanceof jt?pt(N):new jt(N);if(G.g!="")w&&(G.g=w+"."+G.g),Nt(G,G.s);else{var re=o.location;G=re.protocol,w=w?w+"."+re.hostname:re.hostname,re=+re.port;var ue=new jt(null);G&&Yt(ue,G),w&&(ue.g=w),re&&Nt(ue,re),N&&(ue.l=N),G=ue}return N=f.D,w=f.ya,N&&w&&Ke(G,N,w),Ke(G,"VER",f.la),oo(f,G),G}function dg(f,w,N){if(w&&!f.J)throw Error("Can't create secondary domain capable XhrIo object.");return w=f.Ca&&!f.pa?new Pt(new hs({eb:N})):new Pt(f.pa),w.Ha(f.J),w}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function hg(){}n=hg.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function $n(f,w){St.call(this),this.g=new tg(w),this.l=f,this.h=w&&w.messageUrlParams||null,f=w&&w.messageHeaders||null,w&&w.clientProtocolHeaderRequired&&(f?f["X-Client-Protocol"]="webchannel":f={"X-Client-Protocol":"webchannel"}),this.g.o=f,f=w&&w.initMessageHeaders||null,w&&w.messageContentType&&(f?f["X-WebChannel-Content-Type"]=w.messageContentType:f={"X-WebChannel-Content-Type":w.messageContentType}),w&&w.va&&(f?f["X-WebChannel-Client-Profile"]=w.va:f={"X-WebChannel-Client-Profile":w.va}),this.g.S=f,(f=w&&w.Sb)&&!R(f)&&(this.g.m=f),this.v=w&&w.supportsCrossDomainXhr||!1,this.u=w&&w.sendRawJson||!1,(w=w&&w.httpSessionIdParam)&&!R(w)&&(this.g.D=w,f=this.h,f!==null&&w in f&&(f=this.h,w in f&&delete f[w])),this.j=new Xs(this)}g($n,St),$n.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},$n.prototype.close=function(){Id(this.g)},$n.prototype.o=function(f){var w=this.g;if(typeof f=="string"){var N={};N.__data__=f,f=N}else this.u&&(N={},N.__data__=Ya(f),f=N);w.i.push(new Ne(w.Ya++,f)),w.G==3&&Hl(w)},$n.prototype.N=function(){this.g.l=null,delete this.j,Id(this.g),delete this.g,$n.aa.N.call(this)};function fg(f){Qa.call(this),f.__headers__&&(this.headers=f.__headers__,this.statusCode=f.__status__,delete f.__headers__,delete f.__status__);var w=f.__sm__;if(w){e:{for(const N in w){f=N;break e}f=void 0}(this.i=f)&&(f=this.i,w=w!==null&&f in w?w[f]:void 0),this.data=w}else this.data=f}g(fg,Qa);function pg(){Ja.call(this),this.status=1}g(pg,Ja);function Xs(f){this.g=f}g(Xs,hg),Xs.prototype.ua=function(){Mt(this.g,"a")},Xs.prototype.ta=function(f){Mt(this.g,new fg(f))},Xs.prototype.sa=function(f){Mt(this.g,new pg)},Xs.prototype.ra=function(){Mt(this.g,"b")},$n.prototype.send=$n.prototype.o,$n.prototype.open=$n.prototype.m,$n.prototype.close=$n.prototype.close,_.NO_ERROR=0,_.TIMEOUT=8,_.HTTP_ERROR=6,p.COMPLETE="complete",Sd.EventType=cs,cs.OPEN="a",cs.CLOSE="b",cs.ERROR="c",cs.MESSAGE="d",St.prototype.listen=St.prototype.K,Pt.prototype.listenOnce=Pt.prototype.L,Pt.prototype.getLastError=Pt.prototype.Ka,Pt.prototype.getLastErrorCode=Pt.prototype.Ba,Pt.prototype.getStatus=Pt.prototype.Z,Pt.prototype.getResponseJson=Pt.prototype.Oa,Pt.prototype.getResponseText=Pt.prototype.oa,Pt.prototype.send=Pt.prototype.ea,Pt.prototype.setWithCredentials=Pt.prototype.Ha}).apply(typeof hc<"u"?hc:typeof self<"u"?self:typeof window<"u"?window:{});const a_="@firebase/firestore",o_="4.9.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let gn=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};gn.UNAUTHENTICATED=new gn(null),gn.GOOGLE_CREDENTIALS=new gn("google-credentials-uid"),gn.FIRST_PARTY=new gn("first-party-uid"),gn.MOCK_USER=new gn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Dl="12.0.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $a=new om("@firebase/firestore");function ui(n,...e){if($a.logLevel<=st.DEBUG){const t=e.map(vm);$a.debug(`Firestore (${Dl}): ${n}`,...t)}}function dS(n,...e){if($a.logLevel<=st.ERROR){const t=e.map(vm);$a.error(`Firestore (${Dl}): ${n}`,...t)}}function eC(n,...e){if($a.logLevel<=st.WARN){const t=e.map(vm);$a.warn(`Firestore (${Dl}): ${n}`,...t)}}function vm(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ul(n,e,t){let i="Unexpected state";typeof e=="string"?i=e:t=e,hS(n,i,t)}function hS(n,e,t){let i=`FIRESTORE (${Dl}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{i+=" CONTEXT: "+JSON.stringify(t)}catch{i+=" CONTEXT: "+t}throw dS(i),new Error(i)}function Bo(n,e,t,i){let r="Unexpected state";typeof t=="string"?r=t:i=t,n||hS(e,r,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ze={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class et extends dr{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fo{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fS{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class tC{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(gn.UNAUTHENTICATED))}shutdown(){}}class nC{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class iC{constructor(e){this.t=e,this.currentUser=gn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Bo(this.o===void 0,42304);let i=this.i;const r=l=>this.i!==i?(i=this.i,t(l)):Promise.resolve();let s=new Fo;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Fo,e.enqueueRetryable(()=>r(this.currentUser))};const a=()=>{const l=s;e.enqueueRetryable(async()=>{await l.promise,await r(this.currentUser)})},o=l=>{ui("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(l=>o(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?o(l):(ui("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Fo)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(i=>this.i!==e?(ui("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(Bo(typeof i.accessToken=="string",31837,{l:i}),new fS(i.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Bo(e===null||typeof e=="string",2055,{h:e}),new gn(e)}}class rC{constructor(e,t,i){this.P=e,this.T=t,this.I=i,this.type="FirstParty",this.user=gn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class sC{constructor(e,t,i){this.P=e,this.T=t,this.I=i}getToken(){return Promise.resolve(new rC(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(gn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class l_{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class aC{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,li(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Bo(this.o===void 0,3512);const i=s=>{s.error!=null&&ui("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const a=s.token!==this.m;return this.m=s.token,ui("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>i(s))};const r=s=>{ui("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(s=>r(s)),setTimeout(()=>{if(!this.appCheck){const s=this.V.getImmediate({optional:!0});s?r(s):ui("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new l_(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Bo(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new l_(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oC(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let i=0;i<n;i++)t[i]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lC{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let i="";for(;i.length<20;){const r=oC(40);for(let s=0;s<r.length;++s)i.length<20&&r[s]<t&&(i+=e.charAt(r[s]%62))}return i}}function Jr(n,e){return n<e?-1:n>e?1:0}function cC(n,e){const t=Math.min(n.length,e.length);for(let i=0;i<t;i++){const r=n.charAt(i),s=e.charAt(i);if(r!==s)return dh(r)===dh(s)?Jr(r,s):dh(r)?1:-1}return Jr(n.length,e.length)}const uC=55296,dC=57343;function dh(n){const e=n.charCodeAt(0);return e>=uC&&e<=dC}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const c_="__name__";class Ai{constructor(e,t,i){t===void 0?t=0:t>e.length&&ul(637,{offset:t,range:e.length}),i===void 0?i=e.length-t:i>e.length-t&&ul(1746,{length:i,range:e.length-t}),this.segments=e,this.offset=t,this.len=i}get length(){return this.len}isEqual(e){return Ai.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Ai?e.forEach(i=>{t.push(i)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,i=this.limit();t<i;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const i=Math.min(e.length,t.length);for(let r=0;r<i;r++){const s=Ai.compareSegments(e.get(r),t.get(r));if(s!==0)return s}return Jr(e.length,t.length)}static compareSegments(e,t){const i=Ai.isNumericId(e),r=Ai.isNumericId(t);return i&&!r?-1:!i&&r?1:i&&r?Ai.extractNumericId(e).compare(Ai.extractNumericId(t)):cC(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return ym.fromString(e.substring(4,e.length-2))}}class oi extends Ai{construct(e,t,i){return new oi(e,t,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const i of e){if(i.indexOf("//")>=0)throw new et(Ze.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);t.push(...i.split("/").filter(r=>r.length>0))}return new oi(t)}static emptyPath(){return new oi([])}}const hC=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ts extends Ai{construct(e,t,i){return new Ts(e,t,i)}static isValidIdentifier(e){return hC.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ts.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===c_}static keyField(){return new Ts([c_])}static fromServerFormat(e){const t=[];let i="",r=0;const s=()=>{if(i.length===0)throw new et(Ze.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(i),i=""};let a=!1;for(;r<e.length;){const o=e[r];if(o==="\\"){if(r+1===e.length)throw new et(Ze.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[r+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new et(Ze.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);i+=l,r+=2}else o==="`"?(a=!a,r++):o!=="."||a?(i+=o,r++):(s(),r++)}if(s(),a)throw new et(Ze.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Ts(t)}static emptyPath(){return new Ts([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Is{constructor(e){this.path=e}static fromPath(e){return new Is(oi.fromString(e))}static fromName(e){return new Is(oi.fromString(e).popFirst(5))}static empty(){return new Is(oi.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&oi.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return oi.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Is(new oi(e.slice()))}}function fC(n,e,t,i){if(e===!0&&i===!0)throw new et(Ze.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function pC(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function mC(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(i){return i.constructor?i.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":ul(12329,{type:typeof n})}function gC(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new et(Ze.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=mC(n);throw new et(Ze.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ut(n,e){const t={typeString:n};return e&&(t.value=e),t}function Pl(n,e){if(!pC(n))throw new et(Ze.INVALID_ARGUMENT,"JSON must be an object");let t;for(const i in e)if(e[i]){const r=e[i].typeString,s="value"in e[i]?{value:e[i].value}:void 0;if(!(i in n)){t=`JSON missing required field: '${i}'`;break}const a=n[i];if(r&&typeof a!==r){t=`JSON field '${i}' must be a ${r}.`;break}if(s!==void 0&&a!==s.value){t=`Expected '${i}' field to equal '${s.value}'`;break}}if(t)throw new et(Ze.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const u_=-62135596800,d_=1e6;class xi{static now(){return xi.fromMillis(Date.now())}static fromDate(e){return xi.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),i=Math.floor((e-1e3*t)*d_);return new xi(t,i)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new et(Ze.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new et(Ze.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<u_)throw new et(Ze.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new et(Ze.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/d_}_compareTo(e){return this.seconds===e.seconds?Jr(this.nanoseconds,e.nanoseconds):Jr(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:xi._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Pl(e,xi._jsonSchema))return new xi(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-u_;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}xi._jsonSchemaVersion="firestore/timestamp/1.0",xi._jsonSchema={type:Ut("string",xi._jsonSchemaVersion),seconds:Ut("number"),nanoseconds:Ut("number")};function _C(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yC extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $s{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(r){try{return atob(r)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new yC("Invalid base64 string: "+s):s}}(e);return new $s(t)}static fromUint8Array(e){const t=function(r){let s="";for(let a=0;a<r.length;++a)s+=String.fromCharCode(r[a]);return s}(e);return new $s(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const i=new Uint8Array(t.length);for(let r=0;r<t.length;r++)i[r]=t.charCodeAt(r);return i}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Jr(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}$s.EMPTY_BYTE_STRING=new $s("");const $f="(default)";class Mu{constructor(e,t){this.projectId=e,this.database=t||$f}static empty(){return new Mu("","")}get isDefaultDatabase(){return this.database===$f}isEqual(e){return e instanceof Mu&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vC{constructor(e,t=null,i=[],r=[],s=null,a="F",o=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=i,this.filters=r,this.limit=s,this.limitType=a,this.startAt=o,this.endAt=l,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function EC(n){return new vC(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var h_,Je;(Je=h_||(h_={}))[Je.OK=0]="OK",Je[Je.CANCELLED=1]="CANCELLED",Je[Je.UNKNOWN=2]="UNKNOWN",Je[Je.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Je[Je.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Je[Je.NOT_FOUND=5]="NOT_FOUND",Je[Je.ALREADY_EXISTS=6]="ALREADY_EXISTS",Je[Je.PERMISSION_DENIED=7]="PERMISSION_DENIED",Je[Je.UNAUTHENTICATED=16]="UNAUTHENTICATED",Je[Je.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Je[Je.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Je[Je.ABORTED=10]="ABORTED",Je[Je.OUT_OF_RANGE=11]="OUT_OF_RANGE",Je[Je.UNIMPLEMENTED=12]="UNIMPLEMENTED",Je[Je.INTERNAL=13]="INTERNAL",Je[Je.UNAVAILABLE=14]="UNAVAILABLE",Je[Je.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */new ym([4294967295,4294967295],0);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SC=41943040;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TC=1048576;function hh(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AC{constructor(e,t,i=1e3,r=1.5,s=6e4){this.Mi=e,this.timerId=t,this.d_=i,this.A_=r,this.R_=s,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),i=Math.max(0,Date.now()-this.f_),r=Math.max(0,t-i);r>0&&ui("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${i} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,r,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Em{constructor(e,t,i,r,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=i,this.op=r,this.removalCallback=s,this.deferred=new Fo,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,i,r,s){const a=Date.now()+i,o=new Em(e,t,a,r,s);return o.start(i),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new et(Ze.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}var f_,p_;(p_=f_||(f_={})).Ma="default",p_.Cache="cache";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xC(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m_=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pS="firestore.googleapis.com",g_=!0;class __{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new et(Ze.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=pS,this.ssl=g_}else this.host=e.host,this.ssl=e.ssl??g_;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=SC;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<TC)throw new et(Ze.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}fC("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=xC(e.experimentalLongPollingOptions??{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new et(Ze.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new et(Ze.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new et(Ze.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(i,r){return i.timeoutSeconds===r.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class mS{constructor(e,t,i,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=i,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new __({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new et(Ze.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new et(Ze.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new __(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(i){if(!i)return new tC;switch(i.type){case"firstParty":return new sC(i.sessionIndex||"0",i.iamToken||null,i.authTokenFactory||null);case"provider":return i.client;default:throw new et(Ze.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const i=m_.get(t);i&&(ui("ComponentProvider","Removing Datastore"),m_.delete(t),i.terminate())}(this),Promise.resolve()}}function bC(n,e,t,i={}){var c;n=gC(n,mS);const r=Il(e),s=n._getSettings(),a={...s,emulatorOptions:n._getEmulatorOptions()},o=`${e}:${t}`;r&&(xE(`https://${o}`),bE("Firestore",!0)),s.host!==pS&&s.host!==o&&eC("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l={...s,host:o,ssl:r,emulatorOptions:i};if(!Bs(l,a)&&(n._setSettings(l),i.mockUserToken)){let u,d;if(typeof i.mockUserToken=="string")u=i.mockUserToken,d=gn.MOCK_USER;else{u=uR(i.mockUserToken,(c=n._app)==null?void 0:c.options.projectId);const h=i.mockUserToken.sub||i.mockUserToken.user_id;if(!h)throw new et(Ze.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");d=new gn(h)}n._authCredentials=new nC(new fS(u,d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sm{constructor(e,t,i){this.converter=t,this._query=i,this.type="query",this.firestore=e}withConverter(e){return new Sm(this.firestore,e,this._query)}}class Li{constructor(e,t,i){this.converter=t,this._key=i,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Tm(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Li(this.firestore,e,this._key)}toJSON(){return{type:Li._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,i){if(Pl(t,Li._jsonSchema))return new Li(e,i||null,new Is(oi.fromString(t.referencePath)))}}Li._jsonSchemaVersion="firestore/documentReference/1.0",Li._jsonSchema={type:Ut("string",Li._jsonSchemaVersion),referencePath:Ut("string")};class Tm extends Sm{constructor(e,t,i){super(e,t,EC(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Li(this.firestore,null,new Is(e))}withConverter(e){return new Tm(this.firestore,e,this._path)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y_="AsyncQueue";class v_{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new AC(this,"async_queue_retry"),this._c=()=>{const i=hh();i&&ui(y_,"Visibility state changed to "+i.visibilityState),this.M_.w_()},this.ac=e;const t=hh();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=hh();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new Fo;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!_C(e))throw e;ui(y_,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(i=>{throw this.nc=i,this.rc=!1,dS("INTERNAL UNHANDLED ERROR: ",E_(i)),i}).then(i=>(this.rc=!1,i))));return this.ac=t,t}enqueueAfterDelay(e,t,i){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const r=Em.createAndSchedule(this,e,t,i,s=>this.hc(s));return this.tc.push(r),r}uc(){this.nc&&ul(47125,{Pc:E_(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((t,i)=>t.targetTimeMs-i.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function E_(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class IC extends mS{constructor(e,t,i,r){super(e,t,i,r),this.type="firestore",this._queue=new v_,this._persistenceKey=(r==null?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new v_(e),this._firestoreClient=void 0,await e}}}function RC(n,e){const t=typeof n=="object"?n:wE(),i=typeof n=="string"?n:$f,r=cm(t,"firestore").getImmediate({identifier:i});if(!r._initialized){const s=lR("firestore");s&&bC(r,...s)}return r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yi{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Yi($s.fromBase64String(e))}catch(t){throw new et(Ze.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Yi($s.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Yi._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Pl(e,Yi._jsonSchema))return Yi.fromBase64String(e.bytes)}}Yi._jsonSchemaVersion="firestore/bytes/1.0",Yi._jsonSchema={type:Ut("string",Yi._jsonSchemaVersion),bytes:Ut("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gS{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new et(Ze.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ts(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ws{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new et(Ze.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new et(Ze.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Jr(this._lat,e._lat)||Jr(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:ws._jsonSchemaVersion}}static fromJSON(e){if(Pl(e,ws._jsonSchema))return new ws(e.latitude,e.longitude)}}ws._jsonSchemaVersion="firestore/geoPoint/1.0",ws._jsonSchema={type:Ut("string",ws._jsonSchemaVersion),latitude:Ut("number"),longitude:Ut("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cs{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(i,r){if(i.length!==r.length)return!1;for(let s=0;s<i.length;++s)if(i[s]!==r[s])return!1;return!0}(this._values,e._values)}toJSON(){return{type:Cs._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Pl(e,Cs._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new Cs(e.vectorValues);throw new et(Ze.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Cs._jsonSchemaVersion="firestore/vectorValue/1.0",Cs._jsonSchema={type:Ut("string",Cs._jsonSchemaVersion),vectorValues:Ut("object")};const LC=new RegExp("[~\\*/\\[\\]]");function wC(n,e,t){if(e.search(LC)>=0)throw S_(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n);try{return new gS(...e.split("."))._internalPath}catch{throw S_(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n)}}function S_(n,e,t,i,r){let s=`Function ${e}() called with invalid data`;s+=". ";let a="";return new et(Ze.INVALID_ARGUMENT,s+n+a)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _S{constructor(e,t,i,r,s){this._firestore=e,this._userDataWriter=t,this._key=i,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Li(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new CC(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(yS("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class CC extends _S{data(){return super.data()}}function yS(n,e){return typeof e=="string"?wC(n,e):e instanceof gS?e._internalPath:e._delegate._internalPath}class fc{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Ra extends _S{constructor(e,t,i,r,s,a){super(e,t,i,r,a),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Wc(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const i=this._document.data.field(yS("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new et(Ze.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Ra._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}Ra._jsonSchemaVersion="firestore/documentSnapshot/1.0",Ra._jsonSchema={type:Ut("string",Ra._jsonSchemaVersion),bundleSource:Ut("string","DocumentSnapshot"),bundleName:Ut("string"),bundle:Ut("string")};class Wc extends Ra{data(e={}){return super.data(e)}}class Uo{constructor(e,t,i,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new fc(r.hasPendingWrites,r.fromCache),this.query=i}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(i=>{e.call(t,new Wc(this._firestore,this._userDataWriter,i.key,i,new fc(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new et(Ze.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(r,s){if(r._snapshot.oldDocs.isEmpty()){let a=0;return r._snapshot.docChanges.map(o=>{const l=new Wc(r._firestore,r._userDataWriter,o.doc.key,o.doc,new fc(r._snapshot.mutatedKeys.has(o.doc.key),r._snapshot.fromCache),r.query.converter);return o.doc,{type:"added",doc:l,oldIndex:-1,newIndex:a++}})}{let a=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(o=>s||o.type!==3).map(o=>{const l=new Wc(r._firestore,r._userDataWriter,o.doc.key,o.doc,new fc(r._snapshot.mutatedKeys.has(o.doc.key),r._snapshot.fromCache),r.query.converter);let c=-1,u=-1;return o.type!==0&&(c=a.indexOf(o.doc.key),a=a.delete(o.doc.key)),o.type!==1&&(a=a.add(o.doc),u=a.indexOf(o.doc.key)),{type:kC(o.type),doc:l,oldIndex:c,newIndex:u}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new et(Ze.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Uo._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=lC.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],i=[],r=[];return this.docs.forEach(s=>{s._document!==null&&(t.push(s._document),i.push(this._userDataWriter.convertObjectMap(s._document.data.value.mapValue.fields,"previous")),r.push(s.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function kC(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ul(61501,{type:n})}}Uo._jsonSchemaVersion="firestore/querySnapshot/1.0",Uo._jsonSchema={type:Ut("string",Uo._jsonSchemaVersion),bundleSource:Ut("string","QuerySnapshot"),bundleName:Ut("string"),bundle:Ut("string")};(function(e,t=!0){(function(r){Dl=r})(Wa),Fa(new Fs("firestore",(i,{instanceIdentifier:r,options:s})=>{const a=i.getProvider("app").getImmediate(),o=new IC(new iC(i.getProvider("auth-internal")),new aC(a,i.getProvider("app-check-internal")),function(c,u){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new et(Ze.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Mu(c.options.projectId,u)}(a,r),a);return s={useFetchStreams:t,...s},o._setSettings(s),o},"PUBLIC").setMultipleInstances(!0)),qr(a_,o_,e),qr(a_,o_,"esm2020")})();const DC={apiKey:"AIzaSyAe1EXmLjdezfC_HJ00wxIUdeu3Y9KfQDU",authDomain:"test111-7c3a9.firebaseapp.com",projectId:"test111-7c3a9",storageBucket:"test111-7c3a9.firebasestorage.app",messagingSenderId:"675503940912",appId:"1:675503940912:web:e8c0f780db0b71eecd94f5"},vS=LE(DC),pc=X2(vS);RC(vS);const ES=ae.createContext(void 0),Am=()=>{const n=ae.useContext(ES);if(n===void 0)throw new Error("useAuth must be used within an AuthProvider");return n},PC=({children:n})=>{const[e,t]=ae.useState(null),[i,r]=ae.useState(!0),s=async(c,u)=>{await Mw(pc,c,u)},a=async()=>{await Uw(pc)},o=async c=>{await Ow(pc,c)};ae.useEffect(()=>Fw(pc,u=>{t(u),r(!1)}),[]);const l={currentUser:e,login:s,logout:a,resetPassword:o,loading:i};return z.jsx(ES.Provider,{value:l,children:!i&&n})};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var OC={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MC=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),at=(n,e)=>{const t=ae.forwardRef(({color:i="currentColor",size:r=24,strokeWidth:s=2,absoluteStrokeWidth:a,className:o="",children:l,...c},u)=>ae.createElement("svg",{ref:u,...OC,width:r,height:r,stroke:i,strokeWidth:a?Number(s)*24/Number(r):s,className:["lucide",`lucide-${MC(n)}`,o].join(" "),...c},[...e.map(([d,h])=>ae.createElement(d,h)),...Array.isArray(l)?l:[l]]));return t.displayName=`${n}`,t};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NC=at("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BC=at("Baby",[["path",{d:"M9 12h.01",key:"157uk2"}],["path",{d:"M15 12h.01",key:"1k8ypt"}],["path",{d:"M10 16c.5.3 1.2.5 2 .5s1.5-.2 2-.5",key:"1u7htd"}],["path",{d:"M19 6.3a9 9 0 0 1 1.8 3.9 2 2 0 0 1 0 3.6 9 9 0 0 1-17.6 0 2 2 0 0 1 0-3.6A9 9 0 0 1 12 3c2 0 3.5 1.1 3.5 2.5s-.9 2.5-2 2.5c-.8 0-1.5-.4-1.5-1",key:"5yv0yz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FC=at("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UC=at("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $C=at("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VC=at("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jC=at("Film",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M7 3v18",key:"bbkbws"}],["path",{d:"M3 7.5h4",key:"zfgn84"}],["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 16.5h4",key:"1230mu"}],["path",{d:"M17 3v18",key:"in4fa5"}],["path",{d:"M17 7.5h4",key:"myr1c1"}],["path",{d:"M17 16.5h4",key:"go4c1d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GC=at("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SS=at("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HC=at("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zC=at("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KC=at("Laugh",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M18 13a6 6 0 0 1-6 5 6 6 0 0 1-6-5h12Z",key:"b2q4dd"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WC=at("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qC=at("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YC=at("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XC=at("Maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QC=at("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xm=at("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JC=at("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZC=at("Radio",[["path",{d:"M4.9 19.1C1 15.2 1 8.8 4.9 4.9",key:"1vaf9d"}],["path",{d:"M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5",key:"u1ii0m"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5",key:"1j5fej"}],["path",{d:"M19.1 4.9C23 8.8 23 15.1 19.1 19",key:"10b0cb"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ek=at("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TS=at("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AS=at("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tk=at("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nk=at("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xS=at("Tv",[["rect",{width:"20",height:"15",x:"2",y:"7",rx:"2",ry:"2",key:"10ag99"}],["polyline",{points:"17 2 12 7 7 2",key:"11pgbg"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ik=at("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rk=at("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sk=at("VolumeX",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bS=at("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),ak=()=>{const[n,e]=ae.useState(""),[t,i]=ae.useState(""),[r,s]=ae.useState(!1),[a,o]=ae.useState(""),[l,c]=ae.useState(!1),[u,d]=ae.useState(!1),[h,m]=ae.useState(""),{login:g,resetPassword:v}=Am(),x=async E=>{if(E.preventDefault(),u){try{o(""),c(!0),await v(n),m("Revisa tu email para restablecer tu contraseña")}catch{o("Error al enviar email de recuperación")}c(!1);return}try{o(""),c(!0),await g(n,t)}catch{o("Email o contraseña incorrectos")}c(!1)};return z.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-blue-900 to-black flex items-center justify-center p-4",children:[z.jsx("div",{className:"absolute inset-0 bg-black/50"}),z.jsx("div",{className:"relative z-10 w-full max-w-md",children:z.jsxs("div",{className:"bg-black/80 backdrop-blur-xl rounded-2xl p-8 border border-gray-800",children:[z.jsxs("div",{className:"text-center mb-8",children:[z.jsxs("h1",{className:"text-4xl font-bold text-white mb-2",children:["Sir",z.jsx("span",{className:"text-blue-500",children:"Net"})]}),z.jsx("p",{className:"text-gray-400",children:"Tu plataforma de streaming"})]}),z.jsxs("form",{onSubmit:x,className:"space-y-6",children:[a&&z.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded-lg p-3 flex items-center gap-2 text-red-400",children:[z.jsx(NC,{size:16}),z.jsx("span",{className:"text-sm",children:a})]}),h&&z.jsx("div",{className:"bg-green-500/10 border border-green-500/20 rounded-lg p-3 text-green-400 text-sm",children:h}),z.jsxs("div",{className:"space-y-4",children:[z.jsxs("div",{className:"relative",children:[z.jsx(YC,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),z.jsx("input",{type:"email",placeholder:"Email",value:n,onChange:E=>e(E.target.value),className:"w-full bg-gray-800/50 border border-gray-700 rounded-lg pl-10 pr-4 py-3 text-white placeholder-gray-400 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-all",required:!0})]}),!u&&z.jsxs("div",{className:"relative",children:[z.jsx(WC,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),z.jsx("input",{type:r?"text":"password",placeholder:"Contraseña",value:t,onChange:E=>i(E.target.value),className:"w-full bg-gray-800/50 border border-gray-700 rounded-lg pl-10 pr-12 py-3 text-white placeholder-gray-400 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-all",required:!0}),z.jsx("button",{type:"button",onClick:()=>s(!r),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-white transition-colors",children:r?z.jsx($C,{size:20}):z.jsx(VC,{size:20})})]})]}),z.jsx("button",{type:"submit",disabled:l,className:"w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-semibold py-3 px-4 rounded-lg transition-all duration-200 transform hover:scale-[1.02] disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",children:l?z.jsxs("div",{className:"flex items-center justify-center gap-2",children:[z.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),u?"Enviando...":"Iniciando sesión..."]}):u?"Enviar email de recuperación":"Iniciar sesión"}),z.jsx("div",{className:"text-center",children:z.jsx("button",{type:"button",onClick:()=>{d(!u),o(""),m("")},className:"text-blue-400 hover:text-blue-300 text-sm transition-colors",children:u?"Volver al login":"¿Olvidaste tu contraseña?"})})]})]})})]})},ok=({onSearch:n,onMenuToggle:e,isMenuOpen:t})=>{const[i,r]=ae.useState(""),[s,a]=ae.useState(!1),{logout:o,currentUser:l}=Am(),c=d=>{d.preventDefault(),n(i)},u=async()=>{try{await o()}catch(d){console.error("Error logging out:",d)}};return z.jsx("header",{className:"bg-black/95 backdrop-blur-md border-b border-gray-800 sticky top-0 z-50",children:z.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:z.jsxs("div",{className:"flex items-center justify-between h-16",children:[z.jsxs("div",{className:"flex items-center gap-4",children:[z.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-gray-800",children:t?z.jsx(bS,{size:24}):z.jsx(QC,{size:24})}),z.jsxs("div",{className:"flex items-center gap-2",children:[z.jsx(xS,{className:"text-blue-500",size:32}),z.jsxs("h1",{className:"text-2xl font-bold text-white",children:["Sir",z.jsx("span",{className:"text-blue-500",children:"Net"})]})]})]}),z.jsx("div",{className:"flex-1 max-w-md mx-8",children:z.jsxs("form",{onSubmit:c,className:"relative",children:[z.jsx(TS,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),z.jsx("input",{type:"text",placeholder:"Buscar películas, series...",value:i,onChange:d=>r(d.target.value),className:"w-full bg-gray-800/50 border border-gray-700 rounded-full pl-10 pr-4 py-2 text-white placeholder-gray-400 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-all"})]})}),z.jsx("div",{className:"flex items-center gap-4",children:z.jsxs("div",{className:"relative",children:[z.jsxs("button",{onClick:()=>a(!s),className:"flex items-center gap-2 text-gray-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-gray-800",children:[z.jsx(ik,{size:20}),z.jsx("span",{className:"hidden sm:block text-sm",children:l==null?void 0:l.email})]}),s&&z.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-gray-900 border border-gray-700 rounded-lg shadow-xl py-2",children:[z.jsxs("button",{className:"w-full text-left px-4 py-2 text-gray-300 hover:text-white hover:bg-gray-800 flex items-center gap-2",children:[z.jsx(AS,{size:16}),"Configuración"]}),z.jsxs("button",{className:"w-full text-left px-4 py-2 text-gray-300 hover:text-white hover:bg-gray-800 flex items-center gap-2",children:[z.jsx(SS,{size:16}),"Idioma"]}),z.jsx("hr",{className:"border-gray-700 my-2"}),z.jsxs("button",{onClick:u,className:"w-full text-left px-4 py-2 text-red-400 hover:text-red-300 hover:bg-gray-800 flex items-center gap-2",children:[z.jsx(qC,{size:16}),"Cerrar sesión"]})]})]})})]})})})},lk=({isOpen:n,activeSection:e,onSectionChange:t})=>{const i=[{id:"home",label:"Inicio",icon:HC},{id:"movies",label:"Películas",icon:jC},{id:"series",label:"Series",icon:xS},{id:"kids",label:"Infantil",icon:BC},{id:"comedy",label:"Comedia",icon:KC},{id:"live-tv",label:"TV en Vivo",icon:ZC}],r=[{id:"settings",label:"Configuración",icon:AS},{id:"language",label:"Idioma",icon:SS}];return z.jsx("div",{className:`fixed inset-y-0 left-0 z-40 w-64 bg-gray-900 border-r border-gray-800 transform transition-transform duration-300 ease-in-out ${n?"translate-x-0":"-translate-x-full"}`,children:z.jsxs("div",{className:"flex flex-col h-full pt-20",children:[z.jsx("nav",{className:"flex-1 px-4 py-6",children:z.jsx("div",{className:"space-y-2",children:i.map(s=>{const a=s.icon;return z.jsxs("button",{onClick:()=>t(s.id),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg text-left transition-all duration-200 ${e===s.id?"bg-blue-600 text-white":"text-gray-300 hover:text-white hover:bg-gray-800"}`,children:[z.jsx(a,{size:20}),z.jsx("span",{className:"font-medium",children:s.label})]},s.id)})})}),z.jsx("div",{className:"px-4 py-6 border-t border-gray-800",children:z.jsx("div",{className:"space-y-2",children:r.map(s=>{const a=s.icon;return z.jsxs("button",{onClick:()=>t(s.id),className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-left text-gray-300 hover:text-white hover:bg-gray-800 transition-all duration-200",children:[z.jsx(a,{size:20}),z.jsx("span",{className:"font-medium",children:s.label})]},s.id)})})})]})})},ck=({item:n,onPlay:e,onInfo:t})=>z.jsx("div",{className:"group relative bg-gray-800 rounded-lg overflow-hidden transition-all duration-300 hover:scale-105 hover:z-10",children:z.jsxs("div",{className:"aspect-[2/3] relative",children:[z.jsx("img",{src:n.image,alt:n.title,className:"w-full h-full object-cover",loading:"lazy"}),z.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:z.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-4",children:[z.jsx("h3",{className:"text-white font-semibold text-sm mb-1 line-clamp-2",children:n.title}),z.jsxs("p",{className:"text-gray-300 text-xs mb-3",children:[n.year," • ",n.genre]}),z.jsxs("div",{className:"flex gap-2",children:[z.jsxs("button",{onClick:()=>e(n),className:"flex items-center gap-1 bg-white text-black px-3 py-1.5 rounded-md text-xs font-semibold hover:bg-gray-200 transition-colors",children:[z.jsx(xm,{size:12}),"Reproducir"]}),z.jsxs("button",{onClick:()=>t(n),className:"flex items-center gap-1 bg-gray-600/80 text-white px-3 py-1.5 rounded-md text-xs font-semibold hover:bg-gray-500/80 transition-colors",children:[z.jsx(zC,{size:12}),"Info"]})]})]})})]})}),ms=({title:n,items:e,onPlay:t,onInfo:i})=>z.jsxs("div",{className:"mb-8",children:[z.jsx("h2",{className:"text-2xl font-bold text-white mb-4 px-4",children:n}),z.jsx("div",{className:"flex gap-4 overflow-x-auto pb-4 px-4 scrollbar-hide",children:e.map(r=>z.jsx("div",{className:"flex-shrink-0 w-48",children:z.jsx(ck,{item:r,onPlay:t,onInfo:i})},r.id))})]}),T_=[{name:"A3 CINE",url:"http://177.253.232.83:9088/play/a02q/index.m3u8",category:"peliculas",icon:"/src/assets/images/a3-cine-logo.svg",description:"Canal de películas 24/7"},{name:"Cine Canal",url:"http://177.253.232.83:9088/play/a01s/index.m3u8",category:"peliculas",icon:"fas fa-film",description:"Cine de calidad"},{name:"Cine Familiar HD",url:"http://177.253.232.83:9088/play/a01f/index.m3u8",category:"peliculas",icon:"fas fa-users",description:"Películas para toda la familia"},{name:"Cine Hispano HD",url:"http://177.253.232.83:9088/play/a01e/index.m3u8",category:"peliculas",icon:"fas fa-film",description:"Cine en español"},{name:"Cine Latino",url:"http://177.253.232.83:9088/play/a02p/index.m3u8",category:"peliculas",icon:"fas fa-film",description:"Películas latinas"},{name:"Cine Premium HD",url:"http://177.253.232.83:9088/play/a01d/index.m3u8",category:"peliculas",icon:"fas fa-star",description:"Cine premium"},{name:"Multipremier",url:"http://177.253.232.83:9088/play/a02l/index.m3u8",category:"peliculas",icon:"fas fa-star",description:"Estrenos de películas"},{name:"Baby TV",url:"http://177.253.232.83:9088/play/a01i/index.m3u8",category:"infantil",icon:"fas fa-baby",description:"TV para bebés"},{name:"Canal Infantil HD",url:"http://177.253.232.83:9088/play/a01h/index.m3u8",category:"infantil",icon:"fas fa-child",description:"Contenido infantil"},{name:"Disney Channel",url:"http://177.253.232.83:9088/play/a014/index.m3u8",category:"infantil",icon:"fas fa-magic",description:"Disney Channel"},{name:"Disney Junior",url:"http://177.253.232.83:9088/play/a013/index.m3u8",category:"infantil",icon:"fas fa-magic",description:"Disney Junior"},{name:"Dreamworks Latam",url:"http://177.253.232.83:9088/play/a012/index.m3u8",category:"infantil",icon:"fas fa-dragon",description:"Dreamworks Latinoamérica"},{name:"Discovery Kids",url:"http://177.253.232.83:9088/play/a018/index.m3u8",category:"infantil",icon:"fas fa-child",description:"Discovery Kids"},{name:"Discovery Kits",url:"http://177.253.232.83:9088/play/a017/index.m3u8",category:"infantil",icon:"fas fa-child",description:"Discovery Kits"},{name:"Nick Jr",url:"http://177.253.232.83:9088/play/a00p/index.m3u8",category:"infantil",icon:"fas fa-child",description:"Nick Jr"},{name:"CARACOL HD",url:"http://177.253.232.83:9088/play/a01g/index.m3u8",category:"nacional",icon:"fas fa-tv",description:"Caracol Televisión"},{name:"RCN",url:"http://177.253.232.83:9088/play/a00m/index.m3u8",category:"nacional",icon:"fas fa-tv",description:"RCN Televisión"},{name:"RCN 2",url:"http://177.253.232.83:9088/play/a00l/index.m3u8",category:"nacional",icon:"fas fa-tv",description:"RCN 2"},{name:"SU Colombia",url:"http://177.253.232.83:9088/play/a00g/index.m3u8",category:"nacional",icon:"fas fa-tv",description:"Señal U Colombia"},{name:"TELE MEDELLIN",url:"http://177.253.232.83:9088/play/a00f/index.m3u8",category:"nacional",icon:"fas fa-tv",description:"Telemedellín"},{name:"TELEMEDELLIN IPTV",url:"http://177.253.232.83:9088/play/a030/index.m3u8",category:"nacional",icon:"fas fa-tv",description:"Telemedellín IPTV"},{name:"Tele Yolombo",url:"http://177.253.232.83:9088/play/a00d/index.m3u8",category:"nacional",icon:"fas fa-tv",description:"Tele Yolombo"},{name:"UC Colombia",url:"http://177.253.232.83:9088/play/a008/index.m3u8",category:"nacional",icon:"fas fa-tv",description:"UC Colombia"},{name:"nuestra tele",url:"http://177.253.232.83:9088/play/a02j/index.m3u8",category:"nacional",icon:"fas fa-tv",description:"Nuestra Tele"},{name:"ESPN",url:"http://177.253.232.83:9088/play/a011/index.m3u8",category:"deportes",icon:"fas fa-futbol",description:"ESPN"},{name:"ESPN 2",url:"http://177.253.232.83:9088/play/a010/index.m3u8",category:"deportes",icon:"fas fa-futbol",description:"ESPN 2"},{name:"ESPN 4",url:"http://177.253.232.83:9088/play/a00z/index.m3u8",category:"deportes",icon:"fas fa-futbol",description:"ESPN 4"},{name:"ESPN 5",url:"http://177.253.232.83:9088/play/a00y/index.m3u8",category:"deportes",icon:"fas fa-futbol",description:"ESPN 5"},{name:"ESPN 6",url:"http://177.253.232.83:9088/play/a00x/index.m3u8",category:"deportes",icon:"fas fa-futbol",description:"ESPN 6"},{name:"ESPN 7",url:"http://177.253.232.83:9088/play/a00w/index.m3u8",category:"deportes",icon:"fas fa-futbol",description:"ESPN 7"},{name:"ESPN 8",url:"http://177.253.232.83:9088/play/a00v/index.m3u8",category:"deportes",icon:"fas fa-futbol",description:"ESPN 8"},{name:"TyC Sports",url:"http://177.253.232.83:9088/play/a009/index.m3u8",category:"deportes",icon:"fas fa-futbol",description:"TyC Sports"},{name:"WinSport Bk",url:"http://177.253.232.83:9088/play/a01r/index.m3u8",category:"deportes",icon:"fas fa-basketball-ball",description:"WinSport Baloncesto"},{name:"WinSport Prin",url:"http://177.253.232.83:9088/play/a01q/index.m3u8",category:"deportes",icon:"fas fa-trophy",description:"WinSport Principal"},{name:"WindSport 2 Remplazo",url:"http://177.253.232.83:9088/play/a024/index.m3u8",category:"deportes",icon:"fas fa-trophy",description:"WinSport 2"},{name:"Discovery Channel",url:"http://177.253.232.83:9088/play/a01a/index.m3u8",category:"entretenimiento",icon:"fas fa-compass",description:"Discovery Channel"},{name:"Discovery H&H",url:"http://177.253.232.83:9088/play/a019/index.m3u8",category:"entretenimiento",icon:"fas fa-home",description:"Discovery H&H"},{name:"Discovery Theater",url:"http://177.253.232.83:9088/play/a016/index.m3u8",category:"entretenimiento",icon:"fas fa-theater-masks",description:"Discovery Theater"},{name:"Discovery Turbo",url:"http://177.253.232.83:9088/play/a015/index.m3u8",category:"entretenimiento",icon:"fas fa-car",description:"Discovery Turbo"},{name:"Comedy Central",url:"http://177.253.232.83:9088/play/a01c/index.m3u8",category:"entretenimiento",icon:"fas fa-laugh",description:"Comedy Central"},{name:"DHE",url:"http://177.253.232.83:9088/play/a01b/index.m3u8",category:"entretenimiento",icon:"fas fa-tv",description:"DHE"},{name:"EI",url:"http://177.253.232.83:9088/play/a02w/index.m3u8",category:"entretenimiento",icon:"fas fa-tv",description:"EI"},{name:"FX",url:"http://177.253.232.83:9088/play/a003/index.m3u8",category:"entretenimiento",icon:"fas fa-tv",description:"FX"},{name:"Food",url:"http://177.253.232.83:9088/play/a00t/index.m3u8",category:"entretenimiento",icon:"fas fa-utensils",description:"Food Network"},{name:"Global Media",url:"http://177.253.232.83:9088/play/a00s/index.m3u8",category:"entretenimiento",icon:"fas fa-globe",description:"Global Media"},{name:"ID",url:"http://177.253.232.83:9088/play/a00q/index.m3u8",category:"entretenimiento",icon:"fas fa-search",description:"Investigation Discovery"},{name:"FMH",url:"http://177.253.232.83:9088/play/a02s/index.m3u8",category:"entretenimiento",icon:"fas fa-tv",description:"FMH"},{name:"Paramount Network",url:"http://177.253.232.83:9088/play/a00n/index.m3u8",category:"entretenimiento",icon:"fas fa-tv",description:"Paramount Network"},{name:"Start Channel",url:"http://177.253.232.83:9088/play/a00h/index.m3u8",category:"entretenimiento",icon:"fas fa-play",description:"Start Channel"},{name:"TLC",url:"http://177.253.232.83:9088/play/a00a/index.m3u8",category:"entretenimiento",icon:"fas fa-tv",description:"TLC"},{name:"Telemundo",url:"http://177.253.232.83:9088/play/a02v/index.m3u8",category:"entretenimiento",icon:"fas fa-tv",description:"Telemundo"},{name:"USA Latam",url:"http://177.253.232.83:9088/play/a007/index.m3u8",category:"entretenimiento",icon:"fas fa-tv",description:"USA Latinoamérica"},{name:"Venevision",url:"http://177.253.232.83:9088/play/a006/index.m3u8",category:"entretenimiento",icon:"fas fa-tv",description:"Venevisión"},{name:"Mi Musica HD Popular",url:"http://177.253.232.83:9088/play/a00i/index.m3u8",category:"musica",icon:"fas fa-music",description:"Música Popular"},{name:"MiMusica HD Reggaeton",url:"http://177.253.232.83:9088/play/a001/index.m3u8",category:"musica",icon:"fas fa-music",description:"Reggaeton"},{name:"MiMusica HD Regional",url:"http://177.253.232.83:9088/play/a00k/index.m3u8",category:"musica",icon:"fas fa-music",description:"Música Regional"},{name:"MiMusica HD Salsa",url:"http://177.253.232.83:9088/play/a002/index.m3u8",category:"musica",icon:"fas fa-music",description:"Salsa"},{name:"Nick Music",url:"http://177.253.232.83:9088/play/a00o/index.m3u8",category:"musica",icon:"fas fa-music",description:"Nick Music"},{name:"DW - Envia",url:"http://177.253.232.83:9088/play/a01z/index.m3u8",category:"noticias",icon:"fas fa-globe",description:"Deutsche Welle"},{name:"DW - Recibe",url:"http://177.253.232.83:9088/play/a021/index.m3u8",category:"noticias",icon:"fas fa-globe",description:"Deutsche Welle"},{name:"test",url:"http://177.253.232.83:9088/play/a02z/index.m3u8",category:"entretenimiento",icon:"fas fa-tv",description:"Canal de prueba"}],uk=[{id:"all",name:"Todos los Canales",icon:"fas fa-tv"},{id:"peliculas",name:"Películas",icon:"fas fa-film"},{id:"infantil",name:"Infantil",icon:"fas fa-child"},{id:"nacional",name:"Nacional",icon:"fas fa-flag"},{id:"deportes",name:"Deportes",icon:"fas fa-futbol"},{id:"entretenimiento",name:"Entretenimiento",icon:"fas fa-tv"},{id:"musica",name:"Música",icon:"fas fa-music"},{id:"noticias",name:"Noticias",icon:"fas fa-newspaper"}],dk=({name:n,className:e="",size:t=16})=>{const r={film:z.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:t,height:t,children:z.jsx("path",{d:"M18 4l2 4h-3l-2-4h-2l2 4h-3l-2-4H8l2 4H7L5 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4h-4z"})}),baby:z.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:t,height:t,children:z.jsx("path",{d:"M12 2C13.1 2 14 2.9 14 4s-.9 2-2 2-2-.9-2-2 .9-2 2-2zm8.5 8.5c-.3-.3-.8-.3-1.1 0L18 12.5l-1.4-1.4c-.3-.3-.8-.3-1.1 0-.3.3-.3.8 0 1.1l2 2c.3.3.8.3 1.1 0l2-2c.3-.3.3-.8 0-1.1zM6.5 10.5c-.3-.3-.8-.3-1.1 0L4 12.5l-1.4-1.4c-.3-.3-.8-.3-1.1 0-.3.3-.3.8 0 1.1l2 2c.3.3.8.3 1.1 0l2-2c.3-.3.3-.8 0-1.1zM12 6c-2.2 0-4 1.8-4 4s1.8 4 4 4 4-1.8 4-4-1.8-4-4-4z"})}),tv:z.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:t,height:t,children:z.jsx("path",{d:"M21 3H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h5v2h8v-2h5c1.1 0 1.99-.9 1.99-2L23 5c0-1.1-.9-2-2-2zm0 14H3V5h18v12z"})}),child:z.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:t,height:t,children:z.jsx("path",{d:"M12 2C13.1 2 14 2.9 14 4s-.9 2-2 2-2-.9-2-2 .9-2 2-2zm4 18v-6h2v6h2v-8c0-1.1-.9-2-2-2h-2.5c-.6 0-1.1.3-1.4.8l-1.5 2.5c-.3.5-.8.8-1.4.8H8c-.6 0-1.1-.3-1.4-.8l-1.5-2.5c-.3-.5-.8-.8-1.4-.8H2c-1.1 0-2 .9-2 2v8h2v-6h2v6h2v-6h2v6h2v-6h2v6h2z"})}),futbol:z.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:t,height:t,children:z.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.94-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1.08-1.36-1.9-1.36h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"})}),compass:z.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:t,height:t,children:z.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 5-5v10z"})}),magic:z.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:t,height:t,children:z.jsx("path",{d:"M7.5 5.6L5 7 6.4 4.5 5 2l2.5 1.4L10 2 8.6 4.5 10 7 7.5 5.6zm12 9.8L17 14l1.4 2.5L17 19l2.5-1.4L22 19l-1.4-2.5L22 14l-2.5 1.4zM22 2l-2.5 1.4L17 2l1.4 2.5L17 7l2.5-1.4L22 7l-1.4-2.5L22 2zM9 12c0 1.66-1.34 3-3 3s-3-1.34-3-3 1.34-3 3-3 3 1.34 3 3z"})}),laugh:z.jsxs("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:t,height:t,children:[z.jsx("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),z.jsx("path",{d:"M15.5 11c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5z"}),z.jsx("path",{d:"M8.5 11c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 11 8.5 11z"}),z.jsx("path",{d:"M12 17.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5z"})]}),users:z.jsxs("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:t,height:t,children:[z.jsx("path",{d:"M16 4c0-1.11.89-2 2-2s2 .89 2 2-.89 2-2 2-2-.89-2-2zm4 18v-6h2v6h-2zM12.5 11.5c.83 0 1.5-.67 1.5-1.5s-.67-1.5-1.5-1.5S11 9.17 11 10s.67 1.5 1.5 1.5zM20 10c0-.83-.67-1.5-1.5-1.5S17 9.17 17 10s.67 1.5 1.5 1.5S20 10.83 20 10z"}),z.jsx("path",{d:"M7 4c0-1.11.89-2 2-2s2 .89 2 2-.89 2-2 2-2-.89-2-2zM9 11.5c.83 0 1.5-.67 1.5-1.5S9.83 8.5 9 8.5 7.5 9.17 7.5 10s.67 1.5 1.5 1.5z"}),z.jsx("path",{d:"M4 18v-6h2v6H4z"})]}),star:z.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:t,height:t,children:z.jsx("path",{d:"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"})}),dragon:z.jsxs("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:t,height:t,children:[z.jsx("path",{d:"M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5z"}),z.jsx("path",{d:"M12 9l-3 3 3 3 3-3-3-3z"})]}),home:z.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:t,height:t,children:z.jsx("path",{d:"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"})}),"theater-masks":z.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:t,height:t,children:z.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM7 11c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm5 0c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1z"})}),car:z.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:t,height:t,children:z.jsx("path",{d:"M18.92 6.01C18.72 5.42 18.16 5 17.5 5h-11c-.66 0-1.21.42-1.42 1.01L3 12v8c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h12v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-8l-2.08-5.99zM6.5 16c-.83 0-1.5-.67-1.5-1.5S5.67 13 6.5 13s1.5.67 1.5 1.5S7.33 16 6.5 16zm11 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zM5 11l1.5-4.5h11L19 11H5z"})}),music:z.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:t,height:t,children:z.jsx("path",{d:"M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"})}),globe:z.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:t,height:t,children:z.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.94-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1.08-1.36-1.9-1.36h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"})}),utensils:z.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:t,height:t,children:z.jsx("path",{d:"M11 9H9V2H7v7H5V2H3v7c0 2.12 1.66 3.84 3.75 3.97V22h2.5v-9.03C11.34 12.84 13 11.12 13 9V2h-2v7zm5-3v8h2.5v8H21V2c-2.76 0-5 2.24-5 4z"})}),search:z.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:t,height:t,children:z.jsx("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"})}),play:z.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:t,height:t,children:z.jsx("path",{d:"M8 5v14l11-7z"})}),flag:z.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:t,height:t,children:z.jsx("path",{d:"M14.4 6L14 4H5v17h2v-7h5.6l.4 2h7V6z"})}),newspaper:z.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:t,height:t,children:z.jsx("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-5 14H4v-4h11v4zm0-5H4V9h11v4zm5 5h-4V9h4v9z"})}),"basketball-ball":z.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:t,height:t,children:z.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.94-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1.08-1.36-1.9-1.36h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"})}),trophy:z.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:t,height:t,children:z.jsx("path",{d:"M7 4V2C7 1.45 7.45 1 8 1H16C16.55 1 17 1.45 17 2V4H20C20.55 4 21 4.45 21 5V7C21 8.66 19.66 10 18 10H6C4.34 10 3 8.66 3 7V5C3 4.45 3.45 4 4 4H7ZM9 3V4H15V3H9ZM5 6V7C5 7.55 5.45 8 6 8H18C18.55 8 19 7.55 19 7V6H5ZM7 12H17V14H7V12Z"})})}[n]||z.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:t,height:t,children:z.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 5-5v10z"})});return z.jsx("span",{className:e,children:r})},Re=Number.isFinite||function(n){return typeof n=="number"&&isFinite(n)},hk=Number.isSafeInteger||function(n){return typeof n=="number"&&Math.abs(n)<=fk},fk=Number.MAX_SAFE_INTEGER||9007199254740991;let Pe=function(n){return n.NETWORK_ERROR="networkError",n.MEDIA_ERROR="mediaError",n.KEY_SYSTEM_ERROR="keySystemError",n.MUX_ERROR="muxError",n.OTHER_ERROR="otherError",n}({}),se=function(n){return n.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",n.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",n.KEY_SYSTEM_NO_SESSION="keySystemNoSession",n.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",n.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",n.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",n.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",n.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",n.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",n.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",n.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",n.MANIFEST_LOAD_ERROR="manifestLoadError",n.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",n.MANIFEST_PARSING_ERROR="manifestParsingError",n.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",n.LEVEL_EMPTY_ERROR="levelEmptyError",n.LEVEL_LOAD_ERROR="levelLoadError",n.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",n.LEVEL_PARSING_ERROR="levelParsingError",n.LEVEL_SWITCH_ERROR="levelSwitchError",n.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",n.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",n.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",n.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",n.FRAG_LOAD_ERROR="fragLoadError",n.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",n.FRAG_DECRYPT_ERROR="fragDecryptError",n.FRAG_PARSING_ERROR="fragParsingError",n.FRAG_GAP="fragGap",n.REMUX_ALLOC_ERROR="remuxAllocError",n.KEY_LOAD_ERROR="keyLoadError",n.KEY_LOAD_TIMEOUT="keyLoadTimeOut",n.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",n.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",n.BUFFER_APPEND_ERROR="bufferAppendError",n.BUFFER_APPENDING_ERROR="bufferAppendingError",n.BUFFER_STALLED_ERROR="bufferStalledError",n.BUFFER_FULL_ERROR="bufferFullError",n.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",n.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",n.ASSET_LIST_LOAD_ERROR="assetListLoadError",n.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",n.ASSET_LIST_PARSING_ERROR="assetListParsingError",n.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",n.INTERNAL_EXCEPTION="internalException",n.INTERNAL_ABORTED="aborted",n.ATTACH_MEDIA_ERROR="attachMediaError",n.UNKNOWN="unknown",n}({}),O=function(n){return n.MEDIA_ATTACHING="hlsMediaAttaching",n.MEDIA_ATTACHED="hlsMediaAttached",n.MEDIA_DETACHING="hlsMediaDetaching",n.MEDIA_DETACHED="hlsMediaDetached",n.MEDIA_ENDED="hlsMediaEnded",n.STALL_RESOLVED="hlsStallResolved",n.BUFFER_RESET="hlsBufferReset",n.BUFFER_CODECS="hlsBufferCodecs",n.BUFFER_CREATED="hlsBufferCreated",n.BUFFER_APPENDING="hlsBufferAppending",n.BUFFER_APPENDED="hlsBufferAppended",n.BUFFER_EOS="hlsBufferEos",n.BUFFERED_TO_END="hlsBufferedToEnd",n.BUFFER_FLUSHING="hlsBufferFlushing",n.BUFFER_FLUSHED="hlsBufferFlushed",n.MANIFEST_LOADING="hlsManifestLoading",n.MANIFEST_LOADED="hlsManifestLoaded",n.MANIFEST_PARSED="hlsManifestParsed",n.LEVEL_SWITCHING="hlsLevelSwitching",n.LEVEL_SWITCHED="hlsLevelSwitched",n.LEVEL_LOADING="hlsLevelLoading",n.LEVEL_LOADED="hlsLevelLoaded",n.LEVEL_UPDATED="hlsLevelUpdated",n.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",n.LEVELS_UPDATED="hlsLevelsUpdated",n.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",n.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",n.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",n.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",n.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",n.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",n.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",n.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",n.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",n.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",n.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",n.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",n.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",n.CUES_PARSED="hlsCuesParsed",n.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",n.INIT_PTS_FOUND="hlsInitPtsFound",n.FRAG_LOADING="hlsFragLoading",n.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",n.FRAG_LOADED="hlsFragLoaded",n.FRAG_DECRYPTED="hlsFragDecrypted",n.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",n.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",n.FRAG_PARSING_METADATA="hlsFragParsingMetadata",n.FRAG_PARSED="hlsFragParsed",n.FRAG_BUFFERED="hlsFragBuffered",n.FRAG_CHANGED="hlsFragChanged",n.FPS_DROP="hlsFpsDrop",n.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",n.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",n.ERROR="hlsError",n.DESTROYING="hlsDestroying",n.KEY_LOADING="hlsKeyLoading",n.KEY_LOADED="hlsKeyLoaded",n.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",n.BACK_BUFFER_REACHED="hlsBackBufferReached",n.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",n.ASSET_LIST_LOADING="hlsAssetListLoading",n.ASSET_LIST_LOADED="hlsAssetListLoaded",n.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",n.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",n.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",n.INTERSTITIAL_STARTED="hlsInterstitialStarted",n.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",n.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",n.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",n.INTERSTITIAL_ENDED="hlsInterstitialEnded",n.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",n.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",n.EVENT_CUE_ENTER="hlsEventCueEnter",n}({});var qe={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},Ce={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class Zs{constructor(e,t=0,i=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=i}sample(e,t){const i=Math.pow(this.alpha_,e);this.estimate_=t*(1-i)+i*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class pk{constructor(e,t,i,r=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Zs(e),this.fast_=new Zs(t),this.defaultTTFB_=r,this.ttfb_=new Zs(e)}update(e,t){const{slow_:i,fast_:r,ttfb_:s}=this;i.halfLife!==e&&(this.slow_=new Zs(e,i.getEstimate(),i.getTotalWeight())),r.halfLife!==t&&(this.fast_=new Zs(t,r.getEstimate(),r.getTotalWeight())),s.halfLife!==e&&(this.ttfb_=new Zs(e,s.getEstimate(),s.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const i=8*t,r=e/1e3,s=i/r;this.fast_.sample(r,s),this.slow_.sample(r,s)}sampleTTFB(e){const t=e/1e3,i=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(i,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function mk(n,e,t){return(e=_k(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function ut(){return ut=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)({}).hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},ut.apply(null,arguments)}function A_(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,i)}return t}function ct(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?A_(Object(t),!0).forEach(function(i){mk(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):A_(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}function gk(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var i=t.call(n,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function _k(n){var e=gk(n,"string");return typeof e=="symbol"?e:e+""}class mi{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const i=`[${e}]:`;this.trace=Lr,this.debug=t.debug.bind(null,i),this.log=t.log.bind(null,i),this.warn=t.warn.bind(null,i),this.info=t.info.bind(null,i),this.error=t.error.bind(null,i)}}const Lr=function(){},yk={trace:Lr,debug:Lr,log:Lr,warn:Lr,info:Lr,error:Lr};function Vf(){return ut({},yk)}function vk(n,e){const t=self.console[n];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${n}] >`):Lr}function x_(n,e,t){return e[n]?e[n].bind(e):vk(n,t)}const jf=Vf();function Ek(n,e,t){const i=Vf();if(typeof console=="object"&&n===!0||typeof n=="object"){const r=["debug","log","info","warn","error"];r.forEach(s=>{i[s]=x_(s,n,t)});try{i.log(`Debug logs enabled for "${e}" in hls.js version 1.6.9`)}catch{return Vf()}r.forEach(s=>{jf[s]=x_(s,n)})}else ut(jf,i);return i}const ot=jf;function Zr(n=!0){return typeof self>"u"?void 0:(n||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function Sk(n){return typeof self<"u"&&n===self.ManagedMediaSource}function IS(n,e){const t=Object.keys(n),i=Object.keys(e),r=t.length,s=i.length;return!r||!s||r===s&&!t.some(a=>i.indexOf(a)===-1)}function On(n,e=!1){if(typeof TextDecoder<"u"){const c=new TextDecoder("utf-8").decode(n);if(e){const u=c.indexOf("\0");return u!==-1?c.substring(0,u):c}return c.replace(/\0/g,"")}const t=n.length;let i,r,s,a="",o=0;for(;o<t;){if(i=n[o++],i===0&&e)return a;if(i===0||i===3)continue;switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(i);break;case 12:case 13:r=n[o++],a+=String.fromCharCode((i&31)<<6|r&63);break;case 14:r=n[o++],s=n[o++],a+=String.fromCharCode((i&15)<<12|(r&63)<<6|(s&63)<<0);break}}return a}const zi={hexDump:function(n){let e="";for(let t=0;t<n.length;t++){let i=n[t].toString(16);i.length<2&&(i="0"+i),e+=i}return e}};function RS(n){return Uint8Array.from(n.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function Tk(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var fh={exports:{}},b_;function Ak(){return b_||(b_=1,function(n,e){(function(t){var i=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,s=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(l,c,u){if(u=u||{},l=l.trim(),c=c.trim(),!c){if(!u.alwaysNormalize)return l;var d=o.parseURL(l);if(!d)throw new Error("Error trying to parse base URL.");return d.path=o.normalizePath(d.path),o.buildURLFromParts(d)}var h=o.parseURL(c);if(!h)throw new Error("Error trying to parse relative URL.");if(h.scheme)return u.alwaysNormalize?(h.path=o.normalizePath(h.path),o.buildURLFromParts(h)):c;var m=o.parseURL(l);if(!m)throw new Error("Error trying to parse base URL.");if(!m.netLoc&&m.path&&m.path[0]!=="/"){var g=r.exec(m.path);m.netLoc=g[1],m.path=g[2]}m.netLoc&&!m.path&&(m.path="/");var v={scheme:m.scheme,netLoc:h.netLoc,path:null,params:h.params,query:h.query,fragment:h.fragment};if(!h.netLoc&&(v.netLoc=m.netLoc,h.path[0]!=="/"))if(!h.path)v.path=m.path,h.params||(v.params=m.params,h.query||(v.query=m.query));else{var x=m.path,E=x.substring(0,x.lastIndexOf("/")+1)+h.path;v.path=o.normalizePath(E)}return v.path===null&&(v.path=u.alwaysNormalize?o.normalizePath(h.path):h.path),o.buildURLFromParts(v)},parseURL:function(l){var c=i.exec(l);return c?{scheme:c[1]||"",netLoc:c[2]||"",path:c[3]||"",params:c[4]||"",query:c[5]||"",fragment:c[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(s,"");l.length!==(l=l.replace(a,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};n.exports=o})()}(fh)),fh.exports}var bm=Ak();class Im{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var ht={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class LS{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,bk(this,"stats")}setByteRange(e,t){const i=e.split("@",2);let r;i.length===1?r=(t==null?void 0:t.byteRangeEndOffset)||0:r=parseInt(i[1]),this._byteRange=[r,parseInt(i[0])+r]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[ht.AUDIO]:null,[ht.VIDEO]:null,[ht.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new Im),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=bm.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[ht.AUDIO]=null,e[ht.VIDEO]=null,e[ht.AUDIOVIDEO]=null}}function Bt(n){return n.sn!=="initSegment"}class ph extends LS{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(Re(e)&&Re(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{const i=Object.keys(this.levelkeys);if(i.length===1){const r=this._decryptdata=this.levelkeys[i[0]]||null;if(r)return r.getDecryptData(this.sn)}}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=Re(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const i=Object.keys(this.levelkeys),r=i.length;if(r>1||r===1&&(t=this.levelkeys[i[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!Re(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return Bt(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,i,r,s,a=!1){const{elementaryStreams:o}=this,l=o[e];if(!l){o[e]={startPTS:t,endPTS:i,startDTS:r,endDTS:s,partial:a};return}l.startPTS=Math.min(l.startPTS,t),l.endPTS=Math.max(l.endPTS,i),l.startDTS=Math.min(l.startDTS,r),l.endDTS=Math.max(l.endDTS,s)}}class xk extends LS{constructor(e,t,i,r,s){super(i),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=r;const a=e.enumeratedString("BYTERANGE");a&&this.setByteRange(a,s),s&&(this.fragOffset=s.fragOffset+s.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function wS(n,e){const t=Object.getPrototypeOf(n);if(t){const i=Object.getOwnPropertyDescriptor(t,e);return i||wS(t,e)}}function bk(n,e){const t=wS(n,e);t&&(t.enumerable=!0,Object.defineProperty(n,e,t))}const I_=Math.pow(2,32)-1,Ik=[].push,CS={video:1,audio:2,id3:3,text:4};function Ht(n){return String.fromCharCode.apply(null,n)}function kS(n,e){const t=n[e]<<8|n[e+1];return t<0?65536+t:t}function $e(n,e){const t=DS(n,e);return t<0?4294967296+t:t}function R_(n,e){let t=$e(n,e);return t*=Math.pow(2,32),t+=$e(n,e+4),t}function DS(n,e){return n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3]}function Rk(n){const e=n.byteLength;for(let t=0;t<e;){const i=$e(n,t);if(i>8&&n[t+4]===109&&n[t+5]===111&&n[t+6]===111&&n[t+7]===102)return!0;t=i>1?t+i:e}return!1}function We(n,e){const t=[];if(!e.length)return t;const i=n.byteLength;for(let r=0;r<i;){const s=$e(n,r),a=Ht(n.subarray(r+4,r+8)),o=s>1?r+s:i;if(a===e[0])if(e.length===1)t.push(n.subarray(r+8,o));else{const l=We(n.subarray(r+8,o),e.slice(1));l.length&&Ik.apply(t,l)}r=o}return t}function Lk(n){const e=[],t=n[0];let i=8;const r=$e(n,i);i+=4;let s=0,a=0;t===0?(s=$e(n,i),a=$e(n,i+4),i+=8):(s=R_(n,i),a=R_(n,i+8),i+=16),i+=2;let o=n.length+a;const l=kS(n,i);i+=2;for(let c=0;c<l;c++){let u=i;const d=$e(n,u);u+=4;const h=d&2147483647;if((d&2147483648)>>>31===1)return ot.warn("SIDX has hierarchical references (not supported)"),null;const g=$e(n,u);u+=4,e.push({referenceSize:h,subsegmentDuration:g,info:{duration:g/r,start:o,end:o+h-1}}),o+=h,u+=4,i=u}return{earliestPresentationTime:s,timescale:r,version:t,referencesCount:l,references:e}}function PS(n){const e=[],t=We(n,["moov","trak"]);for(let r=0;r<t.length;r++){const s=t[r],a=We(s,["tkhd"])[0];if(a){let o=a[0];const l=$e(a,o===0?12:20),c=We(s,["mdia","mdhd"])[0];if(c){o=c[0];const u=$e(c,o===0?12:20),d=We(s,["mdia","hdlr"])[0];if(d){const h=Ht(d.subarray(8,12)),m={soun:ht.AUDIO,vide:ht.VIDEO}[h],g=We(s,["mdia","minf","stbl","stsd"])[0],v=wk(g);m?(e[l]={timescale:u,type:m,stsd:v},e[m]=ct({timescale:u,id:l},v)):e[l]={timescale:u,type:h,stsd:v}}}}}return We(n,["moov","mvex","trex"]).forEach(r=>{const s=$e(r,4),a=e[s];a&&(a.default={duration:$e(r,12),flags:$e(r,20)})}),e}function wk(n){const e=n.subarray(8),t=e.subarray(86),i=Ht(e.subarray(4,8));let r=i,s;const a=i==="enca"||i==="encv";if(a){const c=We(e,[i])[0].subarray(i==="enca"?28:78);We(c,["sinf"]).forEach(d=>{const h=We(d,["schm"])[0];if(h){const m=Ht(h.subarray(4,8));if(m==="cbcs"||m==="cenc"){const g=We(d,["frma"])[0];g&&(r=Ht(g))}}})}const o=r;switch(r){case"avc1":case"avc2":case"avc3":case"avc4":{const l=We(t,["avcC"])[0];l&&l.length>3&&(r+="."+gc(l[1])+gc(l[2])+gc(l[3]),s=mc(o==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const l=We(e,[i])[0],c=We(l.subarray(28),["esds"])[0];if(c&&c.length>7){let u=4;if(c[u++]!==3)break;u=mh(c,u),u+=2;const d=c[u++];if(d&128&&(u+=2),d&64&&(u+=c[u++]),c[u++]!==4)break;u=mh(c,u);const h=c[u++];if(h===64)r+="."+gc(h);else break;if(u+=12,c[u++]!==5)break;u=mh(c,u);const m=c[u++];let g=(m&248)>>3;g===31&&(g+=1+((m&7)<<3)+((c[u]&224)>>5)),r+="."+g}break}case"hvc1":case"hev1":{const l=We(t,["hvcC"])[0];if(l&&l.length>12){const c=l[1],u=["","A","B","C"][c>>6],d=c&31,h=$e(l,2),m=(c&32)>>5?"H":"L",g=l[12],v=l.subarray(6,12);r+="."+u+d,r+="."+Ck(h).toString(16).toUpperCase(),r+="."+m+g;let x="";for(let E=v.length;E--;){const R=v[E];(R||x)&&(x="."+R.toString(16).toUpperCase()+x)}r+=x}s=mc(o=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{r=mc(r,t)||r;break}case"vp09":{const l=We(t,["vpcC"])[0];if(l&&l.length>6){const c=l[4],u=l[5],d=l[6]>>4&15;r+="."+Ti(c)+"."+Ti(u)+"."+Ti(d)}break}case"av01":{const l=We(t,["av1C"])[0];if(l&&l.length>2){const c=l[1]>>>5,u=l[1]&31,d=l[2]>>>7?"H":"M",h=(l[2]&64)>>6,m=(l[2]&32)>>5,g=c===2&&h?m?12:10:h?10:8,v=(l[2]&16)>>4,x=(l[2]&8)>>3,E=(l[2]&4)>>2,R=l[2]&3;r+="."+c+"."+Ti(u)+d+"."+Ti(g)+"."+v+"."+x+E+R+"."+Ti(1)+"."+Ti(1)+"."+Ti(1)+"."+0,s=mc("dav1",t)}break}}return{codec:r,encrypted:a,supplemental:s}}function mc(n,e){const t=We(e,["dvvC"]),i=t.length?t[0]:We(e,["dvcC"])[0];if(i){const r=i[2]>>1&127,s=i[2]<<5&32|i[3]>>3&31;return n+"."+Ti(r)+"."+Ti(s)}}function Ck(n){let e=0;for(let t=0;t<32;t++)e|=(n>>t&1)<<31-t;return e>>>0}function mh(n,e){const t=e+5;for(;n[e++]&128&&e<t;);return e}function gc(n){return("0"+n.toString(16).toUpperCase()).slice(-2)}function Ti(n){return(n<10?"0":"")+n}function kk(n,e){if(!n||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&We(n,["moov","trak"]).forEach(r=>{const a=We(r,["mdia","minf","stbl","stsd"])[0].subarray(8);let o=We(a,["enca"]);const l=o.length>0;l||(o=We(a,["encv"])),o.forEach(c=>{const u=l?c.subarray(28):c.subarray(78);We(u,["sinf"]).forEach(h=>{const m=OS(h);if(m){const g=m.subarray(8,24);g.some(v=>v!==0)||(ot.log(`[eme] Patching keyId in 'enc${l?"a":"v"}>sinf>>tenc' box: ${zi.hexDump(g)} -> ${zi.hexDump(t)}`),m.set(t,8))}})})})}function OS(n){const e=We(n,["schm"])[0];if(e){const t=Ht(e.subarray(4,8));if(t==="cbcs"||t==="cenc")return We(n,["schi","tenc"])[0]}return null}function Dk(n,e,t){const i={},r=We(n,["moof","traf"]);for(let s=0;s<r.length;s++){const a=r[s],o=We(a,["tfhd"])[0],l=$e(o,4),c=e[l];if(!c)continue;i[l]||(i[l]={start:NaN,duration:0,sampleCount:0,timescale:c.timescale,type:c.type});const u=i[l],d=We(a,["tfdt"])[0];if(d){const k=d[0];let D=$e(d,4);k===1&&(D===I_?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(D*=I_+1,D+=$e(d,8))),Re(D)&&(!Re(u.start)||D<u.start)&&(u.start=D)}const h=c.default,m=$e(o,0)|(h==null?void 0:h.flags);let g=(h==null?void 0:h.duration)||0;m&8&&(m&2?g=$e(o,12):g=$e(o,8));const v=We(a,["trun"]);let x=u.start||0,E=0,R=g;for(let k=0;k<v.length;k++){const D=v[k],V=$e(D,4),H=u.sampleCount;u.sampleCount+=V;const C=D[3]&1,S=D[3]&4,b=D[2]&1,T=D[2]&2,L=D[2]&4,F=D[2]&8;let U=8,Z=V;for(C&&(U+=4),S&&V&&(!(D[U+1]&1)&&u.keyFrameIndex===void 0&&(u.keyFrameIndex=H),U+=4,b?(R=$e(D,U),U+=4):R=g,T&&(U+=4),F&&(U+=4),x+=R,E+=R,Z--);Z--;)b?(R=$e(D,U),U+=4):R=g,T&&(U+=4),L&&(D[U+1]&1||u.keyFrameIndex===void 0&&(u.keyFrameIndex=u.sampleCount-(Z+1),u.keyFrameStart=x),U+=4),F&&(U+=4),x+=R,E+=R;!E&&g&&(E+=g*V)}u.duration+=E}if(!Object.keys(i).some(s=>i[s].duration)){let s=1/0,a=0;const o=We(n,["sidx"]);for(let l=0;l<o.length;l++){const c=Lk(o[l]);if(c!=null&&c.references){s=Math.min(s,c.earliestPresentationTime/c.timescale);const u=c.references.reduce((d,h)=>d+h.info.duration||0,0);a=Math.max(a,u+c.earliestPresentationTime/c.timescale)}}a&&Re(a)&&Object.keys(i).forEach(l=>{i[l].duration||(i[l].duration=a*i[l].timescale-i[l].start)})}return i}function Pk(n){const e={valid:null,remainder:null},t=We(n,["moof"]);if(t.length<2)return e.remainder=n,e;const i=t[t.length-1];return e.valid=n.slice(0,i.byteOffset-8),e.remainder=n.slice(i.byteOffset-8),e}function Xn(n,e){const t=new Uint8Array(n.length+e.length);return t.set(n),t.set(e,n.length),t}function L_(n,e){const t=[],i=e.samples,r=e.timescale,s=e.id;let a=!1;return We(i,["moof"]).map(l=>{const c=l.byteOffset-8;We(l,["traf"]).map(d=>{const h=We(d,["tfdt"]).map(m=>{const g=m[0];let v=$e(m,4);return g===1&&(v*=Math.pow(2,32),v+=$e(m,8)),v/r})[0];return h!==void 0&&(n=h),We(d,["tfhd"]).map(m=>{const g=$e(m,4),v=$e(m,0)&16777215,x=(v&1)!==0,E=(v&2)!==0,R=(v&8)!==0;let k=0;const D=(v&16)!==0;let V=0;const H=(v&32)!==0;let C=8;g===s&&(x&&(C+=8),E&&(C+=4),R&&(k=$e(m,C),C+=4),D&&(V=$e(m,C),C+=4),H&&(C+=4),e.type==="video"&&(a=md(e.codec)),We(d,["trun"]).map(S=>{const b=S[0],T=$e(S,0)&16777215,L=(T&1)!==0;let F=0;const U=(T&4)!==0,Z=(T&256)!==0;let ie=0;const le=(T&512)!==0;let ge=0;const te=(T&1024)!==0,j=(T&2048)!==0;let $=0;const q=$e(S,4);let Q=8;L&&(F=$e(S,Q),Q+=4),U&&(Q+=4);let fe=F+c;for(let ve=0;ve<q;ve++){if(Z?(ie=$e(S,Q),Q+=4):ie=k,le?(ge=$e(S,Q),Q+=4):ge=V,te&&(Q+=4),j&&(b===0?$=$e(S,Q):$=DS(S,Q),Q+=4),e.type===ht.VIDEO){let be=0;for(;be<ge;){const xe=$e(i,fe);if(fe+=4,Ok(a,i[fe])){const ce=i.subarray(fe,fe+xe);Rm(ce,a?2:1,n+$/r,t)}fe+=xe,be+=xe+4}}n+=ie/r}}))})})}),t}function md(n){if(!n)return!1;const e=n.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function Ok(n,e){if(n){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function Rm(n,e,t,i){const r=MS(n);let s=0;s+=e;let a=0,o=0,l=0;for(;s<r.length;){a=0;do{if(s>=r.length)break;l=r[s++],a+=l}while(l===255);o=0;do{if(s>=r.length)break;l=r[s++],o+=l}while(l===255);const c=r.length-s;let u=s;if(o<c)s+=o;else if(o>c){ot.error(`Malformed SEI payload. ${o} is too small, only ${c} bytes left to parse.`);break}if(a===4){if(r[u++]===181){const h=kS(r,u);if(u+=2,h===49){const m=$e(r,u);if(u+=4,m===1195456820){const g=r[u++];if(g===3){const v=r[u++],x=31&v,E=64&v,R=E?2+x*3:0,k=new Uint8Array(R);if(E){k[0]=v;for(let D=1;D<R;D++)k[D]=r[u++]}i.push({type:g,payloadType:a,pts:t,bytes:k})}}}}}else if(a===5&&o>16){const d=[];for(let g=0;g<16;g++){const v=r[u++].toString(16);d.push(v.length==1?"0"+v:v),(g===3||g===5||g===7||g===9)&&d.push("-")}const h=o-16,m=new Uint8Array(h);for(let g=0;g<h;g++)m[g]=r[u++];i.push({payloadType:a,pts:t,uuid:d.join(""),userData:On(m),userDataBytes:m})}}}function MS(n){const e=n.byteLength,t=[];let i=1;for(;i<e-2;)n[i]===0&&n[i+1]===0&&n[i+2]===3?(t.push(i+2),i+=2):i++;if(t.length===0)return n;const r=e-t.length,s=new Uint8Array(r);let a=0;for(i=0;i<r;a++,i++)a===t[0]&&(a++,t.shift()),s[i]=n[a];return s}function Mk(n){const e=n[0];let t="",i="",r=0,s=0,a=0,o=0,l=0,c=0;if(e===0){for(;Ht(n.subarray(c,c+1))!=="\0";)t+=Ht(n.subarray(c,c+1)),c+=1;for(t+=Ht(n.subarray(c,c+1)),c+=1;Ht(n.subarray(c,c+1))!=="\0";)i+=Ht(n.subarray(c,c+1)),c+=1;i+=Ht(n.subarray(c,c+1)),c+=1,r=$e(n,12),s=$e(n,16),o=$e(n,20),l=$e(n,24),c=28}else if(e===1){c+=4,r=$e(n,c),c+=4;const d=$e(n,c);c+=4;const h=$e(n,c);for(c+=4,a=2**32*d+h,hk(a)||(a=Number.MAX_SAFE_INTEGER,ot.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=$e(n,c),c+=4,l=$e(n,c),c+=4;Ht(n.subarray(c,c+1))!=="\0";)t+=Ht(n.subarray(c,c+1)),c+=1;for(t+=Ht(n.subarray(c,c+1)),c+=1;Ht(n.subarray(c,c+1))!=="\0";)i+=Ht(n.subarray(c,c+1)),c+=1;i+=Ht(n.subarray(c,c+1)),c+=1}const u=n.subarray(c,n.byteLength);return{schemeIdUri:t,value:i,timeScale:r,presentationTime:a,presentationTimeDelta:s,eventDuration:o,id:l,payload:u}}function Nk(n,...e){const t=e.length;let i=8,r=t;for(;r--;)i+=e[r].byteLength;const s=new Uint8Array(i);for(s[0]=i>>24&255,s[1]=i>>16&255,s[2]=i>>8&255,s[3]=i&255,s.set(n,4),r=0,i=8;r<t;r++)s.set(e[r],i),i+=e[r].byteLength;return s}function Bk(n,e,t){if(n.byteLength!==16)throw new RangeError("Invalid system id");let i,r;i=0,r=new Uint8Array;let s;i>0?(s=new Uint8Array(4),e.length>0&&new DataView(s.buffer).setUint32(0,e.length,!1)):s=new Uint8Array;const a=new Uint8Array(4);return t.byteLength>0&&new DataView(a.buffer).setUint32(0,t.byteLength,!1),Nk([112,115,115,104],new Uint8Array([i,0,0,0]),n,s,r,a,t)}const NS=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),Va={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function Lm(n,e){const t=Va[e];return!!t&&!!t[n.slice(0,4)]}function Gf(n,e,t=!0){return!n.split(",").some(i=>!wm(i,e,t))}function wm(n,e,t=!0){var i;const r=Zr(t);return(i=r==null?void 0:r.isTypeSupported(dl(n,e)))!=null?i:!1}function dl(n,e){return`${e}/mp4;codecs=${n}`}function w_(n){if(n){const e=n.substring(0,4);return Va.video[e]}return 2}function Nu(n){const e=NS();return n.split(",").reduce((t,i)=>{const s=e&&md(i)?9:Va.video[i];return s?(s*2+t)/(t?3:2):(Va.audio[i]+t)/(t?2:1)},0)}const gh={};function Fk(n,e=!0){if(gh[n])return gh[n];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[n];for(let r=0;r<t.length;r++){var i;if(wm(t[r],"audio",e))return gh[n]=t[r],t[r];if(t[r]==="mp3"&&(i=Zr(e))!=null&&i.isTypeSupported("audio/mpeg"))return""}return n}const Uk=/flac|opus|mp4a\.40\.34/i;function Bu(n,e=!0){return n.replace(Uk,t=>Fk(t.toLowerCase(),e))}function $k(n,e){const t=[];if(n){const i=n.split(",");for(let r=0;r<i.length;r++)Lm(i[r],"video")||t.push(i[r])}return e&&t.push(e),t.join(",")}function qc(n,e){if(n&&(n.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(n)!==-1)&&(C_(n,"audio")||C_(n,"video")))return n;if(e){const t=e.split(",");if(t.length>1){if(n){for(let i=t.length;i--;)if(t[i].substring(0,4)===n.substring(0,4))return t[i]}return t[0]}}return e||n}function C_(n,e){return Lm(n,e)&&wm(n,e)}function Vk(n){const e=n.split(",");for(let t=0;t<e.length;t++){const i=e[t].split(".");i.length>2&&i[0]==="avc1"&&(e[t]=`avc1.${parseInt(i[1]).toString(16)}${("000"+parseInt(i[2]).toString(16)).slice(-4)}`)}return e.join(",")}function jk(n){if(n.startsWith("av01.")){const e=n.split("."),t=["0","111","01","01","01","0"];for(let i=e.length;i>4&&i<10;i++)e[i]=t[i-4];return e.join(".")}return n}function k_(n){const e=Zr(n)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function Hf(n){return n.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const BS={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]};function FS(n,e){return{supported:!1,configurations:e,decodingInfoResults:[{supported:!1,smooth:!1,powerEfficient:!1}],error:n}}function Gk(n,e,t,i,r,s){const a=n.videoCodec,o=n.audioCodec?n.audioGroups:null,l=s==null?void 0:s.audioCodec,c=s==null?void 0:s.channels,u=c?parseInt(c):l?1/0:2;let d=null;if(o!=null&&o.length)try{o.length===1&&o[0]?d=e.groups[o[0]].channels:d=o.reduce((h,m)=>{if(m){const g=e.groups[m];if(!g)throw new Error(`Audio track group ${m} not found`);Object.keys(g.channels).forEach(v=>{h[v]=(h[v]||0)+g.channels[v]})}return h},{2:0})}catch{return!0}return a!==void 0&&(a.split(",").some(h=>md(h))||n.width>1920&&n.height>1088||n.height>1920&&n.width>1088||n.frameRate>Math.max(i,30)||n.videoRange!=="SDR"&&n.videoRange!==t||n.bitrate>Math.max(r,8e6))||!!d&&Re(u)&&Object.keys(d).some(h=>parseInt(h)>u)}function US(n,e,t,i={}){const r=n.videoCodec;if(!r&&!n.audioCodec||!t)return Promise.resolve(BS);const s=[],a=Hk(n),o=a.length,l=zk(n,e,o>0),c=l.length;for(let u=o||1*c||1;u--;){const d={type:"media-source"};if(o&&(d.video=a[u%o]),c){d.audio=l[u%c];const h=d.audio.bitrate;d.video&&h&&(d.video.bitrate-=h)}s.push(d)}if(r){const u=navigator.userAgent;if(r.split(",").some(d=>md(d))&&NS())return Promise.resolve(FS(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${u})`),s))}return Promise.all(s.map(u=>{const d=Wk(u);return i[d]||(i[d]=t.decodingInfo(u))})).then(u=>({supported:!u.some(d=>!d.supported),configurations:s,decodingInfoResults:u})).catch(u=>({supported:!1,configurations:s,decodingInfoResults:[],error:u}))}function Hk(n){var e;const t=(e=n.videoCodec)==null?void 0:e.split(","),i=$S(n),r=n.width||640,s=n.height||480,a=n.frameRate||30,o=n.videoRange.toLowerCase();return t?t.map(l=>{const c={contentType:dl(jk(l),"video"),width:r,height:s,bitrate:i,framerate:a};return o!=="sdr"&&(c.transferFunction=o),c}):[]}function zk(n,e,t){var i;const r=(i=n.audioCodec)==null?void 0:i.split(","),s=$S(n);return r&&n.audioGroups?n.audioGroups.reduce((a,o)=>{var l;const c=o?(l=e.groups[o])==null?void 0:l.tracks:null;return c?c.reduce((u,d)=>{if(d.groupId===o){const h=parseFloat(d.channels||"");r.forEach(m=>{const g={contentType:dl(m,"audio"),bitrate:t?Kk(m,s):s};h&&(g.channels=""+h),u.push(g)})}return u},a):a},[]):[]}function Kk(n,e){if(e<=1)return 1;let t=128e3;return n==="ec-3"?t=768e3:n==="ac-3"&&(t=64e4),Math.min(e/2,t)}function $S(n){return Math.ceil(Math.max(n.bitrate*.9,n.averageBitrate)/1e3)*1e3||1}function Wk(n){let e="";const{audio:t,video:i}=n;if(i){const r=Hf(i.contentType);e+=`${r}_r${i.height}x${i.width}f${Math.ceil(i.framerate)}${i.transferFunction||"sd"}_${Math.ceil(i.bitrate/1e5)}`}if(t){const r=Hf(t.contentType);e+=`${i?"_":""}${r}_c${t.channels}`}return e}const zf=["NONE","TYPE-0","TYPE-1",null];function qk(n){return zf.indexOf(n)>-1}const Fu=["SDR","PQ","HLG"];function Yk(n){return!!n&&Fu.indexOf(n)>-1}var Yc={No:"",Yes:"YES",v2:"v2"};function D_(n){const{canSkipUntil:e,canSkipDateRanges:t,age:i}=n,r=i<e/2;return e&&r?t?Yc.v2:Yc.Yes:Yc.No}class P_{constructor(e,t,i){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=i}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class hl{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(i=>!!i).map(i=>i.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const i=(t=e.supplemental)==null?void 0:t.videoCodec;i&&i!==e.videoCodec&&(this.codecSet+=`,${i.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return O_(this._audioGroups,e)}hasSubtitleGroup(e){return O_(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let i=this._audioGroups;i||(i=this._audioGroups=[]),i.indexOf(t)===-1&&i.push(t)}else if(e==="text"){let i=this._subtitleGroups;i||(i=this._subtitleGroups=[]),i.indexOf(t)===-1&&i.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function O_(n,e){return!e||!n?!1:n.indexOf(e)!==-1}function Xk(){if(typeof matchMedia=="function"){const n=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(n.media!==e.media)return n.matches===!0}return!1}function Qk(n,e){let t=!1,i=[];if(n&&(t=n!=="SDR",i=[n]),e){i=e.allowedVideoRanges||Fu.slice(0);const r=i.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:r&&Xk(),t||(i=["SDR"])}return{preferHDR:t,allowedVideoRanges:i}}const Jk=n=>{const e=new WeakSet;return(t,i)=>{if(n&&(i=n(t,i)),typeof i=="object"&&i!==null){if(e.has(i))return;e.add(i)}return i}},vt=(n,e)=>JSON.stringify(n,Jk(e));function Zk(n,e,t,i,r){const s=Object.keys(n),a=i==null?void 0:i.channels,o=i==null?void 0:i.audioCodec,l=r==null?void 0:r.videoCodec,c=a&&parseInt(a)===2;let u=!1,d=!1,h=1/0,m=1/0,g=1/0,v=1/0,x=0,E=[];const{preferHDR:R,allowedVideoRanges:k}=Qk(e,r);for(let S=s.length;S--;){const b=n[s[S]];u||(u=b.channels[2]>0),h=Math.min(h,b.minHeight),m=Math.min(m,b.minFramerate),g=Math.min(g,b.minBitrate),k.filter(L=>b.videoRanges[L]>0).length>0&&(d=!0)}h=Re(h)?h:0,m=Re(m)?m:0;const D=Math.max(1080,h),V=Math.max(30,m);g=Re(g)?g:t,t=Math.max(g,t),d||(e=void 0);const H=s.length>1;return{codecSet:s.reduce((S,b)=>{const T=n[b];if(b===S)return S;if(E=d?k.filter(L=>T.videoRanges[L]>0):[],H){if(T.minBitrate>t)return vi(b,`min bitrate of ${T.minBitrate} > current estimate of ${t}`),S;if(!T.hasDefaultAudio)return vi(b,"no renditions with default or auto-select sound found"),S;if(o&&b.indexOf(o.substring(0,4))%5!==0)return vi(b,`audio codec preference "${o}" not found`),S;if(a&&!c){if(!T.channels[a])return vi(b,`no renditions with ${a} channel sound found (channels options: ${Object.keys(T.channels)})`),S}else if((!o||c)&&u&&T.channels[2]===0)return vi(b,"no renditions with stereo sound found"),S;if(T.minHeight>D)return vi(b,`min resolution of ${T.minHeight} > maximum of ${D}`),S;if(T.minFramerate>V)return vi(b,`min framerate of ${T.minFramerate} > maximum of ${V}`),S;if(!E.some(L=>T.videoRanges[L]>0))return vi(b,`no variants with VIDEO-RANGE of ${vt(E)} found`),S;if(l&&b.indexOf(l.substring(0,4))%5!==0)return vi(b,`video codec preference "${l}" not found`),S;if(T.maxScore<x)return vi(b,`max score of ${T.maxScore} < selected max of ${x}`),S}return S&&(Nu(b)>=Nu(S)||T.fragmentError>n[S].fragmentError)?S:(v=T.minIndex,x=T.maxScore,b)},void 0),videoRanges:E,preferHDR:R,minFramerate:m,minBitrate:g,minIndex:v}}function vi(n,e){ot.log(`[abr] start candidates with "${n}" ignored because ${e}`)}function VS(n){return n.reduce((e,t)=>{let i=e.groups[t.groupId];i||(i=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),i.tracks.push(t);const r=t.channels||"2";return i.channels[r]=(i.channels[r]||0)+1,i.hasDefault=i.hasDefault||t.default,i.hasAutoSelect=i.hasAutoSelect||t.autoselect,i.hasDefault&&(e.hasDefaultAudio=!0),i.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function eD(n,e,t,i){return n.slice(t,i+1).reduce((r,s,a)=>{if(!s.codecSet)return r;const o=s.audioGroups;let l=r[s.codecSet];l||(r[s.codecSet]=l={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:a,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!o,fragmentError:0}),l.minBitrate=Math.min(l.minBitrate,s.bitrate);const c=Math.min(s.height,s.width);return l.minHeight=Math.min(l.minHeight,c),l.minFramerate=Math.min(l.minFramerate,s.frameRate),l.minIndex=Math.min(l.minIndex,a),l.maxScore=Math.max(l.maxScore,s.score),l.fragmentError+=s.fragmentError,l.videoRanges[s.videoRange]=(l.videoRanges[s.videoRange]||0)+1,o&&o.forEach(u=>{if(!u)return;const d=e.groups[u];d&&(l.hasDefaultAudio=l.hasDefaultAudio||e.hasDefaultAudio?d.hasDefault:d.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(d.channels).forEach(h=>{l.channels[h]=(l.channels[h]||0)+d.channels[h]}))}),r},{})}function M_(n){if(!n)return n;const{lang:e,assocLang:t,characteristics:i,channels:r,audioCodec:s}=n;return{lang:e,assocLang:t,characteristics:i,channels:r,audioCodec:s}}function wi(n,e,t){if("attrs"in n){const i=e.indexOf(n);if(i!==-1)return i}for(let i=0;i<e.length;i++){const r=e[i];if(ks(n,r,t))return i}return-1}function ks(n,e,t){const{groupId:i,name:r,lang:s,assocLang:a,default:o}=n,l=n.forced;return(i===void 0||e.groupId===i)&&(r===void 0||e.name===r)&&(s===void 0||tD(s,e.lang))&&(s===void 0||e.assocLang===a)&&(o===void 0||e.default===o)&&(l===void 0||e.forced===l)&&(!("characteristics"in n)||nD(n.characteristics||"",e.characteristics))&&(t===void 0||t(n,e))}function tD(n,e="--"){return n.length===e.length?n===e:n.startsWith(e)||e.startsWith(n)}function nD(n,e=""){const t=n.split(","),i=e.split(",");return t.length===i.length&&!t.some(r=>i.indexOf(r)===-1)}function Ss(n,e){const{audioCodec:t,channels:i}=n;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(i===void 0||i===(e.channels||"2"))}function iD(n,e,t,i,r){const s=e[i],o=e.reduce((h,m,g)=>{const v=m.uri;return(h[v]||(h[v]=[])).push(g),h},{})[s.uri];o.length>1&&(i=Math.max.apply(Math,o));const l=s.videoRange,c=s.frameRate,u=s.codecSet.substring(0,4),d=N_(e,i,h=>{if(h.videoRange!==l||h.frameRate!==c||h.codecSet.substring(0,4)!==u)return!1;const m=h.audioGroups,g=t.filter(v=>!m||m.indexOf(v.groupId)!==-1);return wi(n,g,r)>-1});return d>-1?d:N_(e,i,h=>{const m=h.audioGroups,g=t.filter(v=>!m||m.indexOf(v.groupId)!==-1);return wi(n,g,r)>-1})}function N_(n,e,t){for(let i=e;i>-1;i--)if(t(n[i]))return i;for(let i=e+1;i<n.length;i++)if(t(n[i]))return i;return-1}function Uu(n,e){var t;return!!n&&n!==((t=e.loadLevelObj)==null?void 0:t.uri)}class rD extends mi{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var i;const{fragCurrent:r,partCurrent:s,hls:a}=this,{autoLevelEnabled:o,media:l}=a;if(!r||!l)return;const c=performance.now(),u=s?s.stats:r.stats,d=s?s.duration:r.duration,h=c-u.loading.start,m=a.minAutoLevel,g=r.level,v=this._nextAutoLevel;if(u.aborted||u.loaded&&u.loaded===u.total||g<=m){this.clearTimer(),this._nextAutoLevel=-1;return}if(!o)return;const x=v>-1&&v!==g,E=!!t||x;if(!E&&(l.paused||!l.playbackRate||!l.readyState))return;const R=a.mainForwardBufferInfo;if(!E&&R===null)return;const k=this.bwEstimator.getEstimateTTFB(),D=Math.abs(l.playbackRate);if(h<=Math.max(k,1e3*(d/(D*2))))return;const V=R?R.len/D:0,H=u.loading.first?u.loading.first-u.loading.start:-1,C=u.loaded&&H>-1,S=this.getBwEstimate(),b=a.levels,T=b[g],L=Math.max(u.loaded,Math.round(d*(r.bitrate||T.averageBitrate)/8));let F=C?h-H:h;F<1&&C&&(F=Math.min(h,u.loaded*8/S));const U=C?u.loaded*1e3/F:0,Z=k/1e3,ie=U?(L-u.loaded)/U:L*8/S+Z;if(ie<=V)return;const le=U?U*8:S,ge=((i=(t==null?void 0:t.details)||this.hls.latestLevelDetails)==null?void 0:i.live)===!0,te=this.hls.config.abrBandWidthUpFactor;let j=Number.POSITIVE_INFINITY,$;for($=g-1;$>m;$--){const ve=b[$].maxBitrate,be=!b[$].details||ge;if(j=this.getTimeToLoadFrag(Z,le,d*ve,be),j<Math.min(V,d+Z))break}if(j>=ie||j>d*10)return;C?this.bwEstimator.sample(h-Math.min(k,H),u.loaded):this.bwEstimator.sampleTTFB(h);const q=b[$].maxBitrate;this.getBwEstimate()*te>q&&this.resetEstimator(q);const Q=this.findBestLevel(q,m,$,0,V,1,1);Q>-1&&($=Q),this.warn(`Fragment ${r.sn}${s?" part "+s.index:""} of level ${g} is loading too slowly;
      Fragment duration: ${r.duration.toFixed(3)}
      Time to underbuffer: ${V.toFixed(3)} s
      Estimated load time for current fragment: ${ie.toFixed(3)} s
      Estimated load time for down switch fragment: ${j.toFixed(3)} s
      TTFB estimate: ${H|0} ms
      Current BW estimate: ${Re(S)?S|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${$} @ ${q|0} bps`),a.nextLoadLevel=a.nextAutoLevel=$,this.clearTimer();const fe=()=>{if(this.clearTimer(),this.fragCurrent===r&&this.hls.loadLevel===$&&$>0){const ve=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${$>0?"and switching down":""}
      Fragment duration: ${r.duration.toFixed(3)} s
      Time to underbuffer: ${ve.toFixed(3)} s`),r.abortRequests(),this.fragCurrent=this.partCurrent=null,$>m){let be=this.findBestLevel(this.hls.levels[m].bitrate,m,$,0,ve,1,1);be===-1&&(be=m),this.hls.nextLoadLevel=this.hls.nextAutoLevel=be,this.resetEstimator(this.hls.levels[be].bitrate)}}};x||ie>j*2?fe():this.timer=self.setInterval(fe,j*1e3),a.trigger(O.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,part:s,stats:u})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new pk(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.FRAG_LOADING,this.onFragLoading,this),e.on(O.FRAG_LOADED,this.onFragLoaded,this),e.on(O.FRAG_BUFFERED,this.onFragBuffered,this),e.on(O.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(O.LEVEL_LOADED,this.onLevelLoaded,this),e.on(O.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(O.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(O.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.FRAG_LOADING,this.onFragLoading,this),e.off(O.FRAG_LOADED,this.onFragLoaded,this),e.off(O.FRAG_BUFFERED,this.onFragBuffered,this),e.off(O.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(O.LEVEL_LOADED,this.onLevelLoaded,this),e.off(O.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(O.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(O.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const i=t.frag;if(!this.ignoreFragment(i)){if(!i.bitrateTest){var r;this.fragCurrent=i,this.partCurrent=(r=t.part)!=null?r:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case se.BUFFER_ADD_CODEC_ERROR:case se.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case se.FRAG_LOAD_TIMEOUT:{const i=t.frag,{fragCurrent:r,partCurrent:s}=this;if(i&&r&&i.sn===r.sn&&i.level===r.level){const a=performance.now(),o=s?s.stats:i.stats,l=a-o.loading.start,c=o.loading.first?o.loading.first-o.loading.start:-1;if(o.loaded&&c>-1){const d=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(l-Math.min(d,c),o.loaded)}else this.bwEstimator.sampleTTFB(l)}break}}}getTimeToLoadFrag(e,t,i,r){const s=e+i/t,a=r?e+this.lastLevelLoadSec:0;return s+a}onLevelLoaded(e,t){const i=this.hls.config,{loading:r}=t.stats,s=r.end-r.first;Re(s)&&(this.lastLevelLoadSec=s/1e3),t.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:i}){const r=i?i.stats:t.stats;if(t.type===Ce.MAIN&&this.bwEstimator.sampleTTFB(r.loading.first-r.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const s=i?i.duration:t.duration,a=this.hls.levels[t.level],o=(a.loaded?a.loaded.bytes:0)+r.loaded,l=(a.loaded?a.loaded.duration:0)+s;a.loaded={bytes:o,duration:l},a.realBitrate=Math.round(8*o/l)}if(t.bitrateTest){const s={stats:r,frag:t,part:i,id:t.type};this.onFragBuffered(O.FRAG_BUFFERED,s),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:i,part:r}=t,s=r!=null&&r.stats.loaded?r.stats:i.stats;if(s.aborted||this.ignoreFragment(i))return;const a=s.parsing.end-s.loading.start-Math.min(s.loading.first-s.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(a,s.loaded),s.bwEstimate=this.getBwEstimate(),i.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==Ce.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,i=this.getBwEstimate(),r=this.hls.config.maxStarvationDelay,s=this.findBestLevel(i,t,e,0,r,1,1);if(s>-1)return s;const a=this.hls.firstLevel,o=Math.min(Math.max(a,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${a} clamped to ${o}`),o}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,i=this.bwEstimator.canEstimate(),r=this.lastLoadedFragLevel>-1;if(e!==-1&&(!i||!r||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const s=i&&r?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const a=this.hls.levels;if(a.length>Math.max(e,s)&&a[e].loadError<=a[s].loadError)return e}return this._nextAutoLevel=s,this.nextAutoLevelKey=this.getAutoLevelKey(),s}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:i}=this;if(i.levels.length<=1)return i.loadLevel;const{maxAutoLevel:r,config:s,minAutoLevel:a}=i,o=t?t.duration:e?e.duration:0,l=this.getBwEstimate(),c=this.getStarvationDelay();let u=s.abrBandWidthFactor,d=s.abrBandWidthUpFactor;if(c){const x=this.findBestLevel(l,a,r,c,0,u,d);if(x>=0)return this.rebufferNotice=-1,x}let h=o?Math.min(o,s.maxStarvationDelay):s.maxStarvationDelay;if(!c){const x=this.bitrateTestDelay;x&&(h=(o?Math.min(o,s.maxLoadingDelay):s.maxLoadingDelay)-x,this.info(`bitrate test took ${Math.round(1e3*x)}ms, set first fragment max fetchDuration to ${Math.round(1e3*h)} ms`),u=d=1)}const m=this.findBestLevel(l,a,r,c,h,u,d);if(this.rebufferNotice!==m&&(this.rebufferNotice=m,this.info(`${c?"rebuffering expected":"buffer is empty"}, optimal quality level ${m}`)),m>-1)return m;const g=i.levels[a],v=i.loadLevelObj;return v&&(g==null?void 0:g.bitrate)<v.bitrate?a:i.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const i=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,r=e.mainForwardBufferInfo;return(r?r.len:0)/i}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,i,r,s,a,o){var l;const c=r+s,u=this.lastLoadedFragLevel,d=u===-1?this.hls.firstLevel:u,{fragCurrent:h,partCurrent:m}=this,{levels:g,allAudioTracks:v,loadLevel:x,config:E}=this.hls;if(g.length===1)return 0;const R=g[d],k=!!((l=this.hls.latestLevelDetails)!=null&&l.live),D=x===-1||u===-1;let V,H="SDR",C=(R==null?void 0:R.frameRate)||0;const{audioPreference:S,videoPreference:b}=E,T=this.audioTracksByGroup||(this.audioTracksByGroup=VS(v));let L=-1;if(D){if(this.firstSelection!==-1)return this.firstSelection;const le=this.codecTiers||(this.codecTiers=eD(g,T,t,i)),ge=Zk(le,H,e,S,b),{codecSet:te,videoRanges:j,minFramerate:$,minBitrate:q,minIndex:Q,preferHDR:fe}=ge;L=Q,V=te,H=fe?j[j.length-1]:j[0],C=$,e=Math.max(e,q),this.log(`picked start tier ${vt(ge)}`)}else V=R==null?void 0:R.codecSet,H=R==null?void 0:R.videoRange;const F=m?m.duration:h?h.duration:0,U=this.bwEstimator.getEstimateTTFB()/1e3,Z=[];for(let le=i;le>=t;le--){var ie;const ge=g[le],te=le>d;if(!ge)continue;if(E.useMediaCapabilities&&!ge.supportedResult&&!ge.supportedPromise){const be=navigator.mediaCapabilities;typeof(be==null?void 0:be.decodingInfo)=="function"&&Gk(ge,T,H,C,e,S)?(ge.supportedPromise=US(ge,T,be,this.supportedCache),ge.supportedPromise.then(xe=>{if(!this.hls)return;ge.supportedResult=xe;const ce=this.hls.levels,pe=ce.indexOf(ge);xe.error?this.warn(`MediaCapabilities decodingInfo error: "${xe.error}" for level ${pe} ${vt(xe)}`):xe.supported?xe.decodingInfoResults.some(Ie=>Ie.smooth===!1||Ie.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${pe} not smooth or powerEfficient: ${vt(xe)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${pe} ${vt(xe)}`),pe>-1&&ce.length>1&&(this.log(`Removing unsupported level ${pe}`),this.hls.removeLevel(pe),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))})):ge.supportedResult=BS}if((V&&ge.codecSet!==V||H&&ge.videoRange!==H||te&&C>ge.frameRate||!te&&C>0&&C<ge.frameRate||(ie=ge.supportedResult)!=null&&(ie=ie.decodingInfoResults)!=null&&ie.some(be=>be.smooth===!1))&&(!D||le!==L)){Z.push(le);continue}const j=ge.details,$=(m?j==null?void 0:j.partTarget:j==null?void 0:j.averagetargetduration)||F;let q;te?q=o*e:q=a*e;const Q=F&&r>=F*2&&s===0?ge.averageBitrate:ge.maxBitrate,fe=this.getTimeToLoadFrag(U,q,Q*$,j===void 0);if(q>=Q&&(le===u||ge.loadError===0&&ge.fragmentError===0)&&(fe<=U||!Re(fe)||k&&!this.bitrateTestDelay||fe<c)){const be=this.forcedAutoLevel;return le!==x&&(be===-1||be!==x)&&(Z.length&&this.trace(`Skipped level(s) ${Z.join(",")} of ${i} max with CODECS and VIDEO-RANGE:"${g[Z[0]].codecs}" ${g[Z[0]].videoRange}; not compatible with "${V}" ${H}`),this.info(`switch candidate:${d}->${le} adjustedbw(${Math.round(q)})-bitrate=${Math.round(q-Q)} ttfb:${U.toFixed(1)} avgDuration:${$.toFixed(1)} maxFetchDuration:${c.toFixed(1)} fetchDuration:${fe.toFixed(1)} firstSelection:${D} codecSet:${ge.codecSet} videoRange:${ge.videoRange} hls.loadLevel:${x}`)),D&&(this.firstSelection=le),le}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:i}=this.hls;return Math.min(Math.max(e,i),t)}}const jS={search:function(n,e){let t=0,i=n.length-1,r=null,s=null;for(;t<=i;){r=(t+i)/2|0,s=n[r];const a=e(s);if(a>0)t=r+1;else if(a<0)i=r-1;else return s}return null}};function sD(n,e,t){if(e===null||!Array.isArray(n)||!n.length||!Re(e))return null;const i=n[0].programDateTime;if(e<(i||0))return null;const r=n[n.length-1].endProgramDateTime;if(e>=(r||0))return null;for(let s=0;s<n.length;++s){const a=n[s];if(oD(e,t,a))return a}return null}function Vs(n,e,t=0,i=0,r=.005){let s=null;if(n){s=e[1+n.sn-e[0].sn]||null;const o=n.endDTS-t;o>0&&o<15e-7&&(t+=15e-7),s&&n.level!==s.level&&s.end<=n.end&&(s=e[2+n.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(s=e[0]);if(s&&((!n||n.level===s.level)&&B_(t,i,s)===0||aD(s,n,Math.min(r,i))))return s;const a=jS.search(e,B_.bind(null,t,i));return a&&(a!==n||!s)?a:s}function aD(n,e,t){if(e&&e.start===0&&e.level<n.level&&(e.endPTS||0)>0){const i=e.tagList.reduce((r,s)=>(s[0]==="INF"&&(r+=parseFloat(s[1])),r),t);return n.start<=i}return!1}function B_(n=0,e=0,t){if(t.start<=n&&t.start+t.duration>n)return 0;const i=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-i<=n?1:t.start-i>n&&t.start?-1:0}function oD(n,e,t){const i=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-i>n}function GS(n,e,t){if(n&&n.startCC<=e&&n.endCC>=e){let i=n.fragments;const{fragmentHint:r}=n;r&&(i=i.concat(r));let s;return jS.search(i,a=>a.cc<e?1:a.cc>e?-1:(s=a,a.end<=t?1:a.start>t?-1:0)),s||null}return null}function $u(n){switch(n.details){case se.FRAG_LOAD_TIMEOUT:case se.KEY_LOAD_TIMEOUT:case se.LEVEL_LOAD_TIMEOUT:case se.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function F_(n,e){const t=$u(e);return n.default[`${t?"timeout":"error"}Retry`]}function Cm(n,e){const t=n.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*n.retryDelayMs,n.maxRetryDelayMs)}function U_(n){return ct(ct({},n),{errorRetry:null,timeoutRetry:null})}function Vu(n,e,t,i){if(!n)return!1;const r=i==null?void 0:i.code,s=e<n.maxNumRetry&&(lD(r)||!!t);return n.shouldRetry?n.shouldRetry(n,e,t,i,s):s}function lD(n){return n===0&&navigator.onLine===!1||!!n&&(n<400||n>499)}var ln={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},ri={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4};class cD extends mi{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(O.ERROR,this.onError,this),e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(O.ERROR,this.onError,this),e.off(O.ERROR,this.onErrorOut,this),e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===Ce.MAIN?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,t){var i;if(t.fatal)return;const r=this.hls,s=t.context;switch(t.details){case se.FRAG_LOAD_ERROR:case se.FRAG_LOAD_TIMEOUT:case se.KEY_LOAD_ERROR:case se.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case se.FRAG_PARSING_ERROR:if((i=t.frag)!=null&&i.gap){t.errorAction=fl();return}case se.FRAG_GAP:case se.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=ln.SendAlternateToPenaltyBox;return}case se.LEVEL_EMPTY_ERROR:case se.LEVEL_PARSING_ERROR:{var a;const l=t.parent===Ce.MAIN?t.level:r.loadLevel;t.details===se.LEVEL_EMPTY_ERROR&&((a=t.context)!=null&&(a=a.levelDetails)!=null&&a.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,l):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,l))}return;case se.LEVEL_LOAD_ERROR:case se.LEVEL_LOAD_TIMEOUT:typeof(s==null?void 0:s.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.level));return;case se.AUDIO_TRACK_LOAD_ERROR:case se.AUDIO_TRACK_LOAD_TIMEOUT:case se.SUBTITLE_LOAD_ERROR:case se.SUBTITLE_TRACK_LOAD_TIMEOUT:if(s){const l=r.loadLevelObj;if(l&&(s.type===qe.AUDIO_TRACK&&l.hasAudioGroup(s.groupId)||s.type===qe.SUBTITLE_TRACK&&l.hasSubtitleGroup(s.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.loadLevel),t.errorAction.action=ln.SendAlternateToPenaltyBox,t.errorAction.flags=ri.MoveAllAlternatesMatchingHost;return}}return;case se.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const l=r.loadLevelObj,c=l==null?void 0:l.attrs["HDCP-LEVEL"];c?t.errorAction={action:ln.SendAlternateToPenaltyBox,flags:ri.MoveAllAlternatesMatchingHDCP,hdcpLevel:c}:this.keySystemError(t)}return;case se.BUFFER_ADD_CODEC_ERROR:case se.REMUX_ALLOC_ERROR:case se.BUFFER_APPEND_ERROR:if(!t.errorAction){var o;t.errorAction=this.getLevelSwitchAction(t,(o=t.level)!=null?o:r.loadLevel)}return;case se.INTERNAL_EXCEPTION:case se.BUFFER_APPENDING_ERROR:case se.BUFFER_FULL_ERROR:case se.LEVEL_SWITCH_ERROR:case se.BUFFER_STALLED_ERROR:case se.BUFFER_SEEK_OVER_HOLE:case se.BUFFER_NUDGE_ON_STALL:t.errorAction=fl();return}t.type===Pe.KEY_SYSTEM_ERROR&&this.keySystemError(t)}keySystemError(e){const t=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,t)}getPlaylistRetryOrSwitchAction(e,t){const i=this.hls,r=F_(i.config.playlistLoadPolicy,e),s=this.playlistError++;if(Vu(r,s,$u(e),e.response))return{action:ln.RetryRequest,flags:ri.None,retryConfig:r,retryCount:s};const o=this.getLevelSwitchAction(e,t);return r&&(o.retryConfig=r,o.retryCount=s),o}getFragRetryOrSwitchAction(e){const t=this.hls,i=this.getVariantLevelIndex(e.frag),r=t.levels[i],{fragLoadPolicy:s,keyLoadPolicy:a}=t.config,o=F_(e.details.startsWith("key")?a:s,e),l=t.levels.reduce((u,d)=>u+d.fragmentError,0);if(r&&(e.details!==se.FRAG_GAP&&r.fragmentError++,Vu(o,l,$u(e),e.response)))return{action:ln.RetryRequest,flags:ri.None,retryConfig:o,retryCount:l};const c=this.getLevelSwitchAction(e,i);return o&&(c.retryConfig=o,c.retryCount=l),c}getLevelSwitchAction(e,t){const i=this.hls;t==null&&(t=i.loadLevel);const r=this.hls.levels[t];if(r){var s,a;const c=e.details;r.loadError++,c===se.BUFFER_APPEND_ERROR&&r.fragmentError++;let u=-1;const{levels:d,loadLevel:h,minAutoLevel:m,maxAutoLevel:g}=i;!i.autoLevelEnabled&&!i.config.preserveManualLevelOnError&&(i.loadLevel=-1);const v=(s=e.frag)==null?void 0:s.type,E=(v===Ce.AUDIO&&c===se.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(c===se.BUFFER_ADD_CODEC_ERROR||c===se.BUFFER_APPEND_ERROR))&&d.some(({audioCodec:H})=>r.audioCodec!==H),k=e.sourceBufferName==="video"&&(c===se.BUFFER_ADD_CODEC_ERROR||c===se.BUFFER_APPEND_ERROR)&&d.some(({codecSet:H,audioCodec:C})=>r.codecSet!==H&&r.audioCodec===C),{type:D,groupId:V}=(a=e.context)!=null?a:{};for(let H=d.length;H--;){const C=(H+h)%d.length;if(C!==h&&C>=m&&C<=g&&d[C].loadError===0){var o,l;const S=d[C];if(c===se.FRAG_GAP&&v===Ce.MAIN&&e.frag){const b=d[C].details;if(b){const T=Vs(e.frag,b.fragments,e.frag.start);if(T!=null&&T.gap)continue}}else{if(D===qe.AUDIO_TRACK&&S.hasAudioGroup(V)||D===qe.SUBTITLE_TRACK&&S.hasSubtitleGroup(V))continue;if(v===Ce.AUDIO&&(o=r.audioGroups)!=null&&o.some(b=>S.hasAudioGroup(b))||v===Ce.SUBTITLE&&(l=r.subtitleGroups)!=null&&l.some(b=>S.hasSubtitleGroup(b))||E&&r.audioCodec===S.audioCodec||k&&r.codecSet===S.codecSet||!E&&r.codecSet!==S.codecSet)continue}u=C;break}}if(u>-1&&i.loadLevel!==u)return e.levelRetry=!0,this.playlistError=0,{action:ln.SendAlternateToPenaltyBox,flags:ri.None,nextAutoLevel:u}}return{action:ln.SendAlternateToPenaltyBox,flags:ri.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var i;switch((i=t.errorAction)==null?void 0:i.action){case ln.DoNothing:break;case ln.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==se.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,i=e.errorAction;if(!i)return;const{flags:r,hdcpLevel:s,nextAutoLevel:a}=i;switch(r){case ri.None:this.switchLevel(e,a);break;case ri.MoveAllAlternatesMatchingHDCP:s&&(t.maxHdcpLevel=zf[zf.indexOf(s)-1],i.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}i.resolved||this.switchLevel(e,a)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===se.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const i=Hf(e.mimeType),r=this.hls.levels;for(let s=r.length;s--;)r[s][`${e.sourceBufferName}Codec`]===i&&this.hls.removeLevel(s)}}}function fl(n){const e={action:ln.DoNothing,flags:ri.None};return n&&(e.resolved=!0),e}var Kt={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class uD{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.BUFFER_APPENDED,this.onBufferAppended,this),e.on(O.FRAG_BUFFERED,this.onFragBuffered,this),e.on(O.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.BUFFER_APPENDED,this.onBufferAppended,this),e.off(O.FRAG_BUFFERED,this.onFragBuffered,this),e.off(O.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const i=this.activePartLists[t];if(i)for(let r=i.length;r--;){const s=i[r];if(!s)break;if(s.start<=e&&e<=s.end&&s.loaded)return s}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,i){const{fragments:r}=this,s=Object.keys(r);for(let a=s.length;a--;){const o=r[s[a]];if((o==null?void 0:o.body.type)===t&&(!i||o.buffered)){const l=o.body;if(l.start<=e&&e<=l.end)return l}}return null}detectEvictedFragments(e,t,i,r,s){this.timeRanges&&(this.timeRanges[e]=t);const a=(r==null?void 0:r.fragment.sn)||-1;Object.keys(this.fragments).forEach(o=>{const l=this.fragments[o];if(!l||a>=l.body.sn)return;if(!l.buffered&&(!l.loaded||s)){l.body.type===i&&this.removeFragment(l.body);return}const c=l.range[e];if(c){if(c.time.length===0){this.removeFragment(l.body);return}c.time.some(u=>{const d=!this.isTimeBuffered(u.startPTS,u.endPTS,t);return d&&this.removeFragment(l.body),d})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const i=e.frag,r=ea(i),s=this.fragments[r];if(!s||s.buffered&&i.gap)return;const a=!i.relurl;Object.keys(t).forEach(o=>{const l=i.elementaryStreams[o];if(!l)return;const c=t[o],u=a||l.partial===!0;s.range[o]=this.getBufferedTimes(i,e.part,u,c)}),s.loaded=null,Object.keys(s.range).length?(s.buffered=!0,(s.body.endList=i.endList||s.body.endList)&&(this.endListFragments[s.body.type]=s),_c(s)||this.removeParts(i.sn-1,i.type)):this.removeFragment(s.body)}removeParts(e,t){const i=this.activePartLists[t];i&&(this.activePartLists[t]=$_(i,r=>r.fragment.sn>=e))}fragBuffered(e,t){const i=ea(e);let r=this.fragments[i];!r&&t&&(r=this.fragments[i]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),r&&(r.loaded=null,r.buffered=!0)}getBufferedTimes(e,t,i,r){const s={time:[],partial:i},a=e.start,o=e.end,l=e.minEndPTS||o,c=e.maxStartPTS||a;for(let u=0;u<r.length;u++){const d=r.start(u)-this.bufferPadding,h=r.end(u)+this.bufferPadding;if(c>=d&&l<=h){s.time.push({startPTS:Math.max(a,r.start(u)),endPTS:Math.min(o,r.end(u))});break}else if(a<h&&o>d){const m=Math.max(a,r.start(u)),g=Math.min(o,r.end(u));g>m&&(s.partial=!0,s.time.push({startPTS:m,endPTS:g}))}else if(o<=d)break}return s}getPartialFragment(e){let t=null,i,r,s,a=0;const{bufferPadding:o,fragments:l}=this;return Object.keys(l).forEach(c=>{const u=l[c];u&&_c(u)&&(r=u.body.start-o,s=u.body.end+o,e>=r&&e<=s&&(i=Math.min(e-r,s-e),a<=i&&(t=u.body,a=i)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||_c(t))}getState(e){const t=ea(e),i=this.fragments[t];return i?i.buffered?_c(i)?Kt.PARTIAL:Kt.OK:Kt.APPENDING:Kt.NOT_LOADED}isTimeBuffered(e,t,i){let r,s;for(let a=0;a<i.length;a++){if(r=i.start(a)-this.bufferPadding,s=i.end(a)+this.bufferPadding,e>=r&&t<=s)return!0;if(t<=r)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const i=t.frag,r=t.part?null:t,s=ea(i);this.fragments[s]={body:i,appendedPTS:null,loaded:r,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:i,part:r,timeRanges:s,type:a}=t;if(i.sn==="initSegment")return;const o=i.type;if(r){let c=this.activePartLists[o];c||(this.activePartLists[o]=c=[]),c.push(r)}this.timeRanges=s;const l=s[a];this.detectEvictedFragments(a,l,o,r)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=ea(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,i=Object.keys(t);if(!e)return i.length>0;for(let r=i.length;r--;){const s=t[i[r]];if((s==null?void 0:s.body.type)===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,i,r,s){r&&!this.hasGaps||Object.keys(this.fragments).forEach(a=>{const o=this.fragments[a];if(!o)return;const l=o.body;l.type!==i||r&&!l.gap||l.start<t&&l.end>e&&(o.buffered||s)&&this.removeFragment(l)})}removeFragment(e){const t=ea(e);e.clearElementaryStreamInfo();const i=this.activePartLists[e.type];if(i){const r=e.sn;this.activePartLists[e.type]=$_(i,s=>s.fragment.sn!==r)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(i=>i.clearElementaryStreamInfo())}}function _c(n){var e,t,i;return n.buffered&&!!(n.body.gap||(e=n.range.video)!=null&&e.partial||(t=n.range.audio)!=null&&t.partial||(i=n.range.audiovideo)!=null&&i.partial)}function ea(n){return`${n.type}_${n.level}_${n.sn}`}function $_(n,e){return n.filter(t=>{const i=e(t);return i||t.clearElementaryStreamInfo(),i})}var es={cbc:0,ctr:1};class dD{constructor(e,t,i){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=i}decrypt(e,t){switch(this.aesMode){case es.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case es.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function hD(n){const e=n.byteLength,t=e&&new DataView(n.buffer).getUint8(e-1);return t?n.slice(0,e-t):n}class fD{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),i=new Uint32Array(4);for(let r=0;r<4;r++)i[r]=t.getUint32(r*4);return i}initTable(){const e=this.sBox,t=this.invSBox,i=this.subMix,r=i[0],s=i[1],a=i[2],o=i[3],l=this.invSubMix,c=l[0],u=l[1],d=l[2],h=l[3],m=new Uint32Array(256);let g=0,v=0,x=0;for(x=0;x<256;x++)x<128?m[x]=x<<1:m[x]=x<<1^283;for(x=0;x<256;x++){let E=v^v<<1^v<<2^v<<3^v<<4;E=E>>>8^E&255^99,e[g]=E,t[E]=g;const R=m[g],k=m[R],D=m[k];let V=m[E]*257^E*16843008;r[g]=V<<24|V>>>8,s[g]=V<<16|V>>>16,a[g]=V<<8|V>>>24,o[g]=V,V=D*16843009^k*65537^R*257^g*16843008,c[E]=V<<24|V>>>8,u[E]=V<<16|V>>>16,d[E]=V<<8|V>>>24,h[E]=V,g?(g=R^m[m[m[D^R]]],v^=m[m[v]]):g=v=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let i=!0,r=0;for(;r<t.length&&i;)i=t[r]===this.key[r],r++;if(i)return;this.key=t;const s=this.keySize=t.length;if(s!==4&&s!==6&&s!==8)throw new Error("Invalid aes key size="+s);const a=this.ksRows=(s+6+1)*4;let o,l;const c=this.keySchedule=new Uint32Array(a),u=this.invKeySchedule=new Uint32Array(a),d=this.sBox,h=this.rcon,m=this.invSubMix,g=m[0],v=m[1],x=m[2],E=m[3];let R,k;for(o=0;o<a;o++){if(o<s){R=c[o]=t[o];continue}k=R,o%s===0?(k=k<<8|k>>>24,k=d[k>>>24]<<24|d[k>>>16&255]<<16|d[k>>>8&255]<<8|d[k&255],k^=h[o/s|0]<<24):s>6&&o%s===4&&(k=d[k>>>24]<<24|d[k>>>16&255]<<16|d[k>>>8&255]<<8|d[k&255]),c[o]=R=(c[o-s]^k)>>>0}for(l=0;l<a;l++)o=a-l,l&3?k=c[o]:k=c[o-4],l<4||o<=4?u[l]=k:u[l]=g[d[k>>>24]]^v[d[k>>>16&255]]^x[d[k>>>8&255]]^E[d[k&255]],u[l]=u[l]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,i){const r=this.keySize+6,s=this.invKeySchedule,a=this.invSBox,o=this.invSubMix,l=o[0],c=o[1],u=o[2],d=o[3],h=this.uint8ArrayToUint32Array_(i);let m=h[0],g=h[1],v=h[2],x=h[3];const E=new Int32Array(e),R=new Int32Array(E.length);let k,D,V,H,C,S,b,T,L,F,U,Z,ie,le;const ge=this.networkToHostOrderSwap;for(;t<E.length;){for(L=ge(E[t]),F=ge(E[t+1]),U=ge(E[t+2]),Z=ge(E[t+3]),C=L^s[0],S=Z^s[1],b=U^s[2],T=F^s[3],ie=4,le=1;le<r;le++)k=l[C>>>24]^c[S>>16&255]^u[b>>8&255]^d[T&255]^s[ie],D=l[S>>>24]^c[b>>16&255]^u[T>>8&255]^d[C&255]^s[ie+1],V=l[b>>>24]^c[T>>16&255]^u[C>>8&255]^d[S&255]^s[ie+2],H=l[T>>>24]^c[C>>16&255]^u[S>>8&255]^d[b&255]^s[ie+3],C=k,S=D,b=V,T=H,ie=ie+4;k=a[C>>>24]<<24^a[S>>16&255]<<16^a[b>>8&255]<<8^a[T&255]^s[ie],D=a[S>>>24]<<24^a[b>>16&255]<<16^a[T>>8&255]<<8^a[C&255]^s[ie+1],V=a[b>>>24]<<24^a[T>>16&255]<<16^a[C>>8&255]<<8^a[S&255]^s[ie+2],H=a[T>>>24]<<24^a[C>>16&255]<<16^a[S>>8&255]<<8^a[b&255]^s[ie+3],R[t]=ge(k^m),R[t+1]=ge(H^g),R[t+2]=ge(V^v),R[t+3]=ge(D^x),m=L,g=F,v=U,x=Z,t=t+4}return R.buffer}}class pD{constructor(e,t,i){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=i}expandKey(){const e=mD(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function mD(n){switch(n){case es.cbc:return"AES-CBC";case es.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${n}`)}}const gD=16;class km{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const i=self.crypto;i&&(this.subtle=i.subtle||i.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const i=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?hD(i):i}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,i,r){return this.useSoftware?new Promise((s,a)=>{const o=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(o,t,i,r);const l=this.flush();l?s(l.buffer):a(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,i,r)}softwareDecrypt(e,t,i,r){const{currentIV:s,currentResult:a,remainderData:o}=this;if(r!==es.cbc||t.byteLength!==16)return ot.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),o&&(e=Xn(o,e),this.remainderData=null);const l=this.getValidChunk(e);if(!l.length)return null;s&&(i=s);let c=this.softwareDecrypter;c||(c=this.softwareDecrypter=new fD),c.expandKey(t);const u=a;return this.currentResult=c.decrypt(l.buffer,0,i),this.currentIV=l.slice(-16).buffer,u||null}webCryptoDecrypt(e,t,i,r){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,i,r));this.key=t,this.fastAesKey=new pD(this.subtle,t,r)}return this.fastAesKey.expandKey().then(s=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new dD(this.subtle,new Uint8Array(i),r).decrypt(e.buffer,s)):Promise.reject(new Error("web crypto not initialized"))).catch(s=>(ot.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${s.name}: ${s.message}`),this.onWebCryptoError(e,t,i,r)))}onWebCryptoError(e,t,i,r){const s=this.enableSoftwareAES;if(s){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,i,r);const a=this.flush();if(a)return a.buffer}throw new Error("WebCrypto"+(s?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const i=e.length-e.length%gD;return i!==e.length&&(t=e.slice(0,i),this.remainderData=e.slice(i)),t}logOnce(e){this.logEnabled&&(ot.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const V_=Math.pow(2,17);class _D{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const i=e.url;if(!i)return Promise.reject(new Ki({type:Pe.NETWORK_ERROR,details:se.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${i?"part list":"url"}`),networkDetails:null}));this.abort();const r=this.config,s=r.fLoader,a=r.loader;return new Promise((o,l)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(g=>g[0]==="GAP")){l(G_(e));return}else e.gap=!1;const c=this.loader=s?new s(r):new a(r),u=j_(e);e.loader=c;const d=U_(r.fragLoadPolicy.default),h={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:V_};e.stats=c.stats;const m={onSuccess:(g,v,x,E)=>{this.resetLoader(e,c);let R=g.data;x.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(R.slice(0,16)),R=R.slice(16)),o({frag:e,part:null,payload:R,networkDetails:E})},onError:(g,v,x,E)=>{this.resetLoader(e,c),l(new Ki({type:Pe.NETWORK_ERROR,details:se.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:ct({url:i,data:void 0},g),error:new Error(`HTTP Error ${g.code} ${g.text}`),networkDetails:x,stats:E}))},onAbort:(g,v,x)=>{this.resetLoader(e,c),l(new Ki({type:Pe.NETWORK_ERROR,details:se.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:x,stats:g}))},onTimeout:(g,v,x)=>{this.resetLoader(e,c),l(new Ki({type:Pe.NETWORK_ERROR,details:se.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:x,stats:g}))}};t&&(m.onProgress=(g,v,x,E)=>t({frag:e,part:null,payload:x,networkDetails:E})),c.load(u,h,m)})}loadPart(e,t,i){this.abort();const r=this.config,s=r.fLoader,a=r.loader;return new Promise((o,l)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){l(G_(e,t));return}const c=this.loader=s?new s(r):new a(r),u=j_(e,t);e.loader=c;const d=U_(r.fragLoadPolicy.default),h={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:V_};t.stats=c.stats,c.load(u,h,{onSuccess:(m,g,v,x)=>{this.resetLoader(e,c),this.updateStatsFromPart(e,t);const E={frag:e,part:t,payload:m.data,networkDetails:x};i(E),o(E)},onError:(m,g,v,x)=>{this.resetLoader(e,c),l(new Ki({type:Pe.NETWORK_ERROR,details:se.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:ct({url:u.url,data:void 0},m),error:new Error(`HTTP Error ${m.code} ${m.text}`),networkDetails:v,stats:x}))},onAbort:(m,g,v)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,c),l(new Ki({type:Pe.NETWORK_ERROR,details:se.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:v,stats:m}))},onTimeout:(m,g,v)=>{this.resetLoader(e,c),l(new Ki({type:Pe.NETWORK_ERROR,details:se.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:v,stats:m}))}})})}updateStatsFromPart(e,t){const i=e.stats,r=t.stats,s=r.total;if(i.loaded+=r.loaded,s){const l=Math.round(e.duration/t.duration),c=Math.min(Math.round(i.loaded/s),l),d=(l-c)*Math.round(i.loaded/c);i.total=i.loaded+d}else i.total=Math.max(i.loaded,i.total);const a=i.loading,o=r.loading;a.start?a.first+=o.first-o.start:(a.start=o.start,a.first=o.first),a.end=o.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function j_(n,e=null){const t=e||n,i={frag:n,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},r=t.byteRangeStartOffset,s=t.byteRangeEndOffset;if(Re(r)&&Re(s)){var a;let o=r,l=s;if(n.sn==="initSegment"&&yD((a=n.decryptdata)==null?void 0:a.method)){const c=s-r;c%16&&(l=s+(16-c%16)),r!==0&&(i.resetIV=!0,o=r-16)}i.rangeStart=o,i.rangeEnd=l}return i}function G_(n,e){const t=new Error(`GAP ${n.gap?"tag":"attribute"} found`),i={type:Pe.MEDIA_ERROR,details:se.FRAG_GAP,fatal:!1,frag:n,error:t,networkDetails:null};return e&&(i.part=e),(e||n).stats.aborted=!0,new Ki(i)}function yD(n){return n==="AES-128"||n==="AES-256"}class Ki extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class HS extends mi{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class Dm{constructor(e,t,i,r=0,s=-1,a=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=yc(),this.buffering={audio:yc(),video:yc(),audiovideo:yc()},this.level=e,this.sn=t,this.id=i,this.size=r,this.part=s,this.partial=a}}function yc(){return{start:0,executeStart:0,executeEnd:0,end:0}}const H_={length:0,start:()=>0,end:()=>0};class Ge{static isBuffered(e,t){if(e){const i=Ge.getBuffered(e);for(let r=i.length;r--;)if(t>=i.start(r)&&t<=i.end(r))return!0}return!1}static bufferedRanges(e){if(e){const t=Ge.getBuffered(e);return Ge.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let i=0;i<e.length;i++)t.push({start:e.start(i),end:e.end(i)});return t}static bufferInfo(e,t,i){if(e){const r=Ge.bufferedRanges(e);if(r.length)return Ge.bufferedInfo(r,t,i)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,i){t=Math.max(0,t),e.length>1&&e.sort((u,d)=>u.start-d.start||d.end-u.end);let r=-1,s=[];if(i)for(let u=0;u<e.length;u++){t>=e[u].start&&t<=e[u].end&&(r=u);const d=s.length;if(d){const h=s[d-1].end;e[u].start-h<i?e[u].end>h&&(s[d-1].end=e[u].end):s.push(e[u])}else s.push(e[u])}else s=e;let a=0,o,l=t,c=t;for(let u=0;u<s.length;u++){const d=s[u].start,h=s[u].end;if(r===-1&&t>=d&&t<=h&&(r=u),t+i>=d&&t<h)l=d,c=h,a=c-t;else if(t+i<d){o=d;break}}return{len:a,start:l||0,end:c||0,nextStart:o,buffered:e,bufferedIndex:r}}static getBuffered(e){try{return e.buffered||H_}catch(t){return ot.log("failed to get media.buffered",t),H_}}}const zS=/\{\$([a-zA-Z0-9-_]+)\}/g;function z_(n){return zS.test(n)}function Kf(n,e){if(n.variableList!==null||n.hasVariableRefs){const t=n.variableList;return e.replace(zS,i=>{const r=i.substring(2,i.length-1),s=t==null?void 0:t[r];return s===void 0?(n.playlistParsingError||(n.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${r}"`)),i):s})}return e}function K_(n,e,t){let i=n.variableList;i||(n.variableList=i={});let r,s;if("QUERYPARAM"in e){r=e.QUERYPARAM;try{const a=new self.URL(t).searchParams;if(a.has(r))s=a.get(r);else throw new Error(`"${r}" does not match any query parameter in URI: "${t}"`)}catch(a){n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${a.message}`))}}else r=e.NAME,s=e.VALUE;r in i?n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${r}"`)):i[r]=s||""}function vD(n,e,t){const i=e.IMPORT;if(t&&i in t){let r=n.variableList;r||(n.variableList=r={}),r[i]=t[i]}else n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${i}"`))}const ED=/^(\d+)x(\d+)$/,W_=/(.+?)=(".*?"|.*?)(?:,|$)/g;class At{constructor(e,t){typeof e=="string"&&(e=At.parseAttrList(e,t)),ut(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const i=new Uint8Array(t.length/2);for(let r=0;r<t.length/2;r++)i[r]=parseInt(t.slice(r*2,r*2+2),16);return i}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const i=this[e];return i?parseFloat(i):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const i=this[e];return(i?i.split(/[ ,]+/):[]).reduce((r,s)=>(r[s.toLowerCase()]=!0,r),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=ED.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let i;const r={},s='"';for(W_.lastIndex=0;(i=W_.exec(e))!==null;){const a=i[1].trim();let o=i[2];const l=o.indexOf(s)===0&&o.lastIndexOf(s)===o.length-1;let c=!1;if(l)o=o.slice(1,-1);else switch(a){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":c=!0}if(t&&(l||c))o=Kf(t,o);else if(!c&&!l)switch(a){case"CLOSED-CAPTIONS":if(o==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":ot.warn(`${e}: attribute ${a} is missing quotes`)}r[a]=o}return r}}const SD="com.apple.hls.interstitial";function TD(n){return n!=="ID"&&n!=="CLASS"&&n!=="CUE"&&n!=="START-DATE"&&n!=="DURATION"&&n!=="END-DATE"&&n!=="END-ON-NEXT"}function AD(n){return n==="SCTE35-OUT"||n==="SCTE35-IN"||n==="SCTE35-CMD"}class KS{constructor(e,t,i=0){var r;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(t==null?void 0:t.tagAnchor)||null,this.tagOrder=(r=t==null?void 0:t.tagOrder)!=null?r:i,t){const s=t.attr;for(const a in s)if(Object.prototype.hasOwnProperty.call(e,a)&&e[a]!==s[a]){ot.warn(`DATERANGE tag attribute: "${a}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=a;break}e=ut(new At({}),s,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const s=(t==null?void 0:t.endDate)||new Date(this.attr["END-DATE"]);Re(s.getTime())&&(this._endDate=s)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(ot.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(Re(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===SD}get isValid(){return!!this.id&&!this._badValueForSameId&&Re(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const xD=10;class bD{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,i=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!i||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&i>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}get hasProgramDateTime(){return this.fragments.length?Re(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||xD}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let i=e.length;i--;)if(e[i].index>t)return e[i].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function La(n){return n==="AES-128"||n==="AES-256"||n==="AES-256-CTR"}function Pm(n){switch(n){case"AES-128":case"AES-256":return es.cbc;case"AES-256-CTR":return es.ctr;default:throw new Error(`invalid full segment method ${n}`)}}function Om(n){return Uint8Array.from(atob(n),e=>e.charCodeAt(0))}function Wf(n){return Uint8Array.from(unescape(encodeURIComponent(n)),e=>e.charCodeAt(0))}function ID(n){const e=Wf(n).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function RD(n){const e=function(i,r,s){const a=i[r];i[r]=i[s],i[s]=a};e(n,0,3),e(n,1,2),e(n,4,5),e(n,6,7)}function LD(n){const e=n.split(":");let t=null;if(e[0]==="data"&&e.length===2){const i=e[1].split(";"),r=i[i.length-1].split(",");if(r.length===2){const s=r[0]==="base64",a=r[1];s?(i.splice(-1,1),t=Om(a)):t=ID(a)}}return t}const ju=typeof self<"u"?self:void 0;var kt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},xn={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function Xc(n){switch(n){case xn.FAIRPLAY:return kt.FAIRPLAY;case xn.PLAYREADY:return kt.PLAYREADY;case xn.WIDEVINE:return kt.WIDEVINE;case xn.CLEARKEY:return kt.CLEARKEY}}function _h(n){switch(n){case kt.FAIRPLAY:return xn.FAIRPLAY;case kt.PLAYREADY:return xn.PLAYREADY;case kt.WIDEVINE:return xn.WIDEVINE;case kt.CLEARKEY:return xn.CLEARKEY}}function bo(n){const{drmSystems:e,widevineLicenseUrl:t}=n,i=e?[kt.FAIRPLAY,kt.WIDEVINE,kt.PLAYREADY,kt.CLEARKEY].filter(r=>!!e[r]):[];return!i[kt.WIDEVINE]&&t&&i.push(kt.WIDEVINE),i}const WS=function(n){return ju!=null&&(n=ju.navigator)!=null&&n.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function wD(n,e,t,i){let r;switch(n){case kt.FAIRPLAY:r=["cenc","sinf"];break;case kt.WIDEVINE:case kt.PLAYREADY:r=["cenc"];break;case kt.CLEARKEY:r=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${n}`)}return CD(r,e,t,i)}function CD(n,e,t,i){return[{initDataTypes:n,persistentState:i.persistentState||"optional",distinctiveIdentifier:i.distinctiveIdentifier||"optional",sessionTypes:i.sessionTypes||[i.sessionType||"temporary"],audioCapabilities:e.map(s=>({contentType:`audio/mp4; codecs=${s}`,robustness:i.audioRobustness||"",encryptionScheme:i.audioEncryptionScheme||null})),videoCapabilities:t.map(s=>({contentType:`video/mp4; codecs=${s}`,robustness:i.videoRobustness||"",encryptionScheme:i.videoEncryptionScheme||null}))}]}function kD(n){var e;return n.sessionType==="persistent-license"||!!((e=n.sessionTypes)!=null&&e.some(t=>t==="persistent-license"))}function DD(n){const e=new Uint16Array(n.buffer,n.byteOffset,n.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),i=t.substring(t.indexOf("<"),t.length),a=new DOMParser().parseFromString(i,"text/xml").getElementsByTagName("KID")[0];if(a){const o=a.childNodes[0]?a.childNodes[0].nodeValue:a.getAttribute("VALUE");if(o){const l=Om(o).subarray(0,16);return RD(l),l}}return null}let vc={};class gd{static clearKeyUriToKeyIdMap(){vc={}}constructor(e,t,i,r=[1],s=null,a){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=i,this.keyFormatVersions=r,this.iv=s,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!La(e),a!=null&&a.startsWith("0x")&&(this.keyId=new Uint8Array(RS(a)))}matches(e){var t,i;return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&e.keyFormatVersions.join(",")===this.keyFormatVersions.join(",")&&((t=e.iv)==null?void 0:t.join(","))===((i=this.iv)==null?void 0:i.join(","))}isSupported(){if(this.method){if(La(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case xn.FAIRPLAY:case xn.WIDEVINE:case xn.PLAYREADY:case xn.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if(La(this.method)&&this.uri&&!this.iv){typeof e!="number"&&(ot.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const i=PD(e);return new gd(this.method,this.uri,"identity",this.keyFormatVersions,i)}if(this.pssh&&this.keyId)return this;const t=LD(this.uri);if(t)switch(this.keyFormat){case xn.WIDEVINE:if(this.pssh=t,!this.keyId&&t.length>=22){const i=t.length-22;this.keyId=t.subarray(i,i+16)}break;case xn.PLAYREADY:{const i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=Bk(i,null,t),this.keyId=DD(t);break}default:{let i=t.subarray(0,16);if(i.length!==16){const r=new Uint8Array(16);r.set(i,16-i.length),i=r}this.keyId=i;break}}if(!this.keyId||this.keyId.byteLength!==16){let i=vc[this.uri];if(!i){const r=Object.keys(vc).length%Number.MAX_SAFE_INTEGER;i=new Uint8Array(16),new DataView(i.buffer,12,4).setUint32(0,r),vc[this.uri]=i}this.keyId=i}return this}}function PD(n){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=n>>8*(15-t)&255;return e}const q_=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Y_=/#EXT-X-MEDIA:(.*)/g,OD=/^#EXT(?:INF|-X-TARGETDURATION):/m,yh=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),MD=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Ci{static findGroup(e,t){for(let i=0;i<e.length;i++){const r=e[i];if(r.id===t)return r}}static resolve(e,t){return bm.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return OD.test(e)}static parseMasterPlaylist(e,t){const i=z_(e),r={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:i},s=[];q_.lastIndex=0;let a;for(;(a=q_.exec(e))!=null;)if(a[1]){var o;const c=new At(a[1],r),u=Kf(r,a[2]),d={attrs:c,bitrate:c.decimalInteger("BANDWIDTH")||c.decimalInteger("AVERAGE-BANDWIDTH"),name:c.NAME,url:Ci.resolve(u,t)},h=c.decimalResolution("RESOLUTION");h&&(d.width=h.width,d.height=h.height),J_(c.CODECS,d);const m=c["SUPPLEMENTAL-CODECS"];m&&(d.supplemental={},J_(m,d.supplemental)),(o=d.unknownCodecs)!=null&&o.length||s.push(d),r.levels.push(d)}else if(a[3]){const c=a[3],u=a[4];switch(c){case"SESSION-DATA":{const d=new At(u,r),h=d["DATA-ID"];h&&(r.sessionData===null&&(r.sessionData={}),r.sessionData[h]=d);break}case"SESSION-KEY":{const d=X_(u,t,r);d.encrypted&&d.isSupported()?(r.sessionKeys===null&&(r.sessionKeys=[]),r.sessionKeys.push(d)):ot.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${u}"`);break}case"DEFINE":{{const d=new At(u,r);K_(r,d,t)}break}case"CONTENT-STEERING":{const d=new At(u,r);r.contentSteering={uri:Ci.resolve(d["SERVER-URI"],t),pathwayId:d["PATHWAY-ID"]||"."};break}case"START":{r.startTimeOffset=Q_(u);break}}}const l=s.length>0&&s.length<r.levels.length;return r.levels=l?s:r.levels,r.levels.length===0&&(r.playlistParsingError=new Error("no levels found in manifest")),r}static parseMasterPlaylistMedia(e,t,i){let r;const s={},a=i.levels,o={AUDIO:a.map(c=>({id:c.attrs.AUDIO,audioCodec:c.audioCodec})),SUBTITLES:a.map(c=>({id:c.attrs.SUBTITLES,textCodec:c.textCodec})),"CLOSED-CAPTIONS":[]};let l=0;for(Y_.lastIndex=0;(r=Y_.exec(e))!==null;){const c=new At(r[1],i),u=c.TYPE;if(u){const d=o[u],h=s[u]||[];s[u]=h;const m=c.LANGUAGE,g=c["ASSOC-LANGUAGE"],v=c.CHANNELS,x=c.CHARACTERISTICS,E=c["INSTREAM-ID"],R={attrs:c,bitrate:0,id:l++,groupId:c["GROUP-ID"]||"",name:c.NAME||m||"",type:u,default:c.bool("DEFAULT"),autoselect:c.bool("AUTOSELECT"),forced:c.bool("FORCED"),lang:m,url:c.URI?Ci.resolve(c.URI,t):""};if(g&&(R.assocLang=g),v&&(R.channels=v),x&&(R.characteristics=x),E&&(R.instreamId=E),d!=null&&d.length){const k=Ci.findGroup(d,R.groupId)||d[0];Z_(R,k,"audioCodec"),Z_(R,k,"textCodec")}h.push(R)}}return s}static parseLevelPlaylist(e,t,i,r,s,a){var o;const l={url:t},c=new bD(t),u=c.fragments,d=[];let h=null,m=0,g=0,v=0,x=0,E=0,R=null,k=new ph(r,l),D,V,H,C=-1,S=!1,b=null,T;if(yh.lastIndex=0,c.m3u8=e,c.hasVariableRefs=z_(e),((o=yh.exec(e))==null?void 0:o[0])!=="#EXTM3U")return c.playlistParsingError=new Error("Missing format identifier #EXTM3U"),c;for(;(D=yh.exec(e))!==null;){S&&(S=!1,k=new ph(r,l),k.playlistOffset=v,k.setStart(v),k.sn=m,k.cc=x,E&&(k.bitrate=E),k.level=i,h&&(k.initSegment=h,h.rawProgramDateTime&&(k.rawProgramDateTime=h.rawProgramDateTime,h.rawProgramDateTime=null),b&&(k.setByteRange(b),b=null)));const Z=D[1];if(Z){k.duration=parseFloat(Z);const ie=(" "+D[2]).slice(1);k.title=ie||null,k.tagList.push(ie?["INF",Z,ie]:["INF",Z])}else if(D[3]){if(Re(k.duration)){k.playlistOffset=v,k.setStart(v),H&&ty(k,H,c),k.sn=m,k.level=i,k.cc=x,u.push(k);const ie=(" "+D[3]).slice(1);k.relurl=Kf(c,ie),qf(k,R,d),R=k,v+=k.duration,m++,g=0,S=!0}}else{if(D=D[0].match(MD),!D){ot.warn("No matches on slow regex match for level playlist!");continue}for(V=1;V<D.length&&D[V]===void 0;V++);const ie=(" "+D[V]).slice(1),le=(" "+D[V+1]).slice(1),ge=D[V+2]?(" "+D[V+2]).slice(1):null;switch(ie){case"BYTERANGE":R?k.setByteRange(le,R):k.setByteRange(le);break;case"PROGRAM-DATE-TIME":k.rawProgramDateTime=le,k.tagList.push(["PROGRAM-DATE-TIME",le]),C===-1&&(C=u.length);break;case"PLAYLIST-TYPE":c.type&&Vi(c,ie,D),c.type=le.toUpperCase();break;case"MEDIA-SEQUENCE":c.startSN!==0?Vi(c,ie,D):u.length>0&&ny(c,ie,D),m=c.startSN=parseInt(le);break;case"SKIP":{c.skippedSegments&&Vi(c,ie,D);const te=new At(le,c),j=te.decimalInteger("SKIPPED-SEGMENTS");if(Re(j)){c.skippedSegments+=j;for(let q=j;q--;)u.push(null);m+=j}const $=te.enumeratedString("RECENTLY-REMOVED-DATERANGES");$&&(c.recentlyRemovedDateranges=(c.recentlyRemovedDateranges||[]).concat($.split("	")));break}case"TARGETDURATION":c.targetduration!==0&&Vi(c,ie,D),c.targetduration=Math.max(parseInt(le),1);break;case"VERSION":c.version!==null&&Vi(c,ie,D),c.version=parseInt(le);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":c.live||Vi(c,ie,D),c.live=!1;break;case"#":(le||ge)&&k.tagList.push(ge?[le,ge]:[le]);break;case"DISCONTINUITY":x++,k.tagList.push(["DIS"]);break;case"GAP":k.gap=!0,k.tagList.push([ie]);break;case"BITRATE":k.tagList.push([ie,le]),E=parseInt(le)*1e3,Re(E)?k.bitrate=E:E=0;break;case"DATERANGE":{const te=new At(le,c),j=new KS(te,c.dateRanges[te.ID],c.dateRangeTagCount);c.dateRangeTagCount++,j.isValid||c.skippedSegments?c.dateRanges[j.id]=j:ot.warn(`Ignoring invalid DATERANGE tag: "${le}"`),k.tagList.push(["EXT-X-DATERANGE",le]);break}case"DEFINE":{{const te=new At(le,c);"IMPORT"in te?vD(c,te,a):K_(c,te,t)}break}case"DISCONTINUITY-SEQUENCE":c.startCC!==0?Vi(c,ie,D):u.length>0&&ny(c,ie,D),c.startCC=x=parseInt(le);break;case"KEY":{const te=X_(le,t,c);if(te.isSupported()){if(te.method==="NONE"){H=void 0;break}H||(H={});const j=H[te.keyFormat];j!=null&&j.matches(te)||(j&&(H=ut({},H)),H[te.keyFormat]=te)}else ot.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${le}"`);break}case"START":c.startTimeOffset=Q_(le);break;case"MAP":{const te=new At(le,c);if(k.duration){const j=new ph(r,l);ey(j,te,i,H),h=j,k.initSegment=h,h.rawProgramDateTime&&!k.rawProgramDateTime&&(k.rawProgramDateTime=h.rawProgramDateTime)}else{const j=k.byteRangeEndOffset;if(j){const $=k.byteRangeStartOffset;b=`${j-$}@${$}`}else b=null;ey(k,te,i,H),h=k,S=!0}h.cc=x;break}case"SERVER-CONTROL":{T&&Vi(c,ie,D),T=new At(le),c.canBlockReload=T.bool("CAN-BLOCK-RELOAD"),c.canSkipUntil=T.optionalFloat("CAN-SKIP-UNTIL",0),c.canSkipDateRanges=c.canSkipUntil>0&&T.bool("CAN-SKIP-DATERANGES"),c.partHoldBack=T.optionalFloat("PART-HOLD-BACK",0),c.holdBack=T.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{c.partTarget&&Vi(c,ie,D);const te=new At(le);c.partTarget=te.decimalFloatingPoint("PART-TARGET");break}case"PART":{let te=c.partList;te||(te=c.partList=[]);const j=g>0?te[te.length-1]:void 0,$=g++,q=new At(le,c),Q=new xk(q,k,l,$,j);te.push(Q),k.duration+=Q.duration;break}case"PRELOAD-HINT":{const te=new At(le,c);c.preloadHint=te;break}case"RENDITION-REPORT":{const te=new At(le,c);c.renditionReports=c.renditionReports||[],c.renditionReports.push(te);break}default:ot.warn(`line parsed but not handled: ${D}`);break}}}R&&!R.relurl?(u.pop(),v-=R.duration,c.partList&&(c.fragmentHint=R)):c.partList&&(qf(k,R,d),k.cc=x,c.fragmentHint=k,H&&ty(k,H,c)),c.targetduration||(c.playlistParsingError=new Error("#EXT-X-TARGETDURATION is required"));const L=u.length,F=u[0],U=u[L-1];if(v+=c.skippedSegments*c.targetduration,v>0&&L&&U){c.averagetargetduration=v/L;const Z=U.sn;c.endSN=Z!=="initSegment"?Z:0,c.live||(U.endList=!0),C>0&&(BD(u,C),F&&d.unshift(F))}return c.fragmentHint&&(v+=c.fragmentHint.duration),c.totalduration=v,d.length&&c.dateRangeTagCount&&F&&qS(d,c),c.endCC=x,c}}function qS(n,e){const t=n.length;if(!t)return;const i=n[t-1],r=e.live?1/0:e.totalduration,s=Object.keys(e.dateRanges);for(let o=s.length;o--;){const l=e.dateRanges[s[o]],c=l.startDate.getTime();l.tagAnchor=i.ref;for(let u=t;u--;){var a;if(((a=n[u])==null?void 0:a.sn)<e.startSN)break;const d=ND(e,c,n,u,r);if(d!==-1){l.tagAnchor=e.fragments[d].ref;break}}}}function ND(n,e,t,i,r){const s=t[i];if(s){const o=s.programDateTime;if(e>=o||i===0){var a;const l=(((a=t[i+1])==null?void 0:a.start)||r)-s.start;if(e<=o+l*1e3){const c=t[i].sn-n.startSN;if(c<0)return-1;const u=n.fragments;if(u.length>t.length){const h=(t[i+1]||u[u.length-1]).sn-n.startSN;for(let m=h;m>c;m--){const g=u[m].programDateTime;if(e>=g&&e<g+u[m].duration*1e3)return m}}return c}}}return-1}function X_(n,e,t){var i,r;const s=new At(n,t),a=(i=s.METHOD)!=null?i:"",o=s.URI,l=s.hexadecimalInteger("IV"),c=s.KEYFORMATVERSIONS,u=(r=s.KEYFORMAT)!=null?r:"identity";o&&s.IV&&!l&&ot.error(`Invalid IV: ${s.IV}`);const d=o?Ci.resolve(o,e):"",h=(c||"1").split("/").map(Number).filter(Number.isFinite);return new gd(a,d,u,h,l,s.KEYID)}function Q_(n){const t=new At(n).decimalFloatingPoint("TIME-OFFSET");return Re(t)?t:null}function J_(n,e){let t=(n||"").split(/[ ,]+/).filter(i=>i);["video","audio","text"].forEach(i=>{const r=t.filter(s=>Lm(s,i));r.length&&(e[`${i}Codec`]=r.map(s=>s.split("/")[0]).join(","),t=t.filter(s=>r.indexOf(s)===-1))}),e.unknownCodecs=t}function Z_(n,e,t){const i=e[t];i&&(n[t]=i)}function BD(n,e){let t=n[e];for(let i=e;i--;){const r=n[i];if(!r)return;r.programDateTime=t.programDateTime-r.duration*1e3,t=r}}function qf(n,e,t){n.rawProgramDateTime?t.push(n):e!=null&&e.programDateTime&&(n.programDateTime=e.endProgramDateTime)}function ey(n,e,t,i){n.relurl=e.URI,e.BYTERANGE&&n.setByteRange(e.BYTERANGE),n.level=t,n.sn="initSegment",i&&(n.levelkeys=i),n.initSegment=null}function ty(n,e,t){n.levelkeys=e;const{encryptedFragments:i}=t;(!i.length||i[i.length-1].levelkeys!==e)&&Object.keys(e).some(r=>e[r].isCommonEncryption)&&i.push(n)}function Vi(n,e,t){n.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function ny(n,e,t){n.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function vh(n,e){const t=e.startPTS;if(Re(t)){let i=0,r;e.sn>n.sn?(i=t-n.start,r=n):(i=n.start-t,r=e),r.duration!==i&&r.setDuration(i)}else e.sn>n.sn?n.cc===e.cc&&n.minEndPTS?e.setStart(n.start+(n.minEndPTS-n.start)):e.setStart(n.start+n.duration):e.setStart(Math.max(n.start-e.duration,0))}function YS(n,e,t,i,r,s,a){i-t<=0&&(a.warn("Fragment should have a positive duration",e),i=t+e.duration,s=r+e.duration);let l=t,c=i;const u=e.startPTS,d=e.endPTS;if(Re(u)){const E=Math.abs(u-t);n&&E>n.totalduration?a.warn(`media timestamps and playlist times differ by ${E}s for level ${e.level} ${n.url}`):Re(e.deltaPTS)?e.deltaPTS=Math.max(E,e.deltaPTS):e.deltaPTS=E,l=Math.max(t,u),t=Math.min(t,u),r=e.startDTS!==void 0?Math.min(r,e.startDTS):r,c=Math.min(i,d),i=Math.max(i,d),s=e.endDTS!==void 0?Math.max(s,e.endDTS):s}const h=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(i-e.start),e.startPTS=t,e.maxStartPTS=l,e.startDTS=r,e.endPTS=i,e.minEndPTS=c,e.endDTS=s;const m=e.sn;if(!n||m<n.startSN||m>n.endSN)return 0;let g;const v=m-n.startSN,x=n.fragments;for(x[v]=e,g=v;g>0;g--)vh(x[g],x[g-1]);for(g=v;g<x.length-1;g++)vh(x[g],x[g+1]);return n.fragmentHint&&vh(x[x.length-1],n.fragmentHint),n.PTSKnown=n.alignedSliding=!0,h}function FD(n,e,t){if(n===e)return;let i=null;const r=n.fragments;for(let u=r.length-1;u>=0;u--){const d=r[u].initSegment;if(d){i=d;break}}n.fragmentHint&&delete n.fragmentHint.endPTS;let s;VD(n,e,(u,d,h,m)=>{if((!e.startCC||e.skippedSegments)&&d.cc!==u.cc){const g=u.cc-d.cc;for(let v=h;v<m.length;v++)m[v].cc+=g;e.endCC=m[m.length-1].cc}Re(u.startPTS)&&Re(u.endPTS)&&(d.setStart(d.startPTS=u.startPTS),d.startDTS=u.startDTS,d.maxStartPTS=u.maxStartPTS,d.endPTS=u.endPTS,d.endDTS=u.endDTS,d.minEndPTS=u.minEndPTS,d.setDuration(u.endPTS-u.startPTS),d.duration&&(s=d),e.PTSKnown=e.alignedSliding=!0),u.hasStreams&&(d.elementaryStreams=u.elementaryStreams),d.loader=u.loader,u.hasStats&&(d.stats=u.stats),u.initSegment&&(d.initSegment=u.initSegment,i=u.initSegment)});const a=e.fragments,o=e.fragmentHint?a.concat(e.fragmentHint):a;if(i&&o.forEach(u=>{var d;u&&(!u.initSegment||u.initSegment.relurl===((d=i)==null?void 0:d.relurl))&&(u.initSegment=i)}),e.skippedSegments){if(e.deltaUpdateFailed=a.some(u=>!u),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let u=e.skippedSegments;u--;)a.shift();e.startSN=a[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=UD(n.dateRanges,e,t));const u=n.fragments.filter(d=>d.rawProgramDateTime);if(n.hasProgramDateTime&&!e.hasProgramDateTime)for(let d=1;d<o.length;d++)o[d].programDateTime===null&&qf(o[d],o[d-1],u);qS(u,e)}e.endCC=a[a.length-1].cc}if(!e.startCC){var l;const u=JS(n,e.startSN-1);e.startCC=(l=u==null?void 0:u.cc)!=null?l:a[0].cc}$D(n.partList,e.partList,(u,d)=>{d.elementaryStreams=u.elementaryStreams,d.stats=u.stats}),s?YS(e,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS,t):XS(n,e),a.length&&(e.totalduration=e.edge-a[0].start),e.driftStartTime=n.driftStartTime,e.driftStart=n.driftStart;const c=e.advancedDateTime;if(e.advanced&&c){const u=e.edge;e.driftStart||(e.driftStartTime=c,e.driftStart=u),e.driftEndTime=c,e.driftEnd=u}else e.driftEndTime=n.driftEndTime,e.driftEnd=n.driftEnd,e.advancedDateTime=n.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=n.requestScheduled)}function UD(n,e,t){const{dateRanges:i,recentlyRemovedDateranges:r}=e,s=ut({},n);r&&r.forEach(l=>{delete s[l]});const o=Object.keys(s).length;return o&&Object.keys(i).forEach(l=>{const c=s[l],u=new KS(i[l].attr,c);u.isValid?(s[l]=u,c||(u.tagOrder+=o)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${vt(i[l].attr)}"`)}),s}function $D(n,e,t){if(n&&e){let i=0;for(let r=0,s=n.length;r<=s;r++){const a=n[r],o=e[r+i];a&&o&&a.index===o.index&&a.fragment.sn===o.fragment.sn?t(a,o):i--}}}function VD(n,e,t){const i=e.skippedSegments,r=Math.max(n.startSN,e.startSN)-e.startSN,s=(n.fragmentHint?1:0)+(i?e.endSN:Math.min(n.endSN,e.endSN))-e.startSN,a=e.startSN-n.startSN,o=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=n.fragmentHint?n.fragments.concat(n.fragmentHint):n.fragments;for(let c=r;c<=s;c++){const u=l[a+c];let d=o[c];if(i&&!d&&u&&(d=e.fragments[c]=u),u&&d){if(t(u,d,c,o),u.url&&u.url!==d.url){e.playlistParsingError=iy(`media sequence mismatch ${d.sn}:`,n,e,u,d);return}else if(u.cc!==d.cc){e.playlistParsingError=iy(`discontinuity sequence mismatch (${u.cc}!=${d.cc})`,n,e,u,d);return}}}}function iy(n,e,t,i,r){return new Error(`${n} ${r.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function XS(n,e,t=!0){const i=e.startSN+e.skippedSegments-n.startSN,r=n.fragments,s=i>=0;let a=0;if(s&&i<r.length)a=r[i].start;else if(s&&e.startSN===n.endSN+1)a=n.fragmentEnd;else if(s&&t)a=n.fragmentStart+i*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)a=n.fragmentStart;else return;Yf(e,a)}function Yf(n,e){if(e){const t=n.fragments;for(let i=n.skippedSegments;i<t.length;i++)t[i].addStart(e);n.fragmentHint&&n.fragmentHint.addStart(e)}}function QS(n,e=1/0){let t=1e3*n.targetduration;if(n.updated){const i=n.fragments;if(i.length&&t*4>e){const s=i[i.length-1].duration*1e3;s<t&&(t=s)}}else t/=2;return Math.round(t)}function JS(n,e,t){if(!n)return null;let i=n.fragments[e-n.startSN];return i||(i=n.fragmentHint,i&&i.sn===e)?i:e<n.startSN&&t&&t.sn===e?t:null}function ry(n,e,t){return n?ZS(n.partList,e,t):null}function ZS(n,e,t){if(n)for(let i=n.length;i--;){const r=n[i];if(r.index===t&&r.fragment.sn===e)return r}return null}function eT(n){n.forEach((e,t)=>{var i;(i=e.details)==null||i.fragments.forEach(r=>{r.level=t,r.initSegment&&(r.initSegment.level=t)})})}function $o(n,e){for(let i=0,r=n.length;i<r;i++){var t;if(((t=n[i])==null?void 0:t.cc)===e)return n[i]}return null}function jD(n,e){return!!(n&&e.startCC<n.endCC&&e.endCC>n.startCC)}function sy(n,e){const t=n.start+e;n.startPTS=t,n.setStart(t),n.endPTS=t+n.duration}function tT(n,e){const t=e.fragments;for(let i=0,r=t.length;i<r;i++)sy(t[i],n);e.fragmentHint&&sy(e.fragmentHint,n),e.alignedSliding=!0}function GD(n,e){n&&(nT(e,n),e.alignedSliding||Gu(e,n),!e.alignedSliding&&!e.skippedSegments&&XS(n,e,!1))}function nT(n,e){if(!jD(e,n))return;const t=Math.min(e.endCC,n.endCC),i=$o(e.fragments,t),r=$o(n.fragments,t);if(!i||!r)return;ot.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const s=i.start-r.start;tT(s,n)}function Gu(n,e){if(!n.hasProgramDateTime||!e.hasProgramDateTime)return;const t=n.fragments,i=e.fragments;if(!t.length||!i.length)return;let r,s;const a=Math.min(e.endCC,n.endCC);e.startCC<a&&n.startCC<a&&(r=$o(i,a),s=$o(t,a)),(!r||!s)&&(r=i[Math.floor(i.length/2)],s=$o(t,r.cc)||t[Math.floor(t.length/2)]);const o=r.programDateTime,l=s.programDateTime;if(!o||!l)return;const c=(l-o)/1e3-(s.start-r.start);tT(c,n)}const HD={toString:function(n){let e="";const t=n.length;for(let i=0;i<t;i++)e+=`[${n.start(i).toFixed(3)}-${n.end(i).toFixed(3)}]`;return e}},he={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class Mm extends HS{constructor(e,t,i,r,s){super(r,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=he.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:a,fragCurrent:o,media:l,mediaBuffer:c,state:u}=this,d=l?l.currentTime:0,h=Ge.bufferInfo(c||l,d,a.maxBufferHole),m=!h.len;if(this.log(`Media seeking to ${Re(d)?d.toFixed(3):d}, state: ${u}, ${m?"out of":"in"} buffer`),this.state===he.ENDED)this.resetLoadingState();else if(o){const g=a.maxFragLookUpTolerance,v=o.start-g,x=o.start+o.duration+g;if(m||x<h.start||v>h.end){const E=d>x;(d<v||E)&&(E&&o.loader&&(this.log(`Cancelling fragment load for seek (sn: ${o.sn})`),o.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(l){this.fragmentTracker.removeFragmentsInRange(d,1/0,this.playlistType,!0);const g=this.lastCurrentTime;if(d>g&&(this.lastCurrentTime=d),!this.loadingParts){const v=Math.max(h.end,d),x=this.shouldLoadParts(this.getLevelDetails(),v);x&&(this.log(`LL-Part loading ON after seeking to ${d.toFixed(2)} with buffer @${v.toFixed(2)}`),this.loadingParts=x)}}this.hls.hasEnoughToStart||(this.log(`Setting ${m?"startPosition":"nextLoadPosition"} to ${d} for seek without enough to start`),this.nextLoadPosition=d,m&&(this.startPosition=d)),this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=s,this.hls=e,this.fragmentLoader=new _D(e.config),this.keyLoader=i,this.fragmentTracker=t,this.config=e.config,this.decrypter=new km(e.config)}registerListeners(){const{hls:e}=this;e.on(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(O.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(O.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===he.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=he.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const i=e.end||0,r=this.config.timelineOffset||0;if(i<=r)return!1;const s=e.buffered;this.config.maxBufferHole&&s&&s.length>1&&(e=Ge.bufferedInfo(s,e.start,0));const a=e.nextStart;if(a&&a>r&&a<t.edge||this.media.currentTime<e.start)return!1;const l=t.partList;if(l!=null&&l.length){const u=l[l.length-1];return Ge.isBuffered(this.media,u.start+u.duration/2)}const c=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(c)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const i=this.media=this.mediaBuffer=t.media;i.removeEventListener("seeking",this.onMediaSeeking),i.removeEventListener("ended",this.onMediaEnded),i.addEventListener("seeking",this.onMediaSeeking),i.addEventListener("ended",this.onMediaEnded);const r=this.config;this.levels&&r.autoStartLoad&&this.state===he.STOPPED&&this.startLoad(r.startPosition)}onMediaDetaching(e,t){const i=!!t.transferMedia,r=this.media;if(r!==null){if(r.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),r.removeEventListener("seeking",this.onMediaSeeking),r.removeEventListener("ended",this.onMediaEnded),this.keyLoader&&!i&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,i){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=he.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,i){this.startFragRequested=!0,this._loadFragForPlayback(e,t,i)}_loadFragForPlayback(e,t,i){const r=s=>{const a=s.frag;if(this.fragContextChanged(a)){this.warn(`${a.type} sn: ${a.sn}${s.part?" part: "+s.part.index:""} of ${this.fragInfo(a,!1,s.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(a);return}a.stats.chunkCount++,this._handleFragmentLoadProgress(s)};this._doFragLoad(e,t,i,r).then(s=>{if(!s)return;const a=this.state,o=s.frag;if(this.fragContextChanged(o)){(a===he.FRAG_LOADING||!this.fragCurrent&&a===he.PARSING)&&(this.fragmentTracker.removeFragment(o),this.state=he.IDLE);return}"payload"in s&&(this.log(`Loaded ${o.type} sn: ${o.sn} of ${this.playlistLabel()} ${o.level}`),this.hls.trigger(O.FRAG_LOADED,s)),this._handleFragmentLoadComplete(s)}).catch(s=>{this.state===he.STOPPED||this.state===he.ERROR||(this.warn(`Frag error: ${(s==null?void 0:s.message)||s}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:i}=this;if(i.getState(e)===Kt.APPENDING){const s=e.type,a=this.getFwdBufferInfo(this.mediaBuffer,s),o=Math.max(e.duration,a?a.len:this.config.maxBufferLength),l=this.backtrackFragment;((l?e.sn-l.sn:0)===1||this.reduceMaxBufferLength(o,e.duration))&&i.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?i.removeAllFragments():i.hasParts(e.type)&&(i.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),i.getState(e)===Kt.PARTIAL&&i.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(t==null?void 0:t.live)&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,i=null){if(!(e-t))return;const r={startOffset:e,endOffset:t,type:i};this.hls.trigger(O.BUFFER_FLUSHING,r)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(i=>{const r=i==null?void 0:i.frag;if(!r||this.fragContextChanged(r)||!this.levels)throw new Error("init load aborted");return i}).then(i=>{const{hls:r}=this,{frag:s,payload:a}=i,o=s.decryptdata;if(a&&a.byteLength>0&&o!=null&&o.key&&o.iv&&La(o.method)){const l=self.performance.now();return this.decrypter.decrypt(new Uint8Array(a),o.key.buffer,o.iv.buffer,Pm(o.method)).catch(c=>{throw r.trigger(O.ERROR,{type:Pe.MEDIA_ERROR,details:se.FRAG_DECRYPT_ERROR,fatal:!1,error:c,reason:c.message,frag:s}),c}).then(c=>{const u=self.performance.now();return r.trigger(O.FRAG_DECRYPTED,{frag:s,payload:c,stats:{tstart:l,tdecrypt:u}}),i.payload=c,this.completeInitSegmentLoad(i)})}return this.completeInitSegmentLoad(i)}).catch(i=>{this.state===he.STOPPED||this.state===he.ERROR||(this.warn(i),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const i=e.frag.stats;this.state!==he.STOPPED&&(this.state=he.IDLE),e.frag.data=new Uint8Array(e.payload),i.parsing.start=i.buffering.start=self.performance.now(),i.parsing.end=i.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var i,r;const s=e.tracks;if(s&&!t.encrypted&&((i=s.audio)!=null&&i.encrypted||(r=s.video)!=null&&r.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const a=this.media,o=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${a?"attached mediaKeys: "+a.mediaKeys:"detached"})`);return this.warn(o.message),!a||a.mediaKeys?!1:(this.hls.trigger(O.ERROR,{type:Pe.KEY_SYSTEM_ERROR,details:se.KEY_SYSTEM_NO_KEYS,fatal:!1,error:o,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const i=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${i?HD.toString(Ge.getBuffered(i)):"(detached)"})`),Bt(e)){var r;if(e.type!==Ce.SUBTITLE){const a=e.elementaryStreams;if(!Object.keys(a).some(o=>!!a[o])){this.state=he.IDLE;return}}const s=(r=this.levels)==null?void 0:r[e.level];s!=null&&s.fragmentError&&(this.log(`Resetting level fragment error count of ${s.fragmentError} on frag buffered`),s.fragmentError=0)}this.state=he.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:i,part:r,partsLoaded:s}=e,a=!s||s.length===0||s.some(l=>!l),o=new Dm(i.level,i.sn,i.stats.chunkCount+1,0,r?r.index:-1,!a);t.flush(o)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,i=null,r){var s;this.fragCurrent=e;const a=t.details;if(!this.levels||!a)throw new Error(`frag load aborted, missing level${a?"":" detail"}s`);let o=null;e.encrypted&&!((s=e.decryptdata)!=null&&s.key)?(this.log(`Loading key for ${e.sn} of [${a.startSN}-${a.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=he.KEY_LOADING,this.fragCurrent=e,o=this.keyLoader.load(e).then(h=>{if(!this.fragContextChanged(h.frag))return this.hls.trigger(O.KEY_LOADED,h),this.state===he.KEY_LOADING&&(this.state=he.IDLE),h}),this.hls.trigger(O.KEY_LOADING,{frag:e}),this.fragCurrent===null&&(o=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):e.encrypted||(o=this.keyLoader.loadClear(e,a.encryptedFragments,this.startFragRequested),o&&this.log("[eme] blocking frag load until media-keys acquired"));const l=this.fragPrevious;if(Bt(e)&&(!l||e.sn!==l.sn)){const h=this.shouldLoadParts(t.details,e.end);h!==this.loadingParts&&(this.log(`LL-Part loading ${h?"ON":"OFF"} loading sn ${l==null?void 0:l.sn}->${e.sn}`),this.loadingParts=h)}if(i=Math.max(e.start,i||0),this.loadingParts&&Bt(e)){const h=a.partList;if(h&&r){i>e.end&&a.fragmentHint&&(e=a.fragmentHint);const m=this.getNextPart(h,e,i);if(m>-1){const g=h[m];e=this.fragCurrent=g.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${g.index} (${m}/${h.length-1}) of ${this.fragInfo(e,!1,g)}) cc: ${e.cc} [${a.startSN}-${a.endSN}], target: ${parseFloat(i.toFixed(3))}`),this.nextLoadPosition=g.start+g.duration,this.state=he.FRAG_LOADING;let v;return o?v=o.then(x=>!x||this.fragContextChanged(x.frag)?null:this.doFragPartsLoad(e,g,t,r)).catch(x=>this.handleFragLoadError(x)):v=this.doFragPartsLoad(e,g,t,r).catch(x=>this.handleFragLoadError(x)),this.hls.trigger(O.FRAG_LOADING,{frag:e,part:g,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):v}else if(!e.url||this.loadedEndOfParts(h,i))return Promise.resolve(null)}}if(Bt(e)&&this.loadingParts){var c;this.log(`LL-Part loading OFF after next part miss @${i.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(c=a.partList)==null?void 0:c.filter(h=>h.loaded).map(h=>`[${h.start}-${h.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+a.startSN+"-"+a.endSN+"]"}, target: ${parseFloat(i.toFixed(3))}`),Re(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=he.FRAG_LOADING;const u=this.config.progressive;let d;return u&&o?d=o.then(h=>!h||this.fragContextChanged(h.frag)?null:this.fragmentLoader.load(e,r)).catch(h=>this.handleFragLoadError(h)):d=Promise.all([this.fragmentLoader.load(e,u?r:void 0),o]).then(([h])=>(!u&&r&&r(h),h)).catch(h=>this.handleFragLoadError(h)),this.hls.trigger(O.FRAG_LOADING,{frag:e,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):d}doFragPartsLoad(e,t,i,r){return new Promise((s,a)=>{var o;const l=[],c=(o=i.details)==null?void 0:o.partList,u=d=>{this.fragmentLoader.loadPart(e,d,r).then(h=>{l[d.index]=h;const m=h.part;this.hls.trigger(O.FRAG_LOADED,h);const g=ry(i.details,e.sn,d.index+1)||ZS(c,e.sn,d.index+1);if(g)u(g);else return s({frag:e,part:m,partsLoaded:l})}).catch(a)};u(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t&&t.details===se.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(O.ERROR,t)}else this.hls.trigger(O.ERROR,{type:Pe.OTHER_ERROR,details:se.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==he.PARSING){!this.fragCurrent&&this.state!==he.STOPPED&&this.state!==he.ERROR&&(this.state=he.IDLE);return}const{frag:i,part:r,level:s}=t,a=self.performance.now();i.stats.parsing.end=a,r&&(r.stats.parsing.end=a);const o=this.getLevelDetails(),c=o&&i.sn>o.endSN||this.shouldLoadParts(o,i.end);c!==this.loadingParts&&(this.log(`LL-Part loading ${c?"ON":"OFF"} after parsing segment ending @${i.end.toFixed(2)}`),this.loadingParts=c),this.updateLevelTiming(i,r,s,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var i;const s=e.partList[0],a=s.end+(((i=e.fragmentHint)==null?void 0:i.duration)||0);if(t>=a){var r;if((this.hls.hasEnoughToStart?((r=this.media)==null?void 0:r.currentTime)||this.lastCurrentTime:this.getLoadPosition())>s.start-s.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:i}=this,{level:r,sn:s,part:a}=e;if(!(t!=null&&t[r]))return this.warn(`Levels object was unset while buffering fragment ${s} of ${this.playlistLabel()} ${r}. The current chunk will not be buffered.`),null;const o=t[r],l=o.details,c=a>-1?ry(l,s,a):null,u=c?c.fragment:JS(l,s,i);return u?(i&&i!==u&&(u.stats=i.stats),{frag:u,part:c,level:o}):null}bufferFragmentData(e,t,i,r,s){if(this.state!==he.PARSING)return;const{data1:a,data2:o}=e;let l=a;if(o&&(l=Xn(a,o)),!l.length)return;const c=this.initPTS[t.cc],u=c?-c.baseTime/c.timescale:void 0,d={type:e.type,frag:t,part:i,chunkMeta:r,offset:u,parent:t.type,data:l};if(this.hls.trigger(O.BUFFER_APPENDING,d),e.dropped&&e.independent&&!i){if(s)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!Ge.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const i=t.currentTime,r=Ge.bufferInfo(t,i,0),s=e.duration,a=Math.min(this.config.maxFragLookUpTolerance*2,s*.25),o=Math.max(Math.min(e.start-a,r.end-a),i+a);e.start-o>a&&this.flushMainBuffer(o,e.start)}getFwdBufferInfo(e,t){var i;const r=this.getLoadPosition();if(!Re(r))return null;const a=this.lastCurrentTime>r||(i=this.media)!=null&&i.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,r,t,a)}getFwdBufferInfoAtPos(e,t,i,r){const s=Ge.bufferInfo(e,t,r);if(s.len===0&&s.nextStart!==void 0){const a=this.fragmentTracker.getBufferedFrag(t,i);if(a&&(s.nextStart<=a.end||a.gap)){const o=Math.max(Math.min(s.nextStart,a.end)-t,r);return Ge.bufferInfo(e,t,o)}}return s}getMaxBufferLength(e){const{config:t}=this;let i;return e?i=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):i=t.maxBufferLength,Math.min(i,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const i=this.config,r=Math.max(Math.min(e-t,i.maxBufferLength),t),s=Math.max(e-t*3,i.maxMaxBufferLength/2,r);return s>=r?(i.maxMaxBufferLength=s,this.warn(`Reduce max buffer length to ${s}s`),!0):!1}getAppendedFrag(e,t=Ce.MAIN){const i=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return i&&"fragment"in i?i.fragment:i}getNextFragment(e,t){const i=t.fragments,r=i.length;if(!r)return null;const{config:s}=this,a=i[0].start,o=s.lowLatencyMode&&!!t.partList;let l=null;if(t.live){const d=s.initialLiveManifestSize;if(r<d)return this.warn(`Not enough fragments to start playback (have: ${r}, need: ${d})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<a){var c;o&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),l=this.getInitialLiveFragment(t);const h=this.hls.startPosition,m=this.hls.liveSyncPosition,g=l?(h!==-1&&h>=a?h:m)||l.start:e;this.log(`Setting startPosition to ${g} to match start frag at live edge. mainStart: ${h} liveSyncPosition: ${m} frag.start: ${(c=l)==null?void 0:c.start}`),this.startPosition=this.nextLoadPosition=g}}else e<=a&&(l=i[0]);if(!l){const d=this.loadingParts?t.partEnd:t.fragmentEnd;l=this.getFragmentAtPosition(e,d,t)}let u=this.filterReplacedPrimary(l,t);if(!u&&l){const d=l.sn-t.startSN;u=this.filterReplacedPrimary(i[d+1]||null,t)}return this.mapToInitFragWhenRequired(u)}isLoopLoading(e,t){const i=this.fragmentTracker.getState(e);return(i===Kt.OK||i===Kt.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,i,r,s){let a=null;if(e.gap&&(a=this.getNextFragment(this.nextLoadPosition,t),a&&!a.gap&&i.nextStart)){const o=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,r,0);if(o!==null&&i.len+o.len>=s){const l=a.sn;return this.loopSn!==l&&(this.log(`buffer full after gaps in "${r}" playlist starting at sn: ${l}`),this.loopSn=l),null}}return this.loopSn=void 0,a}get primaryPrefetch(){if(ay(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(ay(this.config)&&e.type!==Ce.SUBTITLE){const i=this.hls.interstitialsManager,r=i==null?void 0:i.bufferingItem;if(r){const a=r.event;if(a){if(a.appendInPlace||Math.abs(e.start-r.start)>1||r.start===0)return null}else if(e.end<=r.start&&(t==null?void 0:t.live)===!1||e.start>r.end&&r.nextEvent&&(r.nextEvent.appendInPlace||e.start-r.end>1))return null}const s=i==null?void 0:i.playerQueue;if(s)for(let a=s.length;a--;){const o=s[a].interstitial;if(o.appendInPlace&&e.start>=o.startTime&&e.end<=o.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,i){let r=-1,s=!1,a=!0;for(let o=0,l=e.length;o<l;o++){const c=e[o];if(a=a&&!c.independent,r>-1&&i<c.start)break;const u=c.loaded;u?r=-1:(s||(c.independent||a)&&c.fragment===t)&&(c.fragment!==t&&this.warn(`Need buffer at ${i} but next unloaded part starts at ${c.start}`),r=o),s=u}return r}loadedEndOfParts(e,t){let i;for(let r=e.length;r--;){if(i=e[r],!i.loaded)return!1;if(t>i.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,i=this.fragPrevious;let r=null;if(i){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${i.programDateTime}`),r=sD(t,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!r){const s=i.sn+1;if(s>=e.startSN&&s<=e.endSN){const a=t[s-e.startSN];i.cc===a.cc&&(r=a,this.log(`Live playlist, switching playlist, load frag with next SN: ${r.sn}`))}r||(r=GS(e,i.cc,i.end),r&&this.log(`Live playlist, switching playlist, load frag with same CC: ${r.sn}`))}}else{const s=this.hls.liveSyncPosition;s!==null&&(r=this.getFragmentAtPosition(s,this.bitrateTest?e.fragmentEnd:e.edge,e))}return r}getFragmentAtPosition(e,t,i){const{config:r}=this;let{fragPrevious:s}=this,{fragments:a,endSN:o}=i;const{fragmentHint:l}=i,{maxFragLookUpTolerance:c}=r,u=i.partList,d=!!(this.loadingParts&&u!=null&&u.length&&l);d&&!this.bitrateTest&&u[u.length-1].fragment.sn===l.sn&&(a=a.concat(l),o=l.sn);let h;if(e<t){var m;const v=e<this.lastCurrentTime||e>t-c||(m=this.media)!=null&&m.paused||!this.startFragRequested?0:c;h=Vs(s,a,e,v)}else h=a[a.length-1];if(h){const g=h.sn-i.startSN,v=this.fragmentTracker.getState(h);if((v===Kt.OK||v===Kt.PARTIAL&&h.gap)&&(s=h),s&&h.sn===s.sn&&(!d||u[0].fragment.sn>h.sn||!i.live)&&h.level===s.level){const E=a[g+1];h.sn<o&&this.fragmentTracker.getState(E)!==Kt.OK?h=E:h=null}}return h}alignPlaylists(e,t,i){const r=e.fragments.length;if(!r)return this.warn("No fragments in live playlist"),0;const s=e.fragmentStart,a=!t,o=e.alignedSliding&&Re(s);if(a||!o&&!s){GD(i,e);const l=e.fragmentStart;return this.log(`Live playlist sliding: ${l.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${r}`),l}return s}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let i=this.startPosition;i<t&&(i=-1);const r=this.timelineOffset;if(i===-1){const s=this.startTimeOffset!==null,a=s?this.startTimeOffset:e.startTimeOffset;a!==null&&Re(a)?(i=t+a,a<0&&(i+=e.edge),i=Math.min(Math.max(t,i),t+e.totalduration),this.log(`Setting startPosition to ${i} for start time offset ${a} found in ${s?"multivariant":"media"} playlist`),this.startPosition=i):e.live?(i=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${i}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=i=0),this.lastCurrentTime=i+r}this.nextLoadPosition=i+r}getLoadPosition(){var e;const{media:t}=this;let i=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?i=t.currentTime:this.nextLoadPosition>=0&&(i=this.nextLoadPosition),i}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&Bt(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==he.FRAG_LOADING_WAITING_RETRY)&&(this.state=he.IDLE)}onFragmentOrKeyLoadError(e,t){if(t.chunkMeta&&!t.frag){const g=this.getCurrentContext(t.chunkMeta);g&&(t.frag=g.frag)}const i=t.frag;if(!i||i.type!==e||!this.levels)return;if(this.fragContextChanged(i)){var r;this.warn(`Frag load error must match current frag to retry ${i.url} > ${(r=this.fragCurrent)==null?void 0:r.url}`);return}const s=t.details===se.FRAG_GAP;s&&this.fragmentTracker.fragBuffered(i,!0);const a=t.errorAction,{action:o,flags:l,retryCount:c=0,retryConfig:u}=a||{},d=!!a&&!!u,h=d&&o===ln.RetryRequest,m=d&&!a.resolved&&l===ri.MoveAllAlternatesMatchingHost;if(!h&&m&&Bt(i)&&!i.endList)this.resetFragmentErrors(e),this.treatAsGap(i),a.resolved=!0;else if((h||m)&&c<u.maxNumRetry){this.resetStartWhenNotLoaded(this.levelLastLoaded);const g=Cm(u,c);this.warn(`Fragment ${i.sn} of ${e} ${i.level} errored with ${t.details}, retrying loading ${c+1}/${u.maxNumRetry} in ${g}ms`),a.resolved=!0,this.retryDate=self.performance.now()+g,this.state=he.FRAG_LOADING_WAITING_RETRY}else if(u&&a)if(this.resetFragmentErrors(e),c<u.maxNumRetry)!s&&o!==ln.RemoveAlternatePermanently&&(a.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${c})`);return}else o===ln.SendAlternateToPenaltyBox?this.state=he.WAITING_LEVEL:this.state=he.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(e){if(this.state===he.PARSING||this.state===he.PARSED){const t=e.frag,i=e.parent,r=this.getFwdBufferInfo(this.mediaBuffer,i),s=r&&r.len>.5;s&&this.reduceMaxBufferLength(r.len,(t==null?void 0:t.duration)||10);const a=!s;return a&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${i} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),a}return!1}resetFragmentErrors(e){e===Ce.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==he.STOPPED&&(this.state=he.IDLE)}afterBufferFlushed(e,t,i){if(!e)return;const r=Ge.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,r,i),this.state===he.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==he.STOPPED&&(this.state=he.IDLE)}resetStartWhenNotLoaded(e){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.warn(`The loading context changed while buffering fragment ${e.sn} of ${this.playlistLabel()} ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,i,r){const s=i.details;if(!s){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((l,c)=>{const u=e.elementaryStreams[c];if(u){const d=u.endPTS-u.startPTS;if(d<=0)return this.warn(`Could not parse fragment ${e.sn} ${c} duration reliably (${d})`),l||!1;const h=r?0:YS(s,e,u.startPTS,u.endPTS,u.startDTS,u.endDTS,this);return this.hls.trigger(O.LEVEL_PTS_UPDATED,{details:s,level:i,drift:h,type:c,frag:e,start:u.startPTS,end:u.endPTS}),!0}return l},!1)){var o;if(i.fragmentError===0&&this.treatAsGap(e,i),((o=this.transmuxer)==null?void 0:o.error)===null){const l=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(l.message),this.hls.trigger(O.ERROR,{type:Pe.MEDIA_ERROR,details:se.FRAG_PARSING_ERROR,fatal:!1,error:l,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${i.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=he.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(O.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===Ce.MAIN?"level":"track"}fragInfo(e,t=!0,i){var r,s;return`${this.playlistLabel()} ${e.level} (${i?"part":"frag"}:[${((r=t&&!i?e.startPTS:(i||e).start)!=null?r:NaN).toFixed(3)}-${((s=t&&!i?e.endPTS:(i||e).end)!=null?s:NaN).toFixed(3)}]${i&&e.type==="main"?"INDEPENDENT="+(i.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function ay(n){return!!n.interstitialsController&&n.enableInterstitialPlayback!==!1}class iT{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let i;if(e.length)e.length===1?i=e[0]:i=zD(e,t);else return new Uint8Array(0);return this.reset(),i}reset(){this.chunks.length=0,this.dataLength=0}}function zD(n,e){const t=new Uint8Array(e);let i=0;for(let r=0;r<n.length;r++){const s=n[r];t.set(s,i),i+=s.length}return t}var Eh={exports:{}},oy;function KD(){return oy||(oy=1,function(n){var e=Object.prototype.hasOwnProperty,t="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(t=!1));function r(l,c,u){this.fn=l,this.context=c,this.once=u||!1}function s(l,c,u,d,h){if(typeof u!="function")throw new TypeError("The listener must be a function");var m=new r(u,d||l,h),g=t?t+c:c;return l._events[g]?l._events[g].fn?l._events[g]=[l._events[g],m]:l._events[g].push(m):(l._events[g]=m,l._eventsCount++),l}function a(l,c){--l._eventsCount===0?l._events=new i:delete l._events[c]}function o(){this._events=new i,this._eventsCount=0}o.prototype.eventNames=function(){var c=[],u,d;if(this._eventsCount===0)return c;for(d in u=this._events)e.call(u,d)&&c.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(u)):c},o.prototype.listeners=function(c){var u=t?t+c:c,d=this._events[u];if(!d)return[];if(d.fn)return[d.fn];for(var h=0,m=d.length,g=new Array(m);h<m;h++)g[h]=d[h].fn;return g},o.prototype.listenerCount=function(c){var u=t?t+c:c,d=this._events[u];return d?d.fn?1:d.length:0},o.prototype.emit=function(c,u,d,h,m,g){var v=t?t+c:c;if(!this._events[v])return!1;var x=this._events[v],E=arguments.length,R,k;if(x.fn){switch(x.once&&this.removeListener(c,x.fn,void 0,!0),E){case 1:return x.fn.call(x.context),!0;case 2:return x.fn.call(x.context,u),!0;case 3:return x.fn.call(x.context,u,d),!0;case 4:return x.fn.call(x.context,u,d,h),!0;case 5:return x.fn.call(x.context,u,d,h,m),!0;case 6:return x.fn.call(x.context,u,d,h,m,g),!0}for(k=1,R=new Array(E-1);k<E;k++)R[k-1]=arguments[k];x.fn.apply(x.context,R)}else{var D=x.length,V;for(k=0;k<D;k++)switch(x[k].once&&this.removeListener(c,x[k].fn,void 0,!0),E){case 1:x[k].fn.call(x[k].context);break;case 2:x[k].fn.call(x[k].context,u);break;case 3:x[k].fn.call(x[k].context,u,d);break;case 4:x[k].fn.call(x[k].context,u,d,h);break;default:if(!R)for(V=1,R=new Array(E-1);V<E;V++)R[V-1]=arguments[V];x[k].fn.apply(x[k].context,R)}}return!0},o.prototype.on=function(c,u,d){return s(this,c,u,d,!1)},o.prototype.once=function(c,u,d){return s(this,c,u,d,!0)},o.prototype.removeListener=function(c,u,d,h){var m=t?t+c:c;if(!this._events[m])return this;if(!u)return a(this,m),this;var g=this._events[m];if(g.fn)g.fn===u&&(!h||g.once)&&(!d||g.context===d)&&a(this,m);else{for(var v=0,x=[],E=g.length;v<E;v++)(g[v].fn!==u||h&&!g[v].once||d&&g[v].context!==d)&&x.push(g[v]);x.length?this._events[m]=x.length===1?x[0]:x:a(this,m)}return this},o.prototype.removeAllListeners=function(c){var u;return c?(u=t?t+c:c,this._events[u]&&a(this,u)):(this._events=new i,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,n.exports=o}(Eh)),Eh.exports}var WD=KD(),Nm=Tk(WD);const pl="1.6.9",ja={};function qD(){return typeof __HLS_WORKER_BUNDLE__=="function"}function YD(){const n=ja[pl];if(n)return n.clientCount++,n;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),r={worker:new self.Worker(t),objectURL:t,clientCount:1};return ja[pl]=r,r}function XD(n){const e=ja[n];if(e)return e.clientCount++,e;const t=new self.URL(n,self.location.href).href,r={worker:new self.Worker(t),scriptURL:t,clientCount:1};return ja[n]=r,r}function QD(n){const e=ja[n||pl];if(e&&e.clientCount--===1){const{worker:i,objectURL:r}=e;delete ja[n||pl],r&&self.URL.revokeObjectURL(r),i.terminate()}}function rT(n,e){return e+10<=n.length&&n[e]===51&&n[e+1]===68&&n[e+2]===73&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128}function Bm(n,e){return e+10<=n.length&&n[e]===73&&n[e+1]===68&&n[e+2]===51&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128}function _d(n,e){let t=0;return t=(n[e]&127)<<21,t|=(n[e+1]&127)<<14,t|=(n[e+2]&127)<<7,t|=n[e+3]&127,t}function ml(n,e){const t=e;let i=0;for(;Bm(n,e);){i+=10;const r=_d(n,e+6);i+=r,rT(n,e+10)&&(i+=10),e+=i}if(i>0)return n.subarray(t,t+i)}function JD(n,e,t,i){const r=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],s=e[t+2],a=s>>2&15;if(a>12){const m=new Error(`invalid ADTS sampling index:${a}`);n.emit(O.ERROR,O.ERROR,{type:Pe.MEDIA_ERROR,details:se.FRAG_PARSING_ERROR,fatal:!0,error:m,reason:m.message});return}const o=(s>>6&3)+1,l=e[t+3]>>6&3|(s&1)<<2,c="mp4a.40."+o,u=r[a];let d=a;(o===5||o===29)&&(d-=3);const h=[o<<3|(d&14)>>1,(d&1)<<7|l<<3];return ot.log(`manifest codec:${i}, parsed codec:${c}, channels:${l}, rate:${u} (ADTS object type:${o} sampling index:${a})`),{config:h,samplerate:u,channelCount:l,codec:c,parsedCodec:c,manifestCodec:i}}function sT(n,e){return n[e]===255&&(n[e+1]&246)===240}function aT(n,e){return n[e+1]&1?7:9}function Fm(n,e){return(n[e+3]&3)<<11|n[e+4]<<3|(n[e+5]&224)>>>5}function ZD(n,e){return e+5<n.length}function Hu(n,e){return e+1<n.length&&sT(n,e)}function eP(n,e){return ZD(n,e)&&sT(n,e)&&Fm(n,e)<=n.length-e}function tP(n,e){if(Hu(n,e)){const t=aT(n,e);if(e+t>=n.length)return!1;const i=Fm(n,e);if(i<=t)return!1;const r=e+i;return r===n.length||Hu(n,r)}return!1}function oT(n,e,t,i,r){if(!n.samplerate){const s=JD(e,t,i,r);if(!s)return;ut(n,s)}}function lT(n){return 1024*9e4/n}function nP(n,e){const t=aT(n,e);if(e+t<=n.length){const i=Fm(n,e)-t;if(i>0)return{headerLength:t,frameLength:i}}}function cT(n,e,t,i,r){const s=lT(n.samplerate),a=i+r*s,o=nP(e,t);let l;if(o){const{frameLength:d,headerLength:h}=o,m=h+d,g=Math.max(0,t+m-e.length);g?(l=new Uint8Array(m-h),l.set(e.subarray(t+h,e.length),0)):l=e.subarray(t+h,t+m);const v={unit:l,pts:a};return g||n.samples.push(v),{sample:v,length:m,missing:g}}const c=e.length-t;return l=new Uint8Array(c),l.set(e.subarray(t,e.length),0),{sample:{unit:l,pts:a},length:c,missing:-1}}function iP(n,e){return Bm(n,e)&&_d(n,e+6)+10<=n.length-e}function rP(n){return n instanceof ArrayBuffer?n:n.byteOffset==0&&n.byteLength==n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer}function Sh(n,e=0,t=1/0){return sP(n,e,t,Uint8Array)}function sP(n,e,t,i){const r=aP(n);let s=1;"BYTES_PER_ELEMENT"in i&&(s=i.BYTES_PER_ELEMENT);const a=oP(n)?n.byteOffset:0,o=(a+n.byteLength)/s,l=(a+e)/s,c=Math.floor(Math.max(0,Math.min(l,o))),u=Math.floor(Math.min(c+Math.max(t,0),o));return new i(r,c,u-c)}function aP(n){return n instanceof ArrayBuffer?n:n.buffer}function oP(n){return n&&n.buffer instanceof ArrayBuffer&&n.byteLength!==void 0&&n.byteOffset!==void 0}function lP(n){const e={key:n.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(n.size<2)return;if(n.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const i=n.data.subarray(1).indexOf(0);if(i===-1)return;const r=On(Sh(n.data,1,i)),s=n.data[2+i],a=n.data.subarray(3+i).indexOf(0);if(a===-1)return;const o=On(Sh(n.data,3+i,a));let l;return r==="-->"?l=On(Sh(n.data,4+i+a)):l=rP(n.data.subarray(4+i+a)),e.mimeType=r,e.pictureType=s,e.description=o,e.data=l,e}function cP(n){if(n.size<2)return;const e=On(n.data,!0),t=new Uint8Array(n.data.subarray(e.length+1));return{key:n.type,info:e,data:t.buffer}}function uP(n){if(n.size<2)return;if(n.type==="TXXX"){let t=1;const i=On(n.data.subarray(t),!0);t+=i.length+1;const r=On(n.data.subarray(t));return{key:n.type,info:i,data:r}}const e=On(n.data.subarray(1));return{key:n.type,info:"",data:e}}function dP(n){if(n.type==="WXXX"){if(n.size<2)return;let t=1;const i=On(n.data.subarray(t),!0);t+=i.length+1;const r=On(n.data.subarray(t));return{key:n.type,info:i,data:r}}const e=On(n.data);return{key:n.type,info:"",data:e}}function hP(n){return n.type==="PRIV"?cP(n):n.type[0]==="W"?dP(n):n.type==="APIC"?lP(n):uP(n)}function fP(n){const e=String.fromCharCode(n[0],n[1],n[2],n[3]),t=_d(n,4),i=10;return{type:e,size:t,data:n.subarray(i,i+t)}}const Ec=10,pP=10;function uT(n){let e=0;const t=[];for(;Bm(n,e);){const i=_d(n,e+6);n[e+5]>>6&1&&(e+=Ec),e+=Ec;const r=e+i;for(;e+pP<r;){const s=fP(n.subarray(e)),a=hP(s);a&&t.push(a),e+=s.size+Ec}rT(n,e)&&(e+=Ec)}return t}function dT(n){return n&&n.key==="PRIV"&&n.info==="com.apple.streaming.transportStreamTimestamp"}function mP(n){if(n.data.byteLength===8){const e=new Uint8Array(n.data),t=e[3]&1;let i=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return i/=45,t&&(i+=4772185884e-2),Math.round(i)}}function Um(n){const e=uT(n);for(let t=0;t<e.length;t++){const i=e[t];if(dT(i))return mP(i)}}let Cn=function(n){return n.audioId3="org.id3",n.dateRange="com.apple.quicktime.HLS",n.emsg="https://aomedia.org/emsg/ID3",n.misbklv="urn:misb:KLV:bin:1910.1",n}({});function bi(n="",e=9e4){return{type:n,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class $m{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,i,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,i){}demux(e,t){this.cachedData&&(e=Xn(this.cachedData,e),this.cachedData=null);let i=ml(e,0),r=i?i.length:0,s;const a=this._audioTrack,o=this._id3Track,l=i?Um(i):void 0,c=e.length;for((this.basePTS===null||this.frameIndex===0&&Re(l))&&(this.basePTS=gP(l,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),i&&i.length>0&&o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Cn.audioId3,duration:Number.POSITIVE_INFINITY});r<c;){if(this.canParse(e,r)){const u=this.appendFrame(a,e,r);u?(this.frameIndex++,this.lastPTS=u.sample.pts,r+=u.length,s=r):r=c}else iP(e,r)?(i=ml(e,r),o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Cn.audioId3,duration:Number.POSITIVE_INFINITY}),r+=i.length,s=r):r++;if(r===c&&s!==c){const u=e.slice(s);this.cachedData?this.cachedData=Xn(this.cachedData,u):this.cachedData=u}}return{audioTrack:a,videoTrack:bi(),id3Track:o,textTrack:bi()}}demuxSampleAes(e,t,i){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:bi(),id3Track:this._id3Track,textTrack:bi()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const gP=(n,e,t)=>{if(Re(n))return n*90;const i=t?t.baseTime*9e4/t.timescale:0;return e*9e4+i};let Sc=null;const _P=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],yP=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],vP=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],EP=[0,1,1,4];function hT(n,e,t,i,r){if(t+24>e.length)return;const s=fT(e,t);if(s&&t+s.frameLength<=e.length){const a=s.samplesPerFrame*9e4/s.sampleRate,o=i+r*a,l={unit:e.subarray(t,t+s.frameLength),pts:o,dts:o};return n.config=[],n.channelCount=s.channelCount,n.samplerate=s.sampleRate,n.samples.push(l),{sample:l,length:s.frameLength,missing:0}}}function fT(n,e){const t=n[e+1]>>3&3,i=n[e+1]>>1&3,r=n[e+2]>>4&15,s=n[e+2]>>2&3;if(t!==1&&r!==0&&r!==15&&s!==3){const a=n[e+2]>>1&1,o=n[e+3]>>6,l=t===3?3-i:i===3?3:4,c=_P[l*14+r-1]*1e3,d=yP[(t===3?0:t===2?1:2)*3+s],h=o===3?1:2,m=vP[t][i],g=EP[i],v=m*8*g,x=Math.floor(m*c/d+a)*g;if(Sc===null){const k=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Sc=k?parseInt(k[1]):0}return!!Sc&&Sc<=87&&i===2&&c>=224e3&&o===0&&(n[e+3]=n[e+3]|128),{sampleRate:d,channelCount:h,frameLength:x,samplesPerFrame:v}}}function Vm(n,e){return n[e]===255&&(n[e+1]&224)===224&&(n[e+1]&6)!==0}function pT(n,e){return e+1<n.length&&Vm(n,e)}function SP(n,e){return Vm(n,e)&&4<=n.length-e}function mT(n,e){if(e+1<n.length&&Vm(n,e)){const i=fT(n,e);let r=4;i!=null&&i.frameLength&&(r=i.frameLength);const s=e+r;return s===n.length||pT(n,s)}return!1}class TP extends $m{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,i,r){super.resetInitSegment(e,t,i,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const i=ml(e,0);let r=(i==null?void 0:i.length)||0;if(mT(e,r))return!1;for(let s=e.length;r<s;r++)if(tP(e,r))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return eP(e,t)}appendFrame(e,t,i){oT(e,this.observer,t,i,e.manifestCodec);const r=cT(e,t,i,this.basePTS,this.frameIndex);if(r&&r.missing===0)return r}}const gT=(n,e)=>{let t=0,i=5;e+=i;const r=new Uint32Array(1),s=new Uint32Array(1),a=new Uint8Array(1);for(;i>0;){a[0]=n[e];const o=Math.min(i,8),l=8-o;s[0]=4278190080>>>24+l<<l,r[0]=(a[0]&s[0])>>l,t=t?t<<o|r[0]:r[0],e+=1,i-=o}return t};class AP extends $m{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,i,r){super.resetInitSegment(e,t,i,r),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,i){const r=_T(e,t,i,this.basePTS,this.frameIndex);if(r!==-1)return{sample:e.samples[e.samples.length-1],length:r,missing:0}}static probe(e){if(!e)return!1;const t=ml(e,0);if(!t)return!1;const i=t.length;return e[i]===11&&e[i+1]===119&&Um(t)!==void 0&&gT(e,i)<16}}function _T(n,e,t,i,r){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const s=e[t+4]>>6;if(s>=3)return-1;const o=[48e3,44100,32e3][s],l=e[t+4]&63,u=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][l*3+s]*2;if(t+u>e.length)return-1;const d=e[t+6]>>5;let h=0;d===2?h+=2:(d&1&&d!==1&&(h+=2),d&4&&(h+=2));const m=(e[t+6]<<8|e[t+7])>>12-h&1,v=[2,1,2,3,3,4,4,5][d]+m,x=e[t+5]>>3,E=e[t+5]&7,R=new Uint8Array([s<<6|x<<1|E>>2,(E&3)<<6|d<<3|m<<2|l>>4,l<<4&224]),k=1536/o*9e4,D=i+r*k,V=e.subarray(t,t+u);return n.config=R,n.channelCount=v,n.samplerate=o,n.samples.push({unit:V,pts:D}),u}class xP extends $m{resetInitSegment(e,t,i,r){super.resetInitSegment(e,t,i,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=ml(e,0);let i=(t==null?void 0:t.length)||0;if(t&&e[i]===11&&e[i+1]===119&&Um(t)!==void 0&&gT(e,i)<=16)return!1;for(let r=e.length;i<r;i++)if(mT(e,i))return ot.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return SP(e,t)}appendFrame(e,t,i){if(this.basePTS!==null)return hT(e,t,i,this.basePTS,this.frameIndex)}}const bP=/\/emsg[-/]ID3/i;class IP{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,i,r){const s=this.videoTrack=bi("video",1),a=this.audioTrack=bi("audio",1),o=this.txtTrack=bi("text",1);if(this.id3Track=bi("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const l=PS(e);if(l.video){const{id:c,timescale:u,codec:d,supplemental:h}=l.video;s.id=c,s.timescale=o.timescale=u,s.codec=d,s.supplemental=h}if(l.audio){const{id:c,timescale:u,codec:d}=l.audio;a.id=c,a.timescale=u,a.codec=d}o.id=CS.text,s.sampleDuration=0,s.duration=a.duration=r}resetContiguity(){this.remainderData=null}static probe(e){return Rk(e)}demux(e,t){this.timeOffset=t;let i=e;const r=this.videoTrack,s=this.txtTrack;if(this.config.progressive){this.remainderData&&(i=Xn(this.remainderData,e));const o=Pk(i);this.remainderData=o.remainder,r.samples=o.valid||new Uint8Array}else r.samples=i;const a=this.extractID3Track(r,t);return s.samples=L_(t,r),{videoTrack:r,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,i=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const r=this.extractID3Track(t,this.timeOffset);return i.samples=L_(e,t),{videoTrack:t,audioTrack:bi(),id3Track:r,textTrack:bi()}}extractID3Track(e,t){const i=this.id3Track;if(e.samples.length){const r=We(e.samples,["emsg"]);r&&r.forEach(s=>{const a=Mk(s);if(bP.test(a.schemeIdUri)){const o=ly(a,t);let l=a.eventDuration===4294967295?Number.POSITIVE_INFINITY:a.eventDuration/a.timeScale;l<=.001&&(l=Number.POSITIVE_INFINITY);const c=a.payload;i.samples.push({data:c,len:c.byteLength,dts:o,pts:o,type:Cn.emsg,duration:l})}else if(this.config.enableEmsgKLVMetadata&&a.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const o=ly(a,t);i.samples.push({data:a.payload,len:a.payload.byteLength,dts:o,pts:o,type:Cn.misbklv,duration:Number.POSITIVE_INFINITY})}})}return i}demuxSampleAes(e,t,i){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function ly(n,e){return Re(n.presentationTime)?n.presentationTime/n.timeScale:e+n.presentationTimeDelta/n.timeScale}class RP{constructor(e,t,i){this.keyData=void 0,this.decrypter=void 0,this.keyData=i,this.decrypter=new km(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,es.cbc)}decryptAacSample(e,t,i){const r=e[t].unit;if(r.length<=16)return;const s=r.subarray(16,r.length-r.length%16),a=s.buffer.slice(s.byteOffset,s.byteOffset+s.length);this.decryptBuffer(a).then(o=>{const l=new Uint8Array(o);r.set(l,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,i)})}decryptAacSamples(e,t,i){for(;;t++){if(t>=e.length){i();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,i),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,i=new Int8Array(t);let r=0;for(let s=32;s<e.length-16;s+=160,r+=16)i.set(e.subarray(s,s+16),r);return i}getAvcDecryptedUnit(e,t){const i=new Uint8Array(t);let r=0;for(let s=32;s<e.length-16;s+=160,r+=16)e.set(i.subarray(r,r+16),s);return e}decryptAvcSample(e,t,i,r,s){const a=MS(s.data),o=this.getAvcEncryptedData(a);this.decryptBuffer(o.buffer).then(l=>{s.data=this.getAvcDecryptedUnit(a,l),this.decrypter.isSync()||this.decryptAvcSamples(e,t,i+1,r)})}decryptAvcSamples(e,t,i,r){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,i=0){if(t>=e.length){r();return}const s=e[t].units;for(;!(i>=s.length);i++){const a=s[i];if(!(a.data.length<=48||a.type!==1&&a.type!==5)&&(this.decryptAvcSample(e,t,i,r,a),!this.decrypter.isSync()))return}}}}class yT{constructor(){this.VideoSample=null}createVideoSample(e,t,i){return{key:e,frame:!1,pts:t,dts:i,units:[],length:0}}getLastNalUnit(e){var t;let i=this.VideoSample,r;if((!i||i.units.length===0)&&(i=e[e.length-1]),(t=i)!=null&&t.units){const s=i.units;r=s[s.length-1]}return r}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const i=t.samples,r=i.length;if(r){const s=i[r-1];e.pts=s.pts,e.dts=s.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,i){const r=t.byteLength;let s=e.naluState||0;const a=s,o=[];let l=0,c,u,d,h=-1,m=0;for(s===-1&&(h=0,m=this.getNALuType(t,0),s=0,l=1);l<r;){if(c=t[l++],!s){s=c?0:1;continue}if(s===1){s=c?0:2;continue}if(!c)s=3;else if(c===1){if(u=l-s-1,h>=0){const g={data:t.subarray(h,u),type:m};o.push(g)}else{const g=this.getLastNalUnit(e.samples);g&&(a&&l<=4-a&&g.state&&(g.data=g.data.subarray(0,g.data.byteLength-a)),u>0&&(g.data=Xn(g.data,t.subarray(0,u)),g.state=0))}l<r?(d=this.getNALuType(t,l),h=l,m=d,s=0):s=-1}else s=0}if(h>=0&&s>=0){const g={data:t.subarray(h,r),type:m,state:s};o.push(g)}if(o.length===0){const g=this.getLastNalUnit(e.samples);g&&(g.data=Xn(g.data,t))}return e.naluState=s,o}}class Vo{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,i=e.byteLength-t,r=new Uint8Array(4),s=Math.min(4,t);if(s===0)throw new Error("no bytes available");r.set(e.subarray(i,i+s)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=s*8,this.bytesAvailable-=s}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const i=this.word>>>32-t;if(e>32&&ot.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?i<<t|this.readBits(t):i}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class LP extends yT{parsePES(e,t,i,r){const s=this.parseNALu(e,i.data,r);let a=this.VideoSample,o,l=!1;i.data=null,a&&s.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),s.forEach(c=>{var u,d;switch(c.type){case 1:{let v=!1;o=!0;const x=c.data;if(l&&x.length>4){const E=this.readSliceType(x);(E===2||E===4||E===7||E===9)&&(v=!0)}if(v){var h;(h=a)!=null&&h.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),a.frame=!0,a.key=v;break}case 5:o=!0,(u=a)!=null&&u.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),a.key=!0,a.frame=!0;break;case 6:{o=!0,Rm(c.data,1,i.pts,t.samples);break}case 7:{var m,g;o=!0,l=!0;const v=c.data,x=this.readSPS(v);if(!e.sps||e.width!==x.width||e.height!==x.height||((m=e.pixelRatio)==null?void 0:m[0])!==x.pixelRatio[0]||((g=e.pixelRatio)==null?void 0:g[1])!==x.pixelRatio[1]){e.width=x.width,e.height=x.height,e.pixelRatio=x.pixelRatio,e.sps=[v];const E=v.subarray(1,4);let R="avc1.";for(let k=0;k<3;k++){let D=E[k].toString(16);D.length<2&&(D="0"+D),R+=D}e.codec=R}break}case 8:o=!0,e.pps=[c.data];break;case 9:o=!0,e.audFound=!0,(d=a)!=null&&d.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts));break;case 12:o=!0;break;default:o=!1;break}a&&o&&a.units.push(c)}),r&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new Vo(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let i=8,r=8,s;for(let a=0;a<e;a++)r!==0&&(s=t.readEG(),r=(i+s+256)%256),i=r===0?i:r}readSPS(e){const t=new Vo(e);let i=0,r=0,s=0,a=0,o,l,c;const u=t.readUByte.bind(t),d=t.readBits.bind(t),h=t.readUEG.bind(t),m=t.readBoolean.bind(t),g=t.skipBits.bind(t),v=t.skipEG.bind(t),x=t.skipUEG.bind(t),E=this.skipScalingList.bind(this);u();const R=u();if(d(5),g(3),u(),x(),R===100||R===110||R===122||R===244||R===44||R===83||R===86||R===118||R===128){const S=h();if(S===3&&g(1),x(),x(),g(1),m())for(l=S!==3?8:12,c=0;c<l;c++)m()&&(c<6?E(16,t):E(64,t))}x();const k=h();if(k===0)h();else if(k===1)for(g(1),v(),v(),o=h(),c=0;c<o;c++)v();x(),g(1);const D=h(),V=h(),H=d(1);H===0&&g(1),g(1),m()&&(i=h(),r=h(),s=h(),a=h());let C=[1,1];if(m()&&m())switch(u()){case 1:C=[1,1];break;case 2:C=[12,11];break;case 3:C=[10,11];break;case 4:C=[16,11];break;case 5:C=[40,33];break;case 6:C=[24,11];break;case 7:C=[20,11];break;case 8:C=[32,11];break;case 9:C=[80,33];break;case 10:C=[18,11];break;case 11:C=[15,11];break;case 12:C=[64,33];break;case 13:C=[160,99];break;case 14:C=[4,3];break;case 15:C=[3,2];break;case 16:C=[2,1];break;case 255:{C=[u()<<8|u(),u()<<8|u()];break}}return{width:Math.ceil((D+1)*16-i*2-r*2),height:(2-H)*(V+1)*16-(H?2:4)*(s+a),pixelRatio:C}}}class wP extends yT{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,i,r){const s=this.parseNALu(e,i.data,r);let a=this.VideoSample,o,l=!1;i.data=null,a&&s.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),s.forEach(c=>{var u,d;switch(c.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:a||(a=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),a.frame=!0,o=!0;break;case 16:case 17:case 18:case 21:if(o=!0,l){var h;(h=a)!=null&&h.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),a.key=!0,a.frame=!0;break;case 19:case 20:o=!0,(u=a)!=null&&u.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),a.key=!0,a.frame=!0;break;case 39:o=!0,Rm(c.data,2,i.pts,t.samples);break;case 32:o=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=ut(e.params,this.readVPS(c.data)),this.initVPS=c.data),e.vps=[c.data];break;case 33:if(o=!0,l=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],c.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const m=this.readSPS(c.data);e.width=m.width,e.height=m.height,e.pixelRatio=m.pixelRatio,e.codec=m.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const g in m.params)e.params[g]=m.params[g]}this.pushParameterSet(e.sps,c.data,e.vps),a||(a=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),a.key=!0;break;case 34:if(o=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const m=this.readPPS(c.data);for(const g in m)e.params[g]=m[g]}this.pushParameterSet(e.pps,c.data,e.vps)}break;case 35:o=!0,e.audFound=!0,(d=a)!=null&&d.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts));break;default:o=!1;break}a&&o&&a.units.push(c)}),r&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}pushParameterSet(e,t,i){(i&&i[0]===this.initVPS||!i&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let i=0;for(let r=0;r<e.byteLength;r++)r>=2&&e[r]===3&&e[r-1]===0&&e[r-2]===0||(t[i]=e[r],i++);return new Uint8Array(t.buffer,0,i)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new Vo(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const i=t.readBits(3),r=t.readBoolean();return{numTemporalLayers:i+1,temporalIdNested:r}}readSPS(e){const t=new Vo(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const i=t.readBits(3);t.readBoolean();const r=t.readBits(2),s=t.readBoolean(),a=t.readBits(5),o=t.readUByte(),l=t.readUByte(),c=t.readUByte(),u=t.readUByte(),d=t.readUByte(),h=t.readUByte(),m=t.readUByte(),g=t.readUByte(),v=t.readUByte(),x=t.readUByte(),E=t.readUByte(),R=[],k=[];for(let Oe=0;Oe<i;Oe++)R.push(t.readBoolean()),k.push(t.readBoolean());if(i>0)for(let Oe=i;Oe<8;Oe++)t.readBits(2);for(let Oe=0;Oe<i;Oe++)R[Oe]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),k[Oe]&&t.readUByte();t.readUEG();const D=t.readUEG();D==3&&t.skipBits(1);const V=t.readUEG(),H=t.readUEG(),C=t.readBoolean();let S=0,b=0,T=0,L=0;C&&(S+=t.readUEG(),b+=t.readUEG(),T+=t.readUEG(),L+=t.readUEG());const F=t.readUEG(),U=t.readUEG(),Z=t.readUEG(),ie=t.readBoolean();for(let Oe=ie?0:i;Oe<=i;Oe++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let Et=0;Et<4;Et++)for(let $t=0;$t<(Et===3?2:6);$t++)if(!t.readBoolean())t.readUEG();else{const Vt=Math.min(64,1<<4+(Et<<1));Et>1&&t.readEG();for(let Qn=0;Qn<Vt;Qn++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const te=t.readUEG();let j=0;for(let Oe=0;Oe<te;Oe++){let Et=!1;if(Oe!==0&&(Et=t.readBoolean()),Et){Oe===te&&t.readUEG(),t.readBoolean(),t.readUEG();let $t=0;for(let Sn=0;Sn<=j;Sn++){const Vt=t.readBoolean();let Qn=!1;Vt||(Qn=t.readBoolean()),(Vt||Qn)&&$t++}j=$t}else{const $t=t.readUEG(),Sn=t.readUEG();j=$t+Sn;for(let Vt=0;Vt<$t;Vt++)t.readUEG(),t.readBoolean();for(let Vt=0;Vt<Sn;Vt++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const Oe=t.readUEG();for(let Et=0;Et<Oe;Et++){for(let $t=0;$t<Z+4;$t++)t.readBits(1);t.readBits(1)}}let q=0,Q=1,fe=1,ve=!0,be=1,xe=0;t.readBoolean(),t.readBoolean();let ce=!1;if(t.readBoolean()){if(t.readBoolean()){const Jn=t.readUByte(),pr=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],gi=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];Jn>0&&Jn<16?(Q=pr[Jn-1],fe=gi[Jn-1]):Jn===255&&(Q=t.readBits(16),fe=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),ce=t.readBoolean(),ce&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(be=t.readBits(32),xe=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const gi=t.readBoolean(),ss=t.readBoolean();let St=!1;(gi||ss)&&(St=t.readBoolean(),St&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),St&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let Mt=0;Mt<=i;Mt++){ve=t.readBoolean();const mr=ve||t.readBoolean();let as=!1;mr?t.readEG():as=t.readBoolean();const os=as?1:t.readUEG()+1;if(gi)for(let Ui=0;Ui<os;Ui++)t.readUEG(),t.readUEG(),St&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(ss)for(let Ui=0;Ui<os;Ui++)t.readUEG(),t.readUEG(),St&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),q=t.readUEG())}let Ie=V,Le=H;if(C){let Oe=1,Et=1;D===1?Oe=Et=2:D==2&&(Oe=2),Ie=V-Oe*b-Oe*S,Le=H-Et*L-Et*T}const ke=r?["A","B","C"][r]:"",ze=o<<24|l<<16|c<<8|u;let ft=0;for(let Oe=0;Oe<32;Oe++)ft=(ft|(ze>>Oe&1)<<31-Oe)>>>0;let gt=ft.toString(16);return a===1&&gt==="2"&&(gt="6"),{codecString:`hvc1.${ke}${a}.${gt}.${s?"H":"L"}${E}.B0`,params:{general_tier_flag:s,general_profile_idc:a,general_profile_space:r,general_profile_compatibility_flags:[o,l,c,u],general_constraint_indicator_flags:[d,h,m,g,v,x],general_level_idc:E,bit_depth:F+8,bit_depth_luma_minus8:F,bit_depth_chroma_minus8:U,min_spatial_segmentation_idc:q,chroma_format_idc:D,frame_rate:{fixed:ve,fps:xe/be}},width:Ie,height:Le,pixelRatio:[Q,fe]}}readPPS(e){const t=new Vo(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const r=t.readBoolean(),s=t.readBoolean();let a=1;return s&&r?a=0:s?a=3:r&&(a=2),{parallelismType:a}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const Xt=188;class wr{constructor(e,t,i,r){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=i,this.logger=r,this.videoParser=null}static probe(e,t){const i=wr.syncOffset(e);return i>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${i}`),i!==-1}static syncOffset(e){const t=e.length;let i=Math.min(Xt*5,t-Xt)+1,r=0;for(;r<i;){let s=!1,a=-1,o=0;for(let l=r;l<t;l+=Xt)if(e[l]===71&&(t-l===Xt||e[l+Xt]===71)){if(o++,a===-1&&(a=l,a!==0&&(i=Math.min(a+Xt*99,e.length-Xt)+1)),s||(s=Xf(e,l)===0),s&&o>1&&(a===0&&o>2||l+Xt>i))return a}else{if(o)return-1;break}r++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:CS[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,i,r){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=wr.createTrack("video"),this._videoTrack.duration=r,this._audioTrack=wr.createTrack("audio",r),this._id3Track=wr.createTrack("id3"),this._txtTrack=wr.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=i}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:i}=this;e&&(e.pesData=null),t&&(t.pesData=null),i&&(i.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,i=!1,r=!1){i||(this.sampleAes=null);let s;const a=this._videoTrack,o=this._audioTrack,l=this._id3Track,c=this._txtTrack;let u=a.pid,d=a.pesData,h=o.pid,m=l.pid,g=o.pesData,v=l.pesData,x=null,E=this.pmtParsed,R=this._pmtId,k=e.length;if(this.remainderData&&(e=Xn(this.remainderData,e),k=e.length,this.remainderData=null),k<Xt&&!r)return this.remainderData=e,{audioTrack:o,videoTrack:a,id3Track:l,textTrack:c};const D=Math.max(0,wr.syncOffset(e));k-=(k-D)%Xt,k<e.byteLength&&!r&&(this.remainderData=new Uint8Array(e.buffer,k,e.buffer.byteLength-k));let V=0;for(let C=D;C<k;C+=Xt)if(e[C]===71){const S=!!(e[C+1]&64),b=Xf(e,C),T=(e[C+3]&48)>>4;let L;if(T>1){if(L=C+5+e[C+4],L===C+Xt)continue}else L=C+4;switch(b){case u:S&&(d&&(s=ta(d,this.logger))&&(this.readyVideoParser(a.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(a,c,s,!1)),d={data:[],size:0}),d&&(d.data.push(e.subarray(L,C+Xt)),d.size+=C+Xt-L);break;case h:if(S){if(g&&(s=ta(g,this.logger)))switch(o.segmentCodec){case"aac":this.parseAACPES(o,s);break;case"mp3":this.parseMPEGPES(o,s);break;case"ac3":this.parseAC3PES(o,s);break}g={data:[],size:0}}g&&(g.data.push(e.subarray(L,C+Xt)),g.size+=C+Xt-L);break;case m:S&&(v&&(s=ta(v,this.logger))&&this.parseID3PES(l,s),v={data:[],size:0}),v&&(v.data.push(e.subarray(L,C+Xt)),v.size+=C+Xt-L);break;case 0:S&&(L+=e[L]+1),R=this._pmtId=CP(e,L);break;case R:{S&&(L+=e[L]+1);const F=kP(e,L,this.typeSupported,i,this.observer,this.logger);u=F.videoPid,u>0&&(a.pid=u,a.segmentCodec=F.segmentVideoCodec),h=F.audioPid,h>0&&(o.pid=h,o.segmentCodec=F.segmentAudioCodec),m=F.id3Pid,m>0&&(l.pid=m),x!==null&&!E&&(this.logger.warn(`MPEG-TS PMT found at ${C} after unknown PID '${x}'. Backtracking to sync byte @${D} to parse all TS packets.`),x=null,C=D-188),E=this.pmtParsed=!0;break}case 17:case 8191:break;default:x=b;break}}else V++;V>0&&Qf(this.observer,new Error(`Found ${V} TS packet/s that do not start with 0x47`),void 0,this.logger),a.pesData=d,o.pesData=g,l.pesData=v;const H={audioTrack:o,videoTrack:a,id3Track:l,textTrack:c};return r&&this.extractRemainingSamples(H),H}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:i,id3Track:r,textTrack:s}=e,a=i.pesData,o=t.pesData,l=r.pesData;let c;if(a&&(c=ta(a,this.logger))?(this.readyVideoParser(i.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(i,s,c,!0),i.pesData=null)):i.pesData=a,o&&(c=ta(o,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,c);break;case"mp3":this.parseMPEGPES(t,c);break;case"ac3":this.parseAC3PES(t,c);break}t.pesData=null}else o!=null&&o.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=o;l&&(c=ta(l,this.logger))?(this.parseID3PES(r,c),r.pesData=null):r.pesData=l}demuxSampleAes(e,t,i){const r=this.demux(e,i,!0,!this.config.progressive),s=this.sampleAes=new RP(this.observer,this.config,t);return this.decrypt(r,s)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new LP:e==="hevc"&&(this.videoParser=new wP))}decrypt(e,t){return new Promise(i=>{const{audioTrack:r,videoTrack:s}=e;r.samples&&r.segmentCodec==="aac"?t.decryptAacSamples(r.samples,0,()=>{s.samples?t.decryptAvcSamples(s.samples,0,0,()=>{i(e)}):i(e)}):s.samples&&t.decryptAvcSamples(s.samples,0,0,()=>{i(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let i=0;const r=this.aacOverFlow;let s=t.data;if(r){this.aacOverFlow=null;const d=r.missing,h=r.sample.unit.byteLength;if(d===-1)s=Xn(r.sample.unit,s);else{const m=h-d;r.sample.unit.set(s.subarray(0,d),m),e.samples.push(r.sample),i=r.missing}}let a,o;for(a=i,o=s.length;a<o-1&&!Hu(s,a);a++);if(a!==i){let d;const h=a<o-1;if(h?d=`AAC PES did not start with ADTS header,offset:${a}`:d="No ADTS header found in AAC PES",Qf(this.observer,new Error(d),h,this.logger),!h)return}oT(e,this.observer,s,a,this.audioCodec);let l;if(t.pts!==void 0)l=t.pts;else if(r){const d=lT(e.samplerate);l=r.sample.pts+d}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let c=0,u;for(;a<o;)if(u=cT(e,s,a,l,c),a+=u.length,u.missing){this.aacOverFlow=u;break}else for(c++;a<o-1&&!Hu(s,a);a++);}parseMPEGPES(e,t){const i=t.data,r=i.length;let s=0,a=0;const o=t.pts;if(o===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;a<r;)if(pT(i,a)){const l=hT(e,i,a,o,s);if(l)a+=l.length,s++;else break}else a++}parseAC3PES(e,t){{const i=t.data,r=t.pts;if(r===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const s=i.length;let a=0,o=0,l;for(;o<s&&(l=_T(e,i,o,r,a++))>0;)o+=l}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const i=ut({},t,{type:this._videoTrack?Cn.emsg:Cn.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(i)}}function Xf(n,e){return((n[e+1]&31)<<8)+n[e+2]}function CP(n,e){return(n[e+10]&31)<<8|n[e+11]}function kP(n,e,t,i,r,s){const a={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},o=(n[e+1]&15)<<8|n[e+2],l=e+3+o-4,c=(n[e+10]&15)<<8|n[e+11];for(e+=12+c;e<l;){const u=Xf(n,e),d=(n[e+3]&15)<<8|n[e+4];switch(n[e]){case 207:if(!i){Th("ADTS AAC",s);break}case 15:a.audioPid===-1&&(a.audioPid=u);break;case 21:a.id3Pid===-1&&(a.id3Pid=u);break;case 219:if(!i){Th("H.264",s);break}case 27:a.videoPid===-1&&(a.videoPid=u);break;case 3:case 4:!t.mpeg&&!t.mp3?s.log("MPEG audio found, not supported in this browser"):a.audioPid===-1&&(a.audioPid=u,a.segmentAudioCodec="mp3");break;case 193:if(!i){Th("AC-3",s);break}case 129:t.ac3?a.audioPid===-1&&(a.audioPid=u,a.segmentAudioCodec="ac3"):s.log("AC-3 audio found, not supported in this browser");break;case 6:if(a.audioPid===-1&&d>0){let h=e+5,m=d;for(;m>2;){switch(n[h]){case 106:t.ac3!==!0?s.log("AC-3 audio found, not supported in this browser for now"):(a.audioPid=u,a.segmentAudioCodec="ac3");break}const v=n[h+1]+2;h+=v,m-=v}}break;case 194:case 135:return Qf(r,new Error("Unsupported EC-3 in M2TS found"),void 0,s),a;case 36:a.videoPid===-1&&(a.videoPid=u,a.segmentVideoCodec="hevc",s.log("HEVC in M2TS found"));break}e+=d+5}return a}function Qf(n,e,t,i){i.warn(`parsing error: ${e.message}`),n.emit(O.ERROR,O.ERROR,{type:Pe.MEDIA_ERROR,details:se.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function Th(n,e){e.log(`${n} with AES-128-CBC encryption found in unencrypted stream`)}function ta(n,e){let t=0,i,r,s,a,o;const l=n.data;if(!n||n.size===0)return null;for(;l[0].length<19&&l.length>1;)l[0]=Xn(l[0],l[1]),l.splice(1,1);if(i=l[0],(i[0]<<16)+(i[1]<<8)+i[2]===1){if(r=(i[4]<<8)+i[5],r&&r>n.size-6)return null;const u=i[7];u&192&&(a=(i[9]&14)*536870912+(i[10]&255)*4194304+(i[11]&254)*16384+(i[12]&255)*128+(i[13]&254)/2,u&64?(o=(i[14]&14)*536870912+(i[15]&255)*4194304+(i[16]&254)*16384+(i[17]&255)*128+(i[18]&254)/2,a-o>60*9e4&&(e.warn(`${Math.round((a-o)/9e4)}s delta between PTS and DTS, align them`),a=o)):o=a),s=i[8];let d=s+9;if(n.size<=d)return null;n.size-=d;const h=new Uint8Array(n.size);for(let m=0,g=l.length;m<g;m++){i=l[m];let v=i.byteLength;if(d)if(d>v){d-=v;continue}else i=i.subarray(d),v-=d,d=0;h.set(i,t),t+=v}return r&&(r-=s+3),{data:h,pts:a,dts:o,len:r}}return null}class DP{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const xr=Math.pow(2,32)-1;class ne{static init(){ne.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in ne.types)ne.types.hasOwnProperty(e)&&(ne.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);ne.HDLR_TYPES={video:t,audio:i};const r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);ne.STTS=ne.STSC=ne.STCO=s,ne.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),ne.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),ne.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),ne.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const a=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);ne.FTYP=ne.box(ne.types.ftyp,a,l,a,o),ne.DINF=ne.box(ne.types.dinf,ne.box(ne.types.dref,r))}static box(e,...t){let i=8,r=t.length;const s=r;for(;r--;)i+=t[r].byteLength;const a=new Uint8Array(i);for(a[0]=i>>24&255,a[1]=i>>16&255,a[2]=i>>8&255,a[3]=i&255,a.set(e,4),r=0,i=8;r<s;r++)a.set(t[r],i),i+=t[r].byteLength;return a}static hdlr(e){return ne.box(ne.types.hdlr,ne.HDLR_TYPES[e])}static mdat(e){return ne.box(ne.types.mdat,e)}static mdhd(e,t){t*=e;const i=Math.floor(t/(xr+1)),r=Math.floor(t%(xr+1));return ne.box(ne.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,i>>24,i>>16&255,i>>8&255,i&255,r>>24,r>>16&255,r>>8&255,r&255,85,196,0,0]))}static mdia(e){return ne.box(ne.types.mdia,ne.mdhd(e.timescale||0,e.duration||0),ne.hdlr(e.type),ne.minf(e))}static mfhd(e){return ne.box(ne.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?ne.box(ne.types.minf,ne.box(ne.types.smhd,ne.SMHD),ne.DINF,ne.stbl(e)):ne.box(ne.types.minf,ne.box(ne.types.vmhd,ne.VMHD),ne.DINF,ne.stbl(e))}static moof(e,t,i){return ne.box(ne.types.moof,ne.mfhd(e),ne.traf(i,t))}static moov(e){let t=e.length;const i=[];for(;t--;)i[t]=ne.trak(e[t]);return ne.box.apply(null,[ne.types.moov,ne.mvhd(e[0].timescale||0,e[0].duration||0)].concat(i).concat(ne.mvex(e)))}static mvex(e){let t=e.length;const i=[];for(;t--;)i[t]=ne.trex(e[t]);return ne.box.apply(null,[ne.types.mvex,...i])}static mvhd(e,t){t*=e;const i=Math.floor(t/(xr+1)),r=Math.floor(t%(xr+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,i>>24,i>>16&255,i>>8&255,i&255,r>>24,r>>16&255,r>>8&255,r&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return ne.box(ne.types.mvhd,s)}static sdtp(e){const t=e.samples||[],i=new Uint8Array(4+t.length);let r,s;for(r=0;r<t.length;r++)s=t[r].flags,i[r+4]=s.dependsOn<<4|s.isDependedOn<<2|s.hasRedundancy;return ne.box(ne.types.sdtp,i)}static stbl(e){return ne.box(ne.types.stbl,ne.stsd(e),ne.box(ne.types.stts,ne.STTS),ne.box(ne.types.stsc,ne.STSC),ne.box(ne.types.stsz,ne.STSZ),ne.box(ne.types.stco,ne.STCO))}static avc1(e){let t=[],i=[],r,s,a;for(r=0;r<e.sps.length;r++)s=e.sps[r],a=s.byteLength,t.push(a>>>8&255),t.push(a&255),t=t.concat(Array.prototype.slice.call(s));for(r=0;r<e.pps.length;r++)s=e.pps[r],a=s.byteLength,i.push(a>>>8&255),i.push(a&255),i=i.concat(Array.prototype.slice.call(s));const o=ne.box(ne.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(i))),l=e.width,c=e.height,u=e.pixelRatio[0],d=e.pixelRatio[1];return ne.box(ne.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,l&255,c>>8&255,c&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,ne.box(ne.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),ne.box(ne.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,u&255,d>>24,d>>16&255,d>>8&255,d&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return ne.box(ne.types.mp4a,ne.audioStsd(e),ne.box(ne.types.esds,ne.esds(e)))}static mp3(e){return ne.box(ne.types[".mp3"],ne.audioStsd(e))}static ac3(e){return ne.box(ne.types["ac-3"],ne.audioStsd(e),ne.box(ne.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return ne.box(ne.types.stsd,ne.STSD,ne.mp4a(e));if(t==="ac3"&&e.config)return ne.box(ne.types.stsd,ne.STSD,ne.ac3(e));if(t==="mp3"&&e.codec==="mp3")return ne.box(ne.types.stsd,ne.STSD,ne.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return ne.box(ne.types.stsd,ne.STSD,ne.avc1(e));if(t==="hevc"&&e.vps)return ne.box(ne.types.stsd,ne.STSD,ne.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,i=(e.duration||0)*(e.timescale||0),r=e.width||0,s=e.height||0,a=Math.floor(i/(xr+1)),o=Math.floor(i%(xr+1));return ne.box(ne.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,o>>24,o>>16&255,o>>8&255,o&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,r&255,0,0,s>>8&255,s&255,0,0]))}static traf(e,t){const i=ne.sdtp(e),r=e.id,s=Math.floor(t/(xr+1)),a=Math.floor(t%(xr+1));return ne.box(ne.types.traf,ne.box(ne.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255])),ne.box(ne.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,s&255,a>>24,a>>16&255,a>>8&255,a&255])),ne.trun(e,i.length+16+20+8+16+8+8),i)}static trak(e){return e.duration=e.duration||4294967295,ne.box(ne.types.trak,ne.tkhd(e),ne.mdia(e))}static trex(e){const t=e.id;return ne.box(ne.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const i=e.samples||[],r=i.length,s=12+16*r,a=new Uint8Array(s);let o,l,c,u,d,h;for(t+=8+s,a.set([e.type==="video"?1:0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,r&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),o=0;o<r;o++)l=i[o],c=l.duration,u=l.size,d=l.flags,h=l.cts,a.set([c>>>24&255,c>>>16&255,c>>>8&255,c&255,u>>>24&255,u>>>16&255,u>>>8&255,u&255,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|d.isNonSync,d.degradPrio&61440,d.degradPrio&15,h>>>24&255,h>>>16&255,h>>>8&255,h&255],12+16*o);return ne.box(ne.types.trun,a)}static initSegment(e){ne.types||ne.init();const t=ne.moov(e);return Xn(ne.FTYP,t)}static hvc1(e){const t=e.params,i=[e.vps,e.sps,e.pps],r=4,s=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),r-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),i.length]);let a=s.length;for(let g=0;g<i.length;g+=1){a+=3;for(let v=0;v<i[g].length;v+=1)a+=2+i[g][v].length}const o=new Uint8Array(a);o.set(s,0),a=s.length;const l=i.length-1;for(let g=0;g<i.length;g+=1){o.set(new Uint8Array([32+g|(g===l?128:0),0,i[g].length]),a),a+=3;for(let v=0;v<i[g].length;v+=1)o.set(new Uint8Array([i[g][v].length>>8,i[g][v].length&255]),a),a+=2,o.set(i[g][v],a),a+=i[g][v].length}const c=ne.box(ne.types.hvcC,o),u=e.width,d=e.height,h=e.pixelRatio[0],m=e.pixelRatio[1];return ne.box(ne.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,u&255,d>>8&255,d&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c,ne.box(ne.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),ne.box(ne.types.pasp,new Uint8Array([h>>24,h>>16&255,h>>8&255,h&255,m>>24,m>>16&255,m>>8&255,m&255])))}}ne.types=void 0;ne.HDLR_TYPES=void 0;ne.STTS=void 0;ne.STSC=void 0;ne.STCO=void 0;ne.STSZ=void 0;ne.VMHD=void 0;ne.SMHD=void 0;ne.STSD=void 0;ne.FTYP=void 0;ne.DINF=void 0;const vT=9e4;function jm(n,e,t=1,i=!1){const r=n*e*t;return i?Math.round(r):r}function PP(n,e,t=1,i=!1){return jm(n,e,1/t,i)}function yo(n,e=!1){return jm(n,1e3,1/vT,e)}function OP(n,e=1){return jm(n,vT,1/e)}const MP=10*1e3,NP=1024,BP=1152,FP=1536;let na=null,Ah=null;function cy(n,e,t,i){return{duration:e,size:t,cts:i,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:n?2:1,isNonSync:n?0:1}}}class Qc extends mi{constructor(e,t,i,r){if(super("mp4-remuxer",r),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=i,this.ISGenerated=!1,na===null){const a=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);na=a?parseInt(a[1]):0}if(Ah===null){const s=navigator.userAgent.match(/Safari\/(\d+)/i);Ah=s?parseInt(s[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){this.log("initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const i=e[0].pts,r=e.reduce((s,a)=>{let o=a.pts,l=o-s;return l<-4294967296&&(t=!0,o=jn(o,i),l=o-s),l>0?s:o},i);return t&&this.debug("PTS rollover detected"),r}remux(e,t,i,r,s,a,o,l){let c,u,d,h,m,g,v=s,x=s;const E=e.pid>-1,R=t.pid>-1,k=t.samples.length,D=e.samples.length>0,V=o&&k>0||k>1;if((!E||D)&&(!R||V)||this.ISGenerated||o){if(this.ISGenerated){var C,S,b,T;const Z=this.videoTrackConfig;(Z&&(t.width!==Z.width||t.height!==Z.height||((C=t.pixelRatio)==null?void 0:C[0])!==((S=Z.pixelRatio)==null?void 0:S[0])||((b=t.pixelRatio)==null?void 0:b[1])!==((T=Z.pixelRatio)==null?void 0:T[1]))||!Z&&V||this.nextAudioTs===null&&D)&&this.resetInitSegment()}this.ISGenerated||(d=this.generateIS(e,t,s,a));const L=this.isVideoContiguous;let F=-1,U;if(V&&(F=UP(t.samples),!L&&this.config.forceKeyFrameOnDiscontinuity))if(g=!0,F>0){this.warn(`Dropped ${F} out of ${k} video samples due to a missing keyframe`);const Z=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(F),t.dropped+=F,x+=(t.samples[0].pts-Z)/t.inputTimeScale,U=x}else F===-1&&(this.warn(`No keyframe found out of ${k} video samples`),g=!1);if(this.ISGenerated){if(D&&V){const Z=this.getVideoStartPts(t.samples),le=(jn(e.samples[0].pts,Z)-Z)/t.inputTimeScale;v+=Math.max(0,le),x+=Math.max(0,-le)}if(D){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),d=this.generateIS(e,t,s,a)),u=this.remuxAudio(e,v,this.isAudioContiguous,a,R||V||l===Ce.AUDIO?x:void 0),V){const Z=u?u.endPTS-u.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),d=this.generateIS(e,t,s,a)),c=this.remuxVideo(t,x,L,Z)}}else V&&(c=this.remuxVideo(t,x,L,0));c&&(c.firstKeyFrame=F,c.independent=F!==-1,c.firstKeyFramePTS=U)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(i.samples.length&&(m=ET(i,s,this._initPTS,this._initDTS)),r.samples.length&&(h=ST(r,s,this._initPTS))),{audio:u,video:c,initSegment:d,independent:g,text:h,id3:m}}generateIS(e,t,i,r){const s=e.samples,a=t.samples,o=this.typeSupported,l={},c=this._initPTS;let u=!c||r,d="audio/mp4",h,m,g,v=-1;if(u&&(h=m=1/0),e.config&&s.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":o.mpeg?(d="audio/mpeg",e.codec=""):o.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}l.audio={id:"audio",container:d,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&o.mpeg?new Uint8Array(0):ne.initSegment([e]),metadata:{channelCount:e.channelCount}},u&&(v=e.id,g=e.inputTimeScale,!c||g!==c.timescale?h=m=s[0].pts-Math.round(g*i):u=!1)}if(t.sps&&t.pps&&a.length){if(t.timescale=t.inputTimeScale,l.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:ne.initSegment([t]),metadata:{width:t.width,height:t.height}},u)if(v=t.id,g=t.inputTimeScale,!c||g!==c.timescale){const x=this.getVideoStartPts(a),E=Math.round(g*i);m=Math.min(m,jn(a[0].dts,x)-E),h=Math.min(h,x-E)}else u=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(l).length)return this.ISGenerated=!0,u?(c&&this.warn(`Timestamps at playlist time: ${r?"":"~"}${i} ${h/g} != initPTS: ${c.baseTime/c.timescale} (${c.baseTime}/${c.timescale}) trackId: ${c.trackId}`),this.log(`Found initPTS at playlist time: ${i} offset: ${h/g} (${h}/${g}) trackId: ${v}`),this._initPTS={baseTime:h,timescale:g,trackId:v},this._initDTS={baseTime:m,timescale:g,trackId:v}):h=g=void 0,{tracks:l,initPTS:h,timescale:g,trackId:v}}remuxVideo(e,t,i,r){const s=e.inputTimeScale,a=e.samples,o=[],l=a.length,c=this._initPTS,u=c.baseTime*s/c.timescale;let d=this.nextVideoTs,h=8,m=this.videoSampleDuration,g,v,x=Number.POSITIVE_INFINITY,E=Number.NEGATIVE_INFINITY,R=!1;if(!i||d===null){const q=u+t*s,Q=a[0].pts-jn(a[0].dts,a[0].pts);na&&d!==null&&Math.abs(q-Q-(d+u))<15e3?i=!0:d=q-Q-u}const k=d+u;for(let q=0;q<l;q++){const Q=a[q];Q.pts=jn(Q.pts,k),Q.dts=jn(Q.dts,k),Q.dts<a[q>0?q-1:q].dts&&(R=!0)}R&&a.sort(function(q,Q){const fe=q.dts-Q.dts,ve=q.pts-Q.pts;return fe||ve}),g=a[0].dts,v=a[a.length-1].dts;const D=v-g,V=D?Math.round(D/(l-1)):m||e.inputTimeScale/30;if(i){const q=g-k,Q=q>V,fe=q<-1;if((Q||fe)&&(Q?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${yo(q,!0)} ms (${q}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${yo(-q,!0)} ms (${q}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!fe||k>=a[0].pts||na)){g=k;const ve=a[0].pts-q;if(Q)a[0].dts=g,a[0].pts=ve;else{let be=!0;for(let xe=0;xe<a.length&&!(a[xe].dts>ve&&be);xe++){const ce=a[xe].pts;if(a[xe].dts-=q,a[xe].pts-=q,xe<a.length-1){const pe=a[xe+1].pts,Ie=a[xe].pts,Le=pe<=Ie,ke=pe<=ce;be=Le==ke}}}this.log(`Video: Initial PTS/DTS adjusted: ${yo(ve,!0)}/${yo(g,!0)}, delta: ${yo(q,!0)} ms`)}}g=Math.max(0,g);let H=0,C=0,S=g;for(let q=0;q<l;q++){const Q=a[q],fe=Q.units,ve=fe.length;let be=0;for(let xe=0;xe<ve;xe++)be+=fe[xe].data.length;C+=be,H+=ve,Q.length=be,Q.dts<S?(Q.dts=S,S+=V/4|0||1):S=Q.dts,x=Math.min(Q.pts,x),E=Math.max(Q.pts,E)}v=a[l-1].dts;const b=C+4*H+8;let T;try{T=new Uint8Array(b)}catch(q){this.observer.emit(O.ERROR,O.ERROR,{type:Pe.MUX_ERROR,details:se.REMUX_ALLOC_ERROR,fatal:!1,error:q,bytes:b,reason:`fail allocating video mdat ${b}`});return}const L=new DataView(T.buffer);L.setUint32(0,b),T.set(ne.types.mdat,4);let F=!1,U=Number.POSITIVE_INFINITY,Z=Number.POSITIVE_INFINITY,ie=Number.NEGATIVE_INFINITY,le=Number.NEGATIVE_INFINITY;for(let q=0;q<l;q++){const Q=a[q],fe=Q.units;let ve=0;for(let ce=0,pe=fe.length;ce<pe;ce++){const Ie=fe[ce],Le=Ie.data,ke=Ie.data.byteLength;L.setUint32(h,ke),h+=4,T.set(Le,h),h+=ke,ve+=4+ke}let be;if(q<l-1)m=a[q+1].dts-Q.dts,be=a[q+1].pts-Q.pts;else{const ce=this.config,pe=q>0?Q.dts-a[q-1].dts:V;if(be=q>0?Q.pts-a[q-1].pts:V,ce.stretchShortVideoTrack&&this.nextAudioTs!==null){const Ie=Math.floor(ce.maxBufferHole*s),Le=(r?x+r*s:this.nextAudioTs+u)-Q.pts;Le>Ie?(m=Le-pe,m<0?m=pe:F=!0,this.log(`It is approximately ${Le/90} ms to the next segment; using duration ${m/90} ms for the last video frame.`)):m=pe}else m=pe}const xe=Math.round(Q.pts-Q.dts);U=Math.min(U,m),ie=Math.max(ie,m),Z=Math.min(Z,be),le=Math.max(le,be),o.push(cy(Q.key,m,ve,xe))}if(o.length){if(na){if(na<70){const q=o[0].flags;q.dependsOn=2,q.isNonSync=0}}else if(Ah&&le-Z<ie-U&&V/ie<.025&&o[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let q=g;for(let Q=0,fe=o.length;Q<fe;Q++){const ve=q+o[Q].duration,be=q+o[Q].cts;if(Q<fe-1){const xe=ve+o[Q+1].cts;o[Q].duration=xe-be}else o[Q].duration=Q?o[Q-1].duration:V;o[Q].cts=0,q=ve}}}m=F||!m?V:m;const ge=v+m;this.nextVideoTs=d=ge-u,this.videoSampleDuration=m,this.isVideoContiguous=!0;const $={data1:ne.moof(e.sequenceNumber++,g,ut(e,{samples:o})),data2:T,startPTS:(x-u)/s,endPTS:(E+m-u)/s,startDTS:(g-u)/s,endDTS:d/s,type:"video",hasAudio:!1,hasVideo:!0,nb:o.length,dropped:e.dropped};return e.samples=[],e.dropped=0,$}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return BP;case"ac3":return FP;default:return NP}}remuxAudio(e,t,i,r,s){const a=e.inputTimeScale,o=e.samplerate?e.samplerate:a,l=a/o,c=this.getSamplesPerFrame(e),u=c*l,d=this._initPTS,h=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,m=[],g=s!==void 0;let v=e.samples,x=h?0:8,E=this.nextAudioTs||-1;const R=d.baseTime*a/d.timescale,k=R+t*a;if(this.isAudioContiguous=i=i||v.length&&E>0&&(r&&Math.abs(k-(E+R))<9e3||Math.abs(jn(v[0].pts,k)-(E+R))<20*u),v.forEach(function(le){le.pts=jn(le.pts,k)}),!i||E<0){if(v=v.filter(le=>le.pts>=0),!v.length)return;s===0?E=0:r&&!g?E=Math.max(0,k-R):E=v[0].pts-R}if(e.segmentCodec==="aac"){const le=this.config.maxAudioFramesDrift;for(let ge=0,te=E+R;ge<v.length;ge++){const j=v[ge],$=j.pts,q=$-te,Q=Math.abs(1e3*q/a);if(q<=-le*u&&g)ge===0&&(this.warn(`Audio frame @ ${($/a).toFixed(3)}s overlaps marker by ${Math.round(1e3*q/a)} ms.`),this.nextAudioTs=E=$-R,te=$);else if(q>=le*u&&Q<MP&&g){let fe=Math.round(q/u);for(te=$-fe*u;te<0&&fe&&u;)fe--,te+=u;ge===0&&(this.nextAudioTs=E=te-R),this.warn(`Injecting ${fe} audio frames @ ${((te-R)/a).toFixed(3)}s due to ${Math.round(1e3*q/a)} ms gap.`);for(let ve=0;ve<fe;ve++){let be=DP.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);be||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),be=j.unit.subarray()),v.splice(ge,0,{unit:be,pts:te}),te+=u,ge++}}j.pts=te,te+=u}}let D=null,V=null,H,C=0,S=v.length;for(;S--;)C+=v[S].unit.byteLength;for(let le=0,ge=v.length;le<ge;le++){const te=v[le],j=te.unit;let $=te.pts;if(V!==null){const Q=m[le-1];Q.duration=Math.round(($-V)/l)}else if(i&&e.segmentCodec==="aac"&&($=E+R),D=$,C>0){C+=x;try{H=new Uint8Array(C)}catch(Q){this.observer.emit(O.ERROR,O.ERROR,{type:Pe.MUX_ERROR,details:se.REMUX_ALLOC_ERROR,fatal:!1,error:Q,bytes:C,reason:`fail allocating audio mdat ${C}`});return}h||(new DataView(H.buffer).setUint32(0,C),H.set(ne.types.mdat,4))}else return;H.set(j,x);const q=j.byteLength;x+=q,m.push(cy(!0,c,q,0)),V=$}const b=m.length;if(!b)return;const T=m[m.length-1];E=V-R,this.nextAudioTs=E+l*T.duration;const L=h?new Uint8Array(0):ne.moof(e.sequenceNumber++,D/l,ut({},e,{samples:m}));e.samples=[];const F=(D-R)/a,U=E/a,ie={data1:L,data2:H,startPTS:F,endPTS:U,startDTS:F,endDTS:U,type:"audio",hasAudio:!0,hasVideo:!1,nb:b};return this.isAudioContiguous=!0,ie}}function jn(n,e){let t;if(e===null)return n;for(e<n?t=-8589934592:t=8589934592;Math.abs(n-e)>4294967296;)n+=t;return n}function UP(n){for(let e=0;e<n.length;e++)if(n[e].key)return e;return-1}function ET(n,e,t,i){const r=n.samples.length;if(!r)return;const s=n.inputTimeScale;for(let o=0;o<r;o++){const l=n.samples[o];l.pts=jn(l.pts-t.baseTime*s/t.timescale,e*s)/s,l.dts=jn(l.dts-i.baseTime*s/i.timescale,e*s)/s}const a=n.samples;return n.samples=[],{samples:a}}function ST(n,e,t){const i=n.samples.length;if(!i)return;const r=n.inputTimeScale;for(let a=0;a<i;a++){const o=n.samples[a];o.pts=jn(o.pts-t.baseTime*r/t.timescale,e*r)/r}n.samples.sort((a,o)=>a.pts-o.pts);const s=n.samples;return n.samples=[],{samples:s}}class $P extends mi{constructor(e,t,i,r){super("passthrough-remuxer",r),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,i,r){this.audioCodec=t,this.videoCodec=i,this.generateInitSegment(e,r),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:i,videoCodec:r}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:s,video:a}=this.initData=PS(e);if(t)kk(e,t);else{const l=s||a;l!=null&&l.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${l.codec}")!`)}s&&(i=uy(s,ht.AUDIO,this)),a&&(r=uy(a,ht.VIDEO,this));const o={};s&&a?o.audiovideo={container:"video/mp4",codec:i+","+r,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:s?o.audio={container:"audio/mp4",codec:i,encrypted:s.encrypted,initSegment:e,id:"audio"}:a?o.video={container:"video/mp4",codec:r,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=o}remux(e,t,i,r,s,a){var o,l;let{initPTS:c,lastEndTime:u}=this;const d={audio:void 0,video:void 0,text:r,id3:i,initSegment:void 0};Re(u)||(u=this.lastEndTime=s||0);const h=t.samples;if(!h.length)return d;const m={initPTS:void 0,timescale:void 0,trackId:void 0};let g=this.initData;if((o=g)!=null&&o.length||(this.generateInitSegment(h),g=this.initData),!((l=g)!=null&&l.length))return this.warn("Failed to generate initSegment."),d;this.emitInitSegment&&(m.tracks=this.initTracks,this.emitInitSegment=!1);const v=Dk(h,g,this),x=g.audio?v[g.audio.id]:null,E=g.video?v[g.video.id]:null,R=Tc(E,1/0),k=Tc(x,1/0),D=Tc(E,0,!0),V=Tc(x,0,!0);let H=s,C=0;const S=x&&(!E||!c&&k<R||c&&c.trackId===g.audio.id),b=S?x:E;if(b){const te=b.timescale,j=b.start-s*te,$=S?g.audio.id:g.video.id;H=b.start/te,C=S?V-k:D-R,(a||!c)&&(VP(c,H,s,C)||te!==c.timescale)&&(c&&this.warn(`Timestamps at playlist time: ${a?"":"~"}${s} ${j/te} != initPTS: ${c.baseTime/c.timescale} (${c.baseTime}/${c.timescale}) trackId: ${c.trackId}`),this.log(`Found initPTS at playlist time: ${s} offset: ${H-s} (${j}/${te}) trackId: ${$}`),c=null,m.initPTS=j,m.timescale=te,m.trackId=$)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${s}`);c?(m.initPTS=c.baseTime,m.timescale=c.timescale,m.trackId=c.trackId):((!m.timescale||m.trackId===void 0||m.initPTS===void 0)&&(this.warn("Could not set initPTS"),m.initPTS=H,m.timescale=1,m.trackId=-1),this.initPTS=c={baseTime:m.initPTS,timescale:m.timescale,trackId:m.trackId});const T=H-c.baseTime/c.timescale,L=T+C;C>0?this.lastEndTime=L:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const F=!!g.audio,U=!!g.video;let Z="";F&&(Z+="audio"),U&&(Z+="video");const ie=(g.audio?g.audio.encrypted:!1)||(g.video?g.video.encrypted:!1),le={data1:h,startPTS:T,startDTS:T,endPTS:L,endDTS:L,type:Z,hasAudio:F,hasVideo:U,nb:1,dropped:0,encrypted:ie};d.audio=F&&!U?le:void 0,d.video=U?le:void 0;const ge=E==null?void 0:E.sampleCount;if(ge){const te=E.keyFrameIndex,j=te!==-1;le.nb=ge,le.dropped=te===0||this.isVideoContiguous?0:j?te:ge,le.independent=j,le.firstKeyFrame=te,j&&E.keyFrameStart&&(le.firstKeyFramePTS=(E.keyFrameStart-c.baseTime)/c.timescale),this.isVideoContiguous||(d.independent=j),this.isVideoContiguous||(this.isVideoContiguous=j),le.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${te}/${ge} dropped: ${le.dropped} start: ${le.firstKeyFramePTS||"NA"}`)}return d.initSegment=m,d.id3=ET(i,s,c,c),r.samples.length&&(d.text=ST(r,s,c)),d}}function Tc(n,e,t=!1){return(n==null?void 0:n.start)!==void 0?(n.start+(t?n.duration:0))/n.timescale:e}function VP(n,e,t,i){if(n===null)return!0;const r=Math.max(i,1),s=e-n.baseTime/n.timescale;return Math.abs(s-t)>r}function uy(n,e,t){const i=n.codec;return i&&i.length>4?i:e===ht.AUDIO?i==="ec-3"||i==="ac-3"||i==="alac"?i:i==="fLaC"||i==="Opus"?Bu(i,!1):(t.warn(`Unhandled audio codec "${i}" in mp4 MAP`),i||"mp4a"):(t.warn(`Unhandled video codec "${i}" in mp4 MAP`),i||"avc1")}let Wi;try{Wi=self.performance.now.bind(self.performance)}catch{Wi=Date.now}const Jc=[{demux:IP,remux:$P},{demux:wr,remux:Qc},{demux:TP,remux:Qc},{demux:xP,remux:Qc}];Jc.splice(2,0,{demux:AP,remux:Qc});class dy{constructor(e,t,i,r,s,a){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=i,this.id=s,this.logger=a}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,i,r){const s=i.transmuxing;s.executeStart=Wi();let a=new Uint8Array(e);const{currentTransmuxState:o,transmuxConfig:l}=this;r&&(this.currentTransmuxState=r);const{contiguous:c,discontinuity:u,trackSwitch:d,accurateTimeOffset:h,timeOffset:m,initSegmentChange:g}=r||o,{audioCodec:v,videoCodec:x,defaultInitPts:E,duration:R,initSegmentData:k}=l,D=jP(a,t);if(D&&La(D.method)){const S=this.getDecrypter(),b=Pm(D.method);if(S.isSync()){let T=S.softwareDecrypt(a,D.key.buffer,D.iv.buffer,b);if(i.part>-1){const F=S.flush();T=F&&F.buffer}if(!T)return s.executeEnd=Wi(),xh(i);a=new Uint8Array(T)}else return this.asyncResult=!0,this.decryptionPromise=S.webCryptoDecrypt(a,D.key.buffer,D.iv.buffer,b).then(T=>{const L=this.push(T,null,i);return this.decryptionPromise=null,L}),this.decryptionPromise}const V=this.needsProbing(u,d);if(V){const S=this.configureTransmuxer(a);if(S)return this.logger.warn(`[transmuxer] ${S.message}`),this.observer.emit(O.ERROR,O.ERROR,{type:Pe.MEDIA_ERROR,details:se.FRAG_PARSING_ERROR,fatal:!1,error:S,reason:S.message}),s.executeEnd=Wi(),xh(i)}(u||d||g||V)&&this.resetInitSegment(k,v,x,R,t),(u||g||V)&&this.resetInitialTimestamp(E),c||this.resetContiguity();const H=this.transmux(a,D,m,h,i);this.asyncResult=gl(H);const C=this.currentTransmuxState;return C.contiguous=!0,C.discontinuity=!1,C.trackSwitch=!1,s.executeEnd=Wi(),H}flush(e){const t=e.transmuxing;t.executeStart=Wi();const{decrypter:i,currentTransmuxState:r,decryptionPromise:s}=this;if(s)return this.asyncResult=!0,s.then(()=>this.flush(e));const a=[],{timeOffset:o}=r;if(i){const d=i.flush();d&&a.push(this.push(d.buffer,null,e))}const{demuxer:l,remuxer:c}=this;if(!l||!c){t.executeEnd=Wi();const d=[xh(e)];return this.asyncResult?Promise.resolve(d):d}const u=l.flush(o);return gl(u)?(this.asyncResult=!0,u.then(d=>(this.flushRemux(a,d,e),a))):(this.flushRemux(a,u,e),this.asyncResult?Promise.resolve(a):a)}flushRemux(e,t,i){const{audioTrack:r,videoTrack:s,id3Track:a,textTrack:o}=t,{accurateTimeOffset:l,timeOffset:c}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${i.sn}${i.part>-1?" part: "+i.part:""} of ${this.id===Ce.MAIN?"level":"track"} ${i.level}`);const u=this.remuxer.remux(r,s,a,o,c,l,!0,this.id);e.push({remuxResult:u,chunkMeta:i}),i.transmuxing.executeEnd=Wi()}resetInitialTimestamp(e){const{demuxer:t,remuxer:i}=this;!t||!i||(t.resetTimeStamp(e),i.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,i,r,s){const{demuxer:a,remuxer:o}=this;!a||!o||(a.resetInitSegment(e,t,i,r),o.resetInitSegment(e,t,i,s))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,i,r,s){let a;return t&&t.method==="SAMPLE-AES"?a=this.transmuxSampleAes(e,t,i,r,s):a=this.transmuxUnencrypted(e,i,r,s),a}transmuxUnencrypted(e,t,i,r){const{audioTrack:s,videoTrack:a,id3Track:o,textTrack:l}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(s,a,o,l,t,i,!1,this.id),chunkMeta:r}}transmuxSampleAes(e,t,i,r,s){return this.demuxer.demuxSampleAes(e,t,i).then(a=>({remuxResult:this.remuxer.remux(a.audioTrack,a.videoTrack,a.id3Track,a.textTrack,i,r,!1,this.id),chunkMeta:s}))}configureTransmuxer(e){const{config:t,observer:i,typeSupported:r}=this;let s;for(let d=0,h=Jc.length;d<h;d++){var a;if((a=Jc[d].demux)!=null&&a.probe(e,this.logger)){s=Jc[d];break}}if(!s)return new Error("Failed to find demuxer by probing fragment data");const o=this.demuxer,l=this.remuxer,c=s.remux,u=s.demux;(!l||!(l instanceof c))&&(this.remuxer=new c(i,t,r,this.logger)),(!o||!(o instanceof u))&&(this.demuxer=new u(i,t,r,this.logger),this.probe=u.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new km(this.config)),e}}function jP(n,e){let t=null;return n.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const xh=n=>({remuxResult:{},chunkMeta:n});function gl(n){return"then"in n&&n.then instanceof Function}class GP{constructor(e,t,i,r,s){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=i,this.duration=r,this.defaultInitPts=s||null}}class HP{constructor(e,t,i,r,s,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=i,this.trackSwitch=r,this.timeOffset=s,this.initSegmentChange=a}}let hy=0;class TT{constructor(e,t,i,r){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=hy++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=l=>{const c=l.data,u=this.hls;if(!(!u||!(c!=null&&c.event)||c.instanceNo!==this.instanceNo))switch(c.event){case"init":{var d;const h=(d=this.workerContext)==null?void 0:d.objectURL;h&&self.URL.revokeObjectURL(h);break}case"transmuxComplete":{this.handleTransmuxComplete(c.data);break}case"flush":{this.onFlush(c.data);break}case"workerLog":{u.logger[c.data.logType]&&u.logger[c.data.logType](c.data.message);break}default:{c.data=c.data||{},c.data.frag=this.frag,c.data.part=this.part,c.data.id=this.id,u.trigger(c.event,c.data);break}}},this.onWorkerError=l=>{if(!this.hls)return;const c=new Error(`${l.message}  (${l.filename}:${l.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(O.ERROR,{type:Pe.OTHER_ERROR,details:se.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:c})};const s=e.config;this.hls=e,this.id=t,this.useWorker=!!s.enableWorker,this.onTransmuxComplete=i,this.onFlush=r;const a=(l,c)=>{c=c||{},c.frag=this.frag||void 0,l===O.ERROR&&(c=c,c.parent=this.id,c.part=this.part,this.error=c.error),this.hls.trigger(l,c)};this.observer=new Nm,this.observer.on(O.FRAG_DECRYPTED,a),this.observer.on(O.ERROR,a);const o=k_(s.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const l=this.hls.logger;if(s.workerPath||qD()){try{s.workerPath?(l.log(`loading Web Worker ${s.workerPath} for "${t}"`),this.workerContext=XD(s.workerPath)):(l.log(`injecting Web Worker for "${t}"`),this.workerContext=YD());const{worker:u}=this.workerContext;u.addEventListener("message",this.onWorkerMessage),u.addEventListener("error",this.onWorkerError),u.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:o,id:t,config:vt(s)})}catch(u){l.warn(`Error setting up "${t}" Web Worker, fallback to inline`,u),this.terminateWorker(),this.error=null,this.transmuxer=new dy(this.observer,o,s,"",t,e.logger)}return}}this.transmuxer=new dy(this.observer,o,s,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=hy++;const t=this.hls.config,i=k_(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:i,id:this.id,config:vt(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),QD(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,i,r,s,a,o,l,c,u){var d,h;c.transmuxing.start=self.performance.now();const{instanceNo:m,transmuxer:g}=this,v=a?a.start:s.start,x=s.decryptdata,E=this.frag,R=!(E&&s.cc===E.cc),k=!(E&&c.level===E.level),D=E?c.sn-E.sn:-1,V=this.part?c.part-this.part.index:-1,H=D===0&&c.id>1&&c.id===(E==null?void 0:E.stats.chunkCount),C=!k&&(D===1||D===0&&(V===1||H&&V<=0)),S=self.performance.now();(k||D||s.stats.parsing.start===0)&&(s.stats.parsing.start=S),a&&(V||!C)&&(a.stats.parsing.start=S);const b=!(E&&((d=s.initSegment)==null?void 0:d.url)===((h=E.initSegment)==null?void 0:h.url)),T=new HP(R,C,l,k,v,b);if(!C||R||b){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${s.type} sn: ${c.sn}${c.part>-1?" part: "+c.part:""} ${this.id===Ce.MAIN?"level":"track"}: ${c.level} id: ${c.id}
        discontinuity: ${R}
        trackSwitch: ${k}
        contiguous: ${C}
        accurateTimeOffset: ${l}
        timeOffset: ${v}
        initSegmentChange: ${b}`);const L=new GP(i,r,t,o,u);this.configureTransmuxer(L)}if(this.frag=s,this.part=a,this.workerContext)this.workerContext.worker.postMessage({instanceNo:m,cmd:"demux",data:e,decryptdata:x,chunkMeta:c,state:T},e instanceof ArrayBuffer?[e]:[]);else if(g){const L=g.push(e,x,c,T);gl(L)?L.then(F=>{this.handleTransmuxComplete(F)}).catch(F=>{this.transmuxerError(F,c,"transmuxer-interface push error")}):this.handleTransmuxComplete(L)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:i}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(i){const r=i.flush(e);gl(r)?r.then(s=>{this.handleFlushResult(s,e)}).catch(s=>{this.transmuxerError(s,e,"transmuxer-interface flush error")}):this.handleFlushResult(r,e)}}transmuxerError(e,t,i){this.hls&&(this.error=e,this.hls.trigger(O.ERROR,{type:Pe.MEDIA_ERROR,details:se.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:i}))}handleFlushResult(e,t){e.forEach(i=>{this.handleTransmuxComplete(i)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:i}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):i&&i.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const fy=100;class zP extends Mm{constructor(e,t,i){super(e,t,i,"audio-stream-controller",Ce.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(O.LEVEL_LOADED,this.onLevelLoaded,this),e.on(O.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(O.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(O.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(O.BUFFER_RESET,this.onBufferReset,this),e.on(O.BUFFER_CREATED,this.onBufferCreated,this),e.on(O.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(O.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(O.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(O.FRAG_LOADING,this.onFragLoading,this),e.on(O.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(O.LEVEL_LOADED,this.onLevelLoaded,this),e.off(O.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(O.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(O.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(O.BUFFER_RESET,this.onBufferReset,this),e.off(O.BUFFER_CREATED,this.onBufferCreated,this),e.off(O.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(O.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(O.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(O.FRAG_LOADING,this.onFragLoading,this),e.off(O.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:i,initPTS:r,timescale:s,trackId:a}){if(i===Ce.MAIN){const o=t.cc,l=this.fragCurrent;if(this.initPTS[o]={baseTime:r,timescale:s,trackId:a},this.log(`InitPTS for cc: ${o} found from main: ${r/s} (${r}/${s}) trackId: ${a}`),this.mainAnchor=t,this.state===he.WAITING_INIT_PTS){const c=this.waitingData;(!c&&!this.loadingParts||c&&c.frag.cc!==o)&&this.syncWithAnchor(t,c==null?void 0:c.frag)}else!this.hls.hasEnoughToStart&&l&&l.cc!==o?(l.abortRequests(),this.syncWithAnchor(t,l)):this.state===he.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var i;const r=((i=this.mainFragLoading)==null?void 0:i.frag)||null;if(t&&(r==null?void 0:r.cc)===t.cc)return;const s=(r||e).cc,a=this.getLevelDetails(),o=this.getLoadPosition(),l=GS(a,s,o);l&&(this.log(`Syncing with main frag at ${l.start} cc ${l.cc}`),this.startFragRequested=!1,this.nextLoadPosition=l.start,this.resetLoadingState(),this.state===he.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=he.STOPPED;return}const i=this.lastCurrentTime;this.stopLoad(),this.setInterval(fy),i>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),e=i,this.state=he.IDLE):this.state=he.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case he.IDLE:this.doTickIdle();break;case he.WAITING_TRACK:{const{levels:t,trackId:i}=this,r=t==null?void 0:t[i],s=r==null?void 0:r.details;if(s&&!this.waitForLive(r)){if(this.waitForCdnTuneIn(s))break;this.state=he.WAITING_INIT_PTS}break}case he.FRAG_LOADING_WAITING_RETRY:{var e;const t=performance.now(),i=this.retryDate;if(!i||t>=i||(e=this.media)!=null&&e.seeking){const{levels:r,trackId:s}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((r==null?void 0:r[s])||null),this.state=he.IDLE}break}case he.WAITING_INIT_PTS:{const t=this.waitingData;if(t){const{frag:i,part:r,cache:s,complete:a}=t,o=this.mainAnchor;if(this.initPTS[i.cc]!==void 0){this.waitingData=null,this.state=he.FRAG_LOADING;const l=s.flush().buffer,c={frag:i,part:r,payload:l,networkDetails:null};this._handleFragmentLoadProgress(c),a&&super._handleFragmentLoadComplete(c)}else o&&o.cc!==t.frag.cc&&this.syncWithAnchor(o,t.frag)}else this.state=he.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:i,media:r,trackId:s}=this,a=t.config;if(!this.buffering||!r&&!this.primaryPrefetch&&(this.startFragRequested||!a.startFragPrefetch)||!(i!=null&&i[s]))return;const o=i[s],l=o.details;if(!l||this.waitForLive(o)||this.waitForCdnTuneIn(l)){this.state=he.WAITING_TRACK,this.startFragRequested=!1;return}const c=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&c&&(this.bufferFlushed=!1,this.afterBufferFlushed(c,ht.AUDIO,Ce.AUDIO));const u=this.getFwdBufferInfo(c,Ce.AUDIO);if(u===null)return;if(!this.switchingTrack&&this._streamEnded(u,l)){t.trigger(O.BUFFER_EOS,{type:"audio"}),this.state=he.ENDED;return}const d=u.len,h=t.maxBufferLength,m=l.fragments,g=m[0].start,v=this.getLoadPosition(),x=this.flushing?v:u.end;if(this.switchingTrack&&r){const k=v;l.PTSKnown&&k<g&&(u.end>g||u.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=g+.05)}if(d>=h&&!this.switchingTrack&&x<m[m.length-1].start)return;let E=this.getNextFragment(x,l);if(E&&this.isLoopLoading(E,x)&&(E=this.getNextFragmentLoopLoading(E,l,u,Ce.MAIN,h)),!E){this.bufferFlushed=!0;return}let R=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&R&&Bt(E)&&!E.endList&&(!l.live||!this.loadingParts&&x<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(R)===Kt.OK&&(this.mainFragLoading=R=null),R&&Bt(R))){if(E.start>R.end){const D=this.fragmentTracker.getFragAtPos(x,Ce.MAIN);D&&D.end>R.end&&(R=D,this.mainFragLoading={frag:D,targetBufferTime:null})}if(E.start>R.end)return}this.loadFragment(E,o,x)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(i=>new hl(i))}onAudioTrackSwitching(e,t){const i=!!t.url;this.trackId=t.id;const{fragCurrent:r}=this;r&&(r.abortRequests(),this.removeUnbufferedFrags(r.start)),this.resetLoadingState(),i?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==he.STOPPED&&(this.setInterval(fy),this.state=he.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const i=this.cachedTrackLoadedData;i&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(O.AUDIO_TRACK_LOADED,i))}onAudioTrackLoaded(e,t){var i;const{levels:r}=this,{details:s,id:a,groupId:o,track:l}=t;if(!r){this.warn(`Audio tracks reset while loading track ${a} "${l.name}" of "${o}"`);return}const c=this.mainDetails;if(!c||s.endCC>c.endCC||c.expired){this.cachedTrackLoadedData=t,this.state!==he.STOPPED&&(this.state=he.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${a} "${l.name}" of "${o}" loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""},duration:${s.totalduration}`);const u=r[a];let d=0;if(s.live||(i=u.details)!=null&&i.live){if(this.checkLiveUpdate(s),s.deltaUpdateFailed)return;if(u.details){var h;d=this.alignPlaylists(s,u.details,(h=this.levelLastLoaded)==null?void 0:h.details)}s.alignedSliding||(nT(s,c),s.alignedSliding||Gu(s,c),d=s.fragmentStart)}u.details=s,this.levelLastLoaded=u,this.startFragRequested||this.setStartPosition(c,d),this.hls.trigger(O.AUDIO_TRACK_UPDATED,{details:s,id:a,groupId:t.groupId}),this.state===he.WAITING_TRACK&&!this.waitForCdnTuneIn(s)&&(this.state=he.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const i=e.frag,{part:r,payload:s}=e,{config:a,trackId:o,levels:l}=this;if(!l){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const c=l[o];if(!c){this.warn("Audio track is undefined on fragment load progress");return}const u=c.details;if(!u){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(i.start);return}const d=a.defaultAudioCodec||c.audioCodec||"mp4a.40.2";let h=this.transmuxer;h||(h=this.transmuxer=new TT(this.hls,Ce.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const m=this.initPTS[i.cc],g=(t=i.initSegment)==null?void 0:t.data;if(m!==void 0){const x=r?r.index:-1,E=x!==-1,R=new Dm(i.level,i.sn,i.stats.chunkCount,s.byteLength,x,E);h.push(s,g,d,"",i,r,u.totalduration,!1,R,m)}else{this.log(`Unknown video PTS for cc ${i.cc}, waiting for video PTS before demuxing audio frag ${i.sn} of [${u.startSN} ,${u.endSN}],track ${o}`);const{cache:v}=this.waitingData=this.waitingData||{frag:i,part:r,cache:new iT,complete:!1};v.push(new Uint8Array(s)),this.state!==he.STOPPED&&(this.state=he.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const i=t.tracks.audio;i&&(this.mediaBuffer=i.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===Ce.MAIN&&Bt(t.frag)&&(this.mainFragLoading=t,this.state===he.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:i,part:r}=t;if(i.type!==Ce.AUDIO){!this.audioOnly&&i.type===Ce.MAIN&&!i.elementaryStreams.video&&!i.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${r?" p: "+r.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(Bt(i)){this.fragPrevious=i;const s=this.switchingTrack;s&&(this.bufferedTrack=s,this.switchingTrack=null,this.hls.trigger(O.AUDIO_TRACK_SWITCHED,ct({},s)))}this.fragBufferedComplete(i,r),this.media&&this.tick()}onError(e,t){var i;if(t.fatal){this.state=he.ERROR;return}switch(t.details){case se.FRAG_GAP:case se.FRAG_PARSING_ERROR:case se.FRAG_DECRYPT_ERROR:case se.FRAG_LOAD_ERROR:case se.FRAG_LOAD_TIMEOUT:case se.KEY_LOAD_ERROR:case se.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Ce.AUDIO,t);break;case se.AUDIO_TRACK_LOAD_ERROR:case se.AUDIO_TRACK_LOAD_TIMEOUT:case se.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===he.WAITING_TRACK&&((i=t.context)==null?void 0:i.type)===qe.AUDIO_TRACK&&(this.state=he.IDLE);break;case se.BUFFER_ADD_CODEC_ERROR:case se.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case se.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case se.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==ht.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==ht.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===he.ENDED&&(this.state=he.IDLE);const i=this.mediaBuffer||this.media;i&&(this.afterBufferFlushed(i,t,Ce.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const i="audio",{hls:r}=this,{remuxResult:s,chunkMeta:a}=e,o=this.getCurrentContext(a);if(!o){this.resetWhenMissingContext(a);return}const{frag:l,part:c,level:u}=o,{details:d}=u,{audio:h,text:m,id3:g,initSegment:v}=s;if(this.fragContextChanged(l)||!d){this.fragmentTracker.removeFragment(l);return}if(this.state=he.PARSING,this.switchingTrack&&h&&this.completeAudioSwitch(this.switchingTrack),v!=null&&v.tracks){const x=l.initSegment||l;if(this.unhandledEncryptionError(v,l))return;this._bufferInitSegment(u,v.tracks,x,a),r.trigger(O.FRAG_PARSING_INIT_SEGMENT,{frag:x,id:i,tracks:v.tracks})}if(h){const{startPTS:x,endPTS:E,startDTS:R,endDTS:k}=h;c&&(c.elementaryStreams[ht.AUDIO]={startPTS:x,endPTS:E,startDTS:R,endDTS:k}),l.setElementaryStreamInfo(ht.AUDIO,x,E,R,k),this.bufferFragmentData(h,l,c,a)}if(g!=null&&(t=g.samples)!=null&&t.length){const x=ut({id:i,frag:l,details:d},g);r.trigger(O.FRAG_PARSING_METADATA,x)}if(m){const x=ut({id:i,frag:l,details:d},m);r.trigger(O.FRAG_PARSING_USERDATA,x)}}_bufferInitSegment(e,t,i,r){if(this.state!==he.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const s=t.audio;s.id=Ce.AUDIO;const a=e.audioCodec;this.log(`Init audio buffer, container:${s.container}, codecs[level/parsed]=[${a}/${s.codec}]`),a&&a.split(",").length===1&&(s.levelCodec=a),this.hls.trigger(O.BUFFER_CODECS,t);const o=s.initSegment;if(o!=null&&o.byteLength){const l={type:"audio",frag:i,part:null,chunkMeta:r,parent:i.type,data:o};this.hls.trigger(O.BUFFER_APPENDING,l)}this.tickImmediate()}loadFragment(e,t,i){const r=this.fragmentTracker.getState(e);if(this.switchingTrack||r===Kt.NOT_LOADED||r===Kt.PARTIAL){var s;if(!Bt(e))this._loadInitSegment(e,t);else if((s=t.details)!=null&&s.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=he.WAITING_INIT_PTS;const a=this.mainDetails;a&&a.fragmentStart!==t.details.fragmentStart&&Gu(t.details,a)}else super.loadFragment(e,t,i)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:i,assocLang:r,characteristics:s,audioCodec:a,channels:o}=this.bufferedTrack;ks({name:t,lang:i,assocLang:r,characteristics:s,audioCodec:a,channels:o},e,Ss)||(Uu(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(O.AUDIO_TRACK_SWITCHED,ct({},e))}}class Gm extends mi{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,i){const r=t==null?void 0:t.renditionReports;if(r){let s=-1;for(let a=0;a<r.length;a++){const o=r[a];let l;try{l=new self.URL(o.URI,t.url).href}catch(c){this.warn(`Could not construct new URL for Rendition Report: ${c}`),l=o.URI||""}if(l===e){s=a;break}else l===e.substring(0,l.length)&&(s=a)}if(s!==-1){const a=r[s],o=parseInt(a["LAST-MSN"])||t.lastPartSn;let l=parseInt(a["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const u=Math.min(t.age-t.partTarget,t.targetduration);l>=0&&u>t.partTarget&&(l+=1)}const c=i&&D_(i);return new P_(o,l>=0?l:void 0,c)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(i){this.warn(`Could not construct new URL with HLS Delivery Directives: ${i}`)}return e}playlistLoaded(e,t,i){const{details:r,stats:s}=t,a=self.performance.now(),o=s.loading.first?Math.max(0,a-s.loading.first):0;r.advancedDateTime=Date.now()-o;const l=this.hls.config.timelineOffset;if(l!==r.appliedTimelineOffset){const u=Math.max(l||0,0);r.appliedTimelineOffset=u,r.fragments.forEach(d=>{d.setStart(d.playlistOffset+u)})}if(r.live||i!=null&&i.live){const u="levelInfo"in t?t.levelInfo:t.track;if(r.reloaded(i),i&&r.fragments.length>0){FD(i,r,this);const R=r.playlistParsingError;if(R){this.warn(R);const k=this.hls;if(!k.config.ignorePlaylistParsingErrors){var c;const{networkDetails:D}=t;k.trigger(O.ERROR,{type:Pe.NETWORK_ERROR,details:se.LEVEL_PARSING_ERROR,fatal:!1,url:r.url,error:R,reason:R.message,level:t.level||void 0,parent:(c=r.fragments[0])==null?void 0:c.type,networkDetails:D,stats:s});return}r.playlistParsingError=null}}r.requestScheduled===-1&&(r.requestScheduled=s.loading.start);const d=this.hls.mainForwardBufferInfo,h=d?d.end-d.len:0,m=(r.edge-h)*1e3,g=QS(r,m);if(r.requestScheduled+g<a?r.requestScheduled=a:r.requestScheduled+=g,this.log(`live playlist ${e} ${r.advanced?"REFRESHED "+r.lastPartSn+"-"+r.lastPartIndex:r.updated?"UPDATED":"MISSED"}`),!this.canLoad||!r.live)return;let v,x,E;if(r.canBlockReload&&r.endSN&&r.advanced){const R=this.hls.config.lowLatencyMode,k=r.lastPartSn,D=r.endSN,V=r.lastPartIndex,H=V!==-1,C=k===D;H?C?(x=D+1,E=R?0:V):(x=k,E=R?V+1:r.maxPartIndex):x=D+1;const S=r.age,b=S+r.ageHeader;let T=Math.min(b-r.partTarget,r.targetduration*1.5);if(T>0){if(b>r.targetduration*3)this.log(`Playlist last advanced ${S.toFixed(2)}s ago. Omitting segment and part directives.`),x=void 0,E=void 0;else if(i!=null&&i.tuneInGoal&&b-r.partTarget>i.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${i.tuneInGoal} to: ${T} with playlist age: ${r.age}`),T=0;else{const L=Math.floor(T/r.targetduration);if(x+=L,E!==void 0){const F=Math.round(T%r.targetduration/r.partTarget);E+=F}this.log(`CDN Tune-in age: ${r.ageHeader}s last advanced ${S.toFixed(2)}s goal: ${T} skip sn ${L} to part ${E}`)}r.tuneInGoal=T}if(v=this.getDeliveryDirectives(r,t.deliveryDirectives,x,E),R||!C){r.requestScheduled=a,this.loadingPlaylist(u,v);return}}else(r.canBlockReload||r.canSkipUntil)&&(v=this.getDeliveryDirectives(r,t.deliveryDirectives,x,E));v&&x!==void 0&&r.canBlockReload&&(r.requestScheduled=s.loading.first+Math.max(g-o*2,g/2)),this.scheduleLoading(u,v,r)}else this.clearTimer()}scheduleLoading(e,t,i){const r=i||e.details;if(!r){this.loadingPlaylist(e,t);return}const s=self.performance.now(),a=r.requestScheduled;if(s>=a){this.loadingPlaylist(e,t);return}const o=a-s;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(o)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),o)}getDeliveryDirectives(e,t,i,r){let s=D_(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(i=t.msn,r=t.part,s=Yc.No),new P_(i,r,s)}checkRetry(e){const t=e.details,i=$u(e),r=e.errorAction,{action:s,retryCount:a=0,retryConfig:o}=r||{},l=!!r&&!!o&&(s===ln.RetryRequest||!r.resolved&&s===ln.SendAlternateToPenaltyBox);if(l){var c;if(a>=o.maxNumRetry)return!1;if(i&&(c=e.context)!=null&&c.deliveryDirectives)this.warn(`Retrying playlist loading ${a+1}/${o.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const u=Cm(o,a);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),u),this.warn(`Retrying playlist loading ${a+1}/${o.maxNumRetry} after "${t}" in ${u}ms`)}e.levelRetry=!0,r.resolved=!0}return l}}function AT(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!_l(n[t].attrs,e[t].attrs))return!1;return!0}function _l(n,e,t){const i=n["STABLE-RENDITION-ID"];return i&&!t?i===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(r=>n[r]!==e[r])}function Jf(n,e){return e.label.toLowerCase()===n.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(n.lang||"").toLowerCase())}class KP extends Gm{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.MANIFEST_PARSED,this.onManifestParsed,this),e.on(O.LEVEL_LOADING,this.onLevelLoading,this),e.on(O.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(O.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(O.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.MANIFEST_PARSED,this.onManifestParsed,this),e.off(O.LEVEL_LOADING,this.onLevelLoading,this),e.off(O.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(O.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(O.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:i,groupId:r,details:s}=t,a=this.tracksInGroup[i];if(!a||a.groupId!==r){this.warn(`Audio track with id:${i} and group:${r} not found in active group ${a==null?void 0:a.groupId}`);return}const o=a.details;a.details=t.details,this.log(`Audio track ${i} "${a.name}" lang:${a.lang} group:${r} loaded [${s.startSN}-${s.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const i=t.audioGroups||null,r=this.groupIds;let s=this.currentTrack;if(!i||(r==null?void 0:r.length)!==(i==null?void 0:i.length)||i!=null&&i.some(o=>(r==null?void 0:r.indexOf(o))===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(h=>!i||i.indexOf(h.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(h=>h.default)&&(this.selectDefaultTrack=!1),o.forEach((h,m)=>{h.id=m});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const l=this.hls.config.audioPreference;if(!s&&l){const h=wi(l,o,Ss);if(h>-1)s=o[h];else{const m=wi(l,this.tracks);s=this.tracks[m]}}let c=this.findTrackId(s);c===-1&&s&&(c=this.findTrackId(null));const u={audioTracks:o};this.log(`Updating audio tracks, ${o.length} track(s) found in group(s): ${i==null?void 0:i.join(",")}`),this.hls.trigger(O.AUDIO_TRACKS_UPDATED,u);const d=this.trackId;if(c!==-1&&d===-1)this.setAudioTrack(c);else if(o.length&&d===-1){var a;const h=new Error(`No audio track selected for current audio group-ID(s): ${(a=this.groupIds)==null?void 0:a.join(",")} track count: ${o.length}`);this.warn(h.message),this.hls.trigger(O.ERROR,{type:Pe.MEDIA_ERROR,details:se.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:h})}}}onError(e,t){t.fatal||!t.context||t.context.type===qe.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const i=this.allAudioTracks;if(this.selectDefaultTrack=!1,i.length){const r=this.currentTrack;if(r&&ks(e,r,Ss))return r;const s=wi(e,this.tracksInGroup,Ss);if(s>-1){const a=this.tracksInGroup[s];return this.setAudioTrack(s),a}else if(r){let a=t.loadLevel;a===-1&&(a=t.firstAutoLevel);const o=iD(e,t.levels,i,a,Ss);if(o===-1)return null;t.nextLoadLevel=o}if(e.channels||e.audioCodec){const a=wi(e,i);if(a>-1)return i[a]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const i=this.currentTrack,r=t[e],s=r.details&&!r.details.live;if(e===this.trackId&&r===i&&s||(this.log(`Switching to audio-track ${e} "${r.name}" lang:${r.lang} group:${r.groupId} channels:${r.channels}`),this.trackId=e,this.currentTrack=r,this.hls.trigger(O.AUDIO_TRACK_SWITCHING,ct({},r)),s))return;const a=this.switchParams(r.url,i==null?void 0:i.details,r.details);this.loadPlaylist(a)}findTrackId(e){const t=this.tracksInGroup;for(let i=0;i<t.length;i++){const r=t[i];if(!(this.selectDefaultTrack&&!r.default)&&(!e||ks(e,r,Ss)))return i}if(e){const{name:i,lang:r,assocLang:s,characteristics:a,audioCodec:o,channels:l}=e;for(let c=0;c<t.length;c++){const u=t[c];if(ks({name:i,lang:r,assocLang:s,characteristics:a,audioCodec:o,channels:l},u,Ss))return c}for(let c=0;c<t.length;c++){const u=t[c];if(_l(e.attrs,u.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return c}for(let c=0;c<t.length;c++){const u=t[c];if(_l(e.attrs,u.attrs,["LANGUAGE"]))return c}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&Uu(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const i=e.id,r=e.groupId,s=this.getUrlWithDirectives(e.url,t),a=e.details,o=a==null?void 0:a.age;this.log(`Loading audio-track ${i} "${e.name}" lang:${e.lang} group:${r}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${s}`),this.hls.trigger(O.AUDIO_TRACK_LOADING,{url:s,id:i,groupId:r,deliveryDirectives:t||null,track:e})}}class WP{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,i){if(this.queues===null||this.tracks===null)return;const r=this.queues[t];r.push(e),r.length===1&&!i&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const i={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(i,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const i={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(i)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const i=(t=e[0])==null?void 0:t.label;(i==="async-blocker"||i==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const r=t[0];try{r.execute()}catch(s){var i;if(r.onError(s),this.queues===null||this.tracks===null)return;const a=(i=this.tracks[e])==null?void 0:i.buffer;a!=null&&a.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,i;return(t=this.queues)!=null&&t[e]||(i=this.tracks)!=null&&i[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const i=(t=this.tracks)==null?void 0:t[e],r=i==null?void 0:i.buffer;return r?`SourceBuffer${r.updating?" updating":""}${i.ended?" ended":""}${i.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(i=>i.label).join(", "))||""}}const py=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,xT="HlsJsTrackRemovedError";class qP extends Error{constructor(e){super(e),this.name=xT}}class YP extends mi{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=i=>{var r;this.hls&&((r=this.mediaSource)==null?void 0:r.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=i=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=i=>{const{media:r,mediaSource:s}=this;i&&this.log("Media source opened"),!(!r||!s)&&(s.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(O.MEDIA_ATTACHED,{media:r,mediaSource:s}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:i,_objectUrl:r}=this;i!==r&&this.error(`Media element src was set while attaching MediaSource (${r} > ${i})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=Sk(Zr(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(O.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.MANIFEST_PARSED,this.onManifestParsed,this),e.on(O.BUFFER_RESET,this.onBufferReset,this),e.on(O.BUFFER_APPENDING,this.onBufferAppending,this),e.on(O.BUFFER_CODECS,this.onBufferCodecs,this),e.on(O.BUFFER_EOS,this.onBufferEos,this),e.on(O.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(O.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(O.FRAG_PARSED,this.onFragParsed,this),e.on(O.FRAG_CHANGED,this.onFragChanged,this),e.on(O.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(O.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.MANIFEST_PARSED,this.onManifestParsed,this),e.off(O.BUFFER_RESET,this.onBufferReset,this),e.off(O.BUFFER_APPENDING,this.onBufferAppending,this),e.off(O.BUFFER_CODECS,this.onBufferCodecs,this),e.off(O.BUFFER_EOS,this.onBufferEos,this),e.off(O.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(O.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(O.FRAG_PARSED,this.onFragParsed,this),e.off(O.FRAG_CHANGED,this.onFragChanged,this),e.off(O.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const i={};if(this.operationQueue){const s=this.isUpdating();s||this.operationQueue.removeBlockers();const a=this.isQueued();(s||a)&&this.warn(`Transfering MediaSource with${a?" operations in queue":""}${s?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const r=this.transferData;return!this.sourceBufferCount&&r&&r.mediaSource===t?ut(i,r.tracks):this.sourceBuffers.forEach(s=>{const[a]=s;a&&(i[a]=ut({},this.tracks[a]),this.removeBuffer(a)),s[0]=s[1]=null}),{media:e,mediaSource:t,tracks:i}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var i;let r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsTotal=r,this.log(`${r} bufferCodec event(s) expected.`),(i=this.transferData)!=null&&i.mediaSource&&this.sourceBufferCount&&r&&this.bufferCreated()}onMediaAttaching(e,t){const i=this.media=t.media;this.transferData=this.overrides=void 0;const r=Zr(this.appendSource);if(r){const s=!!t.mediaSource;(s||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const a=this.mediaSource=t.mediaSource||new r;if(this.assignMediaSource(a),s)this._objectUrl=i.src,this.attachTransferred();else{const o=this._objectUrl=self.URL.createObjectURL(a);if(this.appendSource)try{i.removeAttribute("src");const l=self.ManagedMediaSource;i.disableRemotePlayback=i.disableRemotePlayback||l&&a instanceof l,my(i),XP(i,o),i.load()}catch{i.src=o}else i.src=o}i.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,i;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(i=e.constructor)==null?void 0:i.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const i=this.tracks,r=t.tracks,s=r?Object.keys(r):null,a=s?s.length:0,o=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(r&&s&&a){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${vt(i,(l,c)=>l==="initSegment"?void 0:c)};
transfer tracks: ${vt(r,(l,c)=>l==="initSegment"?void 0:c)}}`),!IS(r,i)){t.mediaSource=null,t.tracks=void 0;const l=e.currentTime,c=this.details,u=Math.max(l,(c==null?void 0:c.fragments[0].start)||0);if(u-l>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${l} -> ${u}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(r)}"->"${Object.keys(i)}") start time: ${u} currentTime: ${l}`),this.onMediaDetaching(O.MEDIA_DETACHING,{}),this.onMediaAttaching(O.MEDIA_ATTACHING,t),e.currentTime=u;return}this.transferData=void 0,s.forEach(l=>{const c=l,u=r[c];if(u){const d=u.buffer;if(d){const h=this.fragmentTracker,m=u.id;if(h.hasFragments(m)||h.hasParts(m)){const x=Ge.getBuffered(d);h.detectEvictedFragments(c,x,m,null,!0)}const g=bh(c),v=[c,d];this.sourceBuffers[g]=v,d.updating&&this.operationQueue&&this.operationQueue.prependBlocker(c),this.trackSourceBuffer(c,u)}}}),o(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),o()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const i=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:r,mediaSource:s,_objectUrl:a}=this;if(s){if(this.log(`media source ${i?"transferring":"detaching"}`),i)this.sourceBuffers.forEach(([o])=>{o&&this.removeBuffer(o)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const o=s.readyState==="open";try{const l=s.sourceBuffers;for(let c=l.length;c--;)o&&l[c].abort(),s.removeSourceBuffer(l[c]);o&&s.endOfStream()}catch(l){this.warn(`onMediaDetaching: ${l.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}s.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("sourceended",this._onMediaSourceEnded),s.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(s.removeEventListener("startstreaming",this._onStartStreaming),s.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}r&&(r.removeEventListener("emptied",this._onMediaEmptied),i||(a&&self.URL.revokeObjectURL(a),this.mediaSrc===a?(r.removeAttribute("src"),this.appendSource&&my(r),r.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(O.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const i=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),i)try{var r;(r=this.mediaSource)!=null&&r.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(i)}catch(s){this.warn(`onBufferReset ${e}`,s)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[bh(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new WP(this.tracks)}onBufferCodecs(e,t){const i=this.tracks,r=Object.keys(t);this.log(`BUFFER_CODECS: "${r}" (current SB count ${this.sourceBufferCount})`);const s="audiovideo"in t&&(i.audio||i.video)||i.audiovideo&&("audio"in t||"video"in t),a=!s&&this.sourceBufferCount&&this.media&&r.some(o=>!i[o]);if(s||a){this.warn(`Unsupported transition between "${Object.keys(i)}" and "${r}" SourceBuffers`);return}r.forEach(o=>{var l,c;const u=t[o],{id:d,codec:h,levelCodec:m,container:g,metadata:v,supplemental:x}=u;let E=i[o];const R=(l=this.transferData)==null||(l=l.tracks)==null?void 0:l[o],k=R!=null&&R.buffer?R:E,D=(k==null?void 0:k.pendingCodec)||(k==null?void 0:k.codec),V=k==null?void 0:k.levelCodec;E||(E=i[o]={buffer:void 0,listeners:[],codec:h,supplemental:x,container:g,levelCodec:m,metadata:v,id:d});const H=qc(D,V),C=H==null?void 0:H.replace(py,"$1");let S=qc(h,m);const b=(c=S)==null?void 0:c.replace(py,"$1");S&&H&&C!==b&&(o.slice(0,5)==="audio"&&(S=Bu(S,this.appendSource)),this.log(`switching codec ${D} to ${S}`),S!==(E.pendingCodec||E.codec)&&(E.pendingCodec=S),E.container=g,this.appendChangeType(o,g,S))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&this.mediaSourceOpenOrEnded&&this.checkPendingTracks()}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const i=this.tracks[t];return e[t]={id:i.id,container:i.container,codec:i.codec,levelCodec:i.levelCodec},e},{})}appendChangeType(e,t,i){const r=`${t};codecs=${i}`,s={label:`change-type=${r}`,execute:()=>{const a=this.tracks[e];if(a){const o=a.buffer;o!=null&&o.changeType&&(this.log(`changing ${e} sourceBuffer type to ${r}`),o.changeType(r),a.codec=i,a.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:a=>{this.warn(`Failed to change ${e} SourceBuffer type`,a)}};this.append(s,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const i=e.start,r=i+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(i,Ce.MAIN))==null?void 0:t.gap)===!0)return;const a={label:"block-audio",execute:()=>{var o;const l=this.tracks.video;(this.lastVideoAppendEnd>r||l!=null&&l.buffer&&Ge.isBuffered(l.buffer,r)||((o=this.fragmentTracker.getAppendedFrag(r,Ce.MAIN))==null?void 0:o.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn("Error executing block-audio operation",o)}};this.blockedAudioAppend={op:a,frag:e},this.append(a,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:i}=this,{data:r,type:s,parent:a,frag:o,part:l,chunkMeta:c,offset:u}=t,d=c.buffering[s],{sn:h,cc:m}=o,g=self.performance.now();d.start=g;const v=o.stats.buffering,x=l?l.stats.buffering:null;v.start===0&&(v.start=g),x&&x.start===0&&(x.start=g);const E=i.audio;let R=!1;s==="audio"&&(E==null?void 0:E.container)==="audio/mpeg"&&(R=!this.lastMpegAudioChunk||c.id===1||this.lastMpegAudioChunk.sn!==c.sn,this.lastMpegAudioChunk=c);const k=i.video,D=k==null?void 0:k.buffer;if(D&&h!=="initSegment"){const C=l||o,S=this.blockedAudioAppend;if(s==="audio"&&a!=="main"&&!this.blockedAudioAppend&&!(k.ending||k.ended)){const T=C.start+C.duration*.05,L=D.buffered,F=this.currentOp("video");!L.length&&!F?this.blockAudio(C):!F&&!Ge.isBuffered(D,T)&&this.lastVideoAppendEnd<T&&this.blockAudio(C)}else if(s==="video"){const b=C.end;if(S){const T=S.frag.start;(b>T||b<this.lastVideoAppendEnd||Ge.isBuffered(D,T))&&this.unblockAudio()}this.lastVideoAppendEnd=b}}const V=(l||o).start,H={label:`append-${s}`,execute:()=>{var C;d.executeStart=self.performance.now();const S=(C=this.tracks[s])==null?void 0:C.buffer;S&&(R?this.updateTimestampOffset(S,V,.1,s,h,m):u!==void 0&&Re(u)&&this.updateTimestampOffset(S,u,1e-6,s,h,m)),this.appendExecutor(r,s)},onStart:()=>{},onComplete:()=>{const C=self.performance.now();d.executeEnd=d.end=C,v.first===0&&(v.first=C),x&&x.first===0&&(x.first=C);const S={};this.sourceBuffers.forEach(([b,T])=>{b&&(S[b]=Ge.getBuffered(T))}),this.appendErrors[s]=0,s==="audio"||s==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(O.BUFFER_APPENDED,{type:s,frag:o,part:l,chunkMeta:c,parent:o.type,timeRanges:S})},onError:C=>{var S;const b={type:Pe.MEDIA_ERROR,parent:o.type,details:se.BUFFER_APPEND_ERROR,sourceBufferName:s,frag:o,part:l,chunkMeta:c,error:C,err:C,fatal:!1},T=(S=this.media)==null?void 0:S.error;if(C.code===DOMException.QUOTA_EXCEEDED_ERR||C.name=="QuotaExceededError"||"quota"in C)b.details=se.BUFFER_FULL_ERROR;else if(C.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!T)b.errorAction=fl(!0);else if(C.name===xT&&this.sourceBufferCount===0)b.errorAction=fl(!0);else{const L=++this.appendErrors[s];this.warn(`Failed ${L}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${s}" sourceBuffer (${T||"no media error"})`),(L>=this.hls.config.appendErrorMaxRetry||T)&&(b.fatal=!0)}this.hls.trigger(O.ERROR,b)}};this.append(H,s,this.isPending(this.tracks[s]))}getFlushOp(e,t,i){return this.log(`queuing "${e}" remove ${t}-${i}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,i)},onStart:()=>{},onComplete:()=>{this.hls.trigger(O.BUFFER_FLUSHED,{type:e})},onError:r=>{this.warn(`Failed to remove ${t}-${i} from "${e}" SourceBuffer`,r)}}}onBufferFlushing(e,t){const{type:i,startOffset:r,endOffset:s}=t;i?this.append(this.getFlushOp(i,r,s),i):this.sourceBuffers.forEach(([a])=>{a&&this.append(this.getFlushOp(a,r,s),a)})}onFragParsed(e,t){const{frag:i,part:r}=t,s=[],a=r?r.elementaryStreams:i.elementaryStreams;a[ht.AUDIOVIDEO]?s.push("audiovideo"):(a[ht.AUDIO]&&s.push("audio"),a[ht.VIDEO]&&s.push("video"));const o=()=>{const l=self.performance.now();i.stats.buffering.end=l,r&&(r.stats.buffering.end=l);const c=r?r.stats:i.stats;this.hls.trigger(O.FRAG_BUFFERED,{frag:i,part:r,stats:c,id:i.type})};s.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${i.type} level: ${i.level} sn: ${i.sn}`),this.blockBuffers(o,s).catch(l=>{this.warn(`Fragment buffered callback ${l}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var i;this.sourceBuffers.forEach(([a])=>{if(a){const o=this.tracks[a];(!t.type||t.type===a)&&(o.ending=!0,o.ended||(o.ended=!0,this.log(`${a} buffer reached EOS`)))}});const r=((i=this.overrides)==null?void 0:i.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([a])=>{var o;return a&&!((o=this.tracks[a])!=null&&o.ended)})?r?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:a}=this;if(!a||a.readyState!=="open"){a&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${a.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),a.endOfStream(),this.hls.trigger(O.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(O.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===se.BUFFER_APPEND_ERROR&&t.frag){var i;const r=(i=t.errorAction)==null?void 0:i.nextAutoLevel;Re(r)&&r!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:i}=this;if(!i||t===null||!this.sourceBufferCount)return;const r=e.config,s=i.currentTime,a=t.levelTargetDuration,o=t.live&&r.liveBackBufferLength!==null?r.liveBackBufferLength:r.backBufferLength;if(Re(o)&&o>=0){const c=Math.max(o,a),u=Math.floor(s/a)*a-c;this.flushBackBuffer(s,a,u)}const l=r.frontBufferFlushThreshold;if(Re(l)&&l>0){const c=Math.max(r.maxBufferLength,l),u=Math.max(c,a),d=Math.floor(s/a)*a+u;this.flushFrontBuffer(s,a,d)}}flushBackBuffer(e,t,i){this.sourceBuffers.forEach(([r,s])=>{if(s){const o=Ge.getBuffered(s);if(o.length>0&&i>o.start(0)){var a;this.hls.trigger(O.BACK_BUFFER_REACHED,{bufferEnd:i});const l=this.tracks[r];if((a=this.details)!=null&&a.live)this.hls.trigger(O.LIVE_BACK_BUFFER_REACHED,{bufferEnd:i});else if(l!=null&&l.ended){this.log(`Cannot flush ${r} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(O.BUFFER_FLUSHING,{startOffset:0,endOffset:i,type:r})}}})}flushFrontBuffer(e,t,i){this.sourceBuffers.forEach(([r,s])=>{if(s){const a=Ge.getBuffered(s),o=a.length;if(o<2)return;const l=a.start(o-1),c=a.end(o-1);if(i>l||e>=l&&e<=c)return;this.hls.trigger(O.BUFFER_FLUSHING,{startOffset:l,endOffset:1/0,type:r})}})}getDurationAndRange(){var e;const{details:t,mediaSource:i}=this;if(!t||!this.media||(i==null?void 0:i.readyState)!=="open")return null;const r=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&i.setLiveSeekableRange){const c=Math.max(0,t.fragmentStart),u=Math.max(c,r);return{duration:1/0,start:c,end:u}}return{duration:1/0}}const s=(e=this.overrides)==null?void 0:e.duration;if(s)return Re(s)?{duration:s}:null;const a=this.media.duration,o=Re(i.duration)?i.duration:0;return r>o&&r>a||!Re(a)?{duration:r}:null}updateMediaSource({duration:e,start:t,end:i}){const r=this.mediaSource;!this.media||!r||r.readyState!=="open"||(r.duration!==e&&(Re(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),r.duration=e),t!==void 0&&i!==void 0&&(this.log(`MediaSource duration is set to ${r.duration}. Setting seekable range to ${t}-${i}.`),r.setLiveSeekableRange(t,i)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:i}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${vt(i)}`),this.tracksReady){var r;const s=(r=this.transferData)==null?void 0:r.tracks;s&&Object.keys(s).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,i])=>{if(t){const r=this.tracks[t];e[t]={buffer:i,container:r.container,codec:r.codec,supplemental:r.supplemental,levelCodec:r.levelCodec,id:r.id,metadata:r.metadata}}}),this.hls.trigger(O.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(O.ERROR,{type:Pe.MEDIA_ERROR,details:se.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:i}=this;if(!i)throw new Error("createSourceBuffers called when mediaSource was null");for(const s in e){const a=s,o=e[a];if(this.isPending(o)){const l=this.getTrackCodec(o,a),c=`${o.container};codecs=${l}`;o.codec=l,this.log(`creating sourceBuffer(${c})${this.currentOp(a)?" Queued":""} ${vt(o)}`);try{const u=i.addSourceBuffer(c),d=bh(a),h=[a,u];t[d]=h,o.buffer=u}catch(u){var r;this.error(`error while trying to add sourceBuffer: ${u.message}`),this.shiftAndExecuteNext(a),(r=this.operationQueue)==null||r.removeBlockers(),delete this.tracks[a],this.hls.trigger(O.ERROR,{type:Pe.MEDIA_ERROR,details:se.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:u,sourceBufferName:a,mimeType:c,parent:o.id});return}this.trackSourceBuffer(a,o)}}this.bufferCreated()}getTrackCodec(e,t){const i=e.supplemental;let r=e.codec;i&&(t==="video"||t==="audiovideo")&&Gf(i,"video")&&(r=$k(r,i));const s=qc(r,e.levelCodec);return s?t.slice(0,5)==="audio"?Bu(s,this.appendSource):s:""}trackSourceBuffer(e,t){const i=t.buffer;if(!i)return;const r=this.getTrackCodec(t,e);this.tracks[e]={buffer:i,codec:r,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(s,a)=>{const o=a.removedRanges;o!=null&&o.length&&this.hls.trigger(O.BUFFER_FLUSHED,{type:s})})}get mediaSrc(){var e,t;const i=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return i==null?void 0:i.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const i=this.currentOp(e);i&&(i.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var i;const r=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(i=this.mediaSource)==null?void 0:i.readyState}`);this.error(`${r}`,t),this.hls.trigger(O.ERROR,{type:Pe.MEDIA_ERROR,details:se.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:r,fatal:!1});const s=this.currentOp(e);s&&s.onError(r)}updateTimestampOffset(e,t,i,r,s,a){const o=t-e.timestampOffset;Math.abs(o)>=i&&(this.log(`Updating ${r} SourceBuffer timestampOffset to ${t} (sn: ${s} cc: ${a})`),e.timestampOffset=t)}removeExecutor(e,t,i){const{media:r,mediaSource:s}=this,a=this.tracks[e],o=a==null?void 0:a.buffer;if(!r||!s||!o){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const l=Re(r.duration)?r.duration:1/0,c=Re(s.duration)?s.duration:1/0,u=Math.max(0,t),d=Math.min(i,l,c);d>u&&(!a.ending||a.ended)?(a.ended=!1,this.log(`Removing [${u},${d}] from the ${e} SourceBuffer`),o.remove(u,d)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const i=this.tracks[t],r=i==null?void 0:i.buffer;if(!r)throw new qP(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);i.ending=!1,i.ended=!1,r.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:i}=this,r=t.map(a=>this.appendBlocker(a));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(r).then(a=>{i===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var i;const r=(i=this.tracks[t])==null?void 0:i.buffer;!r||r.updating||this.shiftAndExecuteNext(t)})}append(e,t,i){this.operationQueue&&this.operationQueue.append(e,t,i)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,i){const r=this.tracks[e];if(!r)return;const s=r.buffer;if(!s)return;const a=i.bind(this,e);r.listeners.push({event:t,listener:a}),s.addEventListener(t,a)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const i=t.buffer;i&&(t.listeners.forEach(r=>{i.removeEventListener(r.event,r.listener)}),t.listeners.length=0)}}function my(n){const e=n.querySelectorAll("source");[].slice.call(e).forEach(t=>{n.removeChild(t)})}function XP(n,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,n.appendChild(t)}function bh(n){return n==="audio"?1:0}class Hm{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(O.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(O.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(O.MANIFEST_PARSED,this.onManifestParsed,this),e.on(O.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(O.BUFFER_CODECS,this.onBufferCodecs,this),e.on(O.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(O.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(O.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(O.MANIFEST_PARSED,this.onManifestParsed,this),e.off(O.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(O.BUFFER_CODECS,this.onBufferCodecs,this),e.off(O.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const i=this.hls.levels[t.droppedLevel];this.isLevelAllowed(i)&&this.restrictedLevels.push({bitrate:i.bitrate,height:i.height,width:i.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const i=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,i.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&Re(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,i=this.getMaxLevel(e.length-1);i!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${i}: ${e[i].height}p@${e[i].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=i,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const i=t.filter((r,s)=>this.isLevelAllowed(r)&&s<=e);return this.clientRect=null,Hm.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const i=e.getBoundingClientRect();t.width=i.width,t.height=i.height,!t.width&&!t.height&&(t.width=i.right-i.left||e.width||0,t.height=i.bottom-i.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(i=>e.bitrate===i.bitrate&&e.width===i.width&&e.height===i.height)}static getMaxLevelByMediaSize(e,t,i){if(!(e!=null&&e.length))return-1;const r=(o,l)=>l?o.width!==l.width||o.height!==l.height:!0;let s=e.length-1;const a=Math.max(t,i);for(let o=0;o<e.length;o+=1){const l=e[o];if((l.width>=a||l.height>=a)&&r(l,e[o+1])){s=o;break}}return s}}const QP={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Tn=QP,JP={HLS:"h"},ZP=JP;class Ni{constructor(e,t){Array.isArray(e)&&(e=e.map(i=>i instanceof Ni?i:new Ni(i))),this.value=e,this.params=t}}const eO="Dict";function tO(n){return Array.isArray(n)?JSON.stringify(n):n instanceof Map?"Map{}":n instanceof Set?"Set{}":typeof n=="object"?JSON.stringify(n):String(n)}function nO(n,e,t,i){return new Error(`failed to ${n} "${tO(e)}" as ${t}`,{cause:i})}function Bi(n,e,t){return nO("serialize",n,e,t)}class bT{constructor(e){this.description=e}}const gy="Bare Item",iO="Boolean";function rO(n){if(typeof n!="boolean")throw Bi(n,iO);return n?"?1":"?0"}function sO(n){return btoa(String.fromCharCode(...n))}const aO="Byte Sequence";function oO(n){if(ArrayBuffer.isView(n)===!1)throw Bi(n,aO);return`:${sO(n)}:`}const lO="Integer";function cO(n){return n<-999999999999999||999999999999999<n}function IT(n){if(cO(n))throw Bi(n,lO);return n.toString()}function uO(n){return`@${IT(n.getTime()/1e3)}`}function RT(n,e){if(n<0)return-RT(-n,e);const t=Math.pow(10,e);if(Math.abs(n*t%1-.5)<Number.EPSILON){const r=Math.floor(n*t);return(r%2===0?r:r+1)/t}else return Math.round(n*t)/t}const dO="Decimal";function hO(n){const e=RT(n,3);if(Math.floor(Math.abs(e)).toString().length>12)throw Bi(n,dO);const t=e.toString();return t.includes(".")?t:`${t}.0`}const fO="String",pO=/[\x00-\x1f\x7f]+/;function mO(n){if(pO.test(n))throw Bi(n,fO);return`"${n.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function gO(n){return n.description||n.toString().slice(7,-1)}const _O="Token";function _y(n){const e=gO(n);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw Bi(e,_O);return e}function Zf(n){switch(typeof n){case"number":if(!Re(n))throw Bi(n,gy);return Number.isInteger(n)?IT(n):hO(n);case"string":return mO(n);case"symbol":return _y(n);case"boolean":return rO(n);case"object":if(n instanceof Date)return uO(n);if(n instanceof Uint8Array)return oO(n);if(n instanceof bT)return _y(n);default:throw Bi(n,gy)}}const yO="Key";function ep(n){if(/^[a-z*][a-z0-9\-_.*]*$/.test(n)===!1)throw Bi(n,yO);return n}function zm(n){return n==null?"":Object.entries(n).map(([e,t])=>t===!0?`;${ep(e)}`:`;${ep(e)}=${Zf(t)}`).join("")}function LT(n){return n instanceof Ni?`${Zf(n.value)}${zm(n.params)}`:Zf(n)}function vO(n){return`(${n.value.map(LT).join(" ")})${zm(n.params)}`}function EO(n,e={whitespace:!0}){if(typeof n!="object"||n==null)throw Bi(n,eO);const t=n instanceof Map?n.entries():Object.entries(n),i=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([r,s])=>{s instanceof Ni||(s=new Ni(s));let a=ep(r);return s.value===!0?a+=zm(s.params):(a+="=",Array.isArray(s.value)?a+=vO(s):a+=LT(s)),a}).join(`,${i}`)}function wT(n,e){return EO(n,e)}const Ei="CMCD-Object",wt="CMCD-Request",gs="CMCD-Session",br="CMCD-Status",SO={br:Ei,ab:Ei,d:Ei,ot:Ei,tb:Ei,tpb:Ei,lb:Ei,tab:Ei,lab:Ei,url:Ei,pb:wt,bl:wt,tbl:wt,dl:wt,ltc:wt,mtp:wt,nor:wt,nrr:wt,rc:wt,sn:wt,sta:wt,su:wt,ttfb:wt,ttfbb:wt,ttlb:wt,cmsdd:wt,cmsds:wt,smrt:wt,df:wt,cs:wt,ts:wt,cid:gs,pr:gs,sf:gs,sid:gs,st:gs,v:gs,msd:gs,bs:br,bsd:br,cdn:br,rtp:br,bg:br,pt:br,ec:br,e:br},TO={REQUEST:wt};function AO(n){return Object.keys(n).reduce((e,t)=>{var i;return(i=n[t])===null||i===void 0||i.forEach(r=>e[r]=t),e},{})}function xO(n,e){const t={};if(!n)return t;const i=Object.keys(n),r=e?AO(e):{};return i.reduce((s,a)=>{var o;const l=SO[a]||r[a]||TO.REQUEST,c=(o=s[l])!==null&&o!==void 0?o:s[l]={};return c[a]=n[a],s},t)}function bO(n){return["ot","sf","st","e","sta"].includes(n)}function IO(n){return typeof n=="number"?Re(n):n!=null&&n!==""&&n!==!1}const CT="event";function RO(n,e){const t=new URL(n),i=new URL(e);if(t.origin!==i.origin)return n;const r=t.pathname.split("/").slice(1),s=i.pathname.split("/").slice(1,-1);for(;r[0]===s[0];)r.shift(),s.shift();for(;s.length;)s.shift(),r.unshift("..");return r.join("/")+t.search+t.hash}const Zc=n=>Math.round(n),tp=(n,e)=>Array.isArray(n)?n.map(t=>tp(t,e)):n instanceof Ni&&typeof n.value=="string"?new Ni(tp(n.value,e),n.params):(e.baseUrl&&(n=RO(n,e.baseUrl)),e.version===1?encodeURIComponent(n):n),Ac=n=>Zc(n/100)*100,LO=(n,e)=>{let t=n;return e.version>=2&&(n instanceof Ni&&typeof n.value=="string"?t=new Ni([n]):typeof n=="string"&&(t=[n])),tp(t,e)},wO={br:Zc,d:Zc,bl:Ac,dl:Ac,mtp:Ac,nor:LO,rtp:Ac,tb:Zc},kT="request",DT="response",Km=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],CO=["e"],kO=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function yd(n){return kO.test(n)}function DO(n){return Km.includes(n)||CO.includes(n)||yd(n)}const PT=["d","dl","nor","ot","rtp","su"];function PO(n){return Km.includes(n)||PT.includes(n)||yd(n)}const OO=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function MO(n){return Km.includes(n)||PT.includes(n)||OO.includes(n)||yd(n)}const NO=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function BO(n){return NO.includes(n)||yd(n)}const FO={[DT]:MO,[CT]:DO,[kT]:PO};function OT(n,e={}){const t={};if(n==null||typeof n!="object")return t;const i=e.version||n.v||1,r=e.reportingMode||kT,s=i===1?BO:FO[r];let a=Object.keys(n).filter(s);const o=e.filter;typeof o=="function"&&(a=a.filter(o));const l=r===DT||r===CT;l&&!a.includes("ts")&&a.push("ts"),i>1&&!a.includes("v")&&a.push("v");const c=ut({},wO,e.formatters),u={version:i,reportingMode:r,baseUrl:e.baseUrl};return a.sort().forEach(d=>{let h=n[d];const m=c[d];if(typeof m=="function"&&(h=m(h,u)),d==="v"){if(i===1)return;h=i}d=="pr"&&h===1||(l&&d==="ts"&&!Re(h)&&(h=Date.now()),IO(h)&&(bO(d)&&typeof h=="string"&&(h=new bT(h)),t[d]=h))}),t}function UO(n,e={}){const t={};if(!n)return t;const i=OT(n,e),r=xO(i,e==null?void 0:e.customHeaderMap);return Object.entries(r).reduce((s,[a,o])=>{const l=wT(o,{whitespace:!1});return l&&(s[a]=l),s},t)}function $O(n,e,t){return ut(n,UO(e,t))}const VO="CMCD";function jO(n,e={}){return n?wT(OT(n,e),{whitespace:!1}):""}function GO(n,e={}){if(!n)return"";const t=jO(n,e);return encodeURIComponent(t)}function HO(n,e={}){if(!n)return"";const t=GO(n,e);return`${VO}=${t}`}const yy=/CMCD=[^&#]+/;function zO(n,e,t){const i=HO(e,t);if(!i)return n;if(yy.test(n))return n.replace(yy,i);const r=n.includes("?")?"&":"?";return`${n}${r}${i}`}class KO{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=r=>{try{this.apply(r,{ot:Tn.MANIFEST,su:!this.initialized})}catch(s){this.hls.logger.warn("Could not generate manifest CMCD data.",s)}},this.applyFragmentData=r=>{try{const{frag:s,part:a}=r,o=this.hls.levels[s.level],l=this.getObjectType(s),c={d:(a||s).duration*1e3,ot:l};(l===Tn.VIDEO||l===Tn.AUDIO||l==Tn.MUXED)&&(c.br=o.bitrate/1e3,c.tb=this.getTopBandwidth(l)/1e3,c.bl=this.getBufferLength(l));const u=a?this.getNextPart(a):this.getNextFrag(s);u!=null&&u.url&&u.url!==s.url&&(c.nor=u.url),this.apply(r,c)}catch(s){this.hls.logger.warn("Could not generate segment CMCD data.",s)}},this.hls=e;const t=this.config=e.config,{cmcd:i}=t;i!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=i.sessionId||e.sessionId,this.cid=i.contentId,this.useHeaders=i.useHeaders===!0,this.includeKeys=i.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(O.MEDIA_DETACHED,this.onMediaDetached,this),e.on(O.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(O.MEDIA_DETACHED,this.onMediaDetached,this),e.off(O.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var i,r;this.audioBuffer=(i=t.tracks.audio)==null?void 0:i.buffer,this.videoBuffer=(r=t.tracks.video)==null?void 0:r.buffer}createData(){var e;return{v:1,sf:ZP.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){ut(t,this.createData());const i=t.ot===Tn.INIT||t.ot===Tn.VIDEO||t.ot===Tn.MUXED;this.starved&&i&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:r}=this;r&&(t=Object.keys(t).reduce((a,o)=>(r.includes(o)&&(a[o]=t[o]),a),{}));const s={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),$O(e.headers,t,s)):e.url=zO(e.url,t,s)}getNextFrag(e){var t;const i=(t=this.hls.levels[e.level])==null?void 0:t.details;if(i){const r=e.sn-i.startSN;return i.fragments[r+1]}}getNextPart(e){var t;const{index:i,fragment:r}=e,s=(t=this.hls.levels[r.level])==null||(t=t.details)==null?void 0:t.partList;if(s){const{sn:a}=r;for(let o=s.length-1;o>=0;o--){const l=s[o];if(l.index===i&&l.fragment.sn===a)return s[o+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return Tn.TIMED_TEXT;if(e.sn==="initSegment")return Tn.INIT;if(t==="audio")return Tn.AUDIO;if(t==="main")return this.hls.audioTracks.length?Tn.VIDEO:Tn.MUXED}getTopBandwidth(e){let t=0,i;const r=this.hls;if(e===Tn.AUDIO)i=r.audioTracks;else{const s=r.maxAutoLevel,a=s>-1?s+1:r.levels.length;i=r.levels.slice(0,a)}return i.forEach(s=>{s.bitrate>t&&(t=s.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,i=e===Tn.AUDIO?this.audioBuffer:this.videoBuffer;return!i||!t?NaN:Ge.bufferInfo(i,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,i=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new i(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,a,o){t(s),this.loader.load(s,a,o)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,i=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new i(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,a,o){t(s),this.loader.load(s,a,o)}}}}const WO=3e5;class qO extends mi{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(O.MANIFEST_PARSED,this.onManifestParsed,this),e.on(O.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(O.MANIFEST_PARSED,this.onManifestParsed,this),e.off(O.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(i=>i!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:i}=t;i!==null&&(this.pathwayId=i.pathwayId,this.uri=i.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:i}=t;if((i==null?void 0:i.action)===ln.SendAlternateToPenaltyBox&&i.flags===ri.MoveAllAlternatesMatchingHost){const r=this.levels;let s=this._pathwayPriority,a=this.pathwayId;if(t.context){const{groupId:o,pathwayId:l,type:c}=t.context;o&&r?a=this.getPathwayForGroupId(o,c,a):l&&(a=l)}a in this.penalizedPathways||(this.penalizedPathways[a]=performance.now()),!s&&r&&(s=this.pathways()),s&&s.length>1&&(this.updatePathwayPriority(s),i.resolved=this.pathwayId!==a),t.details===se.BUFFER_APPEND_ERROR&&!t.fatal?i.resolved=!0:i.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${a} levels: ${r&&r.length} priorities: ${vt(s)} penalized: ${vt(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const i=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${i}"`),t=this.getLevelsForPathway(i),this.pathwayId=i}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const i=this.penalizedPathways,r=performance.now();Object.keys(i).forEach(s=>{r-i[s]>WO&&delete i[s]});for(let s=0;s<e.length;s++){const a=e[s];if(a in i)continue;if(a===this.pathwayId)return;const o=this.hls.nextLoadLevel,l=this.hls.levels[o];if(t=this.getLevelsForPathway(a),t.length>0){this.log(`Setting Pathway to "${a}"`),this.pathwayId=a,eT(t),this.hls.trigger(O.LEVELS_UPDATED,{levels:t});const c=this.hls.levels[o];l&&c&&this.levels&&(c.attrs["STABLE-VARIANT-ID"]!==l.attrs["STABLE-VARIANT-ID"]&&c.bitrate!==l.bitrate&&this.log(`Unstable Pathways change from bitrate ${l.bitrate} to ${c.bitrate}`),this.hls.nextLoadLevel=o);break}}}getPathwayForGroupId(e,t,i){const r=this.getLevelsForPathway(i).concat(this.levels||[]);for(let s=0;s<r.length;s++)if(t===qe.AUDIO_TRACK&&r[s].hasAudioGroup(e)||t===qe.SUBTITLE_TRACK&&r[s].hasSubtitleGroup(e))return r[s].pathwayId;return i}clonePathways(e){const t=this.levels;if(!t)return;const i={},r={};e.forEach(s=>{const{ID:a,"BASE-ID":o,"URI-REPLACEMENT":l}=s;if(t.some(u=>u.pathwayId===a))return;const c=this.getLevelsForPathway(o).map(u=>{const d=new At(u.attrs);d["PATHWAY-ID"]=a;const h=d.AUDIO&&`${d.AUDIO}_clone_${a}`,m=d.SUBTITLES&&`${d.SUBTITLES}_clone_${a}`;h&&(i[d.AUDIO]=h,d.AUDIO=h),m&&(r[d.SUBTITLES]=m,d.SUBTITLES=m);const g=MT(u.uri,d["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",l),v=new hl({attrs:d,audioCodec:u.audioCodec,bitrate:u.bitrate,height:u.height,name:u.name,url:g,videoCodec:u.videoCodec,width:u.width});if(u.audioGroups)for(let x=1;x<u.audioGroups.length;x++)v.addGroupId("audio",`${u.audioGroups[x]}_clone_${a}`);if(u.subtitleGroups)for(let x=1;x<u.subtitleGroups.length;x++)v.addGroupId("text",`${u.subtitleGroups[x]}_clone_${a}`);return v});t.push(...c),vy(this.audioTracks,i,l,a),vy(this.subtitleTracks,r,l,a)})}loadSteeringManifest(e){const t=this.hls.config,i=t.loader;this.loader&&this.loader.destroy(),this.loader=new i(t);let r;try{r=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(r.protocol!=="data:"){const u=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;r.searchParams.set("_HLS_pathway",this.pathwayId),r.searchParams.set("_HLS_throughput",""+u)}const s={responseType:"json",url:r.href},a=t.steeringManifestLoadPolicy.default,o=a.errorRetry||a.timeoutRetry||{},l={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},c={onSuccess:(u,d,h,m)=>{this.log(`Loaded steering manifest: "${r}"`);const g=u.data;if((g==null?void 0:g.VERSION)!==1){this.log(`Steering VERSION ${g.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=g.TTL;const{"RELOAD-URI":v,"PATHWAY-CLONES":x,"PATHWAY-PRIORITY":E}=g;if(v)try{this.uri=new self.URL(v,r).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${v}`);return}this.scheduleRefresh(this.uri||h.url),x&&this.clonePathways(x);const R={steeringManifest:g,url:r.toString()};this.hls.trigger(O.STEERING_MANIFEST_LOADED,R),E&&this.updatePathwayPriority(E)},onError:(u,d,h,m)=>{if(this.log(`Error loading steering manifest: ${u.code} ${u.text} (${d.url})`),this.stopLoad(),u.code===410){this.enabled=!1,this.log(`Steering manifest ${d.url} no longer available`);return}let g=this.timeToLoad*1e3;if(u.code===429){const v=this.loader;if(typeof(v==null?void 0:v.getResponseHeader)=="function"){const x=v.getResponseHeader("Retry-After");x&&(g=parseFloat(x)*1e3)}this.log(`Steering manifest ${d.url} rate limited`);return}this.scheduleRefresh(this.uri||d.url,g)},onTimeout:(u,d,h)=>{this.log(`Timeout loading steering manifest (${d.url})`),this.scheduleRefresh(this.uri||d.url)}};this.log(`Requesting steering manifest: ${r}`),this.loader.load(s,l,c)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var i;const r=(i=this.hls)==null?void 0:i.media;if(r&&!r.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function vy(n,e,t,i){n&&Object.keys(e).forEach(r=>{const s=n.filter(a=>a.groupId===r).map(a=>{const o=ut({},a);return o.details=void 0,o.attrs=new At(o.attrs),o.url=o.attrs.URI=MT(a.url,a.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),o.groupId=o.attrs["GROUP-ID"]=e[r],o.attrs["PATHWAY-ID"]=i,o});n.push(...s)})}function MT(n,e,t,i){const{HOST:r,PARAMS:s,[t]:a}=i;let o;e&&(o=a==null?void 0:a[e],o&&(n=o));const l=new self.URL(n);return r&&!o&&(l.host=r),s&&Object.keys(s).sort().forEach(c=>{c&&l.searchParams.set(c,s[c])}),l.href}function Dn(n,e,t){Kn(n,e,t),n.addEventListener(e,t)}function Kn(n,e,t){n.removeEventListener(e,t)}class wa extends mi{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=wa.CDMCleanupPromise?[wa.CDMCleanupPromise]:[],this.onMediaEncrypted=t=>{const{initDataType:i,initData:r}=t,s=`"${t.type}" event: init data type: "${i}"`;if(this.debug(s),r!==null){if(!this.keyFormatPromise){let a=Object.keys(this.keySystemAccessPromises);a.length||(a=bo(this.config));const o=a.map(_h).filter(l=>!!l);this.keyFormatPromise=this.getKeyFormatPromise(o)}this.keyFormatPromise.then(a=>{const o=Xc(a);if(i!=="sinf"||o!==kt.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${i}" for selected key-system ${o}`);return}let l;try{const m=Ht(new Uint8Array(r)),g=Om(JSON.parse(m).sinf),v=OS(g);if(!v)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");l=new Uint8Array(v.subarray(8,24))}catch(m){this.warn(`${s} Failed to parse sinf: ${m}`);return}const c=zi.hexDump(l),{keyIdToKeySessionPromise:u,mediaKeySessions:d}=this;let h=u[c];for(let m=0;m<d.length;m++){const g=d[m],v=g.decryptdata;if(!v.keyId)continue;const x=zi.hexDump(v.keyId);if(c===x||v.uri.replace(/-/g,"").indexOf(c)!==-1){if(h=u[x],!h)continue;if(v.pssh)break;delete u[x],v.pssh=new Uint8Array(r),v.keyId=l,h=u[c]=h.then(()=>this.generateRequestWithPreferredKeySession(g,i,r,"encrypted-event-key-match")),h.catch(E=>this.handleError(E));break}}h||this.handleError(new Error(`Key ID ${c} not encountered in playlist. Key-system sessions ${d.length}.`))}).catch(a=>this.handleError(a))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onWaitingForKey=null}registerListeners(){this.hls.on(O.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(O.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(O.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(O.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(O.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(O.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(O.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(O.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(O.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(O.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:i}=this.config,r=t[e];if(r)return r.licenseUrl;if(e===kt.WIDEVINE&&i)return i}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,i=t[e];if(i)return i.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,i=(a,o,l)=>!!a&&l.indexOf(a)===o,r=t.map(a=>a.audioCodec).filter(i),s=t.map(a=>a.videoCodec).filter(i);return r.length+s.length===0&&s.push("avc1.42e01e"),new Promise((a,o)=>{const l=c=>{const u=c.shift();this.getMediaKeysPromise(u,r,s).then(d=>a({keySystem:u,mediaKeys:d})).catch(d=>{c.length?l(c):d instanceof Vn?o(d):o(new Vn({type:Pe.KEY_SYSTEM_ERROR,details:se.KEY_SYSTEM_NO_ACCESS,error:d,fatal:!0},d.message))})};l(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:i}=this.config;if(typeof i!="function"){let r=`Configured requestMediaKeySystemAccess is not a function ${i}`;return WS===null&&self.location.protocol==="http:"&&(r=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(r))}return i(e,t)}getMediaKeysPromise(e,t,i){const r=wD(e,t,i,this.config.drmSystemOptions),s=this.keySystemAccessPromises[e];let a=s==null?void 0:s.keySystemAccess;if(!a){this.log(`Requesting encrypted media "${e}" key-system access with config: ${vt(r)}`),a=this.requestMediaKeySystemAccess(e,r);const o=this.keySystemAccessPromises[e]={keySystemAccess:a};return a.catch(l=>{this.log(`Failed to obtain access to key-system "${e}": ${l}`)}),a.then(l=>{this.log(`Access for key-system "${l.keySystem}" obtained`);const c=this.fetchServerCertificate(e);return this.log(`Create media-keys for "${e}"`),o.mediaKeys=l.createMediaKeys().then(u=>(this.log(`Media-keys created for "${e}"`),o.hasMediaKeys=!0,c.then(d=>d?this.setMediaKeysServerCertificate(u,e,d):u))),o.mediaKeys.catch(u=>{this.error(`Failed to create media-keys for "${e}"}: ${u}`)}),o.mediaKeys})}return a.then(()=>s.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:i}){this.log(`Creating key-system session "${t}" keyId: ${zi.hexDump(e.keyId||[])}`);const r=i.createSession(),s={decryptdata:e,keySystem:t,mediaKeys:i,mediaKeysSession:r,keyStatus:"status-pending"};return this.mediaKeySessions.push(s),s}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const i=this.createMediaKeySessionContext(e),r=this.getKeyIdString(t),s="cenc";this.keyIdToKeySessionPromise[r]=this.generateRequestWithPreferredKeySession(i,s,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(e.keyId===null)throw new Error("keyId is null");return zi.hexDump(e.keyId)}updateKeySession(e,t){var i;const r=e.mediaKeysSession;return this.log(`Updating key-session "${r.sessionId}" for keyID ${zi.hexDump(((i=e.decryptdata)==null?void 0:i.keyId)||[])}
      } (data length: ${t&&t.byteLength})`),r.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>_h(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:i})=>this.attemptSetMediaKeys(t,i))}selectKeySystem(e){return new Promise((t,i)=>this.getKeySystemSelectionPromise(e).then(({keySystem:r})=>{const s=_h(r);s?t(s):i(new Error(`Unable to find format for key-system "${r}"`))}).catch(i))}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=bo(this.config),i=e.map(Xc).filter(r=>!!r&&t.indexOf(r)!==-1);return this.selectKeySystem(i)}loadKey(e){const t=e.keyInfo.decryptdata,i=this.getKeyIdString(t),r=`(keyId: ${i} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${r}`);let s=this.keyIdToKeySessionPromise[i];return s||(s=this.getKeySystemForKeyPromise(t).then(({keySystem:o,mediaKeys:l})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${r}`),this.attemptSetMediaKeys(o,l).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:o,mediaKeys:l,decryptdata:t}))))),(this.keyIdToKeySessionPromise[i]=s.then(o=>{const l="cenc",c=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(o,l,c,"playlist-key")})).catch(o=>this.handleError(o))),s}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e){this.hls&&(this.error(e.message),e instanceof Vn?this.hls.trigger(O.ERROR,e.data):this.hls.trigger(O.ERROR,{type:Pe.KEY_SYSTEM_ERROR,details:se.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){const t=this.getKeyIdString(e),i=this.keyIdToKeySessionPromise[t];if(!i){const r=Xc(e.keyFormat),s=r?[r]:bo(this.config);return this.attemptKeySystemAccess(s)}return i}getKeySystemSelectionPromise(e){if(e.length||(e=bo(this.config)),e.length===0)throw new Vn({type:Pe.KEY_SYSTEM_ERROR,details:se.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${vt({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaKeys===t)return Promise.resolve();const i=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const r=Promise.all(i).then(()=>{if(!this.media)throw this.mediaKeys=null,new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)});return this.mediaKeys=t,this.setMediaKeysQueue.push(r),r.then(()=>{this.log(`Media-keys set for "${e}"`),i.push(r),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(s=>i.indexOf(s)===-1)})}generateRequestWithPreferredKeySession(e,t,i,r){var s;const a=(s=this.config.drmSystems)==null||(s=s[e.keySystem])==null?void 0:s.generateRequest;if(a)try{const m=a.call(this.hls,t,i,e);if(!m)throw new Error("Invalid response from configured generateRequest filter");t=m.initDataType,i=m.initData?m.initData:null,e.decryptdata.pssh=i?new Uint8Array(i):null}catch(m){var o;if(this.warn(m.message),(o=this.hls)!=null&&o.config.debug)throw m}if(i===null)return this.log(`Skipping key-session request for "${r}" (no initData)`),Promise.resolve(e);const l=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${r}": ${l} (init data type: ${t} length: ${i?i.byteLength:null})`);const c=new Nm,u=e._onmessage=m=>{const g=e.mediaKeysSession;if(!g){c.emit("error",new Error("invalid state"));return}const{messageType:v,message:x}=m;this.log(`"${v}" message event for session "${g.sessionId}" message size: ${x.byteLength}`),v==="license-request"||v==="license-renewal"?this.renewLicense(e,x).catch(E=>{c.eventNames().length?c.emit("error",E):this.handleError(E)}):v==="license-release"?e.keySystem===kt.FAIRPLAY&&(this.updateKeySession(e,Wf("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${v}"`)},d=e._onkeystatuseschange=m=>{if(!e.mediaKeysSession){c.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(e);const v=e.keyStatus;c.emit("keyStatus",v),v==="expired"&&(this.warn(`${e.keySystem} expired for key ${l}`),this.renewKeySession(e))};Dn(e.mediaKeysSession,"message",u),Dn(e.mediaKeysSession,"keystatuseschange",d);const h=new Promise((m,g)=>{c.on("error",g),c.on("keyStatus",v=>{v.startsWith("usable")?m():v==="output-restricted"?g(new Vn({type:Pe.KEY_SYSTEM_ERROR,details:se.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):v==="internal-error"?g(new Vn({type:Pe.KEY_SYSTEM_ERROR,details:se.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${v}"`)):v==="expired"?g(new Error("key expired while generating request")):this.warn(`unhandled key status change "${v}"`)})});return e.mediaKeysSession.generateRequest(t,i).then(()=>{var m;this.log(`Request generated for key-session "${(m=e.mediaKeysSession)==null?void 0:m.sessionId}" keyId: ${l}`)}).catch(m=>{throw new Vn({type:Pe.KEY_SYSTEM_ERROR,details:se.KEY_SYSTEM_NO_SESSION,error:m,fatal:!1},`Error generating key-session request: ${m}`)}).then(()=>h).catch(m=>{throw c.removeAllListeners(),this.removeSession(e),m}).then(()=>(c.removeAllListeners(),e))}onKeyStatusChange(e){e.mediaKeysSession.keyStatuses.forEach((t,i)=>{if(typeof i=="string"&&typeof t=="object"){const r=i;i=t,t=r}this.log(`key status change "${t}" for keyStatuses keyId: ${zi.hexDump("buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i))} session keyId: ${zi.hexDump(new Uint8Array(e.decryptdata.keyId||[]))} uri: ${e.decryptdata.uri}`),e.keyStatus=t})}fetchServerCertificate(e){const t=this.config,i=t.loader,r=new i(t),s=this.getServerCertificateUrl(e);return s?(this.log(`Fetching server certificate for "${e}"`),new Promise((a,o)=>{const l={responseType:"arraybuffer",url:s},c=t.certLoadPolicy.default,u={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(h,m,g,v)=>{a(h.data)},onError:(h,m,g,v)=>{o(new Vn({type:Pe.KEY_SYSTEM_ERROR,details:se.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:g,response:ct({url:l.url,data:void 0},h)},`"${e}" certificate request failed (${s}). Status: ${h.code} (${h.text})`))},onTimeout:(h,m,g)=>{o(new Vn({type:Pe.KEY_SYSTEM_ERROR,details:se.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:g,response:{url:l.url,data:void 0}},`"${e}" certificate request timed out (${s})`))},onAbort:(h,m,g)=>{o(new Error("aborted"))}};r.load(l,u,d)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,i){return new Promise((r,s)=>{e.setServerCertificate(i).then(a=>{this.log(`setServerCertificate ${a?"success":"not supported by CDM"} (${i==null?void 0:i.byteLength}) on "${t}"`),r(e)}).catch(a=>{s(new Vn({type:Pe.KEY_SYSTEM_ERROR,details:se.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:a,fatal:!0},a.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(i=>this.updateKeySession(e,new Uint8Array(i)).catch(r=>{throw new Vn({type:Pe.KEY_SYSTEM_ERROR,details:se.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:r,fatal:!0},r.message)}))}unpackPlayReadyKeyMessage(e,t){const i=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!i.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const r=new DOMParser().parseFromString(i,"application/xml"),s=r.querySelectorAll("HttpHeader");if(s.length>0){let u;for(let d=0,h=s.length;d<h;d++){var a,o;u=s[d];const m=(a=u.querySelector("name"))==null?void 0:a.textContent,g=(o=u.querySelector("value"))==null?void 0:o.textContent;m&&g&&e.setRequestHeader(m,g)}}const l=r.querySelector("Challenge"),c=l==null?void 0:l.textContent;if(!c)throw new Error("Cannot find <Challenge> in key message");return Wf(atob(c))}setupLicenseXHR(e,t,i,r){const s=this.config.licenseXhrSetup;return s?Promise.resolve().then(()=>{if(!i.decryptdata)throw new Error("Key removed");return s.call(this.hls,e,t,i,r)}).catch(a=>{if(!i.decryptdata)throw a;return e.open("POST",t,!0),s.call(this.hls,e,t,i,r)}).then(a=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:a||r})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:r}))}requestLicense(e,t){const i=this.config.keyLoadPolicy.default;return new Promise((r,s)=>{const a=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${a}`);const o=new XMLHttpRequest;o.responseType="arraybuffer",o.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return s(new Error("invalid state"));if(o.readyState===4)if(o.status===200){this._requestLicenseFailureCount=0;let l=o.response;this.log(`License received ${l instanceof ArrayBuffer?l.byteLength:l}`);const c=this.config.licenseResponseCallback;if(c)try{l=c.call(this.hls,o,a,e)}catch(u){this.error(u)}r(l)}else{const l=i.errorRetry,c=l?l.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>c||o.status>=400&&o.status<500)s(new Vn({type:Pe.KEY_SYSTEM_ERROR,details:se.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:o,response:{url:a,data:void 0,code:o.status,text:o.statusText}},`License Request XHR failed (${a}). Status: ${o.status} (${o.statusText})`));else{const u=c-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${u} attempts left`),this.requestLicense(e,t).then(r,s)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=o,this.setupLicenseXHR(o,a,e,t).then(({xhr:l,licenseChallenge:c})=>{e.keySystem==kt.PLAYREADY&&(c=this.unpackPlayReadyKeyMessage(l,c)),l.send(c)})})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const i=t.media;this.media=i,Dn(i,"encrypted",this.onMediaEncrypted),Dn(i,"waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media;e&&(Kn(e,"encrypted",this.onMediaEncrypted),Kn(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;if(this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},!this.mediaKeys&&!this.mediaKeySessions.length)return;const t=this.media,i=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,gd.clearKeyUriToKeyIdMap();const r=i.length;wa.CDMCleanupPromise=Promise.all(i.map(s=>this.removeSession(s)).concat(t==null||(e=t.setMediaKeys(null))==null?void 0:e.catch(s=>{var a;this.log(`Could not clear media keys: ${s}`),(a=this.hls)==null||a.trigger(O.ERROR,{type:Pe.OTHER_ERROR,details:se.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${s}`)})}))).catch(s=>{var a;this.log(`Could not close sessions and clear media keys: ${s}`),(a=this.hls)==null||a.trigger(O.ERROR,{type:Pe.OTHER_ERROR,details:se.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${s}`)})}).then(()=>{r&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const i=t.reduce((r,s)=>(r.indexOf(s.keyFormat)===-1&&r.push(s.keyFormat),r),[]);this.log(`Selecting key-system from session-keys ${i.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(i)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:i}=e;if(t){this.log(`Remove licenses and keys and close session ${t.sessionId}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),i&&i.readyState!==XMLHttpRequest.DONE&&i.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const r=this.mediaKeySessions.indexOf(e);r>-1&&this.mediaKeySessions.splice(r,1);const{drmSystemOptions:s}=this.config;return(kD(s)?new Promise((o,l)=>{self.setTimeout(()=>l(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(o)}):Promise.resolve()).catch(o=>{var l;this.log(`Could not remove session: ${o}`),(l=this.hls)==null||l.trigger(O.ERROR,{type:Pe.OTHER_ERROR,details:se.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${o}`)})}).then(()=>t.close()).catch(o=>{var l;this.log(`Could not close session: ${o}`),(l=this.hls)==null||l.trigger(O.ERROR,{type:Pe.OTHER_ERROR,details:se.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${o}`)})})}}}wa.CDMCleanupPromise=void 0;class Vn extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}class YO{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(O.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(O.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(O.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(O.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const i=this.hls.config;if(i.capLevelOnFPSDrop){const r=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=r,r&&typeof r.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,i){const r=performance.now();if(t){if(this.lastTime){const s=r-this.lastTime,a=i-this.lastDroppedFrames,o=t-this.lastDecodedFrames,l=1e3*a/s,c=this.hls;if(c.trigger(O.FPS_DROP,{currentDropped:a,currentDecoded:o,totalDroppedFrames:i}),l>0&&a>c.config.fpsDroppedMonitoringThreshold*o){let u=c.currentLevel;c.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+u),u>0&&(c.autoLevelCapping===-1||c.autoLevelCapping>=u)&&(u=u-1,c.trigger(O.FPS_DROP_LEVEL_CAPPING,{level:u,droppedLevel:c.currentLevel}),c.autoLevelCapping=u,this.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=i,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function NT(n,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=n,e.dispatchEvent(t)}function BT(n,e){const t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues&&!n.cues.getCueById(e.id))try{if(n.addCue(e),!n.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(i){ot.debug(`[texttrack-utils]: ${i}`);try{const r=new self.TextTrackCue(e.startTime,e.endTime,e.text);r.id=e.id,n.addCue(r)}catch(r){ot.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${r}`)}}t==="disabled"&&(n.mode=t)}function _a(n,e){const t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues)for(let i=n.cues.length;i--;)e&&n.cues[i].removeEventListener("enter",e),n.removeCue(n.cues[i]);t==="disabled"&&(n.mode=t)}function np(n,e,t,i){const r=n.mode;if(r==="disabled"&&(n.mode="hidden"),n.cues&&n.cues.length>0){const s=QO(n.cues,e,t);for(let a=0;a<s.length;a++)(!i||i(s[a]))&&n.removeCue(s[a])}r==="disabled"&&(n.mode=r)}function XO(n,e){if(e<=n[0].startTime)return 0;const t=n.length-1;if(e>n[t].endTime)return-1;let i=0,r=t,s;for(;i<=r;)if(s=Math.floor((r+i)/2),e<n[s].startTime)r=s-1;else if(e>n[s].startTime&&i<t)i=s+1;else return s;return n[i].startTime-e<e-n[r].startTime?i:r}function QO(n,e,t){const i=[],r=XO(n,e);if(r>-1)for(let s=r,a=n.length;s<a;s++){const o=n[s];if(o.startTime>=e&&o.endTime<=t)i.push(o);else if(o.startTime>t)return i}return i}function eu(n){const e=[];for(let t=0;t<n.length;t++){const i=n[t];(i.kind==="subtitles"||i.kind==="captions")&&i.label&&e.push(n[t])}return e}class JO extends Gm{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const i=eu(this.media.textTracks);for(let s=0;s<i.length;s++)if(i[s].mode==="hidden")t=i[s];else if(i[s].mode==="showing"){t=i[s];break}const r=this.findTrackForTextTrack(t);this.subtitleTrack!==r&&this.setSubtitleTrack(r)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.MANIFEST_PARSED,this.onManifestParsed,this),e.on(O.LEVEL_LOADING,this.onLevelLoading,this),e.on(O.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(O.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(O.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.MANIFEST_PARSED,this.onManifestParsed,this),e.off(O.LEVEL_LOADING,this.onLevelLoading,this),e.off(O.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(O.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(O.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const i=this.media;if(!i)return;const r=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||i.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,r)return;eu(i.textTracks).forEach(a=>{_a(a)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:i,groupId:r,details:s}=t,a=this.tracksInGroup[i];if(!a||a.groupId!==r){this.warn(`Subtitle track with id:${i} and group:${r} not found in active group ${a==null?void 0:a.groupId}`);return}const o=a.details;a.details=t.details,this.log(`Subtitle track ${i} "${a.name}" lang:${a.lang} group:${r} loaded [${s.startSN}-${s.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const i=t.subtitleGroups||null,r=this.groupIds;let s=this.currentTrack;if(!i||(r==null?void 0:r.length)!==(i==null?void 0:i.length)||i!=null&&i.some(a=>(r==null?void 0:r.indexOf(a))===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(u=>!i||i.indexOf(u.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(u=>u.default)&&(this.selectDefaultTrack=!1),a.forEach((u,d)=>{u.id=d});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const o=this.hls.config.subtitlePreference;if(!s&&o){this.selectDefaultTrack=!1;const u=wi(o,a);if(u>-1)s=a[u];else{const d=wi(o,this.tracks);s=this.tracks[d]}}let l=this.findTrackId(s);l===-1&&s&&(l=this.findTrackId(null));const c={subtitleTracks:a};this.log(`Updating subtitle tracks, ${a.length} track(s) found in "${i==null?void 0:i.join(",")}" group-id`),this.hls.trigger(O.SUBTITLE_TRACKS_UPDATED,c),l!==-1&&this.trackId===-1&&this.setSubtitleTrack(l)}}findTrackId(e){const t=this.tracksInGroup,i=this.selectDefaultTrack;for(let r=0;r<t.length;r++){const s=t[r];if(!(i&&!s.default||!i&&!e)&&(!e||ks(s,e)))return r}if(e){for(let r=0;r<t.length;r++){const s=t[r];if(_l(e.attrs,s.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return r}for(let r=0;r<t.length;r++){const s=t[r];if(_l(e.attrs,s.attrs,["LANGUAGE"]))return r}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let i=0;i<t.length;i++){const r=t[i];if(Jf(r,e))return i}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===qe.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const i=this.currentTrack;if(i&&ks(e,i))return i;const r=wi(e,this.tracksInGroup);if(r>-1){const s=this.tracksInGroup[r];return this.setSubtitleTrack(r),s}else{if(i)return null;{const s=wi(e,t);if(s>-1)return t[s]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const i=e.id,r=e.groupId,s=this.getUrlWithDirectives(e.url,t),a=e.details,o=a==null?void 0:a.age;this.log(`Loading subtitle ${i} "${e.name}" lang:${e.lang} group:${r}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${s}`),this.hls.trigger(O.SUBTITLE_TRACK_LOADING,{url:s,id:i,groupId:r,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=eu(e.textTracks),i=this.currentTrack;let r;if(i&&(r=t.filter(s=>Jf(i,s))[0],r||this.warn(`Unable to find subtitle TextTrack with name "${i.name}" and language "${i.lang}"`)),[].slice.call(t).forEach(s=>{s.mode!=="disabled"&&s!==r&&(s.mode="disabled")}),r){const s=this.subtitleDisplay?"showing":"hidden";r.mode!==s&&(r.mode=s)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!Re(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const i=this.currentTrack,r=t[e]||null;if(this.trackId=e,this.currentTrack=r,this.toggleTrackModes(),!r){this.hls.trigger(O.SUBTITLE_TRACK_SWITCH,{id:e});return}const s=!!r.details&&!r.details.live;if(e===this.trackId&&r===i&&s)return;this.log(`Switching to subtitle-track ${e}`+(r?` "${r.name}" lang:${r.lang} group:${r.groupId}`:""));const{id:a,groupId:o="",name:l,type:c,url:u}=r;this.hls.trigger(O.SUBTITLE_TRACK_SWITCH,{id:a,groupId:o,name:l,type:c,url:u});const d=this.switchParams(r.url,i==null?void 0:i.details,r.details);this.loadPlaylist(d)}}function ZO(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const s=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(r=="x"?s:s&3|8).toString(16)})}}}function jo(n){let e=5381,t=n.length;for(;t;)e=e*33^n.charCodeAt(--t);return(e>>>0).toString()}const Ca=.025;let zu=function(n){return n[n.Point=0]="Point",n[n.Range=1]="Range",n}({});function eM(n,e,t){return`${n.identifier}-${t+1}-${jo(e)}`}class tM{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const i=this.playoutLimit;return e<=0||isNaN(i)?!1:i===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>i}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return Ih(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,i=Ih(t,e);return t-i<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=Re(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return Ih(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<Ca))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?zu.Range:zu.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return nM(this)}}function Ih(n,e){return n-e.start<e.duration/2&&!(Math.abs(n-(e.start+e.duration))<Ca)?e.start:e.start+e.duration}function FT(n,e,t){const i=new self.URL(n,t);return i.protocol!=="data:"&&i.searchParams.set("_HLS_primary_id",e),i}function Rh(n,e){for(;(t=n.assetList[++e])!=null&&t.error;)var t;return e}function nM(n){return`["${n.identifier}" ${n.cue.pre?"<pre>":n.cue.post?"<post>":""}${n.timelineStart.toFixed(2)}-${n.resumeTime.toFixed(2)}]`}function ia(n){const e=n.timelineStart,t=n.duration||0;return`["${n.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class iM{constructor(e,t,i,r){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(O.PLAYOUT_LIMIT_REACHED,{})};const s=this.hls=new e(t);this.interstitial=i,this.assetItem=r;const a=()=>{this.hasDetails=!0};s.once(O.LEVEL_LOADED,a),s.once(O.AUDIO_TRACK_LOADED,a),s.once(O.SUBTITLE_TRACK_LOADED,a),s.on(O.MEDIA_ATTACHING,(o,{media:l})=>{this.removeMediaListeners(),this.mediaAttached=l,this.interstitial.playoutLimit&&(l.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&s.on(O.BUFFER_APPENDED,()=>{const u=this.bufferedEnd;this.reachedPlayout(u)&&(this._bufferedEosTime=u,s.trigger(O.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=FT(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const i=Math.min(this._bufferedEosTime||1/0,this.duration),r=this.timelineOffset,s=Ge.bufferInfo(e,r,0);return this.getAssetTime(s.end)>=i-.02}reachedPlayout(e){const i=this.interstitial.playoutLimit;return this.startOffset+e>=i}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=Ge.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const i=t-this.startOffset;if(i>0&&i<e)return i}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const i=e-t;if(Math.abs(i)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,i=this.duration;return Math.min(Math.max(0,e-t),i)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=i=>delete i.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,i){var r;(r=this.hls)==null||r.on(e,t)}once(e,t,i){var r;(r=this.hls)==null||r.once(e,t)}off(e,t,i){var r;(r=this.hls)==null||r.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${ia(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const Ey=.033;class rM extends mi{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((i,r)=>e<=r.startOffset&&t>r.startOffset?(delete r.error,i+1):i,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let i=-1;e.nextEvent?i=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(i=this.findEventIndex(e.previousEvent.identifier)+1);const r=this.items;if(r)for(r[i]||(t===void 0&&(t=e.start),i=this.findItemIndexAtTime(t));i>=0&&(s=r[i])!=null&&s.event;){var s;i--}return i}findItemIndexAtTime(e,t){const i=this.items;if(i)for(let r=0;r<i.length;r++){let s=i[r];if(t&&t!=="primary"&&(s=s[t]),e===s.start||e>s.start&&e<s.end)return r}return-1}findJumpRestrictedIndex(e,t){const i=this.items;if(i)for(let r=e;r<=t&&i[r];r++){const s=i[r].event;if(s!=null&&s.restrictions.jump&&!s.appendInPlace)return r}return-1}findEventIndex(e){const t=this.items;if(t)for(let r=t.length;r--;){var i;if(((i=t[r].event)==null?void 0:i.identifier)===e)return r}return-1}findAssetIndex(e,t){const i=e.assetList,r=i.length;if(r>1)for(let s=0;s<r;s++){const a=i[s];if(!a.error){const o=a.timelineStart;if(t===o||t>o&&(t<o+(a.duration||0)||s===r-1))return s}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const i=t.assetList,r=i[i.length-1];if(r)return r.identifier}return null}parseInterstitialDateRanges(e,t){const i=e.main.details,{dateRanges:r}=i,s=this.events,a=this.parseDateRanges(r,{url:i.url},t),o=Object.keys(r),l=s?s.filter(c=>!o.includes(c.identifier)):[];a.length&&a.sort((c,u)=>{const d=c.cue.pre,h=c.cue.post,m=u.cue.pre,g=u.cue.post;if(d&&!m)return-1;if(m&&!d||h&&!g)return 1;if(g&&!h)return-1;if(!d&&!m&&!h&&!g){const v=c.startTime,x=u.startTime;if(v!==x)return v-x}return c.dateRange.tagOrder-u.dateRange.tagOrder}),this.events=a,l.forEach(c=>{this.removeEvent(c)}),this.updateSchedule(e,l)}updateSchedule(e,t=[],i=!1){const r=this.events||[];if(r.length||t.length||this.length<2){const s=this.items,a=this.parseSchedule(r,e);(i||t.length||(s==null?void 0:s.length)!==a.length||a.some((l,c)=>Math.abs(l.playout.start-s[c].playout.start)>.005||Math.abs(l.playout.end-s[c].playout.end)>.005))&&(this.items=a,this.onScheduleUpdate(t,s))}}parseDateRanges(e,t,i){const r=[],s=Object.keys(e);for(let a=0;a<s.length;a++){const o=s[a],l=e[o];if(l.isInterstitial){let c=this.eventMap[o];c?c.setDateRange(l):(c=new tM(l,t),this.eventMap[o]=c,i===!1&&(c.appendInPlace=i)),r.push(c)}}return r}parseSchedule(e,t){const i=[],r=t.main.details,s=r.live?1/0:r.edge;let a=0;if(e=e.filter(l=>!l.error&&!(l.cue.once&&l.hasPlayed)),e.length){this.resolveOffsets(e,t);let l=0,c=0;if(e.forEach((u,d)=>{const h=u.cue.pre,m=u.cue.post,g=e[d-1]||null,v=u.appendInPlace,x=m?s:u.startOffset,E=u.duration,R=u.timelineOccupancy===zu.Range?E:0,k=u.resumptionOffset,D=(g==null?void 0:g.startTime)===x,V=x+u.cumulativeDuration;let H=v?V+E:x+k;if(h||!m&&x<=0){const S=c;c+=R,u.timelineStart=V;const b=a;a+=E,i.push({event:u,start:V,end:H,playout:{start:b,end:a},integrated:{start:S,end:c}})}else if(x<=s){if(!D){const T=x-l;if(T>Ey){const L=l,F=c;c+=T;const U=a;a+=T;const Z={previousEvent:e[d-1]||null,nextEvent:u,start:L,end:L+T,playout:{start:U,end:a},integrated:{start:F,end:c}};i.push(Z)}else T>0&&g&&(g.cumulativeDuration+=T,i[i.length-1].end=x)}m&&(H=V),u.timelineStart=V;const S=c;c+=R;const b=a;a+=E,i.push({event:u,start:V,end:H,playout:{start:b,end:a},integrated:{start:S,end:c}})}else return;const C=u.resumeTime;m||C>s?l=s:l=C}),l<s){var o;const u=l,d=c,h=s-l;c+=h;const m=a;a+=h,i.push({previousEvent:((o=i[i.length-1])==null?void 0:o.event)||null,nextEvent:null,start:l,end:u+h,playout:{start:m,end:a},integrated:{start:d,end:c}})}this.setDurations(s,a,c)}else i.push({previousEvent:null,nextEvent:null,start:0,end:s,playout:{start:0,end:s},integrated:{start:0,end:s}}),this.setDurations(s,s,s);return i}setDurations(e,t,i){this.durations={primary:e,playout:t,integrated:i}}resolveOffsets(e,t){const i=t.main.details,r=i.live?1/0:i.edge;let s=0,a=-1;e.forEach((o,l)=>{const c=o.cue.pre,u=o.cue.post,d=c?0:u?r:o.startTime;this.updateAssetDurations(o),a===d?o.cumulativeDuration=s:(s=0,a=d),!u&&o.snapOptions.in&&(o.resumeAnchor=Vs(null,i.fragments,o.startOffset+o.resumptionOffset,0,0)||void 0),o.appendInPlace&&!o.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(o,t)||(o.appendInPlace=!1)),!o.appendInPlace&&l+1<e.length&&e[l+1].startTime-e[l].resumeTime<Ey&&(e[l+1].appendInPlace=!1,e[l+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${o}`));const m=Re(o.resumeOffset)?o.resumeOffset:o.duration;s+=m})}primaryCanResumeInPlaceAt(e,t){const i=e.resumeTime,r=e.startTime+e.resumptionOffset;return Math.abs(i-r)>Ca?(this.log(`"${e.identifier}" resumption ${i} not aligned with estimated timeline end ${r}`),!1):!Object.keys(t).some(a=>{const o=t[a].details,l=o.edge;if(i>=l)return this.log(`"${e.identifier}" resumption ${i} past ${a} playlist end ${l}`),!1;const c=Vs(null,o.fragments,i);if(!c)return this.log(`"${e.identifier}" resumption ${i} does not align with any fragments in ${a} playlist (${o.fragStart}-${o.fragmentEnd})`),!0;const u=a==="audio"?.175:0;return Math.abs(c.start-i)<Ca+u||Math.abs(c.end-i)<Ca+u?!1:(this.log(`"${e.identifier}" resumption ${i} not aligned with ${a} fragment bounds (${c.start}-${c.end} sn: ${c.sn} cc: ${c.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let i=0,r=!1,s=!1;for(let a=0;a<e.assetList.length;a++){const o=e.assetList[a],l=t+i;o.startOffset=i,o.timelineStart=l,r||(r=o.duration===null),s||(s=!!o.error);const c=o.error?0:o.duration||0;i+=c}r&&!s?e.duration=Math.max(i,e.duration):e.duration=i}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function ji(n){return`[${n.event?'"'+n.event.identifier+'"':"primary"}: ${n.start.toFixed(2)}-${n.end.toFixed(2)}]`}class sM{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const i=e.assetListUrl;let r;try{r=FT(i,this.hls.sessionId,e.baseUrl)}catch(h){const m=this.assignAssetListError(e,se.ASSET_LIST_LOAD_ERROR,h,i);this.hls.trigger(O.ERROR,m);return}t&&r.protocol!=="data:"&&r.searchParams.set("_HLS_start_offset",""+t);const s=this.hls.config,a=s.loader,o=new a(s),l={responseType:"json",url:r.href},c=s.interstitialAssetListLoadPolicy.default,u={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(h,m,g,v)=>{const x=h.data,E=x==null?void 0:x.ASSETS;if(!Array.isArray(E)){const R=this.assignAssetListError(e,se.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),g.url,m,v);this.hls.trigger(O.ERROR,R);return}e.assetListResponse=x,this.hls.trigger(O.ASSET_LIST_LOADED,{event:e,assetListResponse:x,networkDetails:v})},onError:(h,m,g,v)=>{const x=this.assignAssetListError(e,se.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${h.code} ${h.text} (${m.url})`),m.url,v,g);this.hls.trigger(O.ERROR,x)},onTimeout:(h,m,g)=>{const v=this.assignAssetListError(e,se.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${m.url})`),m.url,h,g);this.hls.trigger(O.ERROR,v)}};return o.load(l,u,d),this.hls.trigger(O.ASSET_LIST_LOADING,{event:e}),o}assignAssetListError(e,t,i,r,s,a){return e.error=i,{type:Pe.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:r,error:i,networkDetails:a,stats:s}}}function Sy(n){n==null||n.play().catch(()=>{})}class aM extends mi{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const i=this.currentTime;if(i===void 0||this.playbackDisabled||!this.schedule)return;const r=i-this.timelinePos;if(Math.abs(r)<1/7056e5)return;const a=r<=-.01;this.timelinePos=i,this.bufferedPos=i;const o=this.playingItem;if(!o){this.checkBuffer();return}if(a&&this.schedule.resetErrorsInRange(i,i-r)&&this.updateSchedule(!0),this.checkBuffer(),a&&i<o.start||i>=o.end){var l;const m=this.findItemIndex(o);let g=this.schedule.findItemIndexAtTime(i);if(g===-1&&(g=m+(a?-1:1),this.log(`seeked ${a?"back ":""}to position not covered by schedule ${i} (resolving from ${m} to ${g})`)),!this.isInterstitial(o)&&(l=this.media)!=null&&l.paused&&(this.shouldPlay=!1),!a&&g>m){const v=this.schedule.findJumpRestrictedIndex(m+1,g);if(v>m){this.setSchedulePosition(v);return}}this.setSchedulePosition(g);return}const c=this.playingAsset;if(!c){if(this.playingLastItem&&this.isInterstitial(o)){const m=o.event.assetList[0];m&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(i,m))}return}const u=c.timelineStart,d=c.duration||0;if(a&&i<u||i>=u+d){var h;(h=o.event)!=null&&h.appendInPlace&&(this.clearInterstitial(o.event,o),this.flushFrontBuffer(i)),this.setScheduleToAssetAtTime(i,c)}},this.onTimeupdate=()=>{const i=this.currentTime;if(i===void 0||this.playbackDisabled)return;if(i>this.timelinePos)this.timelinePos=i,i>this.bufferedPos&&this.checkBuffer();else return;const r=this.playingItem;if(!r||this.playingLastItem)return;if(i>=r.end){this.timelinePos=r.end;const o=this.findItemIndex(r);this.setSchedulePosition(o+1)}const s=this.playingAsset;if(!s)return;const a=s.timelineStart+(s.duration||0);i>=a&&this.setScheduleToAssetAtTime(i,s)},this.onScheduleUpdate=(i,r)=>{const s=this.schedule;if(!s)return;const a=this.playingItem,o=s.events||[],l=s.items||[],c=s.durations,u=i.map(v=>v.identifier),d=!!(o.length||u.length);(d||r)&&this.log(`INTERSTITIALS_UPDATED (${o.length}): ${o}
Schedule: ${l.map(v=>ji(v))} pos: ${this.timelinePos}`),u.length&&this.log(`Removed events ${u}`);let h=null,m=null;a&&(h=this.updateItem(a,this.timelinePos),this.itemsMatch(a,h)?this.playingItem=h:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const g=this.bufferingItem;if(g&&(m=this.updateItem(g,this.bufferedPos),this.itemsMatch(g,m)?this.bufferingItem=m:g.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(g.event,null))),i.forEach(v=>{v.assetList.forEach(x=>{this.clearAssetPlayer(x.identifier,null)})}),this.playerQueue.forEach(v=>{if(v.interstitial.appendInPlace){const x=v.assetItem.timelineStart,E=v.timelineOffset-x;if(E)try{v.timelineOffset=x}catch(R){Math.abs(E)>Ca&&this.warn(`${R} ("${v.assetId}" ${v.timelineOffset}->${x})`)}}}),d||r){if(this.hls.trigger(O.INTERSTITIALS_UPDATED,{events:o.slice(0),schedule:l.slice(0),durations:c,removedIds:u}),this.isInterstitial(a)&&u.includes(a.event.identifier)){this.warn(`Interstitial "${a.event.identifier}" removed while playing`),this.primaryFallback(a.event);return}a&&this.trimInPlace(h,a),g&&this.trimInPlace(m,g),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new sM(e),this.schedule=new rM(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(O.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(O.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(O.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(O.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(O.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(O.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(O.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(O.BUFFER_APPENDED,this.onBufferAppended,this),e.on(O.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(O.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(O.MEDIA_ENDED,this.onMediaEnded,this),e.on(O.ERROR,this.onError,this),e.on(O.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(O.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(O.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(O.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(O.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(O.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(O.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(O.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(O.BUFFER_CODECS,this.onBufferCodecs,this),e.off(O.BUFFER_APPENDED,this.onBufferAppended,this),e.off(O.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(O.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(O.MEDIA_ENDED,this.onMediaEnded,this),e.off(O.ERROR,this.onError,this),e.off(O.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){Kn(e,"play",this.onPlay),Kn(e,"pause",this.onPause),Kn(e,"seeking",this.onSeeking),Kn(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const i=this.media=t.media;Dn(i,"seeking",this.onSeeking),Dn(i,"timeupdate",this.onTimeupdate),Dn(i,"play",this.onPlay),Dn(i,"pause",this.onPause)}onMediaAttached(e,t){const i=this.effectivePlayingItem,r=this.detachedData;if(this.detachedData=null,i===null)this.checkStart();else if(!r){this.clearScheduleState();const s=this.findItemIndex(i);this.setSchedulePosition(s)}}clearScheduleState(){this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const i=!!t.transferMedia,r=this.media;if(this.media=null,!i&&(r&&this.removeMediaListeners(r),this.detachedData)){const s=this.getBufferingPlayer();s&&(this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,s.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,i=d=>d&&e.getAssetPlayer(d.identifier),r=(d,h,m,g,v)=>{if(d){let x=d[h].start;const E=d.event;if(E){if(h==="playout"||E.timelineOccupancy!==zu.Point){const R=i(m);(R==null?void 0:R.interstitial)===E&&(x+=R.assetItem.startOffset+R[v])}}else{const R=g==="bufferedPos"?a():e[g];x+=R-d.start}return x}return 0},s=(d,h)=>{var m;if(d!==0&&h!=="primary"&&(m=e.schedule)!=null&&m.length){var g;const v=e.schedule.findItemIndexAtTime(d),x=(g=e.schedule.items)==null?void 0:g[v];if(x){const E=x[h].start-x.start;return d+E}}return d},a=()=>{const d=e.bufferedPos;return d===Number.MAX_VALUE?o("primary"):Math.max(d,0)},o=d=>{var h,m;return(h=e.primaryDetails)!=null&&h.live?e.primaryDetails.edge:((m=e.schedule)==null?void 0:m.durations[d])||0},l=(d,h)=>{var m,g;const v=e.effectivePlayingItem;if(v!=null&&(m=v.event)!=null&&m.restrictions.skip||!e.schedule)return;e.log(`seek to ${d} "${h}"`);const x=e.effectivePlayingItem,E=e.schedule.findItemIndexAtTime(d,h),R=(g=e.schedule.items)==null?void 0:g[E],k=e.getBufferingPlayer(),D=k==null?void 0:k.interstitial,V=D==null?void 0:D.appendInPlace,H=x&&e.itemsMatch(x,R);if(x&&(V||H)){const C=i(e.playingAsset),S=(C==null?void 0:C.media)||e.primaryMedia;if(S){const b=h==="primary"?S.currentTime:r(x,h,e.playingAsset,"timelinePos","currentTime"),T=d-b,L=(V?b:S.currentTime)+T;if(L>=0&&(!C||V||L<=C.duration)){S.currentTime=L;return}}}if(R){let C=d;if(h!=="primary"){const b=R[h].start,T=d-b;C=R.start+T}const S=!e.isInterstitial(R);if((!e.isInterstitial(x)||x.event.appendInPlace)&&(S||R.event.appendInPlace)){const b=e.media||(V?k==null?void 0:k.media:null);b&&(b.currentTime=C)}else if(x){const b=e.findItemIndex(x);if(E>b){const L=e.schedule.findJumpRestrictedIndex(b+1,E);if(L>b){e.setSchedulePosition(L);return}}let T=0;if(S)e.timelinePos=C,e.checkBuffer();else{const L=R.event.assetList,F=d-(R[h]||R).start;for(let U=L.length;U--;){const Z=L[U];if(Z.duration&&F>=Z.startOffset&&F<Z.startOffset+Z.duration){T=U;break}}}e.setSchedulePosition(E,T)}}},c=()=>{const d=e.effectivePlayingItem;if(e.isInterstitial(d))return d;const h=t();return e.isInterstitial(h)?h:null},u={get bufferedEnd(){const d=t(),h=e.bufferingItem;if(h&&h===d){var m;return r(h,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-h.playout.start||((m=e.bufferingAsset)==null?void 0:m.startOffset)||0}return 0},get currentTime(){const d=c(),h=e.effectivePlayingItem;return h&&h===d?r(h,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-h.playout.start:0},set currentTime(d){const h=c(),m=e.effectivePlayingItem;m&&m===h&&l(d+m.playout.start,"playout")},get duration(){const d=c();return d?d.playout.end-d.playout.start:0},get assetPlayers(){var d;const h=(d=c())==null?void 0:d.event.assetList;return h?h.map(m=>e.getAssetPlayer(m.identifier)):[]},get playingIndex(){var d;const h=(d=c())==null?void 0:d.event;return h&&e.effectivePlayingAsset?h.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return c()}};return this.manager={get events(){var d;return((d=e.schedule)==null||(d=d.events)==null?void 0:d.slice(0))||[]},get schedule(){var d;return((d=e.schedule)==null||(d=d.items)==null?void 0:d.slice(0))||[]},get interstitialPlayer(){return c()?u:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const d=t();return e.findItemIndex(d)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const d=e.effectivePlayingItem;return e.findItemIndex(d)},primary:{get bufferedEnd(){return a()},get currentTime(){const d=e.timelinePos;return d>0?d:0},set currentTime(d){l(d,"primary")},get duration(){return o("primary")},get seekableStart(){var d;return((d=e.primaryDetails)==null?void 0:d.fragmentStart)||0}},integrated:{get bufferedEnd(){return r(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return r(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(d){l(d,"integrated")},get duration(){return o("integrated")},get seekableStart(){var d;return s(((d=e.primaryDetails)==null?void 0:d.fragmentStart)||0,"integrated")}},skip:()=>{const d=e.effectivePlayingItem,h=d==null?void 0:d.event;if(h&&!h.restrictions.skip){const m=e.findItemIndex(d);if(h.appendInPlace){const g=d.playout.start+d.event.duration;l(g+.001,"playout")}else e.advanceAfterAssetEnded(h,m,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,i=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!i?!1:this.findItemIndex(t)===i.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const i=this.waitingItem||this.playingItem;if(this.isInterstitial(i)&&!i.event.appendInPlace)return;let r=this.media;!r&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(r=this.primaryMedia);const s=(t=r)==null?void 0:t.currentTime;if(!(s===void 0||!Re(s)))return s}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const i=this.getAssetPlayer(e);i&&this.transferMediaFromPlayer(i,t)}transferMediaFromPlayer(e,t){const i=e.interstitial.appendInPlace,r=e.media;if(i&&r===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&r){this.detachedData={media:r};return}const s=e.transferMedia();this.log(`transfer MediaSource from ${e} ${vt(s)}`),this.detachedData=s}else t&&r&&(this.shouldPlay||(this.shouldPlay=!r.paused))}transferMediaTo(e,t){var i,r;if(e.media===t)return;let s=null;const a=this.hls,o=e!==a,l=o&&e.interstitial.appendInPlace,c=(i=this.detachedData)==null?void 0:i.mediaSource;let u;if(a.media)l&&(s=a.transferMedia(),this.detachedData=s),u="Primary";else if(c){const g=this.getBufferingPlayer();g?(s=g.transferMedia(),u=`${g}`):u="detached MediaSource"}else u="detached media";if(!s){if(c)s=this.detachedData,this.log(`using detachedData: MediaSource ${vt(s)}`);else if(!this.detachedData||a.media===t){const g=this.playerQueue;g.length>1&&g.forEach(v=>{if(o&&v.interstitial.appendInPlace!==l){const x=v.interstitial;this.clearInterstitial(v.interstitial,null),x.appendInPlace=!1,x.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${x}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const d=s&&"mediaSource"in s&&((r=s.mediaSource)==null?void 0:r.readyState)!=="closed",h=d&&s?s:t;this.log(`${d?"transfering MediaSource":"attaching media"} to ${o?e:"Primary"} from ${u} (media.currentTime: ${t.currentTime})`);const m=this.schedule;if(h===s&&m){const g=o&&e.assetId===m.assetIdAtEnd;h.overrides={duration:m.duration,endOfStream:!o||g,cueRemoval:!o}}e.attachMedia(h)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e==null?void 0:e.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const i=this.timelinePos,r=this.effectivePlayingItem;if(i===-1){const s=this.hls.startPosition;if(this.timelinePos=s,t.length&&t[0].cue.pre){const a=e.findEventIndex(t[0].identifier);this.setSchedulePosition(a)}else if(s>=0||!this.primaryLive){const a=this.timelinePos=s>0?s:0,o=e.findItemIndexAtTime(a);this.setSchedulePosition(o)}}else if(r&&!this.playingItem){const s=e.findItemIndex(r);this.setSchedulePosition(s)}}advanceAssetBuffering(e,t){const i=e.event,r=i.findAssetIndex(t),s=Rh(i,r);if(!i.isAssetPastPlayoutLimit(s))this.bufferedToEvent(e,s);else if(this.schedule){var a;const o=(a=this.schedule.items)==null?void 0:a[this.findItemIndex(e)+1];o&&this.bufferedToItem(o)}}advanceAfterAssetEnded(e,t,i){const r=Rh(e,i);if(e.isAssetPastPlayoutLimit(r)){if(this.schedule){const s=this.schedule.items;if(s){const a=t+1,o=s.length;if(a>=o){this.setSchedulePosition(-1);return}const l=e.resumeTime;this.timelinePos<l&&(this.timelinePos=l,e.appendInPlace&&this.advanceInPlace(l),this.checkBuffer(this.bufferedPos<l)),this.setSchedulePosition(a)}}}else{if(e.appendInPlace){const s=e.assetList[r];s&&this.advanceInPlace(s.timelineStart)}this.setSchedulePosition(t,r)}}setScheduleToAssetAtTime(e,t){const i=this.schedule;if(!i)return;const r=t.parentIdentifier,s=i.getEvent(r);if(s){const a=i.findEventIndex(r),o=i.findAssetIndex(s,e);this.advanceAfterAssetEnded(s,a,o-1)}}setSchedulePosition(e,t){var i;const r=(i=this.schedule)==null?void 0:i.items;if(!r||this.playbackDisabled)return;const s=e>=0?r[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${s&&ji(s)})`);const a=this.waitingItem||this.playingItem,o=this.playingLastItem;if(this.isInterstitial(a)){const u=a.event,d=this.playingAsset,h=d==null?void 0:d.identifier,m=h?this.getAssetPlayer(h):null;if(m&&h&&(!this.eventItemsMatch(a,s)||t!==void 0&&h!==u.assetList[t].identifier)){var l;const g=u.findAssetIndex(d);if(this.log(`INTERSTITIAL_ASSET_ENDED ${g+1}/${u.assetList.length} ${ia(d)}`),this.endedAsset=d,this.playingAsset=null,this.hls.trigger(O.INTERSTITIAL_ASSET_ENDED,{asset:d,assetListIndex:g,event:u,schedule:r.slice(0),scheduleIndex:e,player:m}),a!==this.playingItem){this.itemsMatch(a,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(u,this.findItemIndex(this.playingItem),g);return}this.retreiveMediaSource(h,s),m.media&&!((l=this.detachedData)!=null&&l.mediaSource)&&m.detachMedia()}if(!this.eventItemsMatch(a,s)&&(this.endedItem=a,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${u} ${ji(a)}`),u.hasPlayed=!0,this.hls.trigger(O.INTERSTITIAL_ENDED,{event:u,schedule:r.slice(0),scheduleIndex:e}),u.cue.once)){var c;this.updateSchedule();const g=(c=this.schedule)==null?void 0:c.items;if(s&&g){const v=this.findItemIndex(s);this.advanceSchedule(v,g,t,a,o)}return}}this.advanceSchedule(e,r,t,a,o)}advanceSchedule(e,t,i,r,s){const a=this.schedule;if(!a)return;const o=e>=0?t[e]:null,l=this.primaryMedia,c=this.playerQueue;if(c.length&&c.forEach(u=>{const d=u.interstitial,h=a.findEventIndex(d.identifier);(h<e||h>e+1)&&this.clearInterstitial(d,o)}),this.isInterstitial(o)){this.timelinePos=Math.min(Math.max(this.timelinePos,o.start),o.end);const u=o.event;if(i===void 0){i=a.findAssetIndex(u,this.timelinePos);const g=Rh(u,i-1);if(u.isAssetPastPlayoutLimit(g)||u.appendInPlace&&this.timelinePos===o.end){this.advanceAfterAssetEnded(u,e,i);return}i=g}const d=this.waitingItem;this.assetsBuffered(o,l)||this.setBufferingItem(o);let h=this.preloadAssets(u,i);if(this.eventItemsMatch(o,d||r)||(this.waitingItem=o,this.log(`INTERSTITIAL_STARTED ${ji(o)} ${u.appendInPlace?"append in place":""}`),this.hls.trigger(O.INTERSTITIAL_STARTED,{event:u,schedule:t.slice(0),scheduleIndex:e})),!u.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${u}`);return}if(u.assetListLoader&&(u.assetListLoader.destroy(),u.assetListLoader=void 0),!l){this.log(`Waiting for attachMedia to start Interstitial ${u}`);return}this.waitingItem=this.endedItem=null,this.playingItem=o;const m=u.assetList[i];if(!m){this.advanceAfterAssetEnded(u,e,i||0);return}if(h||(h=this.getAssetPlayer(m.identifier)),h===null||h.destroyed){const g=u.assetList.length;this.warn(`asset ${i+1}/${g} player destroyed ${u}`),h=this.createAssetPlayer(u,m,i),h.loadSource()}if(!this.eventItemsMatch(o,this.bufferingItem)&&u.appendInPlace&&this.isAssetBuffered(m))return;this.startAssetPlayer(h,i,t,e,l),this.shouldPlay&&Sy(h.media)}else o!==null?(this.resumePrimary(o,e,r),this.shouldPlay&&Sy(this.hls.media)):s&&this.isInterstitial(r)&&(this.endedItem=null,this.playingItem=r,r.event.appendInPlace||this.attachPrimary(a.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,i){var r,s;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${ji(e)}`),!((r=this.detachedData)!=null&&r.mediaSource)){let o=this.timelinePos;(o<e.start||o>=e.end)&&(o=this.getPrimaryResumption(e,t),this.timelinePos=o),this.attachPrimary(o,e)}if(!i)return;const a=(s=this.schedule)==null?void 0:s.items;a&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${ji(e)}`),this.hls.trigger(O.INTERSTITIALS_PRIMARY_RESUMED,{schedule:a.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const i=e.start;if(this.primaryLive){const r=this.primaryDetails;if(t===0)return this.hls.startPosition;if(r&&(i<r.fragmentStart||i>r.edge))return this.hls.liveSyncPosition||-1}return i}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:Ge.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,i){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const r=this.primaryMedia;if(!r)return;const s=this.hls;s.media?this.checkBuffer():(this.transferMediaTo(s,r),i&&this.startLoadingPrimaryAt(e,i)),i||(this.timelinePos=e,this.startLoadingPrimaryAt(e,i))}startLoadingPrimaryAt(e,t){var i;const r=this.hls;!r.loadingEnabled||!r.media||Math.abs((((i=r.mainForwardBufferInfo)==null?void 0:i.start)||r.media.currentTime)-e)>.5?r.startLoad(e,t):r.bufferingEnabled||r.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(O.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(O.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const i=this.hls.levels[t.level],r=ct(ct({},this.mediaSelection||this.altSelection),{},{main:i});this.mediaSelection=r,this.schedule.parseInterstitialDateRanges(r,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const i=this.hls.audioTracks[t.id],r=this.mediaSelection;if(!r){this.altSelection=ct(ct({},this.altSelection),{},{audio:i});return}const s=ct(ct({},r),{},{audio:i});this.mediaSelection=s}onSubtitleTrackUpdated(e,t){const i=this.hls.subtitleTracks[t.id],r=this.mediaSelection;if(!r){this.altSelection=ct(ct({},this.altSelection),{},{subtitles:i});return}const s=ct(ct({},r),{},{subtitles:i});this.mediaSelection=s}onAudioTrackSwitching(e,t){const i=M_(t);this.playerQueue.forEach(({hls:r})=>r&&(r.setAudioOption(t)||r.setAudioOption(i)))}onSubtitleTrackSwitch(e,t){const i=M_(t);this.playerQueue.forEach(({hls:r})=>r&&(r.setSubtitleOption(t)||t.id!==-1&&r.setSubtitleOption(i)))}onBufferCodecs(e,t){const i=t.tracks;i&&(this.requiredTracks=i)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const i=this.playingItem;if(i&&!this.itemsMatch(i,this.bufferingItem)&&!this.isInterstitial(i)){const r=this.timelinePos;this.bufferedPos=r,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let r=0;r<t.length;r++){const s=t[r];if(s.cue.post){var i;const a=this.schedule.findEventIndex(s.identifier),o=(i=this.schedule.items)==null?void 0:i[a];this.isInterstitial(o)&&this.eventItemsMatch(o,this.bufferingItem)&&this.bufferedToItem(o,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const i=this.findItemIndex(t);this.setSchedulePosition(i+1)}else this.shouldPlay=!1}updateItem(e,t){var i;const r=(i=this.schedule)==null?void 0:i.items;if(e&&r){const s=this.findItemIndex(e,t);return r[s]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((s,a)=>{e.event.isAssetPastPlayoutLimit(a)&&this.clearAssetPlayer(s.identifier,null)});const i=e.end+.25,r=Ge.bufferInfo(this.primaryMedia,i,0);(r.end>i||(r.nextStart||0)>i)&&(this.attachPrimary(i,null),this.flushFrontBuffer(i))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var i;return!!t&&(e===t||e.event.identifier===((i=t.event)==null?void 0:i.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const i=this.mediaSelection;i&&((t=this.schedule)==null||t.updateSchedule(i,[],e))}checkBuffer(e){var t;const i=(t=this.schedule)==null?void 0:t.items;if(!i)return;const r=Ge.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=r.len<1),this.updateBufferedPos(r.end,i,e)}updateBufferedPos(e,t,i){const r=this.schedule,s=this.bufferingItem;if(this.bufferedPos>e||!r)return;if(t.length===1&&this.itemsMatch(t[0],s)){this.bufferedPos=e;return}const a=this.playingItem,o=this.findItemIndex(a);let l=r.findItemIndexAtTime(e);if(this.bufferedPos<e){var c;const u=this.findItemIndex(s),d=Math.min(u+1,t.length-1),h=t[d];if((l===-1&&s&&e>=s.end||(c=h.event)!=null&&c.appendInPlace&&e+.01>=h.start)&&(l=d),this.isInterstitial(s)){const m=s.event;if(d-o>1&&m.appendInPlace===!1||m.assetList.length===0&&m.assetListLoader)return}if(this.bufferedPos=e,l>u&&l>o)this.bufferedToItem(h);else{const m=this.primaryDetails;this.primaryLive&&m&&e>m.edge-m.targetduration&&h.start<m.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(h)&&this.preloadAssets(h.event,0)}}else i&&a&&!this.itemsMatch(a,s)&&(l===o?this.bufferedToItem(a):l===o+1&&this.bufferedToItem(t[l]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(r=>{const s=this.getAssetPlayer(r.identifier);return!(s!=null&&s.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,i=this.schedule;if(!this.itemsMatch(e,t)&&i){const{items:r,events:s}=i;if(!r||!s)return t;const a=this.isInterstitial(e),o=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const l=o?o.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${ji(e)}`+(t?` (${l.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(a){const c=i.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((u,d)=>{const h=this.getAssetPlayer(u.identifier);h&&(d===c&&h.loadSource(),h.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(c=>c.pauseBuffering());this.hls.trigger(O.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:s.slice(0),schedule:r.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const i=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(i!==null){this.bufferingAsset=null;const r=this.detachedData;r?r.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),i=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(i)}bufferedToEvent(e,t){const i=e.event,r=i.assetList.length===0&&!i.assetListLoader,s=i.cue.once;if(r||!s){const a=this.preloadAssets(i,t);if(a!=null&&a.interstitial.appendInPlace){const o=this.primaryMedia;o&&this.bufferAssetPlayer(a,o)}}}preloadAssets(e,t){const i=e.assetUrl,r=e.assetList.length,s=r===0&&!e.assetListLoader,a=e.cue.once;if(s){const l=e.timelineStart;if(e.appendInPlace){var o;const h=this.playingItem;!this.isInterstitial(h)&&(h==null||(o=h.nextEvent)==null?void 0:o.identifier)===e.identifier&&this.flushFrontBuffer(l+.25)}let c,u=0;if(!this.playingItem&&this.primaryLive&&(u=this.hls.startPosition,u===-1&&(u=this.hls.liveSyncPosition||0)),u&&!(e.cue.pre||e.cue.post)){const h=u-l;h>0&&(c=Math.round(h*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${i?1:r} ${e}${c?` live-start: ${u} start-offset: ${c}`:""}`),i)return this.createAsset(e,0,0,l,e.duration,i);const d=this.assetListLoader.loadAssetList(e,c);d&&(e.assetListLoader=d)}else if(!a&&r){for(let c=t;c<r;c++){const u=e.assetList[c],d=this.getAssetPlayerQueueIndex(u.identifier);(d===-1||this.playerQueue[d].destroyed)&&!u.error&&this.createAssetPlayer(e,u,c)}const l=e.assetList[t];if(l){const c=this.getAssetPlayer(l.identifier);return c&&c.loadSource(),c}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(r=>{this.hls.trigger(O.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:r})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let i=0;i<t.length;i++)if(e===t[i].assetId)return i;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let i=0;i<e.length;i++)if(e[i].media===t)return e[i]}return null}createAsset(e,t,i,r,s,a){const o={parentIdentifier:e.identifier,identifier:eM(e,a,t),duration:s,startOffset:i,timelineStart:r,uri:a};return this.createAssetPlayer(e,o,t)}createAssetPlayer(e,t,i){const r=this.hls,s=r.userConfig;let a=s.videoPreference;const o=r.loadLevelObj||r.levels[r.currentLevel];(a||o)&&(a=ut({},a),o.videoCodec&&(a.videoCodec=o.videoCodec),o.videoRange&&(a.allowedVideoRanges=[o.videoRange]));const l=r.audioTracks[r.audioTrack],c=r.subtitleTracks[r.subtitleTrack];let u=0;if(this.primaryLive||e.appendInPlace){const D=this.timelinePos-t.timelineStart;if(D>1){const V=t.duration;V&&D<V&&(u=D)}}const d=t.identifier,h=ct(ct({},s),{},{maxMaxBufferLength:Math.min(180,r.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:r.sessionId,assetPlayerId:d,abrEwmaDefaultEstimate:r.bandwidthEstimate,interstitialsController:void 0,startPosition:u,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:a,audioPreference:l||s.audioPreference,subtitlePreference:c||s.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(h.timelineOffset=t.timelineStart));const m=h.cmcd;m!=null&&m.sessionId&&m.contentId&&(h.cmcd=ut({},m,{contentId:jo(t.uri)})),this.getAssetPlayer(d)&&this.warn(`Duplicate date range identifier ${e} and asset ${d}`);const g=new iM(this.HlsPlayerClass,h,e,t);this.playerQueue.push(g),e.assetList[i]=t;let v=!0;const x=D=>{if(D.live){var V;const S=new Error(`Interstitials MUST be VOD assets ${e}`),b={fatal:!0,type:Pe.OTHER_ERROR,details:se.INTERSTITIAL_ASSET_ITEM_ERROR,error:S},T=((V=this.schedule)==null?void 0:V.findEventIndex(e.identifier))||-1;this.handleAssetItemError(b,e,T,i,S.message);return}const H=D.edge-D.fragmentStart,C=t.duration;(v||C===null||H>C)&&(v=!1,this.log(`Interstitial asset "${d}" duration change ${C} > ${H}`),t.duration=H,this.updateSchedule())};g.on(O.LEVEL_UPDATED,(D,{details:V})=>x(V)),g.on(O.LEVEL_PTS_UPDATED,(D,{details:V})=>x(V)),g.on(O.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const E=(D,V)=>{const H=this.getAssetPlayer(d);if(H&&V.tracks){H.off(O.BUFFER_CODECS,E),H.tracks=V.tracks;const C=this.primaryMedia;this.bufferingAsset===H.assetItem&&C&&!H.media&&this.bufferAssetPlayer(H,C)}};g.on(O.BUFFER_CODECS,E);const R=()=>{var D;const V=this.getAssetPlayer(d);if(this.log(`buffered to end of asset ${V}`),!V||!this.schedule)return;const H=this.schedule.findEventIndex(e.identifier),C=(D=this.schedule.items)==null?void 0:D[H];this.isInterstitial(C)&&this.advanceAssetBuffering(C,t)};g.on(O.BUFFERED_TO_END,R);const k=D=>()=>{if(!this.getAssetPlayer(d)||!this.schedule)return;this.shouldPlay=!0;const H=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,H,D)};return g.once(O.MEDIA_ENDED,k(i)),g.once(O.PLAYOUT_LIMIT_REACHED,k(1/0)),g.on(O.ERROR,(D,V)=>{if(!this.schedule)return;const H=this.getAssetPlayer(d);if(V.details===se.BUFFER_STALLED_ERROR){if(H!=null&&H.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(V,e,this.schedule.findEventIndex(e.identifier),i,`Asset player error ${V.error} ${e}`)}),g.on(O.DESTROYING,()=>{if(!this.getAssetPlayer(d)||!this.schedule)return;const V=new Error(`Asset player destroyed unexpectedly ${d}`),H={fatal:!0,type:Pe.OTHER_ERROR,details:se.INTERSTITIAL_ASSET_ITEM_ERROR,error:V};this.handleAssetItemError(H,e,this.schedule.findEventIndex(e.identifier),i,V.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${ia(t)}`),this.hls.trigger(O.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:i,event:e,player:g}),g}clearInterstitial(e,t){e.assetList.forEach(i=>{this.clearAssetPlayer(i.identifier,t)}),e.reset()}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const i=this.playerQueue[t];this.transferMediaFromPlayer(i,null),i.resetDetails()}}clearAssetPlayer(e,t){const i=this.getAssetPlayerQueueIndex(e);if(i!==-1){this.log(`clear asset player "${e}" toSegment: ${t&&ji(t)}`);const r=this.playerQueue[i];this.transferMediaFromPlayer(r,t),this.playerQueue.splice(i,1),r.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,i,r,s){const{interstitial:a,assetItem:o,assetId:l}=e,c=a.assetList.length,u=this.playingAsset;this.endedAsset=null,this.playingAsset=o,(!u||u.identifier!==l)&&(u&&(this.clearAssetPlayer(u.identifier,i[r]),delete u.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${c} ${ia(o)}`),this.hls.trigger(O.INTERSTITIAL_ASSET_STARTED,{asset:o,assetListIndex:t,event:a,schedule:i.slice(0),scheduleIndex:r,player:e})),this.bufferAssetPlayer(e,s)}bufferAssetPlayer(e,t){var i,r;if(!this.schedule)return;const{interstitial:s,assetItem:a}=e,o=this.schedule.findEventIndex(s.identifier),l=(i=this.schedule.items)==null?void 0:i[o];if(!l)return;e.loadSource(),this.setBufferingItem(l),this.bufferingAsset=a;const c=this.getBufferingPlayer();if(c===e)return;const u=s.appendInPlace;if(u&&(c==null?void 0:c.interstitial.appendInPlace)===!1)return;const d=(c==null?void 0:c.tracks)||((r=this.detachedData)==null?void 0:r.tracks)||this.requiredTracks;if(u&&a!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(d&&!IS(d,e.tracks)){const h=new Error(`Asset ${ia(a)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(d)}')`),m={fatal:!0,type:Pe.OTHER_ERROR,details:se.INTERSTITIAL_ASSET_ITEM_ERROR,error:h},g=s.findAssetIndex(a);this.handleAssetItemError(m,s,o,g,h.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,i=this.primaryMedia;if(!t||!i)return;const r=i.currentTime,s=t.findAssetIndex(e,r),a=e.assetList[s];if(a){const o=this.getAssetPlayer(a.identifier);if(o){const l=o.currentTime||r-a.timelineStart,c=o.duration-l;if(this.warn(`Stalled at ${l} of ${l+c} in ${o} ${e} (media.currentTime: ${r})`),l&&(c/i.playbackRate<.5||o.bufferedInPlaceToEnd(i))&&o.hls){const u=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,u,s)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,i,r,s){if(e.details===se.BUFFER_STALLED_ERROR)return;const a=t.assetList[r]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${a&&ia(a)} ${e.error}`),!this.schedule)return;const o=(a==null?void 0:a.identifier)||"",l=this.getAssetPlayerQueueIndex(o),c=this.playerQueue[l]||null,u=this.schedule.items,d=ut({},e,{fatal:!1,errorAction:fl(!0),asset:a,assetListIndex:r,event:t,schedule:u,scheduleIndex:i,player:c});if(this.hls.trigger(O.INTERSTITIAL_ASSET_ERROR,d),!e.fatal)return;const h=this.playingAsset,m=this.bufferingAsset,g=new Error(s);if(a&&(this.clearAssetPlayer(o,null),a.error=g),!t.assetList.some(v=>!v.error))t.error=g;else for(let v=r;v<t.assetList.length;v++)this.resetAssetPlayer(t.assetList[v].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):h&&h.identifier===o?this.advanceAfterAssetEnded(t,i,r):m&&m.identifier===o&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,m)}primaryFallback(e){const t=e.timelineStart,i=this.effectivePlayingItem;if(i){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${this.timelinePos} playing: ${ji(i)} error: ${e.error}`);let r=this.timelinePos;r===-1&&(r=this.hls.startPosition);const s=this.updateItem(i,r);if(this.itemsMatch(i,s)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t)),!this.schedule)return;const a=this.schedule.findItemIndexAtTime(r);this.setSchedulePosition(a)}else this.checkStart()}onAssetListLoaded(e,t){var i,r;const s=t.event,a=s.identifier,o=t.assetListResponse.ASSETS;if(!((i=this.schedule)!=null&&i.hasEvent(a)))return;const l=s.timelineStart,c=s.duration;let u=0;o.forEach((v,x)=>{const E=parseFloat(v.DURATION);this.createAsset(s,x,u,l+u,E,v.URI),u+=E}),s.duration=u,this.log(`Loaded asset-list with duration: ${u} (was: ${c}) ${s}`);const d=this.waitingItem,h=(d==null?void 0:d.event.identifier)===a;this.updateSchedule();const m=(r=this.bufferingItem)==null?void 0:r.event;if(h){var g;const v=this.schedule.findEventIndex(a),x=(g=this.schedule.items)==null?void 0:g[v];if(x){if(!this.playingItem&&this.timelinePos>x.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==v){s.error=new Error(`Interstitial no longer within playback range ${this.timelinePos} ${s}`),this.updateSchedule(!0),this.primaryFallback(s);return}this.setBufferingItem(x)}this.setSchedulePosition(v)}else if((m==null?void 0:m.identifier)===a){const v=s.assetList[0];if(v){const x=this.getAssetPlayer(v.identifier);if(m.appendInPlace){const E=this.primaryMedia;x&&E&&this.bufferAssetPlayer(x,E)}else x&&x.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case se.ASSET_LIST_PARSING_ERROR:case se.ASSET_LIST_LOAD_ERROR:case se.ASSET_LIST_LOAD_TIMEOUT:{const i=t.interstitial;i&&(this.updateSchedule(!0),this.primaryFallback(i));break}case se.BUFFER_STALLED_ERROR:{const i=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(i)&&i.event.appendInPlace){this.handleInPlaceStall(i.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const Ty=500;class oM extends Mm{constructor(e,t,i){super(e,t,i,"subtitle-stream-controller",Ce.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(O.LEVEL_LOADED,this.onLevelLoaded,this),e.on(O.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(O.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(O.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(O.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(O.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(O.LEVEL_LOADED,this.onLevelLoaded,this),e.off(O.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(O.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(O.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(O.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(O.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=he.IDLE,this.setInterval(Ty),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:i,success:r}=t;if(this.fragContextChanged(i)||(Bt(i)&&(this.fragPrevious=i),this.state=he.IDLE),!r)return;const s=this.tracksBuffered[this.currentTrackId];if(!s)return;let a;const o=i.start;for(let c=0;c<s.length;c++)if(o>=s[c].start&&o<=s[c].end){a=s[c];break}const l=i.start+i.duration;a?a.end=l:(a={start:o,end:l},s.push(a)),this.fragmentTracker.fragBuffered(i),this.fragBufferedComplete(i,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:i,endOffset:r}=t;if(i===0&&r!==Number.POSITIVE_INFINITY){const s=r-1;if(s<=0)return;t.endOffsetSubtitles=Math.max(0,s),this.tracksBuffered.forEach(a=>{for(let o=0;o<a.length;){if(a[o].end<=s){a.shift();continue}else if(a[o].start<s)a[o].start=s;else break;o++}}),this.fragmentTracker.removeFragmentsInRange(i,s,Ce.SUBTITLE)}}onError(e,t){const i=t.frag;(i==null?void 0:i.type)===Ce.SUBTITLE&&(t.details===se.FRAG_GAP&&this.fragmentTracker.fragBuffered(i,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==he.STOPPED&&(this.state=he.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&AT(this.levels,t)){this.levels=t.map(i=>new hl(i));return}this.tracksBuffered=[],this.levels=t.map(i=>{const r=new hl(i);return this.tracksBuffered[r.id]=[],r}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,Ce.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var i;if(this.currentTrackId=t.id,!((i=this.levels)!=null&&i.length)||this.currentTrackId===-1){this.clearInterval();return}const r=this.levels[this.currentTrackId];r!=null&&r.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,r&&this.state!==he.STOPPED&&this.setInterval(Ty)}onSubtitleTrackLoaded(e,t){var i;const{currentTrackId:r,levels:s}=this,{details:a,id:o}=t;if(!s){this.warn(`Subtitle tracks were reset while loading level ${o}`);return}const l=s[o];if(o>=s.length||!l)return;this.log(`Subtitle track ${o} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let c=0;if(a.live||(i=l.details)!=null&&i.live){if(a.deltaUpdateFailed)return;const d=this.mainDetails;if(!d){this.startFragRequested=!1;return}const h=d.fragments[0];if(!l.details)a.hasProgramDateTime&&d.hasProgramDateTime?(Gu(a,d),c=a.fragmentStart):h&&(c=h.start,Yf(a,c));else{var u;c=this.alignPlaylists(a,l.details,(u=this.levelLastLoaded)==null?void 0:u.details),c===0&&h&&(c=h.start,Yf(a,c))}d&&!this.startFragRequested&&this.setStartPosition(d,c)}l.details=a,this.levelLastLoaded=l,o===r&&(this.hls.trigger(O.SUBTITLE_TRACK_UPDATED,{details:a,id:o,groupId:t.groupId}),this.tick(),a.live&&!this.fragCurrent&&this.media&&this.state===he.IDLE&&(Vs(null,a.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:i}=e,r=t.decryptdata,s=this.hls;if(!this.fragContextChanged(t)&&i&&i.byteLength>0&&r!=null&&r.key&&r.iv&&La(r.method)){const a=performance.now();this.decrypter.decrypt(new Uint8Array(i),r.key.buffer,r.iv.buffer,Pm(r.method)).catch(o=>{throw s.trigger(O.ERROR,{type:Pe.MEDIA_ERROR,details:se.FRAG_DECRYPT_ERROR,fatal:!1,error:o,reason:o.message,frag:t}),o}).then(o=>{const l=performance.now();s.trigger(O.FRAG_DECRYPTED,{frag:t,payload:o,stats:{tstart:a,tdecrypt:l}})}).catch(o=>{this.warn(`${o.name}: ${o.message}`),this.state=he.IDLE})}}doTick(){if(!this.media){this.state=he.IDLE;return}if(this.state===he.IDLE){const{currentTrackId:e,levels:t}=this,i=t==null?void 0:t[e];if(!i||!t.length||!i.details||this.waitForLive(i))return;const{config:r}=this,s=this.getLoadPosition(),a=Ge.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],s,r.maxBufferHole),{end:o,len:l}=a,c=i.details,u=this.hls.maxBufferLength+c.levelTargetDuration;if(l>u)return;const d=c.fragments,h=d.length,m=c.edge;let g=null;const v=this.fragPrevious;if(o<m){const R=r.maxFragLookUpTolerance,k=o>m-R?0:R;g=Vs(v,d,Math.max(d[0].start,o),k),!g&&v&&v.start<d[0].start&&(g=d[0])}else g=d[h-1];if(g=this.filterReplacedPrimary(g,i.details),!g)return;const x=g.sn-c.startSN,E=d[x-1];if(E&&E.cc===g.cc&&this.fragmentTracker.getState(E)===Kt.NOT_LOADED&&(g=E),this.fragmentTracker.getState(g)===Kt.NOT_LOADED){const R=this.mapToInitFragWhenRequired(g);R&&this.loadFragment(R,i,o)}}}loadFragment(e,t,i){Bt(e)?super.loadFragment(e,t,i):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new lM(this.tracksBuffered[this.currentTrackId]||[])}}class lM{constructor(e){this.buffered=void 0;const t=(i,r,s)=>{if(r=r>>>0,r>s-1)throw new DOMException(`Failed to execute '${i}' on 'TimeRanges': The index provided (${r}) is greater than the maximum bound (${s})`);return e[r][i]};this.buffered={get length(){return e.length},end(i){return t("end",i,e.length)},start(i){return t("start",i,e.length)}}}}const cM={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},UT=n=>String.fromCharCode(cM[n]||n),ni=15,Gi=100,uM={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},dM={17:2,18:4,21:6,22:8,23:10,19:13,20:15},hM={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},fM={25:2,26:4,29:6,30:8,31:10,27:13,28:15},pM=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class mM{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const i=typeof t=="function"?t():t;ot.log(`${this.time} [${e}] ${i}`)}}}const _s=function(e){const t=[];for(let i=0;i<e.length;i++)t.push(e[i].toString(16));return t};class $T{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let i=0;i<t.length;i++){const r=t[i];e.hasOwnProperty(r)&&(this[r]=e[r])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class gM{constructor(){this.uchar=" ",this.penState=new $T}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class _M{constructor(e){this.chars=[],this.pos=0,this.currPenState=new $T,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<Gi;t++)this.chars.push(new gM);this.logger=e}equals(e){for(let t=0;t<Gi;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<Gi;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<Gi;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Gi&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Gi)}moveCursor(e){const t=this.pos+e;if(e>1)for(let i=this.pos+1;i<t+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=UT(e);if(this.pos>=Gi){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<Gi;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let i=0;i<Gi;i++){const r=this.chars[i].uchar;r!==" "&&(t=!1),e.push(r)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class Lh{constructor(e){this.rows=[],this.currRow=ni-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<ni;t++)this.rows.push(new _M(e));this.logger=e}reset(){for(let e=0;e<ni;e++)this.rows[e].clear();this.currRow=ni-1}equals(e){let t=!0;for(let i=0;i<ni;i++)if(!this.rows[i].equals(e.rows[i])){t=!1;break}return t}copy(e){for(let t=0;t<ni;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<ni;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+vt(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let o=0;o<ni;o++)this.rows[o].clear();const s=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){const o=a.rows[s].cueStartTime,l=this.logger.time;if(o!==null&&l!==null&&o<l)for(let c=0;c<this.nrRollUpRows;c++)this.rows[t-this.nrRollUpRows+c+1].copy(a.rows[s+c])}}this.currRow=t;const i=this.rows[this.currRow];if(e.indent!==null){const s=e.indent,a=Math.max(s-1,0);i.setCursor(e.indent),e.color=i.chars[a].penState.foreground}const r={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(r)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+vt(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let i="",r=-1;for(let s=0;s<ni;s++){const a=this.rows[s].getTextString();a&&(r=s+1,e?t.push("Row "+r+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(e?i="["+t.join(" | ")+"]":i=t.join(`
`)),i}getTextAndFormat(){return this.rows}}class Ay{constructor(e,t,i){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Lh(i),this.nonDisplayedMemory=new Lh(i),this.lastOutputScreen=new Lh(i),this.currRollUpRow=this.displayedMemory.rows[ni-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=i}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[ni-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let i=0;i<e.length;i++)this.writeScreen.insertChar(e[i]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const i=Math.floor(e/2)-16,r=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=r[i]}this.logger.log(2,"MIDROW: "+vt(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class xy{constructor(e,t,i){this.channels=void 0,this.currentChannel=0,this.cmdHistory=vM(),this.logger=void 0;const r=this.logger=new mM;this.channels=[null,new Ay(e,t,r),new Ay(e+1,i,r)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let i=0;i<t.length;i+=2){const r=t[i]&127,s=t[i+1]&127;let a=!1,o=null;if(r===0&&s===0)continue;this.logger.log(3,()=>"["+_s([t[i],t[i+1]])+"] -> ("+_s([r,s])+")");const l=this.cmdHistory;if(r>=16&&r<=31){if(yM(r,s,l)){xc(null,null,l),this.logger.log(3,()=>"Repeated command ("+_s([r,s])+") is dropped");continue}xc(r,s,this.cmdHistory),a=this.parseCmd(r,s),a||(a=this.parseMidrow(r,s)),a||(a=this.parsePAC(r,s)),a||(a=this.parseBackgroundAttributes(r,s))}else xc(null,null,l);if(!a&&(o=this.parseChars(r,s),o)){const u=this.currentChannel;u&&u>0?this.channels[u].insertChars(o):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!a&&!o&&this.logger.log(2,()=>"Couldn't parse cleaned data "+_s([r,s])+" orig: "+_s([t[i],t[i+1]]))}}parseCmd(e,t){const i=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,r=(e===23||e===31)&&t>=33&&t<=35;if(!(i||r))return!1;const s=e===20||e===21||e===23?1:2,a=this.channels[s];return e===20||e===21||e===28||e===29?t===32?a.ccRCL():t===33?a.ccBS():t===34?a.ccAOF():t===35?a.ccAON():t===36?a.ccDER():t===37?a.ccRU(2):t===38?a.ccRU(3):t===39?a.ccRU(4):t===40?a.ccFON():t===41?a.ccRDC():t===42?a.ccTR():t===43?a.ccRTD():t===44?a.ccEDM():t===45?a.ccCR():t===46?a.ccENM():t===47&&a.ccEOC():a.ccTO(t-32),this.currentChannel=s,!0}parseMidrow(e,t){let i=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?i=1:i=2,i!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const r=this.channels[i];return r?(r.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+_s([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let i;const r=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,s=(e===16||e===24)&&t>=64&&t<=95;if(!(r||s))return!1;const a=e<=23?1:2;t>=64&&t<=95?i=a===1?uM[e]:hM[e]:i=a===1?dM[e]:fM[e];const o=this.channels[a];return o?(o.setPAC(this.interpretPAC(i,t)),this.currentChannel=a,!0):!1}interpretPAC(e,t){let i;const r={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?i=t-96:i=t-64,r.underline=(i&1)===1,i<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(r.italics=!0,r.color="white"):r.indent=Math.floor((i-16)/2)*4,r}parseChars(e,t){let i,r=null,s=null;if(e>=25?(i=2,s=e-8):(i=1,s=e),s>=17&&s<=19){let a;s===17?a=t+80:s===18?a=t+112:a=t+144,this.logger.log(2,()=>"Special char '"+UT(a)+"' in channel "+i),r=[a]}else e>=32&&e<=127&&(r=t===0?[e]:[e,t]);return r&&this.logger.log(3,()=>"Char codes =  "+_s(r).join(",")),r}parseBackgroundAttributes(e,t){const i=(e===16||e===24)&&t>=32&&t<=47,r=(e===23||e===31)&&t>=45&&t<=47;if(!(i||r))return!1;let s;const a={};e===16||e===24?(s=Math.floor((t-32)/2),a.background=pM[s],t%2===1&&(a.background=a.background+"_semi")):t===45?a.background="transparent":(a.foreground="black",t===47&&(a.underline=!0));const o=e<=23?1:2;return this.channels[o].setBkgData(a),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}xc(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const i=this.channels[t];i&&i.cueSplitAtTime(e)}}}function xc(n,e,t){t.a=n,t.b=e}function yM(n,e,t){return t.a===n&&t.b===e}function vM(){return{a:null,b:null}}var Wm=function(){if(ju!=null&&ju.VTTCue)return self.VTTCue;const n=["","lr","rl"],e=["start","middle","end","left","right"];function t(o,l){if(typeof l!="string"||!Array.isArray(o))return!1;const c=l.toLowerCase();return~o.indexOf(c)?c:!1}function i(o){return t(n,o)}function r(o){return t(e,o)}function s(o,...l){let c=1;for(;c<arguments.length;c++){const u=arguments[c];for(const d in u)o[d]=u[d]}return o}function a(o,l,c){const u=this,d={enumerable:!0};u.hasBeenReset=!1;let h="",m=!1,g=o,v=l,x=c,E=null,R="",k=!0,D="auto",V="start",H=50,C="middle",S=50,b="middle";Object.defineProperty(u,"id",s({},d,{get:function(){return h},set:function(T){h=""+T}})),Object.defineProperty(u,"pauseOnExit",s({},d,{get:function(){return m},set:function(T){m=!!T}})),Object.defineProperty(u,"startTime",s({},d,{get:function(){return g},set:function(T){if(typeof T!="number")throw new TypeError("Start time must be set to a number.");g=T,this.hasBeenReset=!0}})),Object.defineProperty(u,"endTime",s({},d,{get:function(){return v},set:function(T){if(typeof T!="number")throw new TypeError("End time must be set to a number.");v=T,this.hasBeenReset=!0}})),Object.defineProperty(u,"text",s({},d,{get:function(){return x},set:function(T){x=""+T,this.hasBeenReset=!0}})),Object.defineProperty(u,"region",s({},d,{get:function(){return E},set:function(T){E=T,this.hasBeenReset=!0}})),Object.defineProperty(u,"vertical",s({},d,{get:function(){return R},set:function(T){const L=i(T);if(L===!1)throw new SyntaxError("An invalid or illegal string was specified.");R=L,this.hasBeenReset=!0}})),Object.defineProperty(u,"snapToLines",s({},d,{get:function(){return k},set:function(T){k=!!T,this.hasBeenReset=!0}})),Object.defineProperty(u,"line",s({},d,{get:function(){return D},set:function(T){if(typeof T!="number"&&T!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");D=T,this.hasBeenReset=!0}})),Object.defineProperty(u,"lineAlign",s({},d,{get:function(){return V},set:function(T){const L=r(T);if(!L)throw new SyntaxError("An invalid or illegal string was specified.");V=L,this.hasBeenReset=!0}})),Object.defineProperty(u,"position",s({},d,{get:function(){return H},set:function(T){if(T<0||T>100)throw new Error("Position must be between 0 and 100.");H=T,this.hasBeenReset=!0}})),Object.defineProperty(u,"positionAlign",s({},d,{get:function(){return C},set:function(T){const L=r(T);if(!L)throw new SyntaxError("An invalid or illegal string was specified.");C=L,this.hasBeenReset=!0}})),Object.defineProperty(u,"size",s({},d,{get:function(){return S},set:function(T){if(T<0||T>100)throw new Error("Size must be between 0 and 100.");S=T,this.hasBeenReset=!0}})),Object.defineProperty(u,"align",s({},d,{get:function(){return b},set:function(T){const L=r(T);if(!L)throw new SyntaxError("An invalid or illegal string was specified.");b=L,this.hasBeenReset=!0}})),u.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a}();class EM{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function VT(n){function e(i,r,s,a){return(i|0)*3600+(r|0)*60+(s|0)+parseFloat(a||0)}const t=n.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class SM{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,i){return i?this.has(e)?this.values[e]:t[i]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,i){for(let r=0;r<i.length;++r)if(t===i[r]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const i=parseFloat(t);if(i>=0&&i<=100)return this.set(e,i),!0}return!1}}function jT(n,e,t,i){const r=i?n.split(i):[n];for(const s in r){if(typeof r[s]!="string")continue;const a=r[s].split(t);if(a.length!==2)continue;const o=a[0],l=a[1];e(o,l)}}const ip=new Wm(0,0,""),bc=ip.align==="middle"?"middle":"center";function TM(n,e,t){const i=n;function r(){const o=VT(n);if(o===null)throw new Error("Malformed timestamp: "+i);return n=n.replace(/^[^\sa-zA-Z-]+/,""),o}function s(o,l){const c=new SM;jT(o,function(h,m){let g;switch(h){case"region":for(let v=t.length-1;v>=0;v--)if(t[v].id===m){c.set(h,t[v].region);break}break;case"vertical":c.alt(h,m,["rl","lr"]);break;case"line":g=m.split(","),c.integer(h,g[0]),c.percent(h,g[0])&&c.set("snapToLines",!1),c.alt(h,g[0],["auto"]),g.length===2&&c.alt("lineAlign",g[1],["start",bc,"end"]);break;case"position":g=m.split(","),c.percent(h,g[0]),g.length===2&&c.alt("positionAlign",g[1],["start",bc,"end","line-left","line-right","auto"]);break;case"size":c.percent(h,m);break;case"align":c.alt(h,m,["start",bc,"end","left","right"]);break}},/:/,/\s/),l.region=c.get("region",null),l.vertical=c.get("vertical","");let u=c.get("line","auto");u==="auto"&&ip.line===-1&&(u=-1),l.line=u,l.lineAlign=c.get("lineAlign","start"),l.snapToLines=c.get("snapToLines",!0),l.size=c.get("size",100),l.align=c.get("align",bc);let d=c.get("position","auto");d==="auto"&&ip.position===50&&(d=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=d}function a(){n=n.replace(/^\s+/,"")}if(a(),e.startTime=r(),a(),n.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+i);n=n.slice(3),a(),e.endTime=r(),a(),s(n,e)}function GT(n){return n.replace(/<br(?: \/)?>/gi,`
`)}class AM{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new EM,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function i(){let s=t.buffer,a=0;for(s=GT(s);a<s.length&&s[a]!=="\r"&&s[a]!==`
`;)++a;const o=s.slice(0,a);return s[a]==="\r"&&++a,s[a]===`
`&&++a,t.buffer=s.slice(a),o}function r(s){jT(s,function(a,o){},/:/)}try{let s="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;s=i();const o=s.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!(o!=null&&o[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let a=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(a?a=!1:s=i(),t.state){case"HEADER":/:/.test(s)?r(s):s||(t.state="ID");continue;case"NOTE":s||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(s)){t.state="NOTE";break}if(!s)continue;if(t.cue=new Wm(0,0,""),t.state="CUE",s.indexOf("-->")===-1){t.cue.id=s;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{TM(s,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const o=s.indexOf("-->")!==-1;if(!s||o&&(a=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=s}continue;case"BADCUE":s||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const xM=/\r\n|\n\r|\n|\r/g,wh=function(e,t,i=0){return e.slice(i,i+t.length)===t},bM=function(e){let t=parseInt(e.slice(-3));const i=parseInt(e.slice(-6,-4)),r=parseInt(e.slice(-9,-7)),s=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!Re(t)||!Re(i)||!Re(r)||!Re(s))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*i,t+=60*1e3*r,t+=60*60*1e3*s,t};function qm(n,e,t){return jo(n.toString())+jo(e.toString())+jo(t)}const IM=function(e,t,i){let r=e[t],s=e[r.prevCC];if(!s||!s.new&&r.new){e.ccOffset=e.presentationOffset=r.start,r.new=!1;return}for(;(a=s)!=null&&a.new;){var a;e.ccOffset+=r.start-s.start,r.new=!1,r=s,s=e[r.prevCC]}e.presentationOffset=i};function RM(n,e,t,i,r,s,a){const o=new AM,l=On(new Uint8Array(n)).trim().replace(xM,`
`).split(`
`),c=[],u=e?OP(e.baseTime,e.timescale):0;let d="00:00.000",h=0,m=0,g,v=!0;o.oncue=function(x){const E=t[i];let R=t.ccOffset;const k=(h-u)/9e4;if(E!=null&&E.new&&(m!==void 0?R=t.ccOffset=E.start:IM(t,i,k)),k){if(!e){g=new Error("Missing initPTS for VTT MPEGTS");return}R=k-t.presentationOffset}const D=x.endTime-x.startTime,V=jn((x.startTime+R-m)*9e4,r*9e4)/9e4;x.startTime=Math.max(V,0),x.endTime=Math.max(V+D,0);const H=x.text.trim();x.text=decodeURIComponent(encodeURIComponent(H)),x.id||(x.id=qm(x.startTime,x.endTime,H)),x.endTime>0&&c.push(x)},o.onparsingerror=function(x){g=x},o.onflush=function(){if(g){a(g);return}s(c)},l.forEach(x=>{if(v)if(wh(x,"X-TIMESTAMP-MAP=")){v=!1,x.slice(16).split(",").forEach(E=>{wh(E,"LOCAL:")?d=E.slice(6):wh(E,"MPEGTS:")&&(h=parseInt(E.slice(7)))});try{m=bM(d)/1e3}catch(E){g=E}return}else x===""&&(v=!1);o.parse(x+`
`)}),o.flush()}const Ch="stpp.ttml.im1t",HT=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,zT=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,LM={left:"start",center:"center",right:"end",start:"start",end:"end"};function by(n,e,t,i){const r=We(new Uint8Array(n),["mdat"]);if(r.length===0){i(new Error("Could not parse IMSC1 mdat"));return}const s=r.map(o=>On(o)),a=PP(e.baseTime,1,e.timescale);try{s.forEach(o=>t(wM(o,a)))}catch(o){i(o)}}function wM(n,e){const r=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("tt")[0];if(!r)throw new Error("Invalid ttml");const s={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},a=Object.keys(s).reduce((d,h)=>(d[h]=r.getAttribute(`ttp:${h}`)||s[h],d),{}),o=r.getAttribute("xml:space")!=="preserve",l=Iy(kh(r,"styling","style")),c=Iy(kh(r,"layout","region")),u=kh(r,"body","[begin]");return[].map.call(u,d=>{const h=KT(d,o);if(!h||!d.hasAttribute("begin"))return null;const m=Ph(d.getAttribute("begin"),a),g=Ph(d.getAttribute("dur"),a);let v=Ph(d.getAttribute("end"),a);if(m===null)throw Ry(d);if(v===null){if(g===null)throw Ry(d);v=m+g}const x=new Wm(m-e,v-e,h);x.id=qm(x.startTime,x.endTime,x.text);const E=c[d.getAttribute("region")],R=l[d.getAttribute("style")],k=CM(E,R,l),{textAlign:D}=k;if(D){const V=LM[D];V&&(x.lineAlign=V),x.align=D}return ut(x,k),x}).filter(d=>d!==null)}function kh(n,e,t){const i=n.getElementsByTagName(e)[0];return i?[].slice.call(i.querySelectorAll(t)):[]}function Iy(n){return n.reduce((e,t)=>{const i=t.getAttribute("xml:id");return i&&(e[i]=t),e},{})}function KT(n,e){return[].slice.call(n.childNodes).reduce((t,i,r)=>{var s;return i.nodeName==="br"&&r?t+`
`:(s=i.childNodes)!=null&&s.length?KT(i,e):e?t+i.textContent.trim().replace(/\s+/g," "):t+i.textContent},"")}function CM(n,e,t){const i="http://www.w3.org/ns/ttml#styling";let r=null;const s=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=n!=null&&n.hasAttribute("style")?n.getAttribute("style"):null;return a&&t.hasOwnProperty(a)&&(r=t[a]),s.reduce((o,l)=>{const c=Dh(e,i,l)||Dh(n,i,l)||Dh(r,i,l);return c&&(o[l]=c),o},{})}function Dh(n,e,t){return n&&n.hasAttributeNS(e,t)?n.getAttributeNS(e,t):null}function Ry(n){return new Error(`Could not parse ttml timestamp ${n}`)}function Ph(n,e){if(!n)return null;let t=VT(n);return t===null&&(HT.test(n)?t=kM(n,e):zT.test(n)&&(t=DM(n,e))),t}function kM(n,e){const t=HT.exec(n),i=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+i/e.frameRate}function DM(n,e){const t=zT.exec(n),i=Number(t[1]);switch(t[2]){case"h":return i*3600;case"m":return i*60;case"ms":return i*1e3;case"f":return i/e.frameRate;case"t":return i/e.tickRate}return i}class Ic{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,i){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class PM{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=wy(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(O.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(O.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(O.FRAG_LOADING,this.onFragLoading,this),e.on(O.FRAG_LOADED,this.onFragLoaded,this),e.on(O.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(O.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(O.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(O.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(O.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(O.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(O.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(O.FRAG_LOADING,this.onFragLoading,this),e.off(O.FRAG_LOADED,this.onFragLoaded,this),e.off(O.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(O.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(O.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(O.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(O.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new Ic(this,"textTrack1"),t=new Ic(this,"textTrack2"),i=new Ic(this,"textTrack3"),r=new Ic(this,"textTrack4");this.cea608Parser1=new xy(1,e,t),this.cea608Parser2=new xy(3,i,r)}addCues(e,t,i,r,s){let a=!1;for(let o=s.length;o--;){const l=s[o],c=OM(l[0],l[1],t,i);if(c>=0&&(l[0]=Math.min(l[0],t),l[1]=Math.max(l[1],i),a=!0,c/(i-t)>.5))return}if(a||s.push([t,i]),this.config.renderTextTracksNatively){const o=this.captionsTracks[e];this.Cues.newCue(o,t,i,r)}else{const o=this.Cues.newCue(null,t,i,r);this.hls.trigger(O.CUES_PARSED,{type:"captions",cues:o,track:e})}}onInitPtsFound(e,{frag:t,id:i,initPTS:r,timescale:s,trackId:a}){const{unparsedVttFrags:o}=this;i===Ce.MAIN&&(this.initPTS[t.cc]={baseTime:r,timescale:s,trackId:a}),o.length&&(this.unparsedVttFrags=[],o.forEach(l=>{this.initPTS[l.frag.cc]?this.onFragLoaded(O.FRAG_LOADED,l):this.hls.trigger(O.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:l.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:i}=this;if(i)for(let r=0;r<i.textTracks.length;r++){const s=i.textTracks[r];if(Ly(s,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return s}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:i,media:r}=this,{label:s,languageCode:a}=t[e],o=this.getExistingTrack(s,a);if(o)i[e]=o,_a(i[e]),NT(i[e],r);else{const l=this.createTextTrack("captions",s,a);l&&(l[e]=!0,i[e]=l)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const i=t.label,r={_id:e,label:i,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=r,this.hls.trigger(O.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}createTextTrack(e,t,i){const r=this.media;if(r)return r.addTextTrack(e,t,i)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const i=!!t.transferMedia;if(this.media=null,i)return;const{captionsTracks:r}=this;Object.keys(r).forEach(s=>{_a(r[s]),delete r[s]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=wy(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let i=0;i<t.length;i++)_a(t[i])}onSubtitleTracksUpdated(e,t){const i=t.subtitleTracks||[],r=i.some(s=>s.textCodec===Ch);if(this.config.enableWebVTT||r&&this.config.enableIMSC1){if(AT(this.tracks,i)){this.tracks=i;return}if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){const a=this.media,o=a?eu(a.textTracks):null;if(this.tracks.forEach((l,c)=>{let u;if(o){let d=null;for(let h=0;h<o.length;h++)if(o[h]&&Ly(o[h],l)){d=o[h],o[h]=null;break}d&&(u=d)}if(u)_a(u);else{const d=WT(l);u=this.createTextTrack(d,l.name,l.lang),u&&(u.mode="disabled")}u&&this.textTracks.push(u)}),o!=null&&o.length){const l=o.filter(c=>c!==null).map(c=>c.label);l.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${l.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const a=this.tracks.map(o=>({label:o.name,kind:o.type.toLowerCase(),default:o.default,subtitleTrack:o}));this.hls.trigger(O.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:a})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(i=>{const r=/(?:CC|SERVICE)([1-4])/.exec(i.instreamId);if(!r)return;const s=`textTrack${r[1]}`,a=this.captionsProperties[s];a&&(a.label=i.name,i.lang&&(a.languageCode=i.lang),a.media=i)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===Ce.MAIN){var i,r;const{cea608Parser1:s,cea608Parser2:a,lastSn:o}=this,{cc:l,sn:c}=t.frag,u=(i=(r=t.part)==null?void 0:r.index)!=null?i:-1;s&&a&&(c!==o+1||c===o&&u!==this.lastPartIndex+1||l!==this.lastCc)&&(s.reset(),a.reset()),this.lastCc=l,this.lastSn=c,this.lastPartIndex=u}}onFragLoaded(e,t){const{frag:i,payload:r}=t;if(i.type===Ce.SUBTITLE)if(r.byteLength){const s=i.decryptdata,a="stats"in t;if(s==null||!s.encrypted||a){const o=this.tracks[i.level],l=this.vttCCs;l[i.cc]||(l[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),o&&o.textCodec===Ch?this._parseIMSC1(i,r):this._parseVTTs(t)}}else this.hls.trigger(O.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const i=this.hls;by(t,this.initPTS[e.cc],r=>{this._appendCues(r,e.level),i.trigger(O.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},r=>{i.logger.log(`Failed to parse IMSC1: ${r}`),i.trigger(O.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:r})})}_parseVTTs(e){var t;const{frag:i,payload:r}=e,{initPTS:s,unparsedVttFrags:a}=this,o=s.length-1;if(!s[i.cc]&&o===-1){a.push(e);return}const l=this.hls,c=(t=i.initSegment)!=null&&t.data?Xn(i.initSegment.data,new Uint8Array(r)).buffer:r;RM(c,this.initPTS[i.cc],this.vttCCs,i.cc,i.start,u=>{this._appendCues(u,i.level),l.trigger(O.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:i})},u=>{const d=u.message==="Missing initPTS for VTT MPEGTS";d?a.push(e):this._fallbackToIMSC1(i,r),l.logger.log(`Failed to parse VTT cue: ${u}`),!(d&&o>i.cc)&&l.trigger(O.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:u})})}_fallbackToIMSC1(e,t){const i=this.tracks[e.level];i.textCodec||by(t,this.initPTS[e.cc],()=>{i.textCodec=Ch,this._parseIMSC1(e,t)},()=>{i.textCodec="wvtt"})}_appendCues(e,t){const i=this.hls;if(this.config.renderTextTracksNatively){const r=this.textTracks[t];if(!r||r.mode==="disabled")return;e.forEach(s=>BT(r,s))}else{const r=this.tracks[t];if(!r)return;const s=r.default?"default":"subtitles"+t;i.trigger(O.CUES_PARSED,{type:"subtitles",cues:e,track:s})}}onFragDecrypted(e,t){const{frag:i}=t;i.type===Ce.SUBTITLE&&this.onFragLoaded(O.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:i,samples:r}=t;if(!(i.type===Ce.MAIN&&this.closedCaptionsForLevel(i)==="NONE"))for(let s=0;s<r.length;s++){const a=r[s].bytes;if(a){this.cea608Parser1||this.initCea608Parsers();const o=this.extractCea608Data(a);this.cea608Parser1.addData(r[s].pts,o[0]),this.cea608Parser2.addData(r[s].pts,o[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:i,endOffsetSubtitles:r,type:s}){const{media:a}=this;if(!(!a||a.currentTime<i)){if(!s||s==="video"){const{captionsTracks:o}=this;Object.keys(o).forEach(l=>np(o[l],t,i))}if(this.config.renderTextTracksNatively&&t===0&&r!==void 0){const{textTracks:o}=this;Object.keys(o).forEach(l=>np(o[l],t,r))}}}extractCea608Data(e){const t=[[],[]],i=e[0]&31;let r=2;for(let s=0;s<i;s++){const a=e[r++],o=127&e[r++],l=127&e[r++];if(o===0&&l===0)continue;if((4&a)!==0){const u=3&a;(u===0||u===1)&&(t[u].push(o),t[u].push(l))}}return t}}function WT(n){return n.characteristics&&/transcribes-spoken-dialog/gi.test(n.characteristics)&&/describes-music-and-sound/gi.test(n.characteristics)?"captions":"subtitles"}function Ly(n,e){return!!n&&n.kind===WT(e)&&Jf(e,n)}function OM(n,e,t,i){return Math.min(e,i)-Math.max(n,t)}function wy(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const MM=/\s/,NM={newCue(n,e,t,i){const r=[];let s,a,o,l,c;const u=self.VTTCue||self.TextTrackCue;for(let h=0;h<i.rows.length;h++)if(s=i.rows[h],o=!0,l=0,c="",!s.isEmpty()){var d;for(let v=0;v<s.chars.length;v++)MM.test(s.chars[v].uchar)&&o?l++:(c+=s.chars[v].uchar,o=!1);s.cueStartTime=e,e===t&&(t+=1e-4),l>=16?l--:l++;const m=GT(c.trim()),g=qm(e,t,m);n!=null&&(d=n.cues)!=null&&d.getCueById(g)||(a=new u(e,t,m),a.id=g,a.line=h+1,a.align="left",a.position=10+Math.min(80,Math.floor(l*8/32)*10),r.push(a))}return n&&r.length&&(r.sort((h,m)=>h.line==="auto"||m.line==="auto"?0:h.line>8&&m.line>8?m.line-h.line:h.line-m.line),r.forEach(h=>BT(n,h))),r}};function BM(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const FM=/(\d+)-(\d+)\/(\d+)/;class Cy{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||jM,this.controller=new self.AbortController,this.stats=new Im}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,i){const r=this.stats;if(r.loading.start)throw new Error("Loader can only be used once.");r.loading.start=self.performance.now();const s=UM(e,this.controller.signal),a=e.responseType==="arraybuffer",o=a?"byteLength":"length",{maxTimeToFirstByteMs:l,maxLoadTimeMs:c}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=i,this.request=this.fetchSetup(e,s),self.clearTimeout(this.requestTimeout),t.timeout=l&&Re(l)?l:c,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},t.timeout),(gl(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(d=>{var h;this.response=this.loader=d;const m=Math.max(self.performance.now(),r.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=c,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},c-(m-r.loading.start)),!d.ok){const{status:v,statusText:x}=d;throw new GM(x||"fetch, bad network response",v,d)}r.loading.first=m,r.total=VM(d.headers)||r.total;const g=(h=this.callbacks)==null?void 0:h.onProgress;return g&&Re(t.highWaterMark)?this.loadProgressively(d,r,e,t.highWaterMark,g):a?d.arrayBuffer():e.responseType==="json"?d.json():d.text()}).then(d=>{var h,m;const g=this.response;if(!g)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),r.loading.end=Math.max(self.performance.now(),r.loading.first);const v=d[o];v&&(r.loaded=r.total=v);const x={url:g.url,data:d,code:g.status},E=(h=this.callbacks)==null?void 0:h.onProgress;E&&!Re(t.highWaterMark)&&E(r,e,d,g),(m=this.callbacks)==null||m.onSuccess(x,r,e,g)}).catch(d=>{var h;if(self.clearTimeout(this.requestTimeout),r.aborted)return;const m=d&&d.code||0,g=d?d.message:null;(h=this.callbacks)==null||h.onError({code:m,text:g},e,d?d.details:null,r)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,i,r=0,s){const a=new iT,o=e.body.getReader(),l=()=>o.read().then(c=>{if(c.done)return a.dataLength&&s(t,i,a.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const u=c.value,d=u.length;return t.loaded+=d,d<r||a.dataLength?(a.push(u),a.dataLength>=r&&s(t,i,a.flush().buffer,e)):s(t,i,u.buffer,e),l()}).catch(()=>Promise.reject());return l()}}function UM(n,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(ut({},n.headers))};return n.rangeEnd&&t.headers.set("Range","bytes="+n.rangeStart+"-"+String(n.rangeEnd-1)),t}function $M(n){const e=FM.exec(n);if(e)return parseInt(e[2])-parseInt(e[1])+1}function VM(n){const e=n.get("Content-Range");if(e){const i=$M(e);if(Re(i))return i}const t=n.get("Content-Length");if(t)return parseInt(t)}function jM(n,e){return new self.Request(n.url,e)}class GM extends Error{constructor(e,t,i){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=i}}const HM=/^age:\s*[\d.]+\s*$/im;class qT{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Im,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,i){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=i,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const i=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0,r.aborted=!1;const s=this.xhrSetup;s?Promise.resolve().then(()=>{if(!(this.loader!==i||this.stats.aborted))return s(i,t.url)}).catch(a=>{if(!(this.loader!==i||this.stats.aborted))return i.open("GET",t.url,!0),s(i,t.url)}).then(()=>{this.loader!==i||this.stats.aborted||this.openAndSendXhr(i,t,e)}).catch(a=>{var o;(o=this.callbacks)==null||o.onError({code:i.status,text:a.message},t,i,r)}):this.openAndSendXhr(i,t,e)}openAndSendXhr(e,t,i){e.readyState||e.open("GET",t.url,!0);const r=t.headers,{maxTimeToFirstByteMs:s,maxLoadTimeMs:a}=i.loadPolicy;if(r)for(const o in r)e.setRequestHeader(o,r[o]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),i.timeout=s&&Re(s)?s:a,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:i}=this;if(!e||!t)return;const r=t.readyState,s=this.config;if(!i.aborted&&r>=2&&(i.loading.first===0&&(i.loading.first=Math.max(self.performance.now(),i.loading.start),s.timeout!==s.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),s.timeout=s.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.loadPolicy.maxLoadTimeMs-(i.loading.first-i.loading.start)))),r===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const c=t.status,u=t.responseType==="text"?t.responseText:null;if(c>=200&&c<300){const g=u??t.response;if(g!=null){var a,o;i.loading.end=Math.max(self.performance.now(),i.loading.first);const v=t.responseType==="arraybuffer"?g.byteLength:g.length;i.loaded=i.total=v,i.bwEstimate=i.total*8e3/(i.loading.end-i.loading.first);const x=(a=this.callbacks)==null?void 0:a.onProgress;x&&x(i,e,g,t);const E={url:t.responseURL,data:g,code:c};(o=this.callbacks)==null||o.onSuccess(E,i,e,t);return}}const d=s.loadPolicy.errorRetry,h=i.retry,m={url:e.url,data:void 0,code:c};if(Vu(d,h,!1,m))this.retry(d);else{var l;ot.error(`${c} while loading ${e.url}`),(l=this.callbacks)==null||l.onError({code:c,text:t.statusText},e,t,i)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(Vu(e,t,!0))this.retry(e);else{var i;ot.warn(`timeout while loading ${(i=this.context)==null?void 0:i.url}`);const r=this.callbacks;r&&(this.abortInternal(),r.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:i}=this;this.retryDelay=Cm(e,i.retry),i.retry++,ot.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${i.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&HM.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const zM={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},KM=ct(ct({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:qT,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:rD,bufferController:YP,capLevelController:Hm,errorController:cD,fpsController:YO,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:WS,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:zM},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},WM()),{},{subtitleStreamController:oM,subtitleTrackController:JO,timelineController:PM,audioStreamController:zP,audioTrackController:KP,emeController:wa,cmcdController:KO,contentSteeringController:qO,interstitialsController:aM});function WM(){return{cueHandler:NM,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function qM(n,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const i=rp(n),r=["manifest","level","frag"],s=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return r.forEach(a=>{const o=`${a==="level"?"playlist":a}LoadPolicy`,l=e[o]===void 0,c=[];s.forEach(u=>{const d=`${a}Loading${u}`,h=e[d];if(h!==void 0&&l){c.push(d);const m=i[o].default;switch(e[o]={default:m},u){case"TimeOut":m.maxLoadTimeMs=h,m.maxTimeToFirstByteMs=h;break;case"MaxRetry":m.errorRetry.maxNumRetry=h,m.timeoutRetry.maxNumRetry=h;break;case"RetryDelay":m.errorRetry.retryDelayMs=h,m.timeoutRetry.retryDelayMs=h;break;case"MaxRetryTimeout":m.errorRetry.maxRetryDelayMs=h,m.timeoutRetry.maxRetryDelayMs=h;break}}}),c.length&&t.warn(`hls.js config: "${c.join('", "')}" setting(s) are deprecated, use "${o}": ${vt(e[o])}`)}),ct(ct({},i),e)}function rp(n){return n&&typeof n=="object"?Array.isArray(n)?n.map(rp):Object.keys(n).reduce((e,t)=>(e[t]=rp(n[t]),e),{}):n}function YM(n,e){const t=n.loader;t!==Cy&&t!==qT?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),n.progressive=!1):BM()&&(n.loader=Cy,n.progressive=!0,n.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const tu=2,XM=.1,QM=.05,JM=100;class ZM extends HS{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var i;(i=this.media)!=null&&i.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var i;this.ended=((i=this.media)==null?void 0:i.currentTime)||1,this.hls.trigger(O.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(O.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(O.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(JM),this.mediaSource=t.mediaSource;const i=this.media=t.media;Dn(i,"playing",this.onMediaPlaying),Dn(i,"waiting",this.onMediaWaiting),Dn(i,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:i}=this;i&&(Kn(i,"playing",this.onMediaPlaying),Kn(i,"waiting",this.onMediaWaiting),Kn(i,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var i,r;const s=(i=this.hls)==null?void 0:i.config;if(!s)return;const a=this.media;if(!a)return;const{seeking:o}=a,l=this.seeking&&!o,c=!this.seeking&&o,u=a.paused&&!o||a.ended||a.playbackRate===0;if(this.seeking=o,e!==t){t&&(this.ended=0),this.moved=!0,o||(this.nudgeRetry=0,s.nudgeOnVideoHole&&!u&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(c||l){l&&this.stallResolved(e);return}if(u){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&a.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(O.MEDIA_ENDED,{stalled:!1}));return}if(!Ge.getBuffered(a).length){this.nudgeRetry=0;return}const d=Ge.bufferInfo(a,e,0),h=d.nextStart||0,m=this.fragmentTracker;if(o&&m&&this.hls){const H=ky(this.hls.inFlightFragments,e),C=d.len>tu,S=!h||H||h-e>tu&&!m.getPartialFragment(e);if(C||S)return;this.moved=!1}const g=(r=this.hls)==null?void 0:r.latestLevelDetails;if(!this.moved&&this.stalled!==null&&m){if(!(d.len>0)&&!h)return;const C=Math.max(h,d.start||0)-e,b=!!(g!=null&&g.live)?g.targetduration*2:tu,T=Rc(e,m);if(C>0&&(C<=b||T)){a.paused||this._trySkipBufferHole(T);return}}const v=s.detectStallWithCurrentTimeMs,x=self.performance.now(),E=this.waiting;let R=this.stalled;if(R===null)if(E>0&&x-E<v)R=this.stalled=E;else{this.stalled=x;return}const k=x-R;if(!o&&(k>=v||E)&&this.hls){var D;if(((D=this.mediaSource)==null?void 0:D.readyState)==="ended"&&!(g!=null&&g.live)&&Math.abs(e-((g==null?void 0:g.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(O.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(d),!this.media||!this.hls)return}const V=Ge.bufferInfo(a,e,s.maxBufferHole);this._tryFixBufferStall(V,k,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const i=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(i)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(O.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var i;const r=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(i=this.buffered.audio)!=null&&i.length&&r&&r.length>1&&e>r.end(0)){const s=Ge.bufferedInfo(Ge.timeRangesToArray(this.buffered.audio),e,0);if(s.len>1&&t>=s.start){const a=Ge.timeRangesToArray(r),o=Ge.bufferedInfo(a,t,0).bufferedIndex;if(o>-1&&o<a.length-1){const l=Ge.bufferedInfo(a,e,0).bufferedIndex,c=a[o].end,u=a[o+1].start;if((l===-1||l>o)&&u-c<1&&e-c<2){const d=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${c} -> ${u} buffered index: ${l}`);this.warn(d.message),this.media.currentTime+=1e-6;let h=Rc(e,this.fragmentTracker);h&&"fragment"in h?h=h.fragment:h||(h=void 0);const m=Ge.bufferInfo(this.media,e,0);this.hls.trigger(O.ERROR,{type:Pe.MEDIA_ERROR,details:se.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:d,reason:d.message,frag:h,buffer:m.len,bufferInfo:m})}}}}}_tryFixBufferStall(e,t,i){var r,s;const{fragmentTracker:a,media:o}=this,l=(r=this.hls)==null?void 0:r.config;if(!o||!a||!l)return;const c=(s=this.hls)==null?void 0:s.latestLevelDetails,u=Rc(i,a);if((u||c!=null&&c.live&&i<c.fragmentStart)&&(this._trySkipBufferHole(u)||!this.media))return;const d=e.buffered,h=this.adjacentTraversal(e,i);(d&&d.length>1&&e.len>l.maxBufferHole||e.nextStart&&(e.nextStart-i<l.maxBufferHole||h))&&(t>l.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const i=this.fragmentTracker,r=e.nextStart;if(i&&r){const s=i.getFragAtPos(t,Ce.MAIN),a=i.getFragAtPos(r,Ce.MAIN);if(s&&a)return a.sn-s.sn<2}return!1}_reportStall(e){const{hls:t,media:i,stallReported:r,stalled:s}=this;if(!r&&s!==null&&i&&t){this.stallReported=!0;const a=new Error(`Playback stalling at @${i.currentTime} due to low buffer (${vt(e)})`);this.warn(a.message),t.trigger(O.ERROR,{type:Pe.MEDIA_ERROR,details:se.BUFFER_STALLED_ERROR,fatal:!1,error:a,buffer:e.len,bufferInfo:e,stalled:{start:s}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:i,media:r}=this,s=(t=this.hls)==null?void 0:t.config;if(!r||!i||!s)return 0;const a=r.currentTime,o=Ge.bufferInfo(r,a,0),l=a<o.start?o.start:o.nextStart;if(l&&this.hls){const u=o.len<=s.maxBufferHole,d=o.len>0&&o.len<1&&r.readyState<3,h=l-a;if(h>0&&(u||d)){if(h>s.maxBufferHole){let g=!1;if(a===0){const v=i.getAppendedFrag(0,Ce.MAIN);v&&l<v.end&&(g=!0)}if(!g&&e){var c;if(!((c=this.hls.loadLevelObj)!=null&&c.details)||ky(this.hls.inFlightFragments,l))return 0;let x=!1,E=e.end;for(;E<l;){const R=Rc(E,i);if(R)E+=R.duration;else{x=!0;break}}if(x)return 0}}const m=Math.max(l+QM,a+XM);if(this.warn(`skipping hole, adjusting currentTime from ${a} to ${m}`),this.moved=!0,r.currentTime=m,!(e!=null&&e.gap)){const g=new Error(`fragment loaded with buffer holes, seeking from ${a} to ${m}`),v={type:Pe.MEDIA_ERROR,details:se.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:g,reason:g.message,buffer:o.len,bufferInfo:o};e&&("fragment"in e?v.part=e:v.frag=e),this.hls.trigger(O.ERROR,v)}return m}}return 0}_tryNudgeBuffer(e){const{hls:t,media:i,nudgeRetry:r}=this,s=t==null?void 0:t.config;if(!i||!s)return 0;const a=i.currentTime;if(this.nudgeRetry++,r<s.nudgeMaxRetry){const o=a+(r+1)*s.nudgeOffset,l=new Error(`Nudging 'currentTime' from ${a} to ${o}`);this.warn(l.message),i.currentTime=o,t.trigger(O.ERROR,{type:Pe.MEDIA_ERROR,details:se.BUFFER_NUDGE_ON_STALL,error:l,fatal:!1,buffer:e.len,bufferInfo:e})}else{const o=new Error(`Playhead still not moving while enough data buffered @${a} after ${s.nudgeMaxRetry} nudges`);this.error(o.message),t.trigger(O.ERROR,{type:Pe.MEDIA_ERROR,details:se.BUFFER_STALLED_ERROR,error:o,fatal:!0,buffer:e.len,bufferInfo:e})}}}function ky(n,e){const t=Dy(n.main);if(t&&t.start<=e)return t;const i=Dy(n.audio);return i&&i.start<=e?i:null}function Dy(n){if(!n)return null;switch(n.state){case he.IDLE:case he.STOPPED:case he.ENDED:case he.ERROR:return null}return n.frag}function Rc(n,e){return e.getAppendedFrag(n,Ce.MAIN)||e.getPartialFragment(n)}const eN=.25;function sp(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function Oh(n,e,t,i,r){let s=new n(e,t,"");try{s.value=i,r&&(s.type=r)}catch{s=new n(e,t,vt(r?ct({type:r},i):i))}return s}const Lc=(()=>{const n=sp();try{n&&new n(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class tN{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(O.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(O.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(O.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(O.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(O.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(O.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(O.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(O.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(O.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var i;this.media=t.media,((i=t.overrides)==null?void 0:i.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&_a(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const i=e[t];if(i.kind==="metadata"&&i.label==="id3")return NT(i,this.media),i}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:i,enableID3MetadataCues:r}=this.hls.config;if(!i&&!r)return;const{samples:s}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const a=sp();if(a)for(let o=0;o<s.length;o++){const l=s[o].type;if(l===Cn.emsg&&!i||!r)continue;const c=uT(s[o].data),u=s[o].pts;let d=u+s[o].duration;d>Lc&&(d=Lc),d-u<=0&&(d=u+eN);for(let m=0;m<c.length;m++){const g=c[m];if(!dT(g)){this.updateId3CueEnds(u,l);const v=Oh(a,u,d,g,l);v&&this.id3Track.addCue(v)}}}}updateId3CueEnds(e,t){var i;const r=(i=this.id3Track)==null?void 0:i.cues;if(r)for(let s=r.length;s--;){const a=r[s];a.type===t&&a.startTime<e&&a.endTime===Lc&&(a.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:i,type:r}){const{id3Track:s,hls:a}=this;if(!a)return;const{config:{enableEmsgMetadataCues:o,enableID3MetadataCues:l}}=a;if(s&&(o||l)){let c;r==="audio"?c=u=>u.type===Cn.audioId3&&l:r==="video"?c=u=>u.type===Cn.emsg&&o:c=u=>u.type===Cn.audioId3&&l||u.type===Cn.emsg&&o,np(s,t,i,c)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:i,timelineOffset:r,enableDateRangeMetadataCues:s,interstitialsController:a}=this.hls.config;if(!s)return;const o=sp();if(i&&r&&!a){const{fragmentStart:v,fragmentEnd:x}=e;let E=this.assetCue;E?(E.startTime=v,E.endTime=x):o&&(E=this.assetCue=Oh(o,v,x,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),E&&(E.id=i,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(E),E.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:l}=this,{dateRanges:c}=e,u=Object.keys(c);let d=this.dateRangeCuesAppended;if(l&&t){var h;if((h=l.cues)!=null&&h.length){const v=Object.keys(d).filter(x=>!u.includes(x));for(let x=v.length;x--;){var m;const E=v[x],R=(m=d[E])==null?void 0:m.cues;delete d[E],R&&Object.keys(R).forEach(k=>{const D=R[k];if(D){D.removeEventListener("enter",this.onEventCueEnter);try{l.removeCue(D)}catch{}}})}}else d=this.dateRangeCuesAppended={}}const g=e.fragments[e.fragments.length-1];if(!(u.length===0||!Re(g==null?void 0:g.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let v=0;v<u.length;v++){const x=u[v],E=c[x],R=E.startTime,k=d[x],D=(k==null?void 0:k.cues)||{};let V=(k==null?void 0:k.durationKnown)||!1,H=Lc;const{duration:C,endDate:S}=E;if(S&&C!==null)H=R+C,V=!0;else if(E.endOnNext&&!V){const T=u.reduce((L,F)=>{if(F!==E.id){const U=c[F];if(U.class===E.class&&U.startDate>E.startDate&&(!L||E.startDate<L.startDate))return U}return L},null);T&&(H=T.startTime,V=!0)}const b=Object.keys(E.attr);for(let T=0;T<b.length;T++){const L=b[T];if(!TD(L))continue;const F=D[L];if(F)V&&!(k!=null&&k.durationKnown)?F.endTime=H:Math.abs(F.startTime-R)>.01&&(F.startTime=R,F.endTime=H);else if(o){let U=E.attr[L];AD(L)&&(U=RS(U));const ie=Oh(o,R,H,{key:L,data:U},Cn.dateRange);ie&&(ie.id=x,this.id3Track.addCue(ie),D[L]=ie,a&&(L==="X-ASSET-LIST"||L==="X-ASSET-URL")&&ie.addEventListener("enter",this.onEventCueEnter))}}d[x]={cues:D,dateRange:E,durationKnown:V}}}}}class nN{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,i=this.levelDetails;if(!t||!i)return;this.currentTime=t.currentTime;const r=this.computeLatency();if(r===null)return;this._latency=r;const{lowLatencyMode:s,maxLiveSyncPlaybackRate:a}=this.config;if(!s||a===1||!i.live)return;const o=this.targetLatency;if(o===null)return;const l=r-o,c=Math.min(this.maxLatency,o+i.targetduration);if(l<c&&l>.05&&this.forwardBufferLength>1){const d=Math.min(2,Math.max(1,a)),h=Math.round(2/(1+Math.exp(-.75*l-this.edgeStalled))*20)/20,m=Math.min(d,Math.max(1,h));this.changeMediaPlaybackRate(t,m)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:i,targetduration:r}=e,{liveSyncDuration:s,liveSyncDurationCount:a,lowLatencyMode:o}=this.config,l=this.hls.userConfig;let c=o&&i||t;(this._targetLatencyUpdated||l.liveSyncDuration||l.liveSyncDurationCount||c===0)&&(c=s!==void 0?s:a*r);const u=r;return c+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,u)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const i=this.levelDetails;if(i===null)return null;const r=i.edge,s=e-t-this.edgeStalled,a=r-i.totalduration,o=r-(this.config.lowLatencyMode&&i.partTarget||i.targetduration);return Math.min(Math.max(a,s),o)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const i=e.buffered.length;return(i?e.buffered.end(i-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(O.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(O.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(O.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(O.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var i;t.details===se.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(i=this.levelDetails)!=null&&i.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var i,r;e.playbackRate!==t&&((i=this.hls)==null||i.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(r=this.targetLatency)==null?void 0:r.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class iN extends Gm{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(O.LEVEL_LOADED,this.onLevelLoaded,this),e.on(O.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(O.FRAG_BUFFERED,this.onFragBuffered,this),e.on(O.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(O.LEVEL_LOADED,this.onLevelLoaded,this),e.off(O.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(O.FRAG_BUFFERED,this.onFragBuffered,this),e.off(O.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const i=this.hls.config.preferManagedMediaSource,r=[],s={},a={};let o=!1,l=!1,c=!1;t.levels.forEach(u=>{const d=u.attrs;let{audioCodec:h,videoCodec:m}=u;h&&(u.audioCodec=h=Bu(h,i)||void 0),m&&(m=u.videoCodec=Vk(m));const{width:g,height:v,unknownCodecs:x}=u;let E=x?x.length:0;if(x)for(let T=E;T--;){const L=x[T];this.isAudioSupported(L)?(u.audioCodec=h=h?`${h},${L}`:L,E--,Va.audio[h.substring(0,4)]=2):this.isVideoSupported(L)&&(u.videoCodec=m=m?`${m},${L}`:L,E--,Va.video[m.substring(0,4)]=2)}if(o||(o=!!(g&&v)),l||(l=!!m),c||(c=!!h),E||h&&!this.isAudioSupported(h)||m&&!this.isVideoSupported(m)){this.log(`Some or all CODECS not supported "${d.CODECS}"`);return}const{CODECS:R,"FRAME-RATE":k,"HDCP-LEVEL":D,"PATHWAY-ID":V,RESOLUTION:H,"VIDEO-RANGE":C}=d,b=`${`${V||"."}-`}${u.bitrate}-${H}-${k}-${R}-${C}-${D}`;if(s[b])if(s[b].uri!==u.url&&!u.attrs["PATHWAY-ID"]){const T=a[b]+=1;u.attrs["PATHWAY-ID"]=new Array(T+1).join(".");const L=this.createLevel(u);s[b]=L,r.push(L)}else s[b].addGroupId("audio",d.AUDIO),s[b].addGroupId("text",d.SUBTITLES);else{const T=this.createLevel(u);s[b]=T,a[b]=1,r.push(T)}}),this.filterAndSortMediaOptions(r,t,o,l,c)}createLevel(e){const t=new hl(e),i=e.supplemental;if(i!=null&&i.videoCodec&&!this.isVideoSupported(i.videoCodec)){const r=new Error(`SUPPLEMENTAL-CODECS not supported "${i.videoCodec}"`);this.log(r.message),t.supportedResult=FS(r,[])}return t}isAudioSupported(e){return Gf(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return Gf(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,i,r,s){let a=[],o=[],l=e;if((i||r)&&s&&(l=l.filter(({videoCodec:x,videoRange:E,width:R,height:k})=>(!!x||!!(R&&k))&&Yk(E))),l.length===0){Promise.resolve().then(()=>{if(this.hls){let x="no level with compatible codecs found in manifest",E=x;t.levels.length&&(E=`one or more CODECS in variant not supported: ${vt(t.levels.map(k=>k.attrs.CODECS).filter((k,D,V)=>V.indexOf(k)===D))}`,this.warn(E),x+=` (${E})`);const R=new Error(x);this.hls.trigger(O.ERROR,{type:Pe.MEDIA_ERROR,details:se.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:R,reason:E})}});return}t.audioTracks&&(a=t.audioTracks.filter(x=>!x.audioCodec||this.isAudioSupported(x.audioCodec)),Py(a)),t.subtitles&&(o=t.subtitles,Py(o));const c=l.slice(0);l.sort((x,E)=>{if(x.attrs["HDCP-LEVEL"]!==E.attrs["HDCP-LEVEL"])return(x.attrs["HDCP-LEVEL"]||"")>(E.attrs["HDCP-LEVEL"]||"")?1:-1;if(i&&x.height!==E.height)return x.height-E.height;if(x.frameRate!==E.frameRate)return x.frameRate-E.frameRate;if(x.videoRange!==E.videoRange)return Fu.indexOf(x.videoRange)-Fu.indexOf(E.videoRange);if(x.videoCodec!==E.videoCodec){const R=w_(x.videoCodec),k=w_(E.videoCodec);if(R!==k)return k-R}if(x.uri===E.uri&&x.codecSet!==E.codecSet){const R=Nu(x.codecSet),k=Nu(E.codecSet);if(R!==k)return k-R}return x.averageBitrate!==E.averageBitrate?x.averageBitrate-E.averageBitrate:0});let u=c[0];if(this.steering&&(l=this.steering.filterParsedLevels(l),l.length!==c.length)){for(let x=0;x<c.length;x++)if(c[x].pathwayId===l[0].pathwayId){u=c[x];break}}this._levels=l;for(let x=0;x<l.length;x++)if(l[x]===u){var d;this._firstLevel=x;const E=u.bitrate,R=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${l.length} level(s) found, first bitrate: ${E}`),((d=this.hls.userConfig)==null?void 0:d.abrEwmaDefaultEstimate)===void 0){const k=Math.min(E,this.hls.config.abrEwmaDefaultEstimateMax);k>R&&R===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=k)}break}const h=s&&!r,m=this.hls.config,g=!!(m.audioStreamController&&m.audioTrackController),v={levels:l,audioTracks:a,subtitleTracks:o,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:s,video:r,altAudio:g&&!h&&a.some(x=>!!x.url)};this.hls.trigger(O.MANIFEST_PARSED,v)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const u=new Error("invalid level idx"),d=e<0;if(this.hls.trigger(O.ERROR,{type:Pe.OTHER_ERROR,details:se.LEVEL_SWITCH_ERROR,level:e,fatal:d,error:u,reason:u.message}),d)return;e=Math.min(e,t.length-1)}const i=this.currentLevelIndex,r=this.currentLevel,s=r?r.attrs["PATHWAY-ID"]:void 0,a=t[e],o=a.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=a,i===e&&r&&s===o)return;this.log(`Switching to level ${e} (${a.height?a.height+"p ":""}${a.videoRange?a.videoRange+" ":""}${a.codecSet?a.codecSet+" ":""}@${a.bitrate})${o?" with Pathway "+o:""} from level ${i}${s?" with Pathway "+s:""}`);const l={level:e,attrs:a.attrs,details:a.details,bitrate:a.bitrate,averageBitrate:a.averageBitrate,maxBitrate:a.maxBitrate,realBitrate:a.realBitrate,width:a.width,height:a.height,codecSet:a.codecSet,audioCodec:a.audioCodec,videoCodec:a.videoCodec,audioGroups:a.audioGroups,subtitleGroups:a.subtitleGroups,loaded:a.loaded,loadError:a.loadError,fragmentError:a.fragmentError,name:a.name,id:a.id,uri:a.uri,url:a.url,urlId:0,audioGroupIds:a.audioGroupIds,textGroupIds:a.textGroupIds};this.hls.trigger(O.LEVEL_SWITCHING,l);const c=a.details;if(!c||c.live){const u=this.switchParams(a.uri,r==null?void 0:r.details,c);this.loadPlaylist(u)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),i=e.filter(r=>t.indexOf(r)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=i}}onError(e,t){t.fatal||!t.context||t.context.type===qe.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===Ce.MAIN){const i=t.elementaryStreams;if(!Object.keys(i).some(s=>!!i[s]))return;const r=this._levels[t.level];r!=null&&r.loadError&&(this.log(`Resetting level error count of ${r.loadError} on frag buffered`),r.loadError=0)}}onLevelLoaded(e,t){var i;const{level:r,details:s}=t,a=t.levelInfo;if(!a){var o;this.warn(`Invalid level index ${r}`),(o=t.deliveryDirectives)!=null&&o.skip&&(s.deltaUpdateFailed=!0);return}if(a===this.currentLevel||t.withoutMultiVariant){a.fragmentError===0&&(a.loadError=0);let l=a.details;l===t.details&&l.advanced&&(l=void 0),this.playlistLoaded(r,t,l)}else(i=t.deliveryDirectives)!=null&&i.skip&&(s.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const i=this.getUrlWithDirectives(e.uri,t),r=this.currentLevelIndex,s=e.attrs["PATHWAY-ID"],a=e.details,o=a==null?void 0:a.age;this.log(`Loading level index ${r}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${s?" Pathway "+s:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${i}`),this.hls.trigger(O.LEVEL_LOADING,{url:i,level:r,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const i=this._levels.filter((s,a)=>a!==e?!0:(this.steering&&this.steering.removeLevel(s),s===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,s.details&&s.details.fragments.forEach(o=>o.level=-1)),!1));eT(i),this._levels=i,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const r=i.length-1;this._firstLevel=Math.min(this._firstLevel,r),this._startLevel&&(this._startLevel=Math.min(this._startLevel,r)),this.hls.trigger(O.LEVELS_UPDATED,{levels:i})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:i}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(O.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:i}))}}function Py(n){const e={};n.forEach(t=>{const i=t.groupId||"";t.id=e[i]=e[i]||0,e[i]++})}function YT(){return self.SourceBuffer||self.WebKitSourceBuffer}function XT(){if(!Zr())return!1;const e=YT();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function rN(){if(!XT())return!1;const n=Zr();return typeof(n==null?void 0:n.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>n.isTypeSupported(dl(e,"video")))||["mp4a.40.2","fLaC"].some(e=>n.isTypeSupported(dl(e,"audio"))))}function sN(){var n;const e=YT();return typeof(e==null||(n=e.prototype)==null?void 0:n.changeType)=="function"}const aN=100;class oN extends Mm{constructor(e,t,i){super(e,t,i,"stream-controller",Ce.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const r=this.media,s=r?r.currentTime:null;if(s===null||!Re(s)||(this.log(`Media seeked to ${s.toFixed(3)}`),!this.getBufferedFrag(s)))return;const a=this.getFwdBufferInfoAtPos(r,s,Ce.MAIN,0);if(a===null||a.len===0){this.warn(`Main forward buffer length at ${s} on "seeked" event ${a?a.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(O.MANIFEST_PARSED,this.onManifestParsed,this),e.on(O.LEVEL_LOADING,this.onLevelLoading,this),e.on(O.LEVEL_LOADED,this.onLevelLoaded,this),e.on(O.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(O.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(O.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(O.BUFFER_CREATED,this.onBufferCreated,this),e.on(O.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(O.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(O.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(O.MANIFEST_PARSED,this.onManifestParsed,this),e.off(O.LEVEL_LOADED,this.onLevelLoaded,this),e.off(O.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(O.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(O.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(O.BUFFER_CREATED,this.onBufferCreated,this),e.off(O.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(O.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(O.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:i,hls:r}=this;if(this.stopLoad(),this.setInterval(aN),this.level=-1,!this.startFragRequested){let s=r.startLevel;s===-1&&(r.config.testBandwidth&&this.levels.length>1?(s=0,this.bitrateTest=!0):s=r.firstAutoLevel),r.nextLoadLevel=s,this.level=r.loadLevel,this._hasEnoughToStart=!!t}i>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),e=i),this.state=he.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=he.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case he.WAITING_LEVEL:{const{levels:t,level:i}=this,r=t==null?void 0:t[i],s=r==null?void 0:r.details;if(s&&(!s.live||this.levelLastLoaded===r&&!this.waitForLive(r))){if(this.waitForCdnTuneIn(s))break;this.state=he.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=he.IDLE;break}break}case he.FRAG_LOADING_WAITING_RETRY:{var e;const t=self.performance.now(),i=this.retryDate;if(!i||t>=i||(e=this.media)!=null&&e.seeking){const{levels:r,level:s}=this,a=r==null?void 0:r[s];this.resetStartWhenNotLoaded(a||null),this.state=he.IDLE}}break}this.state===he.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:i,media:r}=this;if(t===null||!r&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const s=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(i!=null&&i[s]))return;const a=i[s],o=this.getMainFwdBufferInfo();if(o===null)return;const l=this.getLevelDetails();if(l&&this._streamEnded(o,l)){const v={};this.altAudio===2&&(v.type="video"),this.hls.trigger(O.BUFFER_EOS,v),this.state=he.ENDED;return}if(!this.buffering)return;e.loadLevel!==s&&e.manualLevel===-1&&this.log(`Adapting to level ${s} from level ${this.level}`),this.level=e.nextLoadLevel=s;const c=a.details;if(!c||this.state===he.WAITING_LEVEL||this.waitForLive(a)){this.level=s,this.state=he.WAITING_LEVEL,this.startFragRequested=!1;return}const u=o.len,d=this.getMaxBufferLength(a.maxBitrate);if(u>=d)return;this.backtrackFragment&&this.backtrackFragment.start>o.end&&(this.backtrackFragment=null);const h=this.backtrackFragment?this.backtrackFragment.start:o.end;let m=this.getNextFragment(h,c);if(this.couldBacktrack&&!this.fragPrevious&&m&&Bt(m)&&this.fragmentTracker.getState(m)!==Kt.OK){var g;const x=((g=this.backtrackFragment)!=null?g:m).sn-c.startSN,E=c.fragments[x-1];E&&m.cc===E.cc&&(m=E,this.fragmentTracker.removeFragment(E))}else this.backtrackFragment&&o.len&&(this.backtrackFragment=null);if(m&&this.isLoopLoading(m,h)){if(!m.gap){const x=this.audioOnly&&!this.altAudio?ht.AUDIO:ht.VIDEO,E=(x===ht.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;E&&this.afterBufferFlushed(E,x,Ce.MAIN)}m=this.getNextFragmentLoopLoading(m,c,o,Ce.MAIN,d)}m&&(m.initSegment&&!m.initSegment.data&&!this.bitrateTest&&(m=m.initSegment),this.loadFragment(m,a,h))}loadFragment(e,t,i){const r=this.fragmentTracker.getState(e);r===Kt.NOT_LOADED||r===Kt.PARTIAL?Bt(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,i):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,Ce.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let i;const r=this.getAppendedFrag(t.currentTime);r&&r.start>1&&this.flushMainBuffer(0,r.start-1);const s=this.getLevelDetails();if(s!=null&&s.live){const o=this.getMainFwdBufferInfo();if(!o||o.len<s.targetduration*2)return}if(!t.paused&&e){const o=this.hls.nextLoadLevel,l=e[o],c=this.fragLastKbps;c&&this.fragCurrent?i=this.fragCurrent.duration*l.maxBitrate/(1e3*c)+1:i=0}else i=0;const a=this.getBufferedFrag(t.currentTime+i);if(a){const o=this.followingBufferedFrag(a);if(o){this.abortCurrentFrag();const l=o.maxStartPTS?o.maxStartPTS:o.start,c=o.duration,u=Math.max(a.end,l+Math.min(Math.max(c-this.config.maxFragLookUpTolerance,c*(this.couldBacktrack?.5:.125)),c*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(u,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case he.KEY_LOADING:case he.FRAG_LOADING:case he.FRAG_LOADING_WAITING_RETRY:case he.PARSING:case he.PARSED:this.state=he.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const i=t.media;Dn(i,"playing",this.onMediaPlaying),Dn(i,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:i}=this;i&&(Kn(i,"playing",this.onMediaPlaying),Kn(i,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(O.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let i=!1,r=!1;for(let s=0;s<t.levels.length;s++){const a=t.levels[s].audioCodec;a&&(i=i||a.indexOf("mp4a.40.2")!==-1,r=r||a.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=i&&r&&!sN(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:i}=this;if(!i||this.state!==he.IDLE)return;const r=t.levelInfo;(!r.details||r.details.live&&(this.levelLastLoaded!==r||r.details.expired)||this.waitForCdnTuneIn(r.details))&&(this.state=he.WAITING_LEVEL)}onLevelLoaded(e,t){var i;const{levels:r,startFragRequested:s}=this,a=t.level,o=t.details,l=o.totalduration;if(!r){this.warn(`Levels were reset while loading level ${a}`);return}this.log(`Level ${a} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""}, cc [${o.startCC}, ${o.endCC}] duration:${l}`);const c=t.levelInfo,u=this.fragCurrent;u&&(this.state===he.FRAG_LOADING||this.state===he.FRAG_LOADING_WAITING_RETRY)&&u.level!==t.level&&u.loader&&this.abortCurrentFrag();let d=0;if(o.live||(i=c.details)!=null&&i.live){var h;if(this.checkLiveUpdate(o),o.deltaUpdateFailed)return;d=this.alignPlaylists(o,c.details,(h=this.levelLastLoaded)==null?void 0:h.details)}if(c.details=o,this.levelLastLoaded=c,s||this.setStartPosition(o,d),this.hls.trigger(O.LEVEL_UPDATED,{details:o,level:a}),this.state===he.WAITING_LEVEL){if(this.waitForCdnTuneIn(o))return;this.state=he.IDLE}s&&o.live&&this.synchronizeToLiveEdge(o),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:i}=this;if(!i)return;const r=this.hls.liveSyncPosition,s=this.getLoadPosition(),a=e.fragmentStart,o=e.edge,l=s>=a-t.maxFragLookUpTolerance&&s<=o;if(r!==null&&i.duration>r&&(s<r||!l)){const u=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!l&&i.readyState<4||s<o-u)&&(this._hasEnoughToStart||(this.nextLoadPosition=r),i.readyState))if(this.warn(`Playback: ${s.toFixed(3)} is located too far from the end of live sliding playlist: ${o}, reset currentTime to : ${r.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var c;const d=Ge.bufferInfo(i,r,0);if(!((c=d.buffered)!=null&&c.length)){i.currentTime=r;return}if(d.start<=s){i.currentTime=r;return}const{nextStart:m}=Ge.bufferedInfo(d.buffered,s,0);m&&(i.currentTime=m)}else i.currentTime=r}}_handleFragmentLoadProgress(e){var t;const i=e.frag,{part:r,payload:s}=e,{levels:a}=this;if(!a){this.warn(`Levels were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const o=a[i.level];if(!o){this.warn(`Level ${i.level} not found on progress`);return}const l=o.details;if(!l){this.warn(`Dropping fragment ${i.sn} of level ${i.level} after level details were reset`),this.fragmentTracker.removeFragment(i);return}const c=o.videoCodec,u=l.PTSKnown||!l.live,d=(t=i.initSegment)==null?void 0:t.data,h=this._getAudioCodec(o),m=this.transmuxer=this.transmuxer||new TT(this.hls,Ce.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),g=r?r.index:-1,v=g!==-1,x=new Dm(i.level,i.sn,i.stats.chunkCount,s.byteLength,g,v),E=this.initPTS[i.cc];m.push(s,d,h,c,i,r,l.totalduration,u,x,E)}onAudioTrackSwitching(e,t){const i=this.hls,r=this.altAudio===2;if(Uu(t.url,i))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const a=this.fragCurrent;a&&(this.log("Switching to main audio track, cancel main fragment load"),a.abortRequests(),this.fragmentTracker.removeFragment(a)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(r){this.fragmentTracker.removeAllFragments(),i.once(O.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(O.AUDIO_TRACK_SWITCHED,t)}),i.trigger(O.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}i.trigger(O.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const i=Uu(t.url,this.hls);if(i){const r=this.videoBuffer;r&&this.mediaBuffer!==r&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r)}this.altAudio=i?2:0,this.tick()}onBufferCreated(e,t){const i=t.tracks;let r,s,a=!1;for(const o in i){const l=i[o];if(l.id==="main"){if(s=o,r=l,o==="video"){const c=i[o];c&&(this.videoBuffer=c.buffer)}}else a=!0}a&&r?(this.log(`Alternate track found, use ${s}.buffered to schedule main fragment loading`),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:i,part:r}=t,s=i.type===Ce.MAIN;if(s){if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${r?" p: "+r.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}`),this.state===he.PARSED&&(this.state=he.IDLE);return}const o=r?r.stats:i.stats;this.fragLastKbps=Math.round(8*o.total/(o.buffering.end-o.loading.first)),Bt(i)&&(this.fragPrevious=i),this.fragBufferedComplete(i,r)}const a=this.media;a&&(!this._hasEnoughToStart&&Ge.getBuffered(a).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),s&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var i;if(t.fatal){this.state=he.ERROR;return}switch(t.details){case se.FRAG_GAP:case se.FRAG_PARSING_ERROR:case se.FRAG_DECRYPT_ERROR:case se.FRAG_LOAD_ERROR:case se.FRAG_LOAD_TIMEOUT:case se.KEY_LOAD_ERROR:case se.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Ce.MAIN,t);break;case se.LEVEL_LOAD_ERROR:case se.LEVEL_LOAD_TIMEOUT:case se.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===he.WAITING_LEVEL&&((i=t.context)==null?void 0:i.type)===qe.LEVEL&&(this.state=he.IDLE);break;case se.BUFFER_ADD_CODEC_ERROR:case se.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case se.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case se.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=he.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==ht.AUDIO||!this.altAudio){const i=(t===ht.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;i&&(this.afterBufferFlushed(i,t,Ce.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let i=this.startPosition;if(i>=0&&t<i){if(e.seeking){this.log(`could not seek to ${i}, already seeking at ${t}`);return}const r=this.timelineOffset;r&&i&&(i+=r);const s=this.getLevelDetails(),a=Ge.getBuffered(e),o=a.length?a.start(0):0,l=o-i,c=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||l>0&&(l<c||this.loadingParts&&l<2*((s==null?void 0:s.partTarget)||0)))&&(this.log(`adjusting start position by ${l} to match buffer start`),i+=l,this.startPosition=i),t<i&&(this.log(`seek to target start position ${i} from current time ${t} buffer start ${o}`),e.currentTime=i)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(i=>{const{hls:r}=this,s=i==null?void 0:i.frag;if(!s||this.fragContextChanged(s))return;t.fragmentError=0,this.state=he.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const a=s.stats;a.parsing.start=a.parsing.end=a.buffering.start=a.buffering.end=self.performance.now(),r.trigger(O.FRAG_LOADED,i),s.bitrateTest=!1})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:i}=this,{remuxResult:r,chunkMeta:s}=e,a=this.getCurrentContext(s);if(!a){this.resetWhenMissingContext(s);return}const{frag:o,part:l,level:c}=a,{video:u,text:d,id3:h,initSegment:m}=r,{details:g}=c,v=this.altAudio?void 0:r.audio;if(this.fragContextChanged(o)){this.fragmentTracker.removeFragment(o);return}if(this.state=he.PARSING,m){const x=m.tracks;if(x){const D=o.initSegment||o;if(this.unhandledEncryptionError(m,o))return;this._bufferInitSegment(c,x,D,s),i.trigger(O.FRAG_PARSING_INIT_SEGMENT,{frag:D,id:t,tracks:x})}const E=m.initPTS,R=m.timescale,k=this.initPTS[o.cc];if(Re(E)&&(!k||k.baseTime!==E||k.timescale!==R)){const D=m.trackId;this.initPTS[o.cc]={baseTime:E,timescale:R,trackId:D},i.trigger(O.INIT_PTS_FOUND,{frag:o,id:t,initPTS:E,timescale:R,trackId:D})}}if(u&&g){v&&u.type==="audiovideo"&&this.logMuxedErr(o);const x=g.fragments[o.sn-1-g.startSN],E=o.sn===g.startSN,R=!x||o.cc>x.cc;if(r.independent!==!1){const{startPTS:k,endPTS:D,startDTS:V,endDTS:H}=u;if(l)l.elementaryStreams[u.type]={startPTS:k,endPTS:D,startDTS:V,endDTS:H};else if(u.firstKeyFrame&&u.independent&&s.id===1&&!R&&(this.couldBacktrack=!0),u.dropped&&u.independent){const C=this.getMainFwdBufferInfo(),S=(C?C.end:this.getLoadPosition())+this.config.maxBufferHole,b=u.firstKeyFramePTS?u.firstKeyFramePTS:k;if(!E&&S<b-this.config.maxBufferHole&&!R){this.backtrack(o);return}else R&&(o.gap=!0);o.setElementaryStreamInfo(u.type,o.start,D,o.start,H,!0)}else E&&k-(g.appliedTimelineOffset||0)>tu&&(o.gap=!0);o.setElementaryStreamInfo(u.type,k,D,V,H),this.backtrackFragment&&(this.backtrackFragment=o),this.bufferFragmentData(u,o,l,s,E||R)}else if(E||R)o.gap=!0;else{this.backtrack(o);return}}if(v){const{startPTS:x,endPTS:E,startDTS:R,endDTS:k}=v;l&&(l.elementaryStreams[ht.AUDIO]={startPTS:x,endPTS:E,startDTS:R,endDTS:k}),o.setElementaryStreamInfo(ht.AUDIO,x,E,R,k),this.bufferFragmentData(v,o,l,s)}if(g&&h!=null&&h.samples.length){const x={id:t,frag:o,details:g,samples:h.samples};i.trigger(O.FRAG_PARSING_METADATA,x)}if(g&&d){const x={id:t,frag:o,details:g,samples:d.samples};i.trigger(O.FRAG_PARSING_USERDATA,x)}}logMuxedErr(e){this.warn(`${Bt(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,i,r){if(this.state!==he.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(i));const{audio:s,video:a,audiovideo:o}=t;if(s){const c=e.audioCodec;let u=qc(s.codec,c);u==="mp4a"&&(u="mp4a.40.5");const d=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){u&&(u.indexOf("mp4a.40.5")!==-1?u="mp4a.40.2":u="mp4a.40.5");const h=s.metadata;h&&"channelCount"in h&&(h.channelCount||1)!==1&&d.indexOf("firefox")===-1&&(u="mp4a.40.5")}u&&u.indexOf("mp4a.40.5")!==-1&&d.indexOf("android")!==-1&&s.container!=="audio/mpeg"&&(u="mp4a.40.2",this.log(`Android: force audio codec to ${u}`)),c&&c!==u&&this.log(`Swapping manifest audio codec "${c}" for "${u}"`),s.levelCodec=u,s.id=Ce.MAIN,this.log(`Init audio buffer, container:${s.container}, codecs[selected/level/parsed]=[${u||""}/${c||""}/${s.codec}]`),delete t.audiovideo}if(a){a.levelCodec=e.videoCodec,a.id=Ce.MAIN;const c=a.codec;if((c==null?void 0:c.length)===4)switch(c){case"hvc1":case"hev1":a.codec="hvc1.1.6.L120.90";break;case"av01":a.codec="av01.0.04M.08";break;case"avc1":a.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${a.container}, codecs[level/parsed]=[${e.videoCodec||""}/${c}]${a.codec!==c?" parsed-corrected="+a.codec:""}${a.supplemental?" supplemental="+a.supplemental:""}`),delete t.audiovideo}o&&(this.log(`Init audiovideo buffer, container:${o.container}, codecs[level/parsed]=[${e.codecs}/${o.codec}]`),delete t.video,delete t.audio);const l=Object.keys(t);if(l.length){if(this.hls.trigger(O.BUFFER_CODECS,t),!this.hls)return;l.forEach(c=>{const d=t[c].initSegment;d!=null&&d.byteLength&&this.hls.trigger(O.BUFFER_APPENDING,{type:c,data:d,frag:i,part:null,chunkMeta:r,parent:i.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,Ce.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,i=e==null?void 0:e[t];return i?this.getMaxBufferLength(i.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=he.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const i=e.currentTime;if(Ge.isBuffered(e,i)?t=this.getAppendedFrag(i):Ge.isBuffered(e,i+.1)&&(t=this.getAppendedFrag(i+.1)),t){this.backtrackFragment=null;const r=this.fragPlaying,s=t.level;(!r||t.sn!==r.sn||r.level!==s)&&(this.fragPlaying=t,this.hls.trigger(O.FRAG_CHANGED,{frag:t}),(!r||r.level!==s)&&this.hls.trigger(O.LEVEL_SWITCHED,{level:s}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return Re(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(Re(t)){const i=this.getLevelDetails(),r=this.currentFrag||(i?Vs(null,i.fragments,t):null);if(r){const s=r.programDateTime;if(s!==null){const a=s+(t-r.start)*1e3;return new Date(a)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class lN{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const i in this.keyUriToKeyInfo){const r=this.keyUriToKeyInfo[i].loader;if(r){var t;if(e&&e!==((t=r.context)==null?void 0:t.frag.type))return;r.abort()}}}detach(){for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=se.KEY_LOAD_ERROR,i,r,s){return new Ki({type:Pe.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:s,error:i,networkDetails:r})}loadClear(e,t,i){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let r=0,s=t.length;r<s;r++){const a=t[r];if(e.cc<=a.cc&&(!Bt(e)||!Bt(a)||e.sn<a.sn)||!i&&r==s-1)return this.emeController.selectKeySystemFormat(a).then(o=>{if(!this.emeController)return;a.setKeyFormat(o);const l=Xc(o);if(l)return this.emeController.getKeySystemAccess([l])})}if(this.config.requireKeySystemAccessOnStart){const r=bo(this.config);if(r.length)return this.emeController.getKeySystemAccess(r)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var i,r;t&&e.setKeyFormat(t);const s=e.decryptdata;if(!s){const c=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,se.KEY_LOAD_ERROR,c))}const a=s.uri;if(!a)return Promise.reject(this.createKeyLoadError(e,se.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${a}"`)));let o=this.keyUriToKeyInfo[a];if((i=o)!=null&&i.decryptdata.key)return s.key=o.decryptdata.key,Promise.resolve({frag:e,keyInfo:o});if((r=o)!=null&&r.keyLoadPromise){var l;switch((l=o.mediaKeySessionContext)==null?void 0:l.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return o.keyLoadPromise.then(c=>(s.key=c.keyInfo.decryptdata.key,{frag:e,keyInfo:o}))}}switch(o=this.keyUriToKeyInfo[a]={decryptdata:s,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},s.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return s.keyFormat==="identity"?this.loadKeyHTTP(o,e):this.loadKeyEME(o,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(o,e);default:return Promise.reject(this.createKeyLoadError(e,se.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${s.method}"`)))}}loadKeyEME(e,t){const i={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const r=this.emeController.loadKey(i);if(r)return(e.keyLoadPromise=r.then(s=>(e.mediaKeySessionContext=s,i))).catch(s=>{throw e.keyLoadPromise=null,s})}return Promise.resolve(i)}loadKeyHTTP(e,t){const i=this.config,r=i.loader,s=new r(i);return t.keyLoader=e.loader=s,e.keyLoadPromise=new Promise((a,o)=>{const l={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},c=i.keyLoadPolicy.default,u={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(h,m,g,v)=>{const{frag:x,keyInfo:E,url:R}=g;if(!x.decryptdata||E!==this.keyUriToKeyInfo[R])return o(this.createKeyLoadError(x,se.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),v));E.decryptdata.key=x.decryptdata.key=new Uint8Array(h.data),x.keyLoader=null,E.loader=null,a({frag:x,keyInfo:E})},onError:(h,m,g,v)=>{this.resetLoader(m),o(this.createKeyLoadError(t,se.KEY_LOAD_ERROR,new Error(`HTTP Error ${h.code} loading key ${h.text}`),g,ct({url:l.url,data:void 0},h)))},onTimeout:(h,m,g)=>{this.resetLoader(m),o(this.createKeyLoadError(t,se.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),g))},onAbort:(h,m,g)=>{this.resetLoader(m),o(this.createKeyLoadError(t,se.INTERNAL_ABORTED,new Error("key loading aborted"),g))}};s.load(l,u,d)})}resetLoader(e){const{frag:t,keyInfo:i,url:r}=e,s=i.loader;t.keyLoader===s&&(t.keyLoader=null,i.loader=null),delete this.keyUriToKeyInfo[r],s&&s.destroy()}}function Oy(n){const{type:e}=n;switch(e){case qe.AUDIO_TRACK:return Ce.AUDIO;case qe.SUBTITLE_TRACK:return Ce.SUBTITLE;default:return Ce.MAIN}}function Mh(n,e){let t=n.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class cN{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(O.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.LEVEL_LOADING,this.onLevelLoading,this),e.on(O.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(O.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(O.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(O.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.LEVEL_LOADING,this.onLevelLoading,this),e.off(O.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(O.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(O.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,i=t.pLoader,r=t.loader,s=i||r,a=new s(t);return this.loaders[e.type]=a,a}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:i}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:qe.MANIFEST,url:i,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:i,level:r,pathwayId:s,url:a,deliveryDirectives:o,levelInfo:l}=t;this.load({id:i,level:r,pathwayId:s,responseType:"text",type:qe.LEVEL,url:a,deliveryDirectives:o,levelOrTrack:l})}onAudioTrackLoading(e,t){const{id:i,groupId:r,url:s,deliveryDirectives:a,track:o}=t;this.load({id:i,groupId:r,level:null,responseType:"text",type:qe.AUDIO_TRACK,url:s,deliveryDirectives:a,levelOrTrack:o})}onSubtitleTrackLoading(e,t){const{id:i,groupId:r,url:s,deliveryDirectives:a,track:o}=t;this.load({id:i,groupId:r,level:null,responseType:"text",type:qe.SUBTITLE_TRACK,url:s,deliveryDirectives:a,levelOrTrack:o})}onLevelsUpdated(e,t){const i=this.loaders[qe.LEVEL];if(i){const r=i.context;r&&!t.levels.some(s=>s===r.levelOrTrack)&&(i.abort(),delete this.loaders[qe.LEVEL])}}load(e){var t;const i=this.hls.config;let r=this.getInternalLoader(e);if(r){const c=this.hls.logger,u=r.context;if(u&&u.levelOrTrack===e.levelOrTrack&&(u.url===e.url||u.deliveryDirectives&&!e.deliveryDirectives)){u.url===e.url?c.log(`[playlist-loader]: ignore ${e.url} ongoing request`):c.log(`[playlist-loader]: ignore ${e.url} in favor of ${u.url}`);return}c.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),r.abort()}let s;if(e.type===qe.MANIFEST?s=i.manifestLoadPolicy.default:s=ut({},i.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),r=this.createInternalLoader(e),Re((t=e.deliveryDirectives)==null?void 0:t.part)){let c;if(e.type===qe.LEVEL&&e.level!==null?c=this.hls.levels[e.level].details:e.type===qe.AUDIO_TRACK&&e.id!==null?c=this.hls.audioTracks[e.id].details:e.type===qe.SUBTITLE_TRACK&&e.id!==null&&(c=this.hls.subtitleTracks[e.id].details),c){const u=c.partTarget,d=c.targetduration;if(u&&d){const h=Math.max(u*3,d*.8)*1e3;s=ut({},s,{maxTimeToFirstByteMs:Math.min(h,s.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(h,s.maxTimeToFirstByteMs)})}}}const a=s.errorRetry||s.timeoutRetry||{},o={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},l={onSuccess:(c,u,d,h)=>{const m=this.getInternalLoader(d);this.resetInternalLoader(d.type);const g=c.data;if(g.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(c,d,new Error("no EXTM3U delimiter"),h||null,u);return}u.parsing.start=performance.now(),Ci.isMediaPlaylist(g)||d.type!==qe.MANIFEST?this.handleTrackOrLevelPlaylist(c,u,d,h||null,m):this.handleMasterPlaylist(c,u,d,h)},onError:(c,u,d,h)=>{this.handleNetworkError(u,d,!1,c,h)},onTimeout:(c,u,d)=>{this.handleNetworkError(u,d,!0,void 0,c)}};r.load(e,o,l)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:i}=this.hls;(e||i)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,i,r){const s=this.hls,a=e.data,o=Mh(e,i),l=Ci.parseMasterPlaylist(a,o);if(l.playlistParsingError){this.handleManifestParsingError(e,i,l.playlistParsingError,r,t);return}const{contentSteering:c,levels:u,sessionData:d,sessionKeys:h,startTimeOffset:m,variableList:g}=l;this.variableList=g;const{AUDIO:v=[],SUBTITLES:x,"CLOSED-CAPTIONS":E}=Ci.parseMasterPlaylistMedia(a,o,l);v.length&&!v.some(k=>!k.url)&&u[0].audioCodec&&!u[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),v.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new At({}),bitrate:0,url:""})),s.trigger(O.MANIFEST_LOADED,{levels:u,audioTracks:v,subtitles:x,captions:E,contentSteering:c,url:o,stats:t,networkDetails:r,sessionData:d,sessionKeys:h,startTimeOffset:m,variableList:g})}handleTrackOrLevelPlaylist(e,t,i,r,s){const a=this.hls,{id:o,level:l,type:c}=i,u=Mh(e,i),d=Re(l)?l:Re(o)?o:0,h=Oy(i),m=Ci.parseLevelPlaylist(e.data,u,d,h,0,this.variableList);if(c===qe.MANIFEST){const g={attrs:new At({}),bitrate:0,details:m,name:"",url:u};m.requestScheduled=t.loading.start+QS(m,0),a.trigger(O.MANIFEST_LOADED,{levels:[g],audioTracks:[],url:u,stats:t,networkDetails:r,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),i.levelDetails=m,this.handlePlaylistLoaded(m,e,t,i,r,s)}handleManifestParsingError(e,t,i,r,s){this.hls.trigger(O.ERROR,{type:Pe.NETWORK_ERROR,details:se.MANIFEST_PARSING_ERROR,fatal:t.type===qe.MANIFEST,url:e.url,err:i,error:i,reason:i.message,response:e,context:t,networkDetails:r,stats:s})}handleNetworkError(e,t,i=!1,r,s){let a=`A network ${i?"timeout":"error"+(r?" (status "+r.code+")":"")} occurred while loading ${e.type}`;e.type===qe.LEVEL?a+=`: ${e.level} id: ${e.id}`:(e.type===qe.AUDIO_TRACK||e.type===qe.SUBTITLE_TRACK)&&(a+=` id: ${e.id} group-id: "${e.groupId}"`);const o=new Error(a);this.hls.logger.warn(`[playlist-loader]: ${a}`);let l=se.UNKNOWN,c=!1;const u=this.getInternalLoader(e);switch(e.type){case qe.MANIFEST:l=i?se.MANIFEST_LOAD_TIMEOUT:se.MANIFEST_LOAD_ERROR,c=!0;break;case qe.LEVEL:l=i?se.LEVEL_LOAD_TIMEOUT:se.LEVEL_LOAD_ERROR,c=!1;break;case qe.AUDIO_TRACK:l=i?se.AUDIO_TRACK_LOAD_TIMEOUT:se.AUDIO_TRACK_LOAD_ERROR,c=!1;break;case qe.SUBTITLE_TRACK:l=i?se.SUBTITLE_TRACK_LOAD_TIMEOUT:se.SUBTITLE_LOAD_ERROR,c=!1;break}u&&this.resetInternalLoader(e.type);const d={type:Pe.NETWORK_ERROR,details:l,fatal:c,url:e.url,loader:u,context:e,error:o,networkDetails:t,stats:s};if(r){const h=(t==null?void 0:t.url)||e.url;d.response=ct({url:h,data:void 0},r)}this.hls.trigger(O.ERROR,d)}handlePlaylistLoaded(e,t,i,r,s,a){const o=this.hls,{type:l,level:c,id:u,groupId:d,deliveryDirectives:h}=r,m=Mh(t,r),g=Oy(r),v=typeof r.level=="number"&&g===Ce.MAIN?c:void 0;if(!e.fragments.length){const E=e.playlistParsingError=new Error("No Segments found in Playlist");o.trigger(O.ERROR,{type:Pe.NETWORK_ERROR,details:se.LEVEL_EMPTY_ERROR,fatal:!1,url:m,error:E,reason:E.message,response:t,context:r,level:v,parent:g,networkDetails:s,stats:i});return}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const x=e.playlistParsingError;if(x){if(this.hls.logger.warn(`${x} ${e.url}`),!o.config.ignorePlaylistParsingErrors){o.trigger(O.ERROR,{type:Pe.NETWORK_ERROR,details:se.LEVEL_PARSING_ERROR,fatal:!1,url:m,error:x,reason:x.message,response:t,context:r,level:v,parent:g,networkDetails:s,stats:i});return}e.playlistParsingError=null}switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),(!a.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),l){case qe.MANIFEST:case qe.LEVEL:o.trigger(O.LEVEL_LOADED,{details:e,levelInfo:r.levelOrTrack||o.levels[0],level:v||0,id:u||0,stats:i,networkDetails:s,deliveryDirectives:h,withoutMultiVariant:l===qe.MANIFEST});break;case qe.AUDIO_TRACK:o.trigger(O.AUDIO_TRACK_LOADED,{details:e,track:r.levelOrTrack,id:u||0,groupId:d||"",stats:i,networkDetails:s,deliveryDirectives:h});break;case qe.SUBTITLE_TRACK:o.trigger(O.SUBTITLE_TRACK_LOADED,{details:e,track:r.levelOrTrack,id:u||0,groupId:d||"",stats:i,networkDetails:s,deliveryDirectives:h});break}}}class Ri{static get version(){return pl}static isMSESupported(){return XT()}static isSupported(){return rN()}static getMediaSource(){return Zr()}static get Events(){return O}static get MetadataSchema(){return Cn}static get ErrorTypes(){return Pe}static get ErrorDetails(){return se}static get DefaultConfig(){return Ri.defaultConfig?Ri.defaultConfig:KM}static set DefaultConfig(e){Ri.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Nm,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=Ek(e.debug||!1,"Hls instance",e.assetPlayerId),i=this.config=qM(Ri.DefaultConfig,e,t);this.userConfig=e,i.progressive&&YM(i,t);const{abrController:r,bufferController:s,capLevelController:a,errorController:o,fpsController:l}=i,c=new o(this),u=this.abrController=new r(this),d=new uD(this),h=i.interstitialsController,m=h?this.interstitialsController=new h(this,Ri):null,g=this.bufferController=new s(this,d),v=this.capLevelController=new a(this),x=new l(this),E=new cN(this),R=i.contentSteeringController,k=R?new R(this):null,D=this.levelController=new iN(this,k),V=new tN(this),H=new lN(this.config),C=this.streamController=new oN(this,d,H),S=this.gapController=new ZM(this,d);v.setStreamController(C),x.setStreamController(C);const b=[E,D,C];m&&b.splice(1,0,m),k&&b.splice(1,0,k),this.networkControllers=b;const T=[u,g,S,v,x,V,d];this.audioTrackController=this.createController(i.audioTrackController,b);const L=i.audioStreamController;L&&b.push(this.audioStreamController=new L(this,d,H)),this.subtitleTrackController=this.createController(i.subtitleTrackController,b);const F=i.subtitleStreamController;F&&b.push(this.subtititleStreamController=new F(this,d,H)),this.createController(i.timelineController,T),H.emeController=this.emeController=this.createController(i.emeController,T),this.cmcdController=this.createController(i.cmcdController,T),this.latencyController=this.createController(nN,T),this.coreComponents=T,b.push(c);const U=c.onErrorOut;typeof U=="function"&&this.on(O.ERROR,U,c),this.on(O.MANIFEST_LOADED,E.onManifestLoaded,E)}createController(e,t){if(e){const i=new e(this);return t&&t.push(i),i}return null}on(e,t,i=this){this._emitter.on(e,t,i)}once(e,t,i=this){this._emitter.once(e,t,i)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,i=this,r){this._emitter.off(e,t,i,r)}listeners(e){return this._emitter.listeners(e)}emit(e,t,i){return this._emitter.emit(e,t,i)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(i){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+i.message+'". Here is a stacktrace:',i),!this.triggeringException){this.triggeringException=!0;const r=e===O.ERROR;this.trigger(O.ERROR,{type:Pe.OTHER_ERROR,details:se.INTERNAL_EXCEPTION,fatal:r,event:e,error:i}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(O.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const s=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(O.ERROR,{type:Pe.OTHER_ERROR,details:se.ATTACH_MEDIA_ERROR,fatal:!0,error:s});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,i=t?e.media:e,r=t?e:{media:i};this._media=i,this.trigger(O.MEDIA_ATTACHING,r)}detachMedia(){this.logger.log("detachMedia"),this.trigger(O.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(O.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,i=this._url,r=this._url=bm.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${r}`),t&&i&&(i!==r||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(O.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let i=0;i<this.networkControllers.length&&(this.networkControllers[i].startLoad(e,t),!(!this.started||!this.networkControllers));i++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[Ce.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[Ce.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[Ce.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e==null?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=ZO()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){qk(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const i=e.length;for(let r=0;r<i;r++)if(e[r].maxBitrate>=t)return r;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:i}=this;let r;if(t===-1&&e!=null&&e.length?r=e.length-1:r=t,i)for(let s=r;s--;){const a=e[s].attrs["HDCP-LEVEL"];if(a&&a<=i)return s}return r}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const i=VS(t);return US(e,i,navigator.mediaCapabilities)}}Ri.defaultConfig=void 0;var QT={exports:{}};(function(n,e){(function(t,i){n.exports=i()})(window,function(){return function(t){var i={};function r(s){if(i[s])return i[s].exports;var a=i[s]={i:s,l:!1,exports:{}};return t[s].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=t,r.c=i,r.d=function(s,a,o){r.o(s,a)||Object.defineProperty(s,a,{enumerable:!0,get:o})},r.r=function(s){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},r.t=function(s,a){if(1&a&&(s=r(s)),8&a||4&a&&typeof s=="object"&&s&&s.__esModule)return s;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:s}),2&a&&typeof s!="string")for(var l in s)r.d(o,l,(function(c){return s[c]}).bind(null,l));return o},r.n=function(s){var a=s&&s.__esModule?function(){return s.default}:function(){return s};return r.d(a,"a",a),a},r.o=function(s,a){return Object.prototype.hasOwnProperty.call(s,a)},r.p="",r(r.s=20)}([function(t,i,r){var s=r(9),a=r.n(s),o=function(){function l(){}return l.e=function(c,u){c&&!l.FORCE_GLOBAL_TAG||(c=l.GLOBAL_TAG);var d="[".concat(c,"] > ").concat(u);l.ENABLE_CALLBACK&&l.emitter.emit("log","error",d),l.ENABLE_ERROR&&(console.error?console.error(d):console.warn?console.warn(d):console.log(d))},l.i=function(c,u){c&&!l.FORCE_GLOBAL_TAG||(c=l.GLOBAL_TAG);var d="[".concat(c,"] > ").concat(u);l.ENABLE_CALLBACK&&l.emitter.emit("log","info",d),l.ENABLE_INFO&&(console.info?console.info(d):console.log(d))},l.w=function(c,u){c&&!l.FORCE_GLOBAL_TAG||(c=l.GLOBAL_TAG);var d="[".concat(c,"] > ").concat(u);l.ENABLE_CALLBACK&&l.emitter.emit("log","warn",d),l.ENABLE_WARN&&(console.warn?console.warn(d):console.log(d))},l.d=function(c,u){c&&!l.FORCE_GLOBAL_TAG||(c=l.GLOBAL_TAG);var d="[".concat(c,"] > ").concat(u);l.ENABLE_CALLBACK&&l.emitter.emit("log","debug",d),l.ENABLE_DEBUG&&(console.debug?console.debug(d):console.log(d))},l.v=function(c,u){c&&!l.FORCE_GLOBAL_TAG||(c=l.GLOBAL_TAG);var d="[".concat(c,"] > ").concat(u);l.ENABLE_CALLBACK&&l.emitter.emit("log","verbose",d),l.ENABLE_VERBOSE&&console.log(d)},l}();o.GLOBAL_TAG="mpegts.js",o.FORCE_GLOBAL_TAG=!1,o.ENABLE_ERROR=!0,o.ENABLE_INFO=!0,o.ENABLE_WARN=!0,o.ENABLE_DEBUG=!0,o.ENABLE_VERBOSE=!0,o.ENABLE_CALLBACK=!1,o.emitter=new a.a,i.a=o},function(t,i,r){var s;(function(a){a.IO_ERROR="io_error",a.DEMUX_ERROR="demux_error",a.INIT_SEGMENT="init_segment",a.MEDIA_SEGMENT="media_segment",a.LOADING_COMPLETE="loading_complete",a.RECOVERED_EARLY_EOF="recovered_early_eof",a.MEDIA_INFO="media_info",a.METADATA_ARRIVED="metadata_arrived",a.SCRIPTDATA_ARRIVED="scriptdata_arrived",a.TIMED_ID3_METADATA_ARRIVED="timed_id3_metadata_arrived",a.SYNCHRONOUS_KLV_METADATA_ARRIVED="synchronous_klv_metadata_arrived",a.ASYNCHRONOUS_KLV_METADATA_ARRIVED="asynchronous_klv_metadata_arrived",a.SMPTE2038_METADATA_ARRIVED="smpte2038_metadata_arrived",a.SCTE35_METADATA_ARRIVED="scte35_metadata_arrived",a.PES_PRIVATE_DATA_DESCRIPTOR="pes_private_data_descriptor",a.PES_PRIVATE_DATA_ARRIVED="pes_private_data_arrived",a.STATISTICS_INFO="statistics_info",a.RECOMMEND_SEEKPOINT="recommend_seekpoint"})(s||(s={})),i.a=s},function(t,i,r){r.d(i,"c",function(){return a}),r.d(i,"b",function(){return o}),r.d(i,"a",function(){return l});var s=r(3),a={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4},o={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"},l=function(){function c(u){this._type=u||"undefined",this._status=a.kIdle,this._needStash=!1,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}return c.prototype.destroy=function(){this._status=a.kIdle,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null},c.prototype.isWorking=function(){return this._status===a.kConnecting||this._status===a.kBuffering},Object.defineProperty(c.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"needStashBuffer",{get:function(){return this._needStash},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"onContentLengthKnown",{get:function(){return this._onContentLengthKnown},set:function(u){this._onContentLengthKnown=u},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"onURLRedirect",{get:function(){return this._onURLRedirect},set:function(u){this._onURLRedirect=u},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(u){this._onDataArrival=u},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"onError",{get:function(){return this._onError},set:function(u){this._onError=u},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"onComplete",{get:function(){return this._onComplete},set:function(u){this._onComplete=u},enumerable:!1,configurable:!0}),c.prototype.open=function(u,d){throw new s.c("Unimplemented abstract function!")},c.prototype.abort=function(){throw new s.c("Unimplemented abstract function!")},c}()},function(t,i,r){r.d(i,"d",function(){return o}),r.d(i,"a",function(){return l}),r.d(i,"b",function(){return c}),r.d(i,"c",function(){return u});var s,a=(s=function(d,h){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(m,g){m.__proto__=g}||function(m,g){for(var v in g)Object.prototype.hasOwnProperty.call(g,v)&&(m[v]=g[v])})(d,h)},function(d,h){if(typeof h!="function"&&h!==null)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");function m(){this.constructor=d}s(d,h),d.prototype=h===null?Object.create(h):(m.prototype=h.prototype,new m)}),o=function(){function d(h){this._message=h}return Object.defineProperty(d.prototype,"name",{get:function(){return"RuntimeException"},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"message",{get:function(){return this._message},enumerable:!1,configurable:!0}),d.prototype.toString=function(){return this.name+": "+this.message},d}(),l=function(d){function h(m){return d.call(this,m)||this}return a(h,d),Object.defineProperty(h.prototype,"name",{get:function(){return"IllegalStateException"},enumerable:!1,configurable:!0}),h}(o),c=function(d){function h(m){return d.call(this,m)||this}return a(h,d),Object.defineProperty(h.prototype,"name",{get:function(){return"InvalidArgumentException"},enumerable:!1,configurable:!0}),h}(o),u=function(d){function h(m){return d.call(this,m)||this}return a(h,d),Object.defineProperty(h.prototype,"name",{get:function(){return"NotImplementedException"},enumerable:!1,configurable:!0}),h}(o)},function(t,i,r){var s;(function(a){a.ERROR="error",a.LOADING_COMPLETE="loading_complete",a.RECOVERED_EARLY_EOF="recovered_early_eof",a.MEDIA_INFO="media_info",a.METADATA_ARRIVED="metadata_arrived",a.SCRIPTDATA_ARRIVED="scriptdata_arrived",a.TIMED_ID3_METADATA_ARRIVED="timed_id3_metadata_arrived",a.SYNCHRONOUS_KLV_METADATA_ARRIVED="synchronous_klv_metadata_arrived",a.ASYNCHRONOUS_KLV_METADATA_ARRIVED="asynchronous_klv_metadata_arrived",a.SMPTE2038_METADATA_ARRIVED="smpte2038_metadata_arrived",a.SCTE35_METADATA_ARRIVED="scte35_metadata_arrived",a.PES_PRIVATE_DATA_DESCRIPTOR="pes_private_data_descriptor",a.PES_PRIVATE_DATA_ARRIVED="pes_private_data_arrived",a.STATISTICS_INFO="statistics_info",a.DESTROYING="destroying"})(s||(s={})),i.a=s},function(t,i,r){var s={};(function(){var a=self.navigator.userAgent.toLowerCase(),o=/(edge)\/([\w.]+)/.exec(a)||/(opr)[\/]([\w.]+)/.exec(a)||/(chrome)[ \/]([\w.]+)/.exec(a)||/(iemobile)[\/]([\w.]+)/.exec(a)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||a.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(a)||a.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(a)||[],l=/(ipad)/.exec(a)||/(ipod)/.exec(a)||/(windows phone)/.exec(a)||/(iphone)/.exec(a)||/(kindle)/.exec(a)||/(android)/.exec(a)||/(windows)/.exec(a)||/(mac)/.exec(a)||/(linux)/.exec(a)||/(cros)/.exec(a)||[],c={browser:o[5]||o[3]||o[1]||"",version:o[2]||o[4]||"0",majorVersion:o[4]||o[2]||"0",platform:l[0]||""},u={};if(c.browser){u[c.browser]=!0;var d=c.majorVersion.split(".");u.version={major:parseInt(c.majorVersion,10),string:c.version},d.length>1&&(u.version.minor=parseInt(d[1],10)),d.length>2&&(u.version.build=parseInt(d[2],10))}c.platform&&(u[c.platform]=!0),(u.chrome||u.opr||u.safari)&&(u.webkit=!0),(u.rv||u.iemobile)&&(u.rv&&delete u.rv,c.browser="msie",u.msie=!0),u.edge&&(delete u.edge,c.browser="msedge",u.msedge=!0),u.opr&&(c.browser="opera",u.opera=!0),u.safari&&u.android&&(c.browser="android",u.android=!0);for(var h in u.name=c.browser,u.platform=c.platform,s)s.hasOwnProperty(h)&&delete s[h];Object.assign(s,u)})(),i.a=s},function(t,i,r){i.a={OK:"OK",FORMAT_ERROR:"FormatError",FORMAT_UNSUPPORTED:"FormatUnsupported",CODEC_UNSUPPORTED:"CodecUnsupported"}},function(t,i,r){var s;(function(a){a.ERROR="error",a.SOURCE_OPEN="source_open",a.UPDATE_END="update_end",a.BUFFER_FULL="buffer_full",a.START_STREAMING="start_streaming",a.END_STREAMING="end_streaming"})(s||(s={})),i.a=s},function(t,i,r){var s=r(9),a=r.n(s),o=r(0),l=function(){function c(){}return Object.defineProperty(c,"forceGlobalTag",{get:function(){return o.a.FORCE_GLOBAL_TAG},set:function(u){o.a.FORCE_GLOBAL_TAG=u,c._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(c,"globalTag",{get:function(){return o.a.GLOBAL_TAG},set:function(u){o.a.GLOBAL_TAG=u,c._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(c,"enableAll",{get:function(){return o.a.ENABLE_VERBOSE&&o.a.ENABLE_DEBUG&&o.a.ENABLE_INFO&&o.a.ENABLE_WARN&&o.a.ENABLE_ERROR},set:function(u){o.a.ENABLE_VERBOSE=u,o.a.ENABLE_DEBUG=u,o.a.ENABLE_INFO=u,o.a.ENABLE_WARN=u,o.a.ENABLE_ERROR=u,c._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(c,"enableDebug",{get:function(){return o.a.ENABLE_DEBUG},set:function(u){o.a.ENABLE_DEBUG=u,c._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(c,"enableVerbose",{get:function(){return o.a.ENABLE_VERBOSE},set:function(u){o.a.ENABLE_VERBOSE=u,c._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(c,"enableInfo",{get:function(){return o.a.ENABLE_INFO},set:function(u){o.a.ENABLE_INFO=u,c._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(c,"enableWarn",{get:function(){return o.a.ENABLE_WARN},set:function(u){o.a.ENABLE_WARN=u,c._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(c,"enableError",{get:function(){return o.a.ENABLE_ERROR},set:function(u){o.a.ENABLE_ERROR=u,c._notifyChange()},enumerable:!1,configurable:!0}),c.getConfig=function(){return{globalTag:o.a.GLOBAL_TAG,forceGlobalTag:o.a.FORCE_GLOBAL_TAG,enableVerbose:o.a.ENABLE_VERBOSE,enableDebug:o.a.ENABLE_DEBUG,enableInfo:o.a.ENABLE_INFO,enableWarn:o.a.ENABLE_WARN,enableError:o.a.ENABLE_ERROR,enableCallback:o.a.ENABLE_CALLBACK}},c.applyConfig=function(u){o.a.GLOBAL_TAG=u.globalTag,o.a.FORCE_GLOBAL_TAG=u.forceGlobalTag,o.a.ENABLE_VERBOSE=u.enableVerbose,o.a.ENABLE_DEBUG=u.enableDebug,o.a.ENABLE_INFO=u.enableInfo,o.a.ENABLE_WARN=u.enableWarn,o.a.ENABLE_ERROR=u.enableError,o.a.ENABLE_CALLBACK=u.enableCallback},c._notifyChange=function(){var u=c.emitter;if(u.listenerCount("change")>0){var d=c.getConfig();u.emit("change",d)}},c.registerListener=function(u){c.emitter.addListener("change",u)},c.removeListener=function(u){c.emitter.removeListener("change",u)},c.addLogListener=function(u){o.a.emitter.addListener("log",u),o.a.emitter.listenerCount("log")>0&&(o.a.ENABLE_CALLBACK=!0,c._notifyChange())},c.removeLogListener=function(u){o.a.emitter.removeListener("log",u),o.a.emitter.listenerCount("log")===0&&(o.a.ENABLE_CALLBACK=!1,c._notifyChange())},c}();l.emitter=new a.a,i.a=l},function(t,i,r){var s,a=typeof Reflect=="object"?Reflect:null,o=a&&typeof a.apply=="function"?a.apply:function(D,V,H){return Function.prototype.apply.call(D,V,H)};s=a&&typeof a.ownKeys=="function"?a.ownKeys:Object.getOwnPropertySymbols?function(D){return Object.getOwnPropertyNames(D).concat(Object.getOwnPropertySymbols(D))}:function(D){return Object.getOwnPropertyNames(D)};var l=Number.isNaN||function(D){return D!=D};function c(){c.init.call(this)}t.exports=c,t.exports.once=function(D,V){return new Promise(function(H,C){function S(T){D.removeListener(V,b),C(T)}function b(){typeof D.removeListener=="function"&&D.removeListener("error",S),H([].slice.call(arguments))}k(D,V,b,{once:!0}),V!=="error"&&function(T,L,F){typeof T.on=="function"&&k(T,"error",L,F)}(D,S,{once:!0})})},c.EventEmitter=c,c.prototype._events=void 0,c.prototype._eventsCount=0,c.prototype._maxListeners=void 0;var u=10;function d(D){if(typeof D!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof D)}function h(D){return D._maxListeners===void 0?c.defaultMaxListeners:D._maxListeners}function m(D,V,H,C){var S,b,T,L;if(d(H),(b=D._events)===void 0?(b=D._events=Object.create(null),D._eventsCount=0):(b.newListener!==void 0&&(D.emit("newListener",V,H.listener?H.listener:H),b=D._events),T=b[V]),T===void 0)T=b[V]=H,++D._eventsCount;else if(typeof T=="function"?T=b[V]=C?[H,T]:[T,H]:C?T.unshift(H):T.push(H),(S=h(D))>0&&T.length>S&&!T.warned){T.warned=!0;var F=new Error("Possible EventEmitter memory leak detected. "+T.length+" "+String(V)+" listeners added. Use emitter.setMaxListeners() to increase limit");F.name="MaxListenersExceededWarning",F.emitter=D,F.type=V,F.count=T.length,L=F,console&&console.warn&&console.warn(L)}return D}function g(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function v(D,V,H){var C={fired:!1,wrapFn:void 0,target:D,type:V,listener:H},S=g.bind(C);return S.listener=H,C.wrapFn=S,S}function x(D,V,H){var C=D._events;if(C===void 0)return[];var S=C[V];return S===void 0?[]:typeof S=="function"?H?[S.listener||S]:[S]:H?function(b){for(var T=new Array(b.length),L=0;L<T.length;++L)T[L]=b[L].listener||b[L];return T}(S):R(S,S.length)}function E(D){var V=this._events;if(V!==void 0){var H=V[D];if(typeof H=="function")return 1;if(H!==void 0)return H.length}return 0}function R(D,V){for(var H=new Array(V),C=0;C<V;++C)H[C]=D[C];return H}function k(D,V,H,C){if(typeof D.on=="function")C.once?D.once(V,H):D.on(V,H);else{if(typeof D.addEventListener!="function")throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof D);D.addEventListener(V,function S(b){C.once&&D.removeEventListener(V,S),H(b)})}}Object.defineProperty(c,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(D){if(typeof D!="number"||D<0||l(D))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+D+".");u=D}}),c.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},c.prototype.setMaxListeners=function(D){if(typeof D!="number"||D<0||l(D))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+D+".");return this._maxListeners=D,this},c.prototype.getMaxListeners=function(){return h(this)},c.prototype.emit=function(D){for(var V=[],H=1;H<arguments.length;H++)V.push(arguments[H]);var C=D==="error",S=this._events;if(S!==void 0)C=C&&S.error===void 0;else if(!C)return!1;if(C){var b;if(V.length>0&&(b=V[0]),b instanceof Error)throw b;var T=new Error("Unhandled error."+(b?" ("+b.message+")":""));throw T.context=b,T}var L=S[D];if(L===void 0)return!1;if(typeof L=="function")o(L,this,V);else{var F=L.length,U=R(L,F);for(H=0;H<F;++H)o(U[H],this,V)}return!0},c.prototype.addListener=function(D,V){return m(this,D,V,!1)},c.prototype.on=c.prototype.addListener,c.prototype.prependListener=function(D,V){return m(this,D,V,!0)},c.prototype.once=function(D,V){return d(V),this.on(D,v(this,D,V)),this},c.prototype.prependOnceListener=function(D,V){return d(V),this.prependListener(D,v(this,D,V)),this},c.prototype.removeListener=function(D,V){var H,C,S,b,T;if(d(V),(C=this._events)===void 0)return this;if((H=C[D])===void 0)return this;if(H===V||H.listener===V)--this._eventsCount==0?this._events=Object.create(null):(delete C[D],C.removeListener&&this.emit("removeListener",D,H.listener||V));else if(typeof H!="function"){for(S=-1,b=H.length-1;b>=0;b--)if(H[b]===V||H[b].listener===V){T=H[b].listener,S=b;break}if(S<0)return this;S===0?H.shift():function(L,F){for(;F+1<L.length;F++)L[F]=L[F+1];L.pop()}(H,S),H.length===1&&(C[D]=H[0]),C.removeListener!==void 0&&this.emit("removeListener",D,T||V)}return this},c.prototype.off=c.prototype.removeListener,c.prototype.removeAllListeners=function(D){var V,H,C;if((H=this._events)===void 0)return this;if(H.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):H[D]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete H[D]),this;if(arguments.length===0){var S,b=Object.keys(H);for(C=0;C<b.length;++C)(S=b[C])!=="removeListener"&&this.removeAllListeners(S);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(V=H[D])=="function")this.removeListener(D,V);else if(V!==void 0)for(C=V.length-1;C>=0;C--)this.removeListener(D,V[C]);return this},c.prototype.listeners=function(D){return x(this,D,!0)},c.prototype.rawListeners=function(D){return x(this,D,!1)},c.listenerCount=function(D,V){return typeof D.listenerCount=="function"?D.listenerCount(V):E.call(D,V)},c.prototype.listenerCount=E,c.prototype.eventNames=function(){return this._eventsCount>0?s(this._events):[]}},function(t,i,r){r.d(i,"b",function(){return o}),r.d(i,"a",function(){return l});var s=r(2),a=r(6),o={NETWORK_ERROR:"NetworkError",MEDIA_ERROR:"MediaError",OTHER_ERROR:"OtherError"},l={NETWORK_EXCEPTION:s.b.EXCEPTION,NETWORK_STATUS_CODE_INVALID:s.b.HTTP_STATUS_CODE_INVALID,NETWORK_TIMEOUT:s.b.CONNECTING_TIMEOUT,NETWORK_UNRECOVERABLE_EARLY_EOF:s.b.UNRECOVERABLE_EARLY_EOF,MEDIA_MSE_ERROR:"MediaMSEError",MEDIA_FORMAT_ERROR:a.a.FORMAT_ERROR,MEDIA_FORMAT_UNSUPPORTED:a.a.FORMAT_UNSUPPORTED,MEDIA_CODEC_UNSUPPORTED:a.a.CODEC_UNSUPPORTED}},function(t,i,r){r.d(i,"d",function(){return s}),r.d(i,"b",function(){return a}),r.d(i,"a",function(){return o}),r.d(i,"c",function(){return l});var s=function(c,u,d,h,m){this.dts=c,this.pts=u,this.duration=d,this.originalDts=h,this.isSyncPoint=m,this.fileposition=null},a=function(){function c(){this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}return c.prototype.appendSyncPoint=function(u){u.isSyncPoint=!0,this.syncPoints.push(u)},c}(),o=function(){function c(){this._list=[]}return c.prototype.clear=function(){this._list=[]},c.prototype.appendArray=function(u){var d=this._list;u.length!==0&&(d.length>0&&u[0].originalDts<d[d.length-1].originalDts&&this.clear(),Array.prototype.push.apply(d,u))},c.prototype.getLastSyncPointBeforeDts=function(u){if(this._list.length==0)return null;var d=this._list,h=0,m=d.length-1,g=0,v=0,x=m;for(u<d[0].dts&&(h=0,v=x+1);v<=x;){if((g=v+Math.floor((x-v)/2))===m||u>=d[g].dts&&u<d[g+1].dts){h=g;break}d[g].dts<u?v=g+1:x=g-1}return this._list[h]},c}(),l=function(){function c(u){this._type=u,this._list=[],this._lastAppendLocation=-1}return Object.defineProperty(c.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"length",{get:function(){return this._list.length},enumerable:!1,configurable:!0}),c.prototype.isEmpty=function(){return this._list.length===0},c.prototype.clear=function(){this._list=[],this._lastAppendLocation=-1},c.prototype._searchNearestSegmentBefore=function(u){var d=this._list;if(d.length===0)return-2;var h=d.length-1,m=0,g=0,v=h,x=0;if(u<d[0].originalBeginDts)return x=-1;for(;g<=v;){if((m=g+Math.floor((v-g)/2))===h||u>d[m].lastSample.originalDts&&u<d[m+1].originalBeginDts){x=m;break}d[m].originalBeginDts<u?g=m+1:v=m-1}return x},c.prototype._searchNearestSegmentAfter=function(u){return this._searchNearestSegmentBefore(u)+1},c.prototype.append=function(u){var d=this._list,h=u,m=this._lastAppendLocation,g=0;m!==-1&&m<d.length&&h.originalBeginDts>=d[m].lastSample.originalDts&&(m===d.length-1||m<d.length-1&&h.originalBeginDts<d[m+1].originalBeginDts)?g=m+1:d.length>0&&(g=this._searchNearestSegmentBefore(h.originalBeginDts)+1),this._lastAppendLocation=g,this._list.splice(g,0,h)},c.prototype.getLastSegmentBefore=function(u){var d=this._searchNearestSegmentBefore(u);return d>=0?this._list[d]:null},c.prototype.getLastSampleBefore=function(u){var d=this.getLastSegmentBefore(u);return d!=null?d.lastSample:null},c.prototype.getLastSyncPointBefore=function(u){for(var d=this._searchNearestSegmentBefore(u),h=this._list[d].syncPoints;h.length===0&&d>0;)d--,h=this._list[d].syncPoints;return h.length>0?h[h.length-1]:null},c}()},function(t,i,r){var s=function(){function a(){this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return a.prototype.isComplete=function(){var o=this.hasAudio===!1||this.hasAudio===!0&&this.audioCodec!=null&&this.audioSampleRate!=null&&this.audioChannelCount!=null,l=this.hasVideo===!1||this.hasVideo===!0&&this.videoCodec!=null&&this.width!=null&&this.height!=null&&this.fps!=null&&this.profile!=null&&this.level!=null&&this.refFrames!=null&&this.chromaFormat!=null&&this.sarNum!=null&&this.sarDen!=null;return this.mimeType!=null&&o&&l},a.prototype.isSeekable=function(){return this.hasKeyframesIndex===!0},a.prototype.getNearestKeyframe=function(o){if(this.keyframesIndex==null)return null;var l=this.keyframesIndex,c=this._search(l.times,o);return{index:c,milliseconds:l.times[c],fileposition:l.filepositions[c]}},a.prototype._search=function(o,l){var c=0,u=o.length-1,d=0,h=0,m=u;for(l<o[0]&&(c=0,h=m+1);h<=m;){if((d=h+Math.floor((m-h)/2))===u||l>=o[d]&&l<o[d+1]){c=d;break}o[d]<l?h=d+1:m=d-1}return c},a}();i.a=s},function(t,i,r){var s=r(9),a=r.n(s),o=r(0),l=r(5),c=r(12);function u(A,y,_){var p=A;if(y+_<p.length){for(;_--;)if((192&p[++y])!=128)return!1;return!0}return!1}var d,h=function(A){for(var y=[],_=A,p=0,I=A.length;p<I;)if(_[p]<128)y.push(String.fromCharCode(_[p])),++p;else{if(!(_[p]<192)){if(_[p]<224){if(u(_,p,1)&&(M=(31&_[p])<<6|63&_[p+1])>=128){y.push(String.fromCharCode(65535&M)),p+=2;continue}}else if(_[p]<240){if(u(_,p,2)&&(M=(15&_[p])<<12|(63&_[p+1])<<6|63&_[p+2])>=2048&&(63488&M)!=55296){y.push(String.fromCharCode(65535&M)),p+=3;continue}}else if(_[p]<248){var M;if(u(_,p,3)&&(M=(7&_[p])<<18|(63&_[p+1])<<12|(63&_[p+2])<<6|63&_[p+3])>65536&&M<1114112){M-=65536,y.push(String.fromCharCode(M>>>10|55296)),y.push(String.fromCharCode(1023&M|56320)),p+=4;continue}}}y.push("�"),++p}return y.join("")},m=r(3),g=(d=new ArrayBuffer(2),new DataView(d).setInt16(0,256,!0),new Int16Array(d)[0]===256),v=function(){function A(){}return A.parseScriptData=function(y,_,p){var I={};try{var M=A.parseValue(y,_,p),P=A.parseValue(y,_+M.size,p-M.size);I[M.data]=P.data}catch(B){o.a.e("AMF",B.toString())}return I},A.parseObject=function(y,_,p){if(p<3)throw new m.a("Data not enough when parse ScriptDataObject");var I=A.parseString(y,_,p),M=A.parseValue(y,_+I.size,p-I.size),P=M.objectEnd;return{data:{name:I.data,value:M.data},size:I.size+M.size,objectEnd:P}},A.parseVariable=function(y,_,p){return A.parseObject(y,_,p)},A.parseString=function(y,_,p){if(p<2)throw new m.a("Data not enough when parse String");var I=new DataView(y,_,p).getUint16(0,!g);return{data:I>0?h(new Uint8Array(y,_+2,I)):"",size:2+I}},A.parseLongString=function(y,_,p){if(p<4)throw new m.a("Data not enough when parse LongString");var I=new DataView(y,_,p).getUint32(0,!g);return{data:I>0?h(new Uint8Array(y,_+4,I)):"",size:4+I}},A.parseDate=function(y,_,p){if(p<10)throw new m.a("Data size invalid when parse Date");var I=new DataView(y,_,p),M=I.getFloat64(0,!g),P=I.getInt16(8,!g);return{data:new Date(M+=60*P*1e3),size:10}},A.parseValue=function(y,_,p){if(p<1)throw new m.a("Data not enough when parse Value");var I,M=new DataView(y,_,p),P=1,B=M.getUint8(0),W=!1;try{switch(B){case 0:I=M.getFloat64(1,!g),P+=8;break;case 1:I=!!M.getUint8(1),P+=1;break;case 2:var K=A.parseString(y,_+1,p-1);I=K.data,P+=K.size;break;case 3:I={};var Y=0;for((16777215&M.getUint32(p-4,!g))==9&&(Y=3);P<p-4;){var J=A.parseObject(y,_+P,p-P-Y);if(J.objectEnd)break;I[J.data.name]=J.data.value,P+=J.size}P<=p-3&&(16777215&M.getUint32(P-1,!g))===9&&(P+=3);break;case 8:for(I={},P+=4,Y=0,(16777215&M.getUint32(p-4,!g))==9&&(Y=3);P<p-8;){var X=A.parseVariable(y,_+P,p-P-Y);if(X.objectEnd)break;I[X.data.name]=X.data.value,P+=X.size}P<=p-3&&(16777215&M.getUint32(P-1,!g))===9&&(P+=3);break;case 9:I=void 0,P=1,W=!0;break;case 10:I=[];var ee=M.getUint32(1,!g);P+=4;for(var oe=0;oe<ee;oe++){var me=A.parseValue(y,_+P,p-P);I.push(me.data),P+=me.size}break;case 11:var de=A.parseDate(y,_+1,p-1);I=de.data,P+=de.size;break;case 12:var Te=A.parseString(y,_+1,p-1);I=Te.data,P+=Te.size;break;default:P=p,o.a.w("AMF","Unsupported AMF value type "+B)}}catch(Ee){o.a.e("AMF",Ee.toString())}return{data:I,size:P,objectEnd:W}},A}(),x=function(){function A(y){this.TAG="ExpGolomb",this._buffer=y,this._buffer_index=0,this._total_bytes=y.byteLength,this._total_bits=8*y.byteLength,this._current_word=0,this._current_word_bits_left=0}return A.prototype.destroy=function(){this._buffer=null},A.prototype._fillCurrentWord=function(){var y=this._total_bytes-this._buffer_index;if(y<=0)throw new m.a("ExpGolomb: _fillCurrentWord() but no bytes available");var _=Math.min(4,y),p=new Uint8Array(4);p.set(this._buffer.subarray(this._buffer_index,this._buffer_index+_)),this._current_word=new DataView(p.buffer).getUint32(0,!1),this._buffer_index+=_,this._current_word_bits_left=8*_},A.prototype.readBits=function(y){if(y>32)throw new m.b("ExpGolomb: readBits() bits exceeded max 32bits!");if(y<=this._current_word_bits_left){var _=this._current_word>>>32-y;return this._current_word<<=y,this._current_word_bits_left-=y,_}var p=this._current_word_bits_left?this._current_word:0;p>>>=32-this._current_word_bits_left;var I=y-this._current_word_bits_left;this._fillCurrentWord();var M=Math.min(I,this._current_word_bits_left),P=this._current_word>>>32-M;return this._current_word<<=M,this._current_word_bits_left-=M,p=p<<M|P},A.prototype.readBool=function(){return this.readBits(1)===1},A.prototype.readByte=function(){return this.readBits(8)},A.prototype._skipLeadingZero=function(){var y;for(y=0;y<this._current_word_bits_left;y++)if(this._current_word&2147483648>>>y)return this._current_word<<=y,this._current_word_bits_left-=y,y;return this._fillCurrentWord(),y+this._skipLeadingZero()},A.prototype.readUEG=function(){var y=this._skipLeadingZero();return this.readBits(y+1)-1},A.prototype.readSEG=function(){var y=this.readUEG();return 1&y?y+1>>>1:-1*(y>>>1)},A}(),E=function(){function A(){}return A._ebsp2rbsp=function(y){for(var _=y,p=_.byteLength,I=new Uint8Array(p),M=0,P=0;P<p;P++)P>=2&&_[P]===3&&_[P-1]===0&&_[P-2]===0||(I[M]=_[P],M++);return new Uint8Array(I.buffer,0,M)},A.parseSPS=function(y){for(var _=y.subarray(1,4),p="avc1.",I=0;I<3;I++){var M=_[I].toString(16);M.length<2&&(M="0"+M),p+=M}var P=A._ebsp2rbsp(y),B=new x(P);B.readByte();var W=B.readByte();B.readByte();var K=B.readByte();B.readUEG();var Y=A.getProfileString(W),J=A.getLevelString(K),X=1,ee=420,oe=8,me=8;if((W===100||W===110||W===122||W===244||W===44||W===83||W===86||W===118||W===128||W===138||W===144)&&((X=B.readUEG())===3&&B.readBits(1),X<=3&&(ee=[0,420,422,444][X]),oe=B.readUEG()+8,me=B.readUEG()+8,B.readBits(1),B.readBool()))for(var de=X!==3?8:12,Te=0;Te<de;Te++)B.readBool()&&(Te<6?A._skipScalingList(B,16):A._skipScalingList(B,64));B.readUEG();var Ee=B.readUEG();if(Ee===0)B.readUEG();else if(Ee===1){B.readBits(1),B.readSEG(),B.readSEG();var _e=B.readUEG();for(Te=0;Te<_e;Te++)B.readSEG()}var Ne=B.readUEG();B.readBits(1);var Ve=B.readUEG(),Ae=B.readUEG(),De=B.readBits(1);De===0&&B.readBits(1),B.readBits(1);var je=0,Me=0,Be=0,Ye=0;B.readBool()&&(je=B.readUEG(),Me=B.readUEG(),Be=B.readUEG(),Ye=B.readUEG());var it=1,Fe=1,He=0,rt=!0,Lt=0,jt=0;if(B.readBool()){if(B.readBool()){var pt=B.readByte();pt>0&&pt<16?(it=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][pt-1],Fe=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][pt-1]):pt===255&&(it=B.readByte()<<8|B.readByte(),Fe=B.readByte()<<8|B.readByte())}if(B.readBool()&&B.readBool(),B.readBool()&&(B.readBits(4),B.readBool()&&B.readBits(24)),B.readBool()&&(B.readUEG(),B.readUEG()),B.readBool()){var Yt=B.readBits(32),Nt=B.readBits(32);rt=B.readBool(),He=(Lt=Nt)/(jt=2*Yt)}}var Gt=1;it===1&&Fe===1||(Gt=it/Fe);var Ke=0,Xe=0;X===0?(Ke=1,Xe=2-De):(Ke=X===3?1:2,Xe=(X===1?2:1)*(2-De));var fn=16*(Ve+1),pn=16*(Ae+1)*(2-De);fn-=(je+Me)*Ke,pn-=(Be+Ye)*Xe;var Ks=Math.ceil(fn*Gt);return B.destroy(),B=null,{codec_mimetype:p,profile_idc:W,level_idc:K,profile_string:Y,level_string:J,chroma_format_idc:X,bit_depth:oe,bit_depth_luma:oe,bit_depth_chroma:me,ref_frames:Ne,chroma_format:ee,chroma_format_string:A.getChromaFormatString(ee),frame_rate:{fixed:rt,fps:He,fps_den:jt,fps_num:Lt},sar_ratio:{width:it,height:Fe},codec_size:{width:fn,height:pn},present_size:{width:Ks,height:pn}}},A._skipScalingList=function(y,_){for(var p=8,I=8,M=0;M<_;M++)I!==0&&(I=(p+y.readSEG()+256)%256),p=I===0?p:I},A.getProfileString=function(y){switch(y){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}},A.getLevelString=function(y){return(y/10).toFixed(1)},A.getChromaFormatString=function(y){switch(y){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}},A}(),R=r(6),k=function(){function A(){}return A._ebsp2rbsp=function(y){for(var _=y,p=_.byteLength,I=new Uint8Array(p),M=0,P=0;P<p;P++)P>=2&&_[P]===3&&_[P-1]===0&&_[P-2]===0||(I[M]=_[P],M++);return new Uint8Array(I.buffer,0,M)},A.parseVPS=function(y){var _=A._ebsp2rbsp(y),p=new x(_);return p.readByte(),p.readByte(),p.readBits(4),p.readBits(2),p.readBits(6),{num_temporal_layers:p.readBits(3)+1,temporal_id_nested:p.readBool()}},A.parseSPS=function(y){var _=A._ebsp2rbsp(y),p=new x(_);p.readByte(),p.readByte();for(var I=0,M=0,P=0,B=0,W=(p.readBits(4),p.readBits(3)),K=(p.readBool(),p.readBits(2)),Y=p.readBool(),J=p.readBits(5),X=p.readByte(),ee=p.readByte(),oe=p.readByte(),me=p.readByte(),de=p.readByte(),Te=p.readByte(),Ee=p.readByte(),_e=p.readByte(),Ne=p.readByte(),Ve=p.readByte(),Ae=p.readByte(),De=[],je=[],Me=0;Me<W;Me++)De.push(p.readBool()),je.push(p.readBool());if(W>0)for(Me=W;Me<8;Me++)p.readBits(2);for(Me=0;Me<W;Me++)De[Me]&&(p.readByte(),p.readByte(),p.readByte(),p.readByte(),p.readByte(),p.readByte(),p.readByte(),p.readByte(),p.readByte(),p.readByte(),p.readByte()),je[Me]&&p.readByte();p.readUEG();var Be=p.readUEG();Be==3&&p.readBits(1);var Ye=p.readUEG(),it=p.readUEG();p.readBool()&&(I+=p.readUEG(),M+=p.readUEG(),P+=p.readUEG(),B+=p.readUEG());var Fe=p.readUEG(),He=p.readUEG(),rt=p.readUEG();for(Me=p.readBool()?0:W;Me<=W;Me++)p.readUEG(),p.readUEG(),p.readUEG();if(p.readUEG(),p.readUEG(),p.readUEG(),p.readUEG(),p.readUEG(),p.readUEG(),p.readBool()&&p.readBool())for(var Lt=0;Lt<4;Lt++)for(var jt=0;jt<(Lt===3?2:6);jt++)if(p.readBool()){var pt=Math.min(64,1<<4+(Lt<<1));for(Lt>1&&p.readSEG(),Me=0;Me<pt;Me++)p.readSEG()}else p.readUEG();p.readBool(),p.readBool(),p.readBool()&&(p.readByte(),p.readUEG(),p.readUEG(),p.readBool());var Yt=p.readUEG(),Nt=0;for(Me=0;Me<Yt;Me++){var Gt=!1;if(Me!==0&&(Gt=p.readBool()),Gt){Me===Yt&&p.readUEG(),p.readBool(),p.readUEG();for(var Ke=0,Xe=0;Xe<=Nt;Xe++){var fn=p.readBool(),pn=!1;fn||(pn=p.readBool()),(fn||pn)&&Ke++}Nt=Ke}else{var Ks=p.readUEG(),no=p.readUEG();for(Nt=Ks+no,Xe=0;Xe<Ks;Xe++)p.readUEG(),p.readBool();for(Xe=0;Xe<no;Xe++)p.readUEG(),p.readBool()}}if(p.readBool()){var Ad=p.readUEG();for(Me=0;Me<Ad;Me++){for(Xe=0;Xe<rt+4;Xe++)p.readBits(1);p.readBits(1)}}var Fl=0,us=1,ds=1,Er=!1,Fn=1,Ws=1;if(p.readBool(),p.readBool(),p.readBool()){if(p.readBool()){var Sr=p.readByte();Sr>0&&Sr<=16?(us=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][Sr-1],ds=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][Sr-1]):Sr===255&&(us=p.readBits(16),ds=p.readBits(16))}if(p.readBool()&&p.readBool(),p.readBool()&&(p.readBits(3),p.readBool(),p.readBool()&&(p.readByte(),p.readByte(),p.readByte())),p.readBool()&&(p.readUEG(),p.readUEG()),p.readBool(),p.readBool(),p.readBool(),p.readBool()&&(p.readUEG(),p.readUEG(),p.readUEG(),p.readUEG()),p.readBool()&&(Fn=p.readBits(32),Ws=p.readBits(32),p.readBool()&&p.readUEG(),p.readBool())){var qs=!1,_i=!1,Ys=!1;for(qs=p.readBool(),_i=p.readBool(),(qs||_i)&&((Ys=p.readBool())&&(p.readByte(),p.readBits(5),p.readBool(),p.readBits(5)),p.readBits(4),p.readBits(4),Ys&&p.readBits(4),p.readBits(5),p.readBits(5),p.readBits(5)),Me=0;Me<=W;Me++){var Ul=p.readBool();Er=Ul;var $l=!0,Un=1;Ul||($l=p.readBool());var Vl=!1;if($l?p.readUEG():Vl=p.readBool(),Vl||(Un=p.readUEG()+1),qs){for(Xe=0;Xe<Un;Xe++)p.readUEG(),p.readUEG(),Ys&&(p.readUEG(),p.readUEG());p.readBool()}if(_i){for(Xe=0;Xe<Un;Xe++)p.readUEG(),p.readUEG(),Ys&&(p.readUEG(),p.readUEG());p.readBool()}}}p.readBool()&&(p.readBool(),p.readBool(),p.readBool(),Fl=p.readUEG(),p.readUEG(),p.readUEG(),p.readUEG(),p.readUEG())}p.readBool();var xd="hvc1.".concat(J,".1.L").concat(Ae,".B0"),hs=Ye-(I+M)*(Be===1||Be===2?2:1),fs=it-(P+B)*(Be===1?2:1),io=1;return us!==1&&ds!==1&&(io=us/ds),p.destroy(),p=null,{codec_mimetype:xd,profile_string:A.getProfileString(J),level_string:A.getLevelString(Ae),profile_idc:J,bit_depth:Fe+8,ref_frames:1,chroma_format:Be,chroma_format_string:A.getChromaFormatString(Be),general_level_idc:Ae,general_profile_space:K,general_tier_flag:Y,general_profile_idc:J,general_profile_compatibility_flags_1:X,general_profile_compatibility_flags_2:ee,general_profile_compatibility_flags_3:oe,general_profile_compatibility_flags_4:me,general_constraint_indicator_flags_1:de,general_constraint_indicator_flags_2:Te,general_constraint_indicator_flags_3:Ee,general_constraint_indicator_flags_4:_e,general_constraint_indicator_flags_5:Ne,general_constraint_indicator_flags_6:Ve,min_spatial_segmentation_idc:Fl,constant_frame_rate:0,chroma_format_idc:Be,bit_depth_luma_minus8:Fe,bit_depth_chroma_minus8:He,frame_rate:{fixed:Er,fps:Ws/Fn,fps_den:Fn,fps_num:Ws},sar_ratio:{width:us,height:ds},codec_size:{width:hs,height:fs},present_size:{width:hs*io,height:fs}}},A.parsePPS=function(y){var _=A._ebsp2rbsp(y),p=new x(_);p.readByte(),p.readByte(),p.readUEG(),p.readUEG(),p.readBool(),p.readBool(),p.readBits(3),p.readBool(),p.readBool(),p.readUEG(),p.readUEG(),p.readSEG(),p.readBool(),p.readBool(),p.readBool()&&p.readUEG(),p.readSEG(),p.readSEG(),p.readBool(),p.readBool(),p.readBool(),p.readBool();var I=p.readBool(),M=p.readBool(),P=1;return M&&I?P=0:M?P=3:I&&(P=2),{parallelismType:P}},A.getChromaFormatString=function(y){switch(y){case 0:return"4:0:0";case 1:return"4:2:0";case 2:return"4:2:2";case 3:return"4:4:4";default:return"Unknown"}},A.getProfileString=function(y){switch(y){case 1:return"Main";case 2:return"Main10";case 3:return"MainSP";case 4:return"Rext";case 9:return"SCC";default:return"Unknown"}},A.getLevelString=function(y){return(y/30).toFixed(1)},A}();function D(A){return A.byteOffset%2==0&&A.byteLength%2==0}function V(A){return A.byteOffset%4==0&&A.byteLength%4==0}function H(A,y){for(var _=0;_<A.length;_++)if(A[_]!==y[_])return!1;return!0}var C=function(A,y){return A.byteLength===y.byteLength&&(V(A)&&V(y)?function(_,p){return H(new Uint32Array(_.buffer,_.byteOffset,_.byteLength/4),new Uint32Array(p.buffer,p.byteOffset,p.byteLength/4))}(A,y):D(A)&&D(y)?function(_,p){return H(new Uint16Array(_.buffer,_.byteOffset,_.byteLength/2),new Uint16Array(p.buffer,p.byteOffset,p.byteLength/2))}(A,y):function(_,p){return H(_,p)}(A,y))},S=function(){return(S=Object.assign||function(A){for(var y,_=1,p=arguments.length;_<p;_++)for(var I in y=arguments[_])Object.prototype.hasOwnProperty.call(y,I)&&(A[I]=y[I]);return A}).apply(this,arguments)},b=function(){function A(){}return A.parseOBUs=function(y,_){for(var p=0;p<y.byteLength;){var I=p,M=(y[p],(120&y[p])>>3),P=(4&y[p])!=0,B=(2&y[p])!=0;y[p],p+=1,P&&(p+=1);var W=Number.POSITIVE_INFINITY;if(B){W=0;for(var K=0;;K++){var Y=y[p++];if(W|=(127&Y)<<7*K,(128&Y)==0)break}}console.log(M),M===1?_=S(S({},A.parseSeuqneceHeader(y.subarray(p,p+W))),{sequence_header_data:y.subarray(I,p+W)}):(M==3&&_||M==6&&_)&&(_=A.parseOBUFrameHeader(y.subarray(p,p+W),0,0,_)),p+=W}return _},A.parseSeuqneceHeader=function(y){var _=new x(y),p=_.readBits(3),I=(_.readBool(),_.readBool()),M=!0,P=0,B=1,W=void 0,K=[];if(I)K.push({operating_point_idc:0,level:_.readBits(5),tier:0});else{if(_.readBool()){var Y=_.readBits(32),J=_.readBits(32),X=_.readBool();if(X){for(var ee=0;_.readBits(1)===0;)ee+=1;ee>=32||(1<<ee)-1+_.readBits(ee)}(P=J)/(B=Y),M=X,_.readBool()&&(_.readBits(5),_.readBits(32),W=_.readBits(5),_.readBits(5))}for(var oe=_.readBool(),me=_.readBits(5),de=0;de<=me;de++){var Te=_.readBits(12),Ee=_.readBits(5),_e=Ee>7?_.readBits(1):0;K.push({operating_point_idc:Te,level:Ee,tier:_e}),oe&&_.readBool()&&_.readBits(4)}}var Ne=K[0],Ve=Ne.level,Ae=Ne.tier,De=_.readBits(4),je=_.readBits(4),Me=_.readBits(De+1)+1,Be=_.readBits(je+1)+1,Ye=!1;I||(Ye=_.readBool()),Ye&&(_.readBits(4),_.readBits(4)),_.readBool(),_.readBool(),_.readBool();var it=!1,Fe=2,He=2,rt=0;I||(_.readBool(),_.readBool(),_.readBool(),_.readBool(),(it=_.readBool())&&(_.readBool(),_.readBool()),(Fe=_.readBool()?2:_.readBits(1))?He=_.readBool()?2:_.readBits(1):He=2,it?rt=_.readBits(3)+1:rt=0);var Lt=_.readBool(),jt=(_.readBool(),_.readBool(),_.readBool()),pt=8;p===2&&jt?pt=_.readBool()?12:10:pt=jt?10:8;var Yt=!1;p!==1&&(Yt=_.readBool()),_.readBool()&&(_.readBits(8),_.readBits(8),_.readBits(8));var Nt=1,Gt=1;return Yt?(_.readBits(1),Nt=1,Gt=1):(_.readBits(1),p==0?(Nt=1,Gt=1):p==1?(Nt=0,Gt=0):pt==12?_.readBits(1)&&_.readBits(1):(Nt=1,Gt=0),Nt&&Gt&&_.readBits(2),_.readBits(1)),_.readBool(),_.destroy(),_=null,{codec_mimetype:"av01.".concat(p,".").concat(A.getLevelString(Ve,Ae),".").concat(pt.toString(10).padStart(2,"0")),level:Ve,tier:Ae,level_string:A.getLevelString(Ve,Ae),profile_idc:p,profile_string:"".concat(p),bit_depth:pt,ref_frames:1,chroma_format:A.getChromaFormat(Yt,Nt,Gt),chroma_format_string:A.getChromaFormatString(Yt,Nt,Gt),sequence_header:{frame_id_numbers_present_flag:Ye,additional_frame_id_length_minus_1:void 0,delta_frame_id_length_minus_2:void 0,reduced_still_picture_header:I,decoder_model_info_present_flag:!1,operating_points:K,buffer_removal_time_length_minus_1:W,equal_picture_interval:M,seq_force_screen_content_tools:Fe,seq_force_integer_mv:He,enable_order_hint:it,order_hint_bits:rt,enable_superres:Lt,frame_width_bit:De+1,frame_height_bit:je+1,max_frame_width:Me,max_frame_height:Be},keyframe:void 0,frame_rate:{fixed:M,fps:P/B,fps_den:B,fps_num:P}}},A.parseOBUFrameHeader=function(y,_,p,I){var M=I.sequence_header,P=new x(y),B=(M.max_frame_width,M.max_frame_height,0);M.frame_id_numbers_present_flag&&(B=M.additional_frame_id_length_minus_1+M.delta_frame_id_length_minus_2+3);var W=0,K=!0,Y=!0,J=!1;if(!M.reduced_still_picture_header){if(P.readBool())return I;K=(W=P.readBits(2))===2||W===0,(Y=P.readBool())&&M.decoder_model_info_present_flag&&M.equal_picture_interval,Y&&P.readBool(),J=!!(W===3||W===0&&Y)||P.readBool()}I.keyframe=K,P.readBool();var X=M.seq_force_screen_content_tools;M.seq_force_screen_content_tools===2&&(X=P.readBits(1)),X&&(M.seq_force_integer_mv,M.seq_force_integer_mv==2&&P.readBits(1)),M.frame_id_numbers_present_flag&&P.readBits(B);var ee=!1;if(ee=W==3||!M.reduced_still_picture_header&&P.readBool(),P.readBits(M.order_hint_bits),K||J||P.readBits(3),M.decoder_model_info_present_flag&&P.readBool()){for(var oe=0;oe<=M.operating_points_cnt_minus_1;oe++)if(M.operating_points[oe].decoder_model_present_for_this_op[oe]){var me=M.operating_points[oe].operating_point_idc;(me===0||me>>_&1&&me>>p+8&1)&&P.readBits(M.buffer_removal_time_length_minus_1+1)}}var de=255;if(W===3||W==0&&Y||(de=P.readBits(8)),(K||de!==255)&&J&&M.enable_order_hint)for(var Te=0;Te<8;Te++)P.readBits(M.order_hint_bits);if(K){var Ee=A.frameSizeAndRenderSize(P,ee,M);I.codec_size={width:Ee.FrameWidth,height:Ee.FrameHeight},I.present_size={width:Ee.RenderWidth,height:Ee.RenderHeight},I.sar_ratio={width:Ee.RenderWidth/Ee.FrameWidth,height:Ee.RenderHeight/Ee.FrameHeight}}return P.destroy(),P=null,I},A.frameSizeAndRenderSize=function(y,_,p){var I=p.max_frame_width,M=p.max_frame_height;_&&(I=y.readBits(p.frame_width_bit)+1,M=y.readBits(p.frame_height_bit)+1);var P=!1;p.enable_superres&&(P=y.readBool());var B=8;P&&(B=y.readBits(3)+9);var W=I;I=Math.floor((8*W+B/2)/B);var K=W,Y=M;if(y.readBool()){var J=y.readBits(16)+1,X=y.readBits(16)+1;K=y.readBits(J)+1,Y=y.readBits(X)+1}return{UpscaledWidth:W,FrameWidth:I,FrameHeight:M,RenderWidth:K,RenderHeight:Y}},A.getLevelString=function(y,_){return"".concat(y.toString(10).padStart(2,"0")).concat(_===0?"M":"H")},A.getChromaFormat=function(y,_,p){return y?0:_===0&&p===0?3:_===1&&p===0?2:_===1&&p===1?1:Number.NaN},A.getChromaFormatString=function(y,_,p){return y?"4:0:0":_===0&&p===0?"4:4:4":_===1&&p===0?"4:2:2":_===1&&p===1?"4:2:0":"Unknown"},A}(),T,L=function(){function A(y,_){this.TAG="FLVDemuxer",this._config=_,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._dataOffset=y.dataOffset,this._firstParse=!0,this._dispatch=!1,this._hasAudio=y.hasAudioTrack,this._hasVideo=y.hasVideoTrack,this._hasAudioFlagOverrided=!1,this._hasVideoFlagOverrided=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new c.a,this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0],this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0],this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},this._littleEndian=function(){var p=new ArrayBuffer(2);return new DataView(p).setInt16(0,256,!0),new Int16Array(p)[0]===256}()}return A.prototype.destroy=function(){this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null},A.probe=function(y){var _=new Uint8Array(y);if(_.byteLength<9)return{needMoreData:!0};var p={match:!1};if(_[0]!==70||_[1]!==76||_[2]!==86||_[3]!==1)return p;var I,M,P=(4&_[4])>>>2!=0,B=(1&_[4])!=0,W=(I=_)[M=5]<<24|I[M+1]<<16|I[M+2]<<8|I[M+3];return W<9?p:{match:!0,consumed:W,dataOffset:W,hasAudioTrack:P,hasVideoTrack:B}},A.prototype.bindDataSource=function(y){return y.onDataArrival=this.parseChunks.bind(this),this},Object.defineProperty(A.prototype,"onTrackMetadata",{get:function(){return this._onTrackMetadata},set:function(y){this._onTrackMetadata=y},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"onMediaInfo",{get:function(){return this._onMediaInfo},set:function(y){this._onMediaInfo=y},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"onMetaDataArrived",{get:function(){return this._onMetaDataArrived},set:function(y){this._onMetaDataArrived=y},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"onScriptDataArrived",{get:function(){return this._onScriptDataArrived},set:function(y){this._onScriptDataArrived=y},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"onError",{get:function(){return this._onError},set:function(y){this._onError=y},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"onDataAvailable",{get:function(){return this._onDataAvailable},set:function(y){this._onDataAvailable=y},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"timestampBase",{get:function(){return this._timestampBase},set:function(y){this._timestampBase=y},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"overridedDuration",{get:function(){return this._duration},set:function(y){this._durationOverrided=!0,this._duration=y,this._mediaInfo.duration=y},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"overridedHasAudio",{set:function(y){this._hasAudioFlagOverrided=!0,this._hasAudio=y,this._mediaInfo.hasAudio=y},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"overridedHasVideo",{set:function(y){this._hasVideoFlagOverrided=!0,this._hasVideo=y,this._mediaInfo.hasVideo=y},enumerable:!1,configurable:!0}),A.prototype.resetMediaInfo=function(){this._mediaInfo=new c.a},A.prototype._isInitialMetadataDispatched=function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!(this._hasAudio||!this._hasVideo)&&this._videoInitialMetadataDispatched},A.prototype.parseChunks=function(y,_){if(!(this._onError&&this._onMediaInfo&&this._onTrackMetadata&&this._onDataAvailable))throw new m.a("Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var p=0,I=this._littleEndian;if(_===0){if(!(y.byteLength>13))return 0;p=A.probe(y).dataOffset}for(this._firstParse&&(this._firstParse=!1,_+p!==this._dataOffset&&o.a.w(this.TAG,"First time parsing but chunk byteStart invalid!"),(M=new DataView(y,p)).getUint32(0,!I)!==0&&o.a.w(this.TAG,"PrevTagSize0 !== 0 !!!"),p+=4);p<y.byteLength;){this._dispatch=!0;var M=new DataView(y,p);if(p+11+4>y.byteLength)break;var P=M.getUint8(0),B=16777215&M.getUint32(0,!I);if(p+11+B+4>y.byteLength)break;if(P===8||P===9||P===18){var W=M.getUint8(4),K=M.getUint8(5),Y=M.getUint8(6)|K<<8|W<<16|M.getUint8(7)<<24;16777215&M.getUint32(7,!I)&&o.a.w(this.TAG,"Meet tag which has StreamID != 0!");var J=p+11;switch(P){case 8:this._parseAudioData(y,J,B,Y);break;case 9:this._parseVideoData(y,J,B,Y,_+p);break;case 18:this._parseScriptData(y,J,B)}var X=M.getUint32(11+B,!I);X!==11+B&&o.a.w(this.TAG,"Invalid PrevTagSize ".concat(X)),p+=11+B+4}else o.a.w(this.TAG,"Unsupported tag type ".concat(P,", skipped")),p+=11+B+4}return this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack),p},A.prototype._parseScriptData=function(y,_,p){var I=v.parseScriptData(y,_,p);if(I.hasOwnProperty("onMetaData")){if(I.onMetaData==null||typeof I.onMetaData!="object")return void o.a.w(this.TAG,"Invalid onMetaData structure!");this._metadata&&o.a.w(this.TAG,"Found another onMetaData tag!"),this._metadata=I;var M=this._metadata.onMetaData;if(this._onMetaDataArrived&&this._onMetaDataArrived(Object.assign({},M)),typeof M.hasAudio=="boolean"&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=M.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),typeof M.hasVideo=="boolean"&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=M.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),typeof M.audiodatarate=="number"&&(this._mediaInfo.audioDataRate=M.audiodatarate),typeof M.videodatarate=="number"&&(this._mediaInfo.videoDataRate=M.videodatarate),typeof M.width=="number"&&(this._mediaInfo.width=M.width),typeof M.height=="number"&&(this._mediaInfo.height=M.height),typeof M.duration=="number"){if(!this._durationOverrided){var P=Math.floor(M.duration*this._timescale);this._duration=P,this._mediaInfo.duration=P}}else this._mediaInfo.duration=0;if(typeof M.framerate=="number"){var B=Math.floor(1e3*M.framerate);if(B>0){var W=B/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=W,this._referenceFrameRate.fps_num=B,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=W}}if(typeof M.keyframes=="object"){this._mediaInfo.hasKeyframesIndex=!0;var K=M.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(K),M.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;this._dispatch=!1,this._mediaInfo.metadata=M,o.a.v(this.TAG,"Parsed onMetaData"),this._mediaInfo.isComplete()&&this._onMediaInfo(this._mediaInfo)}Object.keys(I).length>0&&this._onScriptDataArrived&&this._onScriptDataArrived(Object.assign({},I))},A.prototype._parseKeyframesIndex=function(y){for(var _=[],p=[],I=1;I<y.times.length;I++){var M=this._timestampBase+Math.floor(1e3*y.times[I]);_.push(M),p.push(y.filepositions[I])}return{times:_,filepositions:p}},A.prototype._parseAudioData=function(y,_,p,I){if(p<=1)o.a.w(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");else if(this._hasAudioFlagOverrided!==!0||this._hasAudio!==!1){this._littleEndian;var M=new DataView(y,_,p).getUint8(0),P=M>>>4;if(P!==9)if(P===2||P===10){var B=0,W=(12&M)>>>2;if(W>=0&&W<=4){B=this._flvSoundRateTable[W];var K=1&M,Y=this._audioMetadata,J=this._audioTrack;if(Y||(this._hasAudio===!1&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),(Y=this._audioMetadata={}).type="audio",Y.id=J.id,Y.timescale=this._timescale,Y.duration=this._duration,Y.audioSampleRate=B,Y.channelCount=K===0?1:2),P===10){var X=this._parseAACAudioData(y,_+1,p-1);if(X==null)return;if(X.packetType===0){if(Y.config){if(C(X.data.config,Y.config))return;o.a.w(this.TAG,"AudioSpecificConfig has been changed, re-generate initialization segment")}var ee=X.data;Y.audioSampleRate=ee.samplingRate,Y.channelCount=ee.channelCount,Y.codec=ee.codec,Y.originalCodec=ee.originalCodec,Y.config=ee.config,Y.refSampleDuration=1024/Y.audioSampleRate*Y.timescale,o.a.v(this.TAG,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",Y),(de=this._mediaInfo).audioCodec=Y.originalCodec,de.audioSampleRate=Y.audioSampleRate,de.audioChannelCount=Y.channelCount,de.hasVideo?de.videoCodec!=null&&(de.mimeType='video/x-flv; codecs="'+de.videoCodec+","+de.audioCodec+'"'):de.mimeType='video/x-flv; codecs="'+de.audioCodec+'"',de.isComplete()&&this._onMediaInfo(de)}else if(X.packetType===1){var oe=this._timestampBase+I,me={unit:X.data,length:X.data.byteLength,dts:oe,pts:oe};J.samples.push(me),J.length+=X.data.length}else o.a.e(this.TAG,"Flv: Unsupported AAC data type ".concat(X.packetType))}else if(P===2){if(!Y.codec){var de;if((ee=this._parseMP3AudioData(y,_+1,p-1,!0))==null)return;Y.audioSampleRate=ee.samplingRate,Y.channelCount=ee.channelCount,Y.codec=ee.codec,Y.originalCodec=ee.originalCodec,Y.refSampleDuration=1152/Y.audioSampleRate*Y.timescale,o.a.v(this.TAG,"Parsed MPEG Audio Frame Header"),this._audioInitialMetadataDispatched=!0,this._onTrackMetadata("audio",Y),(de=this._mediaInfo).audioCodec=Y.codec,de.audioSampleRate=Y.audioSampleRate,de.audioChannelCount=Y.channelCount,de.audioDataRate=ee.bitRate,de.hasVideo?de.videoCodec!=null&&(de.mimeType='video/x-flv; codecs="'+de.videoCodec+","+de.audioCodec+'"'):de.mimeType='video/x-flv; codecs="'+de.audioCodec+'"',de.isComplete()&&this._onMediaInfo(de)}var Te=this._parseMP3AudioData(y,_+1,p-1,!1);if(Te==null)return;oe=this._timestampBase+I;var Ee={unit:Te,length:Te.byteLength,dts:oe,pts:oe};J.samples.push(Ee),J.length+=Te.length}}else this._onError(R.a.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+W)}else this._onError(R.a.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+P);else{if(p<=5)return void o.a.w(this.TAG,"Flv: Invalid audio packet, missing AudioFourCC in Ehnanced FLV payload!");var _e=15&M,Ne=String.fromCharCode.apply(String,new Uint8Array(y,_,p).slice(1,5));switch(Ne){case"Opus":this._parseOpusAudioPacket(y,_+5,p-5,I,_e);break;case"fLaC":this._parseFlacAudioPacket(y,_+5,p-5,I,_e);break;default:this._onError(R.a.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec: "+Ne)}}}},A.prototype._parseAACAudioData=function(y,_,p){if(!(p<=1)){var I={},M=new Uint8Array(y,_,p);return I.packetType=M[0],M[0]===0?I.data=this._parseAACAudioSpecificConfig(y,_+1,p-1):I.data=M.subarray(1),I}o.a.w(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!")},A.prototype._parseAACAudioSpecificConfig=function(y,_,p){var I,M,P=new Uint8Array(y,_,p),B=null,W=0,K=null;if(W=I=P[0]>>>3,(M=(7&P[0])<<1|P[1]>>>7)<0||M>=this._mpegSamplingRates.length)this._onError(R.a.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");else{var Y=this._mpegSamplingRates[M],J=(120&P[1])>>>3;if(!(J<0||J>=8)){W===5&&(K=(7&P[1])<<1|P[2]>>>7,(124&P[2])>>>2);var X=self.navigator.userAgent.toLowerCase();return X.indexOf("firefox")!==-1?M>=6?(W=5,B=new Array(4),K=M-3):(W=2,B=new Array(2),K=M):X.indexOf("android")!==-1?(W=2,B=new Array(2),K=M):(W=5,K=M,B=new Array(4),M>=6?K=M-3:J===1&&(W=2,B=new Array(2),K=M)),B[0]=W<<3,B[0]|=(15&M)>>>1,B[1]=(15&M)<<7,B[1]|=(15&J)<<3,W===5&&(B[1]|=(15&K)>>>1,B[2]=(1&K)<<7,B[2]|=8,B[3]=0),{config:B,samplingRate:Y,channelCount:J,codec:"mp4a.40."+W,originalCodec:"mp4a.40."+I}}this._onError(R.a.FORMAT_ERROR,"Flv: AAC invalid channel configuration")}},A.prototype._parseMP3AudioData=function(y,_,p,I){if(!(p<4)){this._littleEndian;var M=new Uint8Array(y,_,p),P=null;if(I){if(M[0]!==255)return;var B=M[1]>>>3&3,W=(6&M[1])>>1,K=(240&M[2])>>>4,Y=(12&M[2])>>>2,J=(M[3]>>>6&3)!==3?2:1,X=0,ee=0;switch(B){case 0:X=this._mpegAudioV25SampleRateTable[Y];break;case 2:X=this._mpegAudioV20SampleRateTable[Y];break;case 3:X=this._mpegAudioV10SampleRateTable[Y]}switch(W){case 1:K<this._mpegAudioL3BitRateTable.length&&(ee=this._mpegAudioL3BitRateTable[K]);break;case 2:K<this._mpegAudioL2BitRateTable.length&&(ee=this._mpegAudioL2BitRateTable[K]);break;case 3:K<this._mpegAudioL1BitRateTable.length&&(ee=this._mpegAudioL1BitRateTable[K])}P={bitRate:ee,samplingRate:X,channelCount:J,codec:"mp3",originalCodec:"mp3"}}else P=M;return P}o.a.w(this.TAG,"Flv: Invalid MP3 packet, header missing!")},A.prototype._parseOpusAudioPacket=function(y,_,p,I,M){if(M===0)this._parseOpusSequenceHeader(y,_,p);else if(M===1)this._parseOpusAudioData(y,_,p,I);else if(M!==2)return void this._onError(R.a.FORMAT_ERROR,"Flv: Invalid video packet type ".concat(M))},A.prototype._parseOpusSequenceHeader=function(y,_,p){if(p<=16)o.a.w(this.TAG,"Flv: Invalid OpusSequenceHeader, lack of data!");else{var I=this._audioMetadata,M=this._audioTrack;I||(this._hasAudio===!1&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),(I=this._audioMetadata={}).type="audio",I.id=M.id,I.timescale=this._timescale,I.duration=this._duration);var P=new DataView(y,_,p);P.setUint8(8,0);var B=P.getUint8(9);P.setUint16(10,P.getUint16(10,!0),!1);var W=P.getUint32(12,!0);P.setUint32(12,P.getUint32(12,!0),!1);var K={config:new Uint8Array(y,_+8,p-8),channelCount:B,samplingFrequence:W,codec:"opus",originalCodec:"opus"};if(I.config){if(C(K.config,I.config))return;o.a.w(this.TAG,"OpusSequenceHeader has been changed, re-generate initialization segment")}I.audioSampleRate=K.samplingFrequence,I.channelCount=K.channelCount,I.codec=K.codec,I.originalCodec=K.originalCodec,I.config=K.config,I.refSampleDuration=20,o.a.v(this.TAG,"Parsed OpusSequenceHeader"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",I);var Y=this._mediaInfo;Y.audioCodec=I.originalCodec,Y.audioSampleRate=I.audioSampleRate,Y.audioChannelCount=I.channelCount,Y.hasVideo?Y.videoCodec!=null&&(Y.mimeType='video/x-flv; codecs="'+Y.videoCodec+","+Y.audioCodec+'"'):Y.mimeType='video/x-flv; codecs="'+Y.audioCodec+'"',Y.isComplete()&&this._onMediaInfo(Y)}},A.prototype._parseOpusAudioData=function(y,_,p,I){var M=this._audioTrack,P=new Uint8Array(y,_,p),B=this._timestampBase+I,W={unit:P,length:P.byteLength,dts:B,pts:B};M.samples.push(W),M.length+=P.length},A.prototype._parseFlacAudioPacket=function(y,_,p,I,M){if(M===0)this._parseFlacSequenceHeader(y,_,p);else if(M===1)this._parseFlacAudioData(y,_,p,I);else if(M!==2)return void this._onError(R.a.FORMAT_ERROR,"Flv: Invalid Flac audio packet type ".concat(M))},A.prototype._parseFlacSequenceHeader=function(y,_,p){var I=this._audioMetadata,M=this._audioTrack;I||(this._hasAudio===!1&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),(I=this._audioMetadata={}).type="audio",I.id=M.id,I.timescale=this._timescale,I.duration=this._duration);var P=new Uint8Array(y,_+4,p-4),B=new x(P),W=B.readBits(16),K=B.readBits(16),Y=K===W?K:null;B.readBits(24),B.readBits(24);var J=B.readBits(20),X=B.readBits(3)+1,ee=B.readBits(5)+1;B.destroy();var oe=new Uint8Array(P.byteLength+4);oe.set(P,4),oe[0]=128,oe[1]=P.byteLength>>>16&255,oe[2]=P.byteLength>>>8&255,oe[3]=P.byteLength>>>0&255;var me={config:oe,channelCount:X,samplingFrequence:J,sampleSize:ee,codec:"flac",originalCodec:"flac"};if(I.config){if(C(me.config,I.config))return;o.a.w(this.TAG,"FlacSequenceHeader has been changed, re-generate initialization segment")}I.audioSampleRate=me.samplingFrequence,I.channelCount=me.channelCount,I.sampleSize=me.sampleSize,I.codec=me.codec,I.originalCodec=me.originalCodec,I.config=me.config,I.refSampleDuration=Y!=null?1e3*Y/me.samplingFrequence:null,o.a.v(this.TAG,"Parsed FlacSequenceHeader"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",I);var de=this._mediaInfo;de.audioCodec=I.originalCodec,de.audioSampleRate=I.audioSampleRate,de.audioChannelCount=I.channelCount,de.hasVideo?de.videoCodec!=null&&(de.mimeType='video/x-flv; codecs="'+de.videoCodec+","+de.audioCodec+'"'):de.mimeType='video/x-flv; codecs="'+de.audioCodec+'"',de.isComplete()&&this._onMediaInfo(de)},A.prototype._parseFlacAudioData=function(y,_,p,I){var M=this._audioTrack,P=new Uint8Array(y,_,p),B=this._timestampBase+I,W={unit:P,length:P.byteLength,dts:B,pts:B};M.samples.push(W),M.length+=P.length},A.prototype._parseVideoData=function(y,_,p,I,M){if(p<=1)o.a.w(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");else if(this._hasVideoFlagOverrided!==!0||this._hasVideo!==!1){var P=new Uint8Array(y,_,p)[0],B=(112&P)>>>4;if(128&P){var W=15&P,K=String.fromCharCode.apply(String,new Uint8Array(y,_,p).slice(1,5));if(K==="hvc1")this._parseEnhancedHEVCVideoPacket(y,_+5,p-5,I,M,B,W);else{if(K!=="av01")return void this._onError(R.a.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: ".concat(K));this._parseEnhancedAV1VideoPacket(y,_+5,p-5,I,M,B,W)}}else{var Y=15&P;if(Y===7)this._parseAVCVideoPacket(y,_+1,p-1,I,M,B);else{if(Y!==12)return void this._onError(R.a.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: ".concat(Y));this._parseHEVCVideoPacket(y,_+1,p-1,I,M,B)}}}},A.prototype._parseAVCVideoPacket=function(y,_,p,I,M,P){if(p<4)o.a.w(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");else{var B=this._littleEndian,W=new DataView(y,_,p),K=W.getUint8(0),Y=(16777215&W.getUint32(0,!B))<<8>>8;if(K===0)this._parseAVCDecoderConfigurationRecord(y,_+4,p-4);else if(K===1)this._parseAVCVideoData(y,_+4,p-4,I,M,P,Y);else if(K!==2)return void this._onError(R.a.FORMAT_ERROR,"Flv: Invalid video packet type ".concat(K))}},A.prototype._parseHEVCVideoPacket=function(y,_,p,I,M,P){if(p<4)o.a.w(this.TAG,"Flv: Invalid HEVC packet, missing HEVCPacketType or/and CompositionTime");else{var B=this._littleEndian,W=new DataView(y,_,p),K=W.getUint8(0),Y=(16777215&W.getUint32(0,!B))<<8>>8;if(K===0)this._parseHEVCDecoderConfigurationRecord(y,_+4,p-4);else if(K===1)this._parseHEVCVideoData(y,_+4,p-4,I,M,P,Y);else if(K!==2)return void this._onError(R.a.FORMAT_ERROR,"Flv: Invalid video packet type ".concat(K))}},A.prototype._parseEnhancedHEVCVideoPacket=function(y,_,p,I,M,P,B){var W=this._littleEndian,K=new DataView(y,_,p);if(B===0)this._parseHEVCDecoderConfigurationRecord(y,_,p);else if(B===1){var Y=(4294967040&K.getUint32(0,!W))>>8;this._parseHEVCVideoData(y,_+3,p-3,I,M,P,Y)}else if(B===3)this._parseHEVCVideoData(y,_,p,I,M,P,0);else if(B!==2)return void this._onError(R.a.FORMAT_ERROR,"Flv: Invalid video packet type ".concat(B))},A.prototype._parseEnhancedAV1VideoPacket=function(y,_,p,I,M,P,B){if(this._littleEndian,B===0)this._parseAV1CodecConfigurationRecord(y,_,p);else if(B===1)this._parseAV1VideoData(y,_,p,I,M,P,0);else{if(B===5)return void this._onError(R.a.FORMAT_ERROR,"Flv: Not Supported MP2T AV1 video packet type ".concat(B));if(B!==2)return void this._onError(R.a.FORMAT_ERROR,"Flv: Invalid video packet type ".concat(B))}},A.prototype._parseAVCDecoderConfigurationRecord=function(y,_,p){if(p<7)o.a.w(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");else{var I=this._videoMetadata,M=this._videoTrack,P=this._littleEndian,B=new DataView(y,_,p);if(I){if(I.avcc!==void 0){var W=new Uint8Array(y,_,p);if(C(W,I.avcc))return;o.a.w(this.TAG,"AVCDecoderConfigurationRecord has been changed, re-generate initialization segment")}}else this._hasVideo===!1&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),(I=this._videoMetadata={}).type="video",I.id=M.id,I.timescale=this._timescale,I.duration=this._duration;var K=B.getUint8(0),Y=B.getUint8(1);if(B.getUint8(2),B.getUint8(3),K===1&&Y!==0)if(this._naluLengthSize=1+(3&B.getUint8(4)),this._naluLengthSize===3||this._naluLengthSize===4){var J=31&B.getUint8(5);if(J!==0){J>1&&o.a.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = ".concat(J));for(var X=6,ee=0;ee<J;ee++){var oe=B.getUint16(X,!P);if(X+=2,oe!==0){var me=new Uint8Array(y,_+X,oe);X+=oe;var de=E.parseSPS(me);if(ee===0){I.codecWidth=de.codec_size.width,I.codecHeight=de.codec_size.height,I.presentWidth=de.present_size.width,I.presentHeight=de.present_size.height,I.profile=de.profile_string,I.level=de.level_string,I.bitDepth=de.bit_depth,I.chromaFormat=de.chroma_format,I.sarRatio=de.sar_ratio,I.frameRate=de.frame_rate,de.frame_rate.fixed!==!1&&de.frame_rate.fps_num!==0&&de.frame_rate.fps_den!==0||(I.frameRate=this._referenceFrameRate);var Te=I.frameRate.fps_den,Ee=I.frameRate.fps_num;I.refSampleDuration=I.timescale*(Te/Ee);for(var _e=me.subarray(1,4),Ne="avc1.",Ve=0;Ve<3;Ve++){var Ae=_e[Ve].toString(16);Ae.length<2&&(Ae="0"+Ae),Ne+=Ae}I.codec=Ne;var De=this._mediaInfo;De.width=I.codecWidth,De.height=I.codecHeight,De.fps=I.frameRate.fps,De.profile=I.profile,De.level=I.level,De.refFrames=de.ref_frames,De.chromaFormat=de.chroma_format_string,De.sarNum=I.sarRatio.width,De.sarDen=I.sarRatio.height,De.videoCodec=Ne,De.hasAudio?De.audioCodec!=null&&(De.mimeType='video/x-flv; codecs="'+De.videoCodec+","+De.audioCodec+'"'):De.mimeType='video/x-flv; codecs="'+De.videoCodec+'"',De.isComplete()&&this._onMediaInfo(De)}}}var je=B.getUint8(X);if(je!==0){for(je>1&&o.a.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = ".concat(je)),X++,ee=0;ee<je;ee++)oe=B.getUint16(X,!P),X+=2,oe!==0&&(X+=oe);I.avcc=new Uint8Array(p),I.avcc.set(new Uint8Array(y,_,p),0),o.a.v(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",I)}else this._onError(R.a.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No PPS")}else this._onError(R.a.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No SPS")}else this._onError(R.a.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: ".concat(this._naluLengthSize-1));else this._onError(R.a.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord")}},A.prototype._parseHEVCDecoderConfigurationRecord=function(y,_,p){if(p<22)o.a.w(this.TAG,"Flv: Invalid HEVCDecoderConfigurationRecord, lack of data!");else{var I=this._videoMetadata,M=this._videoTrack,P=this._littleEndian,B=new DataView(y,_,p);if(I){if(I.hvcc!==void 0){var W=new Uint8Array(y,_,p);if(C(W,I.hvcc))return;o.a.w(this.TAG,"HEVCDecoderConfigurationRecord has been changed, re-generate initialization segment")}}else this._hasVideo===!1&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),(I=this._videoMetadata={}).type="video",I.id=M.id,I.timescale=this._timescale,I.duration=this._duration;var K=B.getUint8(0),Y=31&B.getUint8(1);if(K!==0&&K!==1||Y===0)this._onError(R.a.FORMAT_ERROR,"Flv: Invalid HEVCDecoderConfigurationRecord");else if(this._naluLengthSize=1+(3&B.getUint8(21)),this._naluLengthSize===3||this._naluLengthSize===4){for(var J=B.getUint8(22),X=0,ee=23;X<J;X++){var oe=63&B.getUint8(ee+0),me=B.getUint16(ee+1,!P);ee+=3;for(var de=0;de<me;de++){var Te=B.getUint16(ee+0,!P);if(de===0)if(oe===33){ee+=2;var Ee=new Uint8Array(y,_+ee,Te),_e=k.parseSPS(Ee);I.codecWidth=_e.codec_size.width,I.codecHeight=_e.codec_size.height,I.presentWidth=_e.present_size.width,I.presentHeight=_e.present_size.height,I.profile=_e.profile_string,I.level=_e.level_string,I.bitDepth=_e.bit_depth,I.chromaFormat=_e.chroma_format,I.sarRatio=_e.sar_ratio,I.frameRate=_e.frame_rate,_e.frame_rate.fixed!==!1&&_e.frame_rate.fps_num!==0&&_e.frame_rate.fps_den!==0||(I.frameRate=this._referenceFrameRate);var Ne=I.frameRate.fps_den,Ve=I.frameRate.fps_num;I.refSampleDuration=I.timescale*(Ne/Ve),I.codec=_e.codec_mimetype;var Ae=this._mediaInfo;Ae.width=I.codecWidth,Ae.height=I.codecHeight,Ae.fps=I.frameRate.fps,Ae.profile=I.profile,Ae.level=I.level,Ae.refFrames=_e.ref_frames,Ae.chromaFormat=_e.chroma_format_string,Ae.sarNum=I.sarRatio.width,Ae.sarDen=I.sarRatio.height,Ae.videoCodec=_e.codec_mimetype,Ae.hasAudio?Ae.audioCodec!=null&&(Ae.mimeType='video/x-flv; codecs="'+Ae.videoCodec+","+Ae.audioCodec+'"'):Ae.mimeType='video/x-flv; codecs="'+Ae.videoCodec+'"',Ae.isComplete()&&this._onMediaInfo(Ae),ee+=Te}else ee+=2+Te;else ee+=2+Te}}I.hvcc=new Uint8Array(p),I.hvcc.set(new Uint8Array(y,_,p),0),o.a.v(this.TAG,"Parsed HEVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",I)}else this._onError(R.a.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: ".concat(this._naluLengthSize-1))}},A.prototype._parseAV1CodecConfigurationRecord=function(y,_,p){if(p<4)o.a.w(this.TAG,"Flv: Invalid AV1CodecConfigurationRecord, lack of data!");else{var I=this._videoMetadata,M=this._videoTrack,P=(this._littleEndian,new DataView(y,_,p));I?I.av1c!==void 0&&o.a.w(this.TAG,"Found another AV1CodecConfigurationRecord!"):(this._hasVideo===!1&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),(I=this._videoMetadata={}).type="video",I.id=M.id,I.timescale=this._timescale,I.duration=this._duration);var B=127&P.getUint8(0);if(P.getUint8(1),P.getUint8(1),P.getUint8(2),B===1){var W=b.parseOBUs(new Uint8Array(y,_+4,p-4));if(W!=null){I.profile=W.profile_string,I.level=W.level_string,I.bitDepth=W.bit_depth,I.chromaFormat=W.chroma_format,I.frameRate=W.frame_rate,W.frame_rate.fixed!==!1&&W.frame_rate.fps_num!==0&&W.frame_rate.fps_den!==0||(I.frameRate=this._referenceFrameRate);var K=I.frameRate.fps_den,Y=I.frameRate.fps_num;I.refSampleDuration=I.timescale*(K/Y),I.codec=W.codec_mimetype,I.extra=W;var J=this._mediaInfo;J.fps=I.frameRate.fps,J.profile=I.profile,J.level=I.level,J.refFrames=W.ref_frames,J.chromaFormat=W.chroma_format_string,J.videoCodec=W.codec_mimetype,J.hasAudio?J.audioCodec!=null&&(J.mimeType='video/x-flv; codecs="'+J.videoCodec+","+J.audioCodec+'"'):J.mimeType='video/x-flv; codecs="'+J.videoCodec+'"',J.isComplete()&&this._onMediaInfo(J),I.av1c=new Uint8Array(p),I.av1c.set(new Uint8Array(y,_,p),0),o.a.v(this.TAG,"Preparing AV1CodecConfigurationRecord")}else this._onError(R.a.FORMAT_ERROR,"Flv: Invalid AV1CodecConfigurationRecord")}else this._onError(R.a.FORMAT_ERROR,"Flv: Invalid AV1CodecConfigurationRecord")}},A.prototype._parseAVCVideoData=function(y,_,p,I,M,P,B){for(var W=this._littleEndian,K=new DataView(y,_,p),Y=[],J=0,X=0,ee=this._naluLengthSize,oe=this._timestampBase+I,me=P===1;X<p;){if(X+4>=p){o.a.w(this.TAG,"Malformed Nalu near timestamp ".concat(oe,", offset = ").concat(X,", dataSize = ").concat(p));break}var de=K.getUint32(X,!W);if(ee===3&&(de>>>=8),de>p-ee)return void o.a.w(this.TAG,"Malformed Nalus near timestamp ".concat(oe,", NaluSize > DataSize!"));var Te=31&K.getUint8(X+ee);Te===5&&(me=!0);var Ee=new Uint8Array(y,_+X,ee+de),_e={type:Te,data:Ee};Y.push(_e),J+=Ee.byteLength,X+=ee+de}if(Y.length){var Ne=this._videoTrack,Ve={units:Y,length:J,isKeyframe:me,dts:oe,cts:B,pts:oe+B};me&&(Ve.fileposition=M),Ne.samples.push(Ve),Ne.length+=J}},A.prototype._parseHEVCVideoData=function(y,_,p,I,M,P,B){for(var W=this._littleEndian,K=new DataView(y,_,p),Y=[],J=0,X=0,ee=this._naluLengthSize,oe=this._timestampBase+I,me=P===1;X<p;){if(X+4>=p){o.a.w(this.TAG,"Malformed Nalu near timestamp ".concat(oe,", offset = ").concat(X,", dataSize = ").concat(p));break}var de=K.getUint32(X,!W);if(ee===3&&(de>>>=8),de>p-ee)return void o.a.w(this.TAG,"Malformed Nalus near timestamp ".concat(oe,", NaluSize > DataSize!"));var Te=K.getUint8(X+ee)>>1&63;Te!==19&&Te!==20&&Te!==21||(me=!0);var Ee=new Uint8Array(y,_+X,ee+de),_e={type:Te,data:Ee};Y.push(_e),J+=Ee.byteLength,X+=ee+de}if(Y.length){var Ne=this._videoTrack,Ve={units:Y,length:J,isKeyframe:me,dts:oe,cts:B,pts:oe+B};me&&(Ve.fileposition=M),Ne.samples.push(Ve),Ne.length+=J}},A.prototype._parseAV1VideoData=function(y,_,p,I,M,P,B){this._littleEndian;var W,K=[],Y=this._timestampBase+I,J=P===1;if(J){var X=this._videoMetadata,ee=b.parseOBUs(new Uint8Array(y,_,p),X.extra);if(ee==null)return void this._onError(R.a.FORMAT_ERROR,"Flv: Invalid AV1 VideoData");console.log(ee),X.codecWidth=ee.codec_size.width,X.codecHeight=ee.codec_size.height,X.presentWidth=ee.present_size.width,X.presentHeight=ee.present_size.height,X.sarRatio=ee.sar_ratio;var oe=this._mediaInfo;oe.width=X.codecWidth,oe.height=X.codecHeight,oe.sarNum=X.sarRatio.width,oe.sarDen=X.sarRatio.height,o.a.v(this.TAG,"Parsed AV1DecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",X)}if(W=p,K.push({unitType:0,data:new Uint8Array(y,_+0,p)}),K.length){var me=this._videoTrack,de={units:K,length:W,isKeyframe:J,dts:Y,cts:B,pts:Y+B};J&&(de.fileposition=M),me.samples.push(de),me.length+=W}},A}(),F=function(){function A(){}return A.prototype.destroy=function(){this.onError=null,this.onMediaInfo=null,this.onMetaDataArrived=null,this.onTrackMetadata=null,this.onDataAvailable=null,this.onTimedID3Metadata=null,this.onSynchronousKLVMetadata=null,this.onAsynchronousKLVMetadata=null,this.onSMPTE2038Metadata=null,this.onSCTE35Metadata=null,this.onPESPrivateData=null,this.onPESPrivateDataDescriptor=null},A}(),U=function(){this.program_pmt_pid={}};(function(A){A[A.kMPEG1Audio=3]="kMPEG1Audio",A[A.kMPEG2Audio=4]="kMPEG2Audio",A[A.kPESPrivateData=6]="kPESPrivateData",A[A.kADTSAAC=15]="kADTSAAC",A[A.kLOASAAC=17]="kLOASAAC",A[A.kAC3=129]="kAC3",A[A.kEAC3=135]="kEAC3",A[A.kMetadata=21]="kMetadata",A[A.kSCTE35=134]="kSCTE35",A[A.kH264=27]="kH264",A[A.kH265=36]="kH265"})(T||(T={}));var Z,ie=function(){this.pid_stream_type={},this.common_pids={h264:void 0,h265:void 0,av1:void 0,adts_aac:void 0,loas_aac:void 0,opus:void 0,ac3:void 0,eac3:void 0,mp3:void 0},this.pes_private_data_pids={},this.timed_id3_pids={},this.synchronous_klv_pids={},this.asynchronous_klv_pids={},this.scte_35_pids={},this.smpte2038_pids={}},le=function(){},ge=function(){},te=function(){this.slices=[],this.total_length=0,this.expected_length=0,this.file_position=0};(function(A){A[A.kUnspecified=0]="kUnspecified",A[A.kSliceNonIDR=1]="kSliceNonIDR",A[A.kSliceDPA=2]="kSliceDPA",A[A.kSliceDPB=3]="kSliceDPB",A[A.kSliceDPC=4]="kSliceDPC",A[A.kSliceIDR=5]="kSliceIDR",A[A.kSliceSEI=6]="kSliceSEI",A[A.kSliceSPS=7]="kSliceSPS",A[A.kSlicePPS=8]="kSlicePPS",A[A.kSliceAUD=9]="kSliceAUD",A[A.kEndOfSequence=10]="kEndOfSequence",A[A.kEndOfStream=11]="kEndOfStream",A[A.kFiller=12]="kFiller",A[A.kSPSExt=13]="kSPSExt",A[A.kReserved0=14]="kReserved0"})(Z||(Z={}));var j,$,q=function(){},Q=function(A){var y=A.data.byteLength;this.type=A.type,this.data=new Uint8Array(4+y),new DataView(this.data.buffer).setUint32(0,y),this.data.set(A.data,4)},fe=function(){function A(y){this.TAG="H264AnnexBParser",this.current_startcode_offset_=0,this.eof_flag_=!1,this.data_=y,this.current_startcode_offset_=this.findNextStartCodeOffset(0),this.eof_flag_&&o.a.e(this.TAG,"Could not find H264 startcode until payload end!")}return A.prototype.findNextStartCodeOffset=function(y){for(var _=y,p=this.data_;;){if(_+3>=p.byteLength)return this.eof_flag_=!0,p.byteLength;var I=p[_+0]<<24|p[_+1]<<16|p[_+2]<<8|p[_+3],M=p[_+0]<<16|p[_+1]<<8|p[_+2];if(I===1||M===1)return _;_++}},A.prototype.readNextNaluPayload=function(){for(var y=this.data_,_=null;_==null&&!this.eof_flag_;){var p=this.current_startcode_offset_,I=31&y[p+=(y[p]<<24|y[p+1]<<16|y[p+2]<<8|y[p+3])===1?4:3],M=(128&y[p])>>>7,P=this.findNextStartCodeOffset(p);if(this.current_startcode_offset_=P,!(I>=Z.kReserved0)&&M===0){var B=y.subarray(p,P);(_=new q).type=I,_.data=B}}return _},A}(),ve=function(){function A(y,_,p){var I=8+y.byteLength+1+2+_.byteLength,M=!1;y[3]!==66&&y[3]!==77&&y[3]!==88&&(M=!0,I+=4);var P=this.data=new Uint8Array(I);P[0]=1,P[1]=y[1],P[2]=y[2],P[3]=y[3],P[4]=255,P[5]=225;var B=y.byteLength;P[6]=B>>>8,P[7]=255&B;var W=8;P.set(y,8),P[W+=B]=1;var K=_.byteLength;P[W+1]=K>>>8,P[W+2]=255&K,P.set(_,W+3),W+=3+K,M&&(P[W]=252|p.chroma_format_idc,P[W+1]=248|p.bit_depth_luma-8,P[W+2]=248|p.bit_depth_chroma-8,P[W+3]=0,W+=4)}return A.prototype.getData=function(){return this.data},A}();(function(A){A[A.kNull=0]="kNull",A[A.kAACMain=1]="kAACMain",A[A.kAAC_LC=2]="kAAC_LC",A[A.kAAC_SSR=3]="kAAC_SSR",A[A.kAAC_LTP=4]="kAAC_LTP",A[A.kAAC_SBR=5]="kAAC_SBR",A[A.kAAC_Scalable=6]="kAAC_Scalable",A[A.kLayer1=32]="kLayer1",A[A.kLayer2=33]="kLayer2",A[A.kLayer3=34]="kLayer3"})(j||(j={})),function(A){A[A.k96000Hz=0]="k96000Hz",A[A.k88200Hz=1]="k88200Hz",A[A.k64000Hz=2]="k64000Hz",A[A.k48000Hz=3]="k48000Hz",A[A.k44100Hz=4]="k44100Hz",A[A.k32000Hz=5]="k32000Hz",A[A.k24000Hz=6]="k24000Hz",A[A.k22050Hz=7]="k22050Hz",A[A.k16000Hz=8]="k16000Hz",A[A.k12000Hz=9]="k12000Hz",A[A.k11025Hz=10]="k11025Hz",A[A.k8000Hz=11]="k8000Hz",A[A.k7350Hz=12]="k7350Hz"}($||($={}));var be,xe,ce=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],pe=(be=function(A,y){return(be=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(_,p){_.__proto__=p}||function(_,p){for(var I in p)Object.prototype.hasOwnProperty.call(p,I)&&(_[I]=p[I])})(A,y)},function(A,y){if(typeof y!="function"&&y!==null)throw new TypeError("Class extends value "+String(y)+" is not a constructor or null");function _(){this.constructor=A}be(A,y),A.prototype=y===null?Object.create(y):(_.prototype=y.prototype,new _)}),Ie=function(){},Le=function(A){function y(){return A!==null&&A.apply(this,arguments)||this}return pe(y,A),y}(Ie),ke=function(){function A(y){this.TAG="AACADTSParser",this.data_=y,this.current_syncword_offset_=this.findNextSyncwordOffset(0),this.eof_flag_&&o.a.e(this.TAG,"Could not found ADTS syncword until payload end")}return A.prototype.findNextSyncwordOffset=function(y){for(var _=y,p=this.data_;;){if(_+7>=p.byteLength)return this.eof_flag_=!0,p.byteLength;if((p[_+0]<<8|p[_+1])>>>4===4095)return _;_++}},A.prototype.readNextAACFrame=function(){for(var y=this.data_,_=null;_==null&&!this.eof_flag_;){var p=this.current_syncword_offset_,I=(8&y[p+1])>>>3,M=(6&y[p+1])>>>1,P=1&y[p+1],B=(192&y[p+2])>>>6,W=(60&y[p+2])>>>2,K=(1&y[p+2])<<2|(192&y[p+3])>>>6,Y=(3&y[p+3])<<11|y[p+4]<<3|(224&y[p+5])>>>5;if(y[p+6],p+Y>this.data_.byteLength){this.eof_flag_=!0,this.has_last_incomplete_data=!0;break}var J=P===1?7:9,X=Y-J;p+=J;var ee=this.findNextSyncwordOffset(p+X);if(this.current_syncword_offset_=ee,(I===0||I===1)&&M===0){var oe=y.subarray(p,p+X);(_=new Ie).audio_object_type=B+1,_.sampling_freq_index=W,_.sampling_frequency=ce[W],_.channel_config=K,_.data=oe}}return _},A.prototype.hasIncompleteData=function(){return this.has_last_incomplete_data},A.prototype.getIncompleteData=function(){return this.has_last_incomplete_data?this.data_.subarray(this.current_syncword_offset_):null},A}(),ze=function(){function A(y){this.TAG="AACLOASParser",this.data_=y,this.current_syncword_offset_=this.findNextSyncwordOffset(0),this.eof_flag_&&o.a.e(this.TAG,"Could not found LOAS syncword until payload end")}return A.prototype.findNextSyncwordOffset=function(y){for(var _=y,p=this.data_;;){if(_+1>=p.byteLength)return this.eof_flag_=!0,p.byteLength;if((p[_+0]<<3|p[_+1]>>>5)===695)return _;_++}},A.prototype.getLATMValue=function(y){for(var _=y.readBits(2),p=0,I=0;I<=_;I++)p<<=8,p|=y.readByte();return p},A.prototype.readNextAACFrame=function(y){for(var _=this.data_,p=null;p==null&&!this.eof_flag_;){var I=this.current_syncword_offset_,M=(31&_[I+1])<<8|_[I+2];if(I+3+M>=this.data_.byteLength){this.eof_flag_=!0,this.has_last_incomplete_data=!0;break}var P=new x(_.subarray(I+3,I+3+M)),B=null;if(P.readBool()){if(y==null){o.a.w(this.TAG,"StreamMuxConfig Missing"),this.current_syncword_offset_=this.findNextSyncwordOffset(I+3+M),P.destroy();continue}B=y}else{var W=P.readBool();if(W&&P.readBool()){o.a.e(this.TAG,"audioMuxVersionA is Not Supported"),P.destroy();break}if(W&&this.getLATMValue(P),!P.readBool()){o.a.e(this.TAG,"allStreamsSameTimeFraming zero is Not Supported"),P.destroy();break}if(P.readBits(6)!==0){o.a.e(this.TAG,"more than 2 numSubFrames Not Supported"),P.destroy();break}if(P.readBits(4)!==0){o.a.e(this.TAG,"more than 2 numProgram Not Supported"),P.destroy();break}if(P.readBits(3)!==0){o.a.e(this.TAG,"more than 2 numLayer Not Supported"),P.destroy();break}var K=W?this.getLATMValue(P):0,Y=P.readBits(5);K-=5;var J=P.readBits(4);K-=4;var X=P.readBits(4);K-=4,P.readBits(3),(K-=3)>0&&P.readBits(K);var ee=P.readBits(3);if(ee!==0){o.a.e(this.TAG,"frameLengthType = ".concat(ee,". Only frameLengthType = 0 Supported")),P.destroy();break}P.readByte();var oe=P.readBool();if(oe)if(W)this.getLATMValue(P);else{for(var me=0;;){me<<=8;var de=P.readBool();if(me+=P.readByte(),!de)break}console.log(me)}P.readBool()&&P.readByte(),(B=new Le).audio_object_type=Y,B.sampling_freq_index=J,B.sampling_frequency=ce[B.sampling_freq_index],B.channel_config=X,B.other_data_present=oe}for(var Te=0;;){var Ee=P.readByte();if(Te+=Ee,Ee!==255)break}for(var _e=new Uint8Array(Te),Ne=0;Ne<Te;Ne++)_e[Ne]=P.readByte();(p=new Le).audio_object_type=B.audio_object_type,p.sampling_freq_index=B.sampling_freq_index,p.sampling_frequency=ce[B.sampling_freq_index],p.channel_config=B.channel_config,p.other_data_present=B.other_data_present,p.data=_e,this.current_syncword_offset_=this.findNextSyncwordOffset(I+3+M)}return p},A.prototype.hasIncompleteData=function(){return this.has_last_incomplete_data},A.prototype.getIncompleteData=function(){return this.has_last_incomplete_data?this.data_.subarray(this.current_syncword_offset_):null},A}(),ft=function(A){var y=null,_=A.audio_object_type,p=A.audio_object_type,I=A.sampling_freq_index,M=A.channel_config,P=0,B=navigator.userAgent.toLowerCase();B.indexOf("firefox")!==-1?I>=6?(p=5,y=new Array(4),P=I-3):(p=2,y=new Array(2),P=I):B.indexOf("android")!==-1?(p=2,y=new Array(2),P=I):(p=5,P=I,y=new Array(4),I>=6?P=I-3:M===1&&(p=2,y=new Array(2),P=I)),y[0]=p<<3,y[0]|=(15&I)>>>1,y[1]=(15&I)<<7,y[1]|=(15&M)<<3,p===5&&(y[1]|=(15&P)>>>1,y[2]=(1&P)<<7,y[2]|=8,y[3]=0),this.config=y,this.sampling_rate=ce[I],this.channel_count=M,this.codec_mimetype="mp4a.40."+p,this.original_codec_mimetype="mp4a.40."+_},gt=function(){},dn=function(){};(function(A){A[A.kSpliceNull=0]="kSpliceNull",A[A.kSpliceSchedule=4]="kSpliceSchedule",A[A.kSpliceInsert=5]="kSpliceInsert",A[A.kTimeSignal=6]="kTimeSignal",A[A.kBandwidthReservation=7]="kBandwidthReservation",A[A.kPrivateCommand=255]="kPrivateCommand"})(xe||(xe={}));var Oe,Et=function(A){var y=A.readBool();return y?(A.readBits(6),{time_specified_flag:y,pts_time:4*A.readBits(31)+A.readBits(2)}):(A.readBits(7),{time_specified_flag:y})},$t=function(A){var y=A.readBool();return A.readBits(6),{auto_return:y,duration:4*A.readBits(31)+A.readBits(2)}},Sn=function(A,y){var _=y.readBits(8);return A?{component_tag:_}:{component_tag:_,splice_time:Et(y)}},Vt=function(A){return{component_tag:A.readBits(8),utc_splice_time:A.readBits(32)}},Qn=function(A){var y=A.readBits(32),_=A.readBool();A.readBits(7);var p={splice_event_id:y,splice_event_cancel_indicator:_};if(_)return p;if(p.out_of_network_indicator=A.readBool(),p.program_splice_flag=A.readBool(),p.duration_flag=A.readBool(),A.readBits(5),p.program_splice_flag)p.utc_splice_time=A.readBits(32);else{p.component_count=A.readBits(8),p.components=[];for(var I=0;I<p.component_count;I++)p.components.push(Vt(A))}return p.duration_flag&&(p.break_duration=$t(A)),p.unique_program_id=A.readBits(16),p.avail_num=A.readBits(8),p.avails_expected=A.readBits(8),p},Jn=function(A,y,_,p){return{descriptor_tag:A,descriptor_length:y,identifier:_,provider_avail_id:p.readBits(32)}},pr=function(A,y,_,p){var I=p.readBits(8),M=p.readBits(3);p.readBits(5);for(var P="",B=0;B<M;B++)P+=String.fromCharCode(p.readBits(8));return{descriptor_tag:A,descriptor_length:y,identifier:_,preroll:I,dtmf_count:M,DTMF_char:P}},gi=function(A){var y=A.readBits(8);return A.readBits(7),{component_tag:y,pts_offset:4*A.readBits(31)+A.readBits(2)}},ss=function(A,y,_,p){var I=p.readBits(32),M=p.readBool();p.readBits(7);var P={descriptor_tag:A,descriptor_length:y,identifier:_,segmentation_event_id:I,segmentation_event_cancel_indicator:M};if(M)return P;if(P.program_segmentation_flag=p.readBool(),P.segmentation_duration_flag=p.readBool(),P.delivery_not_restricted_flag=p.readBool(),P.delivery_not_restricted_flag?p.readBits(5):(P.web_delivery_allowed_flag=p.readBool(),P.no_regional_blackout_flag=p.readBool(),P.archive_allowed_flag=p.readBool(),P.device_restrictions=p.readBits(2)),!P.program_segmentation_flag){P.component_count=p.readBits(8),P.components=[];for(var B=0;B<P.component_count;B++)P.components.push(gi(p))}P.segmentation_duration_flag&&(P.segmentation_duration=p.readBits(40)),P.segmentation_upid_type=p.readBits(8),P.segmentation_upid_length=p.readBits(8);var W=new Uint8Array(P.segmentation_upid_length);for(B=0;B<P.segmentation_upid_length;B++)W[B]=p.readBits(8);return P.segmentation_upid=W.buffer,P.segmentation_type_id=p.readBits(8),P.segment_num=p.readBits(8),P.segments_expected=p.readBits(8),P.segmentation_type_id!==52&&P.segmentation_type_id!==54&&P.segmentation_type_id!==56&&P.segmentation_type_id!==58||(P.sub_segment_num=p.readBits(8),P.sub_segments_expected=p.readBits(8)),P},St=function(A,y,_,p){return{descriptor_tag:A,descriptor_length:y,identifier:_,TAI_seconds:p.readBits(48),TAI_ns:p.readBits(32),UTC_offset:p.readBits(16)}},Mt=function(A){return{component_tag:A.readBits(8),ISO_code:String.fromCharCode(A.readBits(8),A.readBits(8),A.readBits(8)),Bit_Stream_Mode:A.readBits(3),Num_Channels:A.readBits(4),Full_Srvc_Audio:A.readBool()}},mr=function(A,y,_,p){for(var I=p.readBits(4),M=[],P=0;P<I;P++)M.push(Mt(p));return{descriptor_tag:A,descriptor_length:y,identifier:_,audio_count:I,components:M}},as=function(A){var y=new x(A),_=y.readBits(8),p=y.readBool(),I=y.readBool();y.readBits(2);var M=y.readBits(12),P=y.readBits(8),B=y.readBool(),W=y.readBits(6),K=4*y.readBits(31)+y.readBits(2),Y=y.readBits(8),J=y.readBits(12),X=y.readBits(12),ee=y.readBits(8),oe=null;ee===xe.kSpliceNull?oe={}:ee===xe.kSpliceSchedule?oe=function(Be){for(var Ye=Be.readBits(8),it=[],Fe=0;Fe<Ye;Fe++)it.push(Qn(Be));return{splice_count:Ye,events:it}}(y):ee===xe.kSpliceInsert?oe=function(Be){var Ye=Be.readBits(32),it=Be.readBool();Be.readBits(7);var Fe={splice_event_id:Ye,splice_event_cancel_indicator:it};if(it)return Fe;if(Fe.out_of_network_indicator=Be.readBool(),Fe.program_splice_flag=Be.readBool(),Fe.duration_flag=Be.readBool(),Fe.splice_immediate_flag=Be.readBool(),Be.readBits(4),Fe.program_splice_flag&&!Fe.splice_immediate_flag&&(Fe.splice_time=Et(Be)),!Fe.program_splice_flag){Fe.component_count=Be.readBits(8),Fe.components=[];for(var He=0;He<Fe.component_count;He++)Fe.components.push(Sn(Fe.splice_immediate_flag,Be))}return Fe.duration_flag&&(Fe.break_duration=$t(Be)),Fe.unique_program_id=Be.readBits(16),Fe.avail_num=Be.readBits(8),Fe.avails_expected=Be.readBits(8),Fe}(y):ee===xe.kTimeSignal?oe=function(Be){return{splice_time:Et(Be)}}(y):ee===xe.kBandwidthReservation?oe={}:ee===xe.kPrivateCommand?oe=function(Be,Ye){for(var it=String.fromCharCode(Ye.readBits(8),Ye.readBits(8),Ye.readBits(8),Ye.readBits(8)),Fe=new Uint8Array(Be-4),He=0;He<Be-4;He++)Fe[He]=Ye.readBits(8);return{identifier:it,private_data:Fe.buffer}}(X,y):y.readBits(8*X);for(var me=[],de=y.readBits(16),Te=0;Te<de;){var Ee=y.readBits(8),_e=y.readBits(8),Ne=String.fromCharCode(y.readBits(8),y.readBits(8),y.readBits(8),y.readBits(8));Ee===0?me.push(Jn(Ee,_e,Ne,y)):Ee===1?me.push(pr(Ee,_e,Ne,y)):Ee===2?me.push(ss(Ee,_e,Ne,y)):Ee===3?me.push(St(Ee,_e,Ne,y)):Ee===4?me.push(mr(Ee,_e,Ne,y)):y.readBits(8*(_e-4)),Te+=2+_e}var Ve={table_id:_,section_syntax_indicator:p,private_indicator:I,section_length:M,protocol_version:P,encrypted_packet:B,encryption_algorithm:W,pts_adjustment:K,cw_index:Y,tier:J,splice_command_length:X,splice_command_type:ee,splice_command:oe,descriptor_loop_length:de,splice_descriptors:me,E_CRC32:B?y.readBits(32):void 0,CRC32:y.readBits(32)};if(ee===xe.kSpliceInsert){var Ae=oe;if(Ae.splice_event_cancel_indicator)return{splice_command_type:ee,detail:Ve,data:A};if(Ae.program_splice_flag&&!Ae.splice_immediate_flag){var De=Ae.duration_flag?Ae.break_duration.auto_return:void 0,je=Ae.duration_flag?Ae.break_duration.duration/90:void 0;return Ae.splice_time.time_specified_flag?{splice_command_type:ee,pts:(K+Ae.splice_time.pts_time)%Math.pow(2,33),auto_return:De,duraiton:je,detail:Ve,data:A}:{splice_command_type:ee,auto_return:De,duraiton:je,detail:Ve,data:A}}return{splice_command_type:ee,auto_return:De=Ae.duration_flag?Ae.break_duration.auto_return:void 0,duraiton:je=Ae.duration_flag?Ae.break_duration.duration/90:void 0,detail:Ve,data:A}}if(ee===xe.kTimeSignal){var Me=oe;return Me.splice_time.time_specified_flag?{splice_command_type:ee,pts:(K+Me.splice_time.pts_time)%Math.pow(2,33),detail:Ve,data:A}:{splice_command_type:ee,detail:Ve,data:A}}return{splice_command_type:ee,detail:Ve,data:A}};(function(A){A[A.kSliceIDR_W_RADL=19]="kSliceIDR_W_RADL",A[A.kSliceIDR_N_LP=20]="kSliceIDR_N_LP",A[A.kSliceCRA_NUT=21]="kSliceCRA_NUT",A[A.kSliceVPS=32]="kSliceVPS",A[A.kSliceSPS=33]="kSliceSPS",A[A.kSlicePPS=34]="kSlicePPS",A[A.kSliceAUD=35]="kSliceAUD"})(Oe||(Oe={}));var os=function(){},Ui=function(A){var y=A.data.byteLength;this.type=A.type,this.data=new Uint8Array(4+y),new DataView(this.data.buffer).setUint32(0,y),this.data.set(A.data,4)},ls=function(){function A(y){this.TAG="H265AnnexBParser",this.current_startcode_offset_=0,this.eof_flag_=!1,this.data_=y,this.current_startcode_offset_=this.findNextStartCodeOffset(0),this.eof_flag_&&o.a.e(this.TAG,"Could not find H265 startcode until payload end!")}return A.prototype.findNextStartCodeOffset=function(y){for(var _=y,p=this.data_;;){if(_+3>=p.byteLength)return this.eof_flag_=!0,p.byteLength;var I=p[_+0]<<24|p[_+1]<<16|p[_+2]<<8|p[_+3],M=p[_+0]<<16|p[_+1]<<8|p[_+2];if(I===1||M===1)return _;_++}},A.prototype.readNextNaluPayload=function(){for(var y=this.data_,_=null;_==null&&!this.eof_flag_;){var p=this.current_startcode_offset_,I=y[p+=(y[p]<<24|y[p+1]<<16|y[p+2]<<8|y[p+3])===1?4:3]>>1&63,M=(128&y[p])>>>7,P=this.findNextStartCodeOffset(p);if(this.current_startcode_offset_=P,M===0){var B=y.subarray(p,P);(_=new os).type=I,_.data=B}}return _},A}(),Ol=function(){function A(y,_,p,I){var M=23+(5+y.byteLength)+(5+_.byteLength)+(5+p.byteLength),P=this.data=new Uint8Array(M);P[0]=1,P[1]=(3&I.general_profile_space)<<6|(I.general_tier_flag?1:0)<<5|31&I.general_profile_idc,P[2]=I.general_profile_compatibility_flags_1,P[3]=I.general_profile_compatibility_flags_2,P[4]=I.general_profile_compatibility_flags_3,P[5]=I.general_profile_compatibility_flags_4,P[6]=I.general_constraint_indicator_flags_1,P[7]=I.general_constraint_indicator_flags_2,P[8]=I.general_constraint_indicator_flags_3,P[9]=I.general_constraint_indicator_flags_4,P[10]=I.general_constraint_indicator_flags_5,P[11]=I.general_constraint_indicator_flags_6,P[12]=I.general_level_idc,P[13]=240|(3840&I.min_spatial_segmentation_idc)>>8,P[14]=255&I.min_spatial_segmentation_idc,P[15]=252|3&I.parallelismType,P[16]=252|3&I.chroma_format_idc,P[17]=248|7&I.bit_depth_luma_minus8,P[18]=248|7&I.bit_depth_chroma_minus8,P[19]=0,P[20]=0,P[21]=(3&I.constant_frame_rate)<<6|(7&I.num_temporal_layers)<<3|(I.temporal_id_nested?1:0)<<2|3,P[22]=3,P[23]=128|Oe.kSliceVPS,P[24]=0,P[25]=1,P[26]=(65280&y.byteLength)>>8,P[27]=(255&y.byteLength)>>0,P.set(y,28),P[23+(5+y.byteLength)+0]=128|Oe.kSliceSPS,P[23+(5+y.byteLength)+1]=0,P[23+(5+y.byteLength)+2]=1,P[23+(5+y.byteLength)+3]=(65280&_.byteLength)>>8,P[23+(5+y.byteLength)+4]=(255&_.byteLength)>>0,P.set(_,23+(5+y.byteLength)+5),P[23+(5+y.byteLength+5+_.byteLength)+0]=128|Oe.kSlicePPS,P[23+(5+y.byteLength+5+_.byteLength)+1]=0,P[23+(5+y.byteLength+5+_.byteLength)+2]=1,P[23+(5+y.byteLength+5+_.byteLength)+3]=(65280&p.byteLength)>>8,P[23+(5+y.byteLength+5+_.byteLength)+4]=(255&p.byteLength)>>0,P.set(p,23+(5+y.byteLength+5+_.byteLength)+5)}return A.prototype.getData=function(){return this.data},A}(),Ml=function(){},Ya=function(){},vd=function(){},Ed=[[64,64,80,80,96,96,112,112,128,128,160,160,192,192,224,224,256,256,320,320,384,384,448,448,512,512,640,640,768,768,896,896,1024,1024,1152,1152,1280,1280],[69,70,87,88,104,105,121,122,139,140,174,175,208,209,243,244,278,279,348,349,417,418,487,488,557,558,696,697,835,836,975,976,1114,1115,1253,1254,1393,1394],[96,96,120,120,144,144,168,168,192,192,240,240,288,288,336,336,384,384,480,480,576,576,672,672,768,768,960,960,1152,1152,1344,1344,1536,1536,1728,1728,1920,1920]],Xa=function(){function A(y){this.TAG="AC3Parser",this.data_=y,this.current_syncword_offset_=this.findNextSyncwordOffset(0),this.eof_flag_&&o.a.e(this.TAG,"Could not found AC3 syncword until payload end")}return A.prototype.findNextSyncwordOffset=function(y){for(var _=y,p=this.data_;;){if(_+7>=p.byteLength)return this.eof_flag_=!0,p.byteLength;if((p[_+0]<<8|p[_+1]<<0)===2935)return _;_++}},A.prototype.readNextAC3Frame=function(){for(var y=this.data_,_=null;_==null&&!this.eof_flag_;){var p=this.current_syncword_offset_,I=y[p+4]>>6,M=[48e3,44200,33e3][I],P=63&y[p+4],B=2*Ed[I][P];if(isNaN(B)||p+B>this.data_.byteLength){this.eof_flag_=!0,this.has_last_incomplete_data=!0;break}var W=this.findNextSyncwordOffset(p+B);this.current_syncword_offset_=W;var K=y[p+5]>>3,Y=7&y[p+5],J=y[p+6]>>5,X=0;1&J&&J!==1&&(X+=2),4&J&&(X+=2),J===2&&(X+=2);var ee=(y[p+6]<<8|y[p+7]<<0)>>12-X&1,oe=[2,1,2,3,3,4,4,5][J]+ee;(_=new vd).sampling_frequency=M,_.channel_count=oe,_.channel_mode=J,_.bit_stream_identification=K,_.low_frequency_effects_channel_on=ee,_.bit_stream_mode=Y,_.frame_size_code=P,_.data=y.subarray(p,p+B)}return _},A.prototype.hasIncompleteData=function(){return this.has_last_incomplete_data},A.prototype.getIncompleteData=function(){return this.has_last_incomplete_data?this.data_.subarray(this.current_syncword_offset_):null},A}(),Nl=function(A){var y;y=[A.sampling_rate_code<<6|A.bit_stream_identification<<1|A.bit_stream_mode>>2,(3&A.bit_stream_mode)<<6|A.channel_mode<<3|A.low_frequency_effects_channel_on<<2|A.frame_size_code>>4,A.frame_size_code<<4&224],this.config=y,this.sampling_rate=A.sampling_frequency,this.bit_stream_identification=A.bit_stream_identification,this.bit_stream_mode=A.bit_stream_mode,this.low_frequency_effects_channel_on=A.low_frequency_effects_channel_on,this.channel_count=A.channel_count,this.channel_mode=A.channel_mode,this.codec_mimetype="ac-3",this.original_codec_mimetype="ac-3"},Sd=function(){},cs=function(){function A(y){this.TAG="EAC3Parser",this.data_=y,this.current_syncword_offset_=this.findNextSyncwordOffset(0),this.eof_flag_&&o.a.e(this.TAG,"Could not found AC3 syncword until payload end")}return A.prototype.findNextSyncwordOffset=function(y){for(var _=y,p=this.data_;;){if(_+7>=p.byteLength)return this.eof_flag_=!0,p.byteLength;if((p[_+0]<<8|p[_+1]<<0)===2935)return _;_++}},A.prototype.readNextEAC3Frame=function(){for(var y=this.data_,_=null;_==null&&!this.eof_flag_;){var p=this.current_syncword_offset_,I=new x(y.subarray(p+2)),M=(I.readBits(2),I.readBits(3),I.readBits(11)+1<<1),P=I.readBits(2),B=null,W=null;P===3?(B=[24e3,22060,16e3][P=I.readBits(2)],W=3):(B=[48e3,44100,32e3][P],W=I.readBits(2));var K=I.readBits(3),Y=I.readBits(1),J=I.readBits(5);if(p+M>this.data_.byteLength){this.eof_flag_=!0,this.has_last_incomplete_data=!0;break}var X=this.findNextSyncwordOffset(p+M);this.current_syncword_offset_=X;var ee=[2,1,2,3,3,4,4,5][K]+Y;I.destroy(),(_=new Sd).sampling_frequency=B,_.channel_count=ee,_.channel_mode=K,_.bit_stream_identification=J,_.low_frequency_effects_channel_on=Y,_.frame_size=M,_.num_blks=[1,2,3,6][W],_.data=y.subarray(p,p+M)}return _},A.prototype.hasIncompleteData=function(){return this.has_last_incomplete_data},A.prototype.getIncompleteData=function(){return this.has_last_incomplete_data?this.data_.subarray(this.current_syncword_offset_):null},A}(),Qa=function(A){var y,_=Math.floor(A.frame_size*A.sampling_frequency/(16*A.num_blks));y=[255&_,248&_,A.sampling_rate_code<<6|A.bit_stream_identification<<1|0,0|A.channel_mode<<1|A.low_frequency_effects_channel_on<<0,0],this.config=y,this.sampling_rate=A.sampling_frequency,this.bit_stream_identification=A.bit_stream_identification,this.num_blks=A.num_blks,this.low_frequency_effects_channel_on=A.low_frequency_effects_channel_on,this.channel_count=A.channel_count,this.channel_mode=A.channel_mode,this.codec_mimetype="ec-3",this.original_codec_mimetype="ec-3"},Ja=function(){},gr=function(){function A(y){this.TAG="AV1OBUInMpegTsParser",this.current_startcode_offset_=0,this.eof_flag_=!1,this.data_=y,this.current_startcode_offset_=this.findNextStartCodeOffset(0),this.eof_flag_&&o.a.e(this.TAG,"Could not find AV1 startcode until payload end!")}return A._ebsp2rbsp=function(y){for(var _=y,p=_.byteLength,I=new Uint8Array(p),M=0,P=0;P<p;P++)P>=2&&_[P]===3&&_[P-1]===0&&_[P-2]===0||(I[M]=_[P],M++);return new Uint8Array(I.buffer,0,M)},A.prototype.findNextStartCodeOffset=function(y){for(var _=y,p=this.data_;;){if(_+2>=p.byteLength)return this.eof_flag_=!0,p.byteLength;if((p[_+0]<<16|p[_+1]<<8|p[_+2])===1)return _;_++}},A.prototype.readNextOBUPayload=function(){for(var y=this.data_,_=null;_==null&&!this.eof_flag_;){var p=this.current_startcode_offset_+3,I=this.findNextStartCodeOffset(p);this.current_startcode_offset_=I,_=A._ebsp2rbsp(y.subarray(p,I))}return _},A}(),Bl=function(){var A=function(y,_){return(A=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,I){p.__proto__=I}||function(p,I){for(var M in I)Object.prototype.hasOwnProperty.call(I,M)&&(p[M]=I[M])})(y,_)};return function(y,_){if(typeof _!="function"&&_!==null)throw new TypeError("Class extends value "+String(_)+" is not a constructor or null");function p(){this.constructor=y}A(y,_),y.prototype=_===null?Object.create(_):(p.prototype=_.prototype,new p)}}(),Zn=function(){return(Zn=Object.assign||function(A){for(var y,_=1,p=arguments.length;_<p;_++)for(var I in y=arguments[_])Object.prototype.hasOwnProperty.call(y,I)&&(A[I]=y[I]);return A}).apply(this,arguments)},Za=function(A){function y(_,p){var I=A.call(this)||this;return I.TAG="TSDemuxer",I.first_parse_=!0,I.media_info_=new c.a,I.timescale_=90,I.duration_=0,I.current_pmt_pid_=-1,I.program_pmt_map_={},I.pes_slice_queues_={},I.section_slice_queues_={},I.video_metadata_={vps:void 0,sps:void 0,pps:void 0,av1c:void 0,details:void 0},I.audio_metadata_={codec:void 0,audio_object_type:void 0,sampling_freq_index:void 0,sampling_frequency:void 0,channel_config:void 0},I.last_pcr_base_=NaN,I.timestamp_offset_=0,I.audio_last_sample_pts_=void 0,I.aac_last_incomplete_data_=null,I.has_video_=!1,I.has_audio_=!1,I.video_init_segment_dispatched_=!1,I.audio_init_segment_dispatched_=!1,I.video_metadata_changed_=!1,I.audio_metadata_changed_=!1,I.loas_previous_frame=null,I.video_track_={type:"video",id:1,sequenceNumber:0,samples:[],length:0},I.audio_track_={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},I.ts_packet_size_=_.ts_packet_size,I.sync_offset_=_.sync_offset,I.config_=p,I}return Bl(y,A),y.prototype.destroy=function(){this.media_info_=null,this.pes_slice_queues_=null,this.section_slice_queues_=null,this.video_metadata_=null,this.audio_metadata_=null,this.aac_last_incomplete_data_=null,this.video_track_=null,this.audio_track_=null,A.prototype.destroy.call(this)},y.probe=function(_){var p=new Uint8Array(_),I=-1,M=188;if(p.byteLength<=3*M)return{needMoreData:!0};for(;I===-1;){for(var P=Math.min(1e3,p.byteLength-3*M),B=0;B<P;){if(p[B]===71&&p[B+M]===71&&p[B+2*M]===71){I=B;break}B++}if(I===-1)if(M===188)M=192;else{if(M!==192)break;M=204}}return I===-1?{match:!1}:(M===192&&I>=4?(o.a.v("TSDemuxer","ts_packet_size = 192, m2ts mode"),I-=4):M===204&&o.a.v("TSDemuxer","ts_packet_size = 204, RS encoded MPEG2-TS stream"),{match:!0,consumed:0,ts_packet_size:M,sync_offset:I})},y.prototype.bindDataSource=function(_){return _.onDataArrival=this.parseChunks.bind(this),this},y.prototype.resetMediaInfo=function(){this.media_info_=new c.a},y.prototype.parseChunks=function(_,p){if(!(this.onError&&this.onMediaInfo&&this.onTrackMetadata&&this.onDataAvailable))throw new m.a("onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var I=0;for(this.first_parse_&&(this.first_parse_=!1,I=this.sync_offset_);I+this.ts_packet_size_<=_.byteLength;){var M=p+I;this.ts_packet_size_===192&&(I+=4);var P=new Uint8Array(_,I,188),B=P[0];if(B!==71){o.a.e(this.TAG,"sync_byte = ".concat(B,", not 0x47"));break}var W=(64&P[1])>>>6,K=(P[1],(31&P[1])<<8|P[2]),Y=(48&P[3])>>>4,J=15&P[3],X=!(!this.pmt_||this.pmt_.pcr_pid!==K),ee={},oe=4;if(Y==2||Y==3){var me=P[4];if(me>0&&(X||Y==3)&&(ee.discontinuity_indicator=(128&P[5])>>>7,ee.random_access_indicator=(64&P[5])>>>6,ee.elementary_stream_priority_indicator=(32&P[5])>>>5,(16&P[5])>>>4)){var de=300*this.getPcrBase(P)+((1&P[10])<<8|P[11]);this.last_pcr_=de}if(Y==2||5+me===188){I+=188,this.ts_packet_size_===204&&(I+=16);continue}oe=5+me}if(Y==1||Y==3){if(K===0||K===this.current_pmt_pid_||this.pmt_!=null&&this.pmt_.pid_stream_type[K]===T.kSCTE35){var Te=188-oe;this.handleSectionSlice(_,I+oe,Te,{pid:K,file_position:M,payload_unit_start_indicator:W,continuity_conunter:J,random_access_indicator:ee.random_access_indicator})}else if(this.pmt_!=null&&this.pmt_.pid_stream_type[K]!=null){Te=188-oe;var Ee=this.pmt_.pid_stream_type[K];K!==this.pmt_.common_pids.h264&&K!==this.pmt_.common_pids.h265&&K!==this.pmt_.common_pids.av1&&K!==this.pmt_.common_pids.adts_aac&&K!==this.pmt_.common_pids.loas_aac&&K!==this.pmt_.common_pids.ac3&&K!==this.pmt_.common_pids.eac3&&K!==this.pmt_.common_pids.opus&&K!==this.pmt_.common_pids.mp3&&this.pmt_.pes_private_data_pids[K]!==!0&&this.pmt_.timed_id3_pids[K]!==!0&&this.pmt_.synchronous_klv_pids[K]!==!0&&this.pmt_.asynchronous_klv_pids[K]!==!0||this.handlePESSlice(_,I+oe,Te,{pid:K,stream_type:Ee,file_position:M,payload_unit_start_indicator:W,continuity_conunter:J,random_access_indicator:ee.random_access_indicator})}}I+=188,this.ts_packet_size_===204&&(I+=16)}return this.dispatchAudioVideoMediaSegment(),I},y.prototype.handleSectionSlice=function(_,p,I,M){var P=new Uint8Array(_,p,I),B=this.section_slice_queues_[M.pid];if(M.payload_unit_start_indicator){var W=P[0];if(B!=null&&B.total_length!==0){var K=new Uint8Array(_,p+1,Math.min(I,W));B.slices.push(K),B.total_length+=K.byteLength,B.total_length===B.expected_length?this.emitSectionSlices(B,M):this.clearSlices(B,M)}for(var Y=1+W;Y<P.byteLength&&P[Y+0]!==255;){var J=(15&P[Y+1])<<8|P[Y+2];this.section_slice_queues_[M.pid]=new te,(B=this.section_slice_queues_[M.pid]).expected_length=J+3,B.file_position=M.file_position,B.random_access_indicator=M.random_access_indicator,K=new Uint8Array(_,p+Y,Math.min(I-Y,B.expected_length-B.total_length)),B.slices.push(K),B.total_length+=K.byteLength,B.total_length===B.expected_length?this.emitSectionSlices(B,M):B.total_length>=B.expected_length&&this.clearSlices(B,M),Y+=K.byteLength}}else B!=null&&B.total_length!==0&&(K=new Uint8Array(_,p,Math.min(I,B.expected_length-B.total_length)),B.slices.push(K),B.total_length+=K.byteLength,B.total_length===B.expected_length?this.emitSectionSlices(B,M):B.total_length>=B.expected_length&&this.clearSlices(B,M))},y.prototype.handlePESSlice=function(_,p,I,M){var P=new Uint8Array(_,p,I),B=P[0]<<16|P[1]<<8|P[2],W=(P[3],P[4]<<8|P[5]);if(M.payload_unit_start_indicator){if(B!==1)return void o.a.e(this.TAG,"handlePESSlice: packet_start_code_prefix should be 1 but with value ".concat(B));var K=this.pes_slice_queues_[M.pid];K&&(K.expected_length===0||K.expected_length===K.total_length?this.emitPESSlices(K,M):this.clearSlices(K,M)),this.pes_slice_queues_[M.pid]=new te,this.pes_slice_queues_[M.pid].file_position=M.file_position,this.pes_slice_queues_[M.pid].random_access_indicator=M.random_access_indicator}if(this.pes_slice_queues_[M.pid]!=null){var Y=this.pes_slice_queues_[M.pid];Y.slices.push(P),M.payload_unit_start_indicator&&(Y.expected_length=W===0?0:W+6),Y.total_length+=P.byteLength,Y.expected_length>0&&Y.expected_length===Y.total_length?this.emitPESSlices(Y,M):Y.expected_length>0&&Y.expected_length<Y.total_length&&this.clearSlices(Y,M)}},y.prototype.emitSectionSlices=function(_,p){for(var I=new Uint8Array(_.total_length),M=0,P=0;M<_.slices.length;M++){var B=_.slices[M];I.set(B,P),P+=B.byteLength}_.slices=[],_.expected_length=-1,_.total_length=0;var W=new ge;W.pid=p.pid,W.data=I,W.file_position=_.file_position,W.random_access_indicator=_.random_access_indicator,this.parseSection(W)},y.prototype.emitPESSlices=function(_,p){for(var I=new Uint8Array(_.total_length),M=0,P=0;M<_.slices.length;M++){var B=_.slices[M];I.set(B,P),P+=B.byteLength}_.slices=[],_.expected_length=-1,_.total_length=0;var W=new le;W.pid=p.pid,W.data=I,W.stream_type=p.stream_type,W.file_position=_.file_position,W.random_access_indicator=_.random_access_indicator,this.parsePES(W)},y.prototype.clearSlices=function(_,p){_.slices=[],_.expected_length=-1,_.total_length=0},y.prototype.parseSection=function(_){var p=_.data,I=_.pid;I===0?this.parsePAT(p):I===this.current_pmt_pid_?this.parsePMT(p):this.pmt_!=null&&this.pmt_.scte_35_pids[I]&&this.parseSCTE35(p)},y.prototype.parsePES=function(_){var p=_.data,I=p[0]<<16|p[1]<<8|p[2],M=p[3],P=p[4]<<8|p[5];if(I===1)if(M!==188&&M!==190&&M!==191&&M!==240&&M!==241&&M!==255&&M!==242&&M!==248){p[6];var B=(192&p[7])>>>6,W=p[8],K=void 0,Y=void 0;B!==2&&B!==3||(K=this.getTimestamp(p,9),Y=B===3?this.getTimestamp(p,14):K);var J=9+W,X=void 0;if(P!==0){if(P<3+W)return void o.a.v(this.TAG,"Malformed PES: PES_packet_length < 3 + PES_header_data_length");X=P-3-W}else X=p.byteLength-J;var ee=p.subarray(J,J+X);switch(_.stream_type){case T.kMPEG1Audio:case T.kMPEG2Audio:this.parseMP3Payload(ee,K);break;case T.kPESPrivateData:this.pmt_.common_pids.av1===_.pid?this.parseAV1Payload(ee,K,Y,_.file_position,_.random_access_indicator):this.pmt_.common_pids.opus===_.pid?this.parseOpusPayload(ee,K):this.pmt_.common_pids.ac3===_.pid?this.parseAC3Payload(ee,K):this.pmt_.common_pids.eac3===_.pid?this.parseEAC3Payload(ee,K):this.pmt_.asynchronous_klv_pids[_.pid]?this.parseAsynchronousKLVMetadataPayload(ee,_.pid,M):this.pmt_.smpte2038_pids[_.pid]?this.parseSMPTE2038MetadataPayload(ee,K,Y,_.pid,M):this.parsePESPrivateDataPayload(ee,K,Y,_.pid,M);break;case T.kADTSAAC:this.parseADTSAACPayload(ee,K);break;case T.kLOASAAC:this.parseLOASAACPayload(ee,K);break;case T.kAC3:this.parseAC3Payload(ee,K);break;case T.kEAC3:this.parseEAC3Payload(ee,K);break;case T.kMetadata:this.pmt_.timed_id3_pids[_.pid]?this.parseTimedID3MetadataPayload(ee,K,Y,_.pid,M):this.pmt_.synchronous_klv_pids[_.pid]&&this.parseSynchronousKLVMetadataPayload(ee,K,Y,_.pid,M);break;case T.kH264:this.parseH264Payload(ee,K,Y,_.file_position,_.random_access_indicator);break;case T.kH265:this.parseH265Payload(ee,K,Y,_.file_position,_.random_access_indicator)}}else(M===188||M===191||M===240||M===241||M===255||M===242||M===248)&&_.stream_type===T.kPESPrivateData&&(J=6,X=void 0,X=P!==0?P:p.byteLength-J,ee=p.subarray(J,J+X),this.parsePESPrivateDataPayload(ee,void 0,void 0,_.pid,M));else o.a.e(this.TAG,"parsePES: packet_start_code_prefix should be 1 but with value ".concat(I))},y.prototype.parsePAT=function(_){var p=_[0];if(p===0){var I=(15&_[1])<<8|_[2],M=(_[3],_[4],(62&_[5])>>>1),P=1&_[5],B=_[6],W=(_[7],null);if(P===1&&B===0)(W=new U).version_number=M;else if((W=this.pat_)==null)return;for(var K=I-5-4,Y=-1,J=-1,X=8;X<8+K;X+=4){var ee=_[X]<<8|_[X+1],oe=(31&_[X+2])<<8|_[X+3];ee===0?W.network_pid=oe:(W.program_pmt_pid[ee]=oe,Y===-1&&(Y=ee),J===-1&&(J=oe))}P===1&&B===0&&(this.pat_==null&&o.a.v(this.TAG,"Parsed first PAT: ".concat(JSON.stringify(W))),this.pat_=W,this.current_program_=Y,this.current_pmt_pid_=J)}else o.a.e(this.TAG,"parsePAT: table_id ".concat(p," is not corresponded to PAT!"))},y.prototype.parsePMT=function(_){var p=_[0];if(p===2){var I=(15&_[1])<<8|_[2],M=_[3]<<8|_[4],P=(62&_[5])>>>1,B=1&_[5],W=_[6],K=(_[7],null);if(B===1&&W===0)(K=new ie).program_number=M,K.version_number=P,this.program_pmt_map_[M]=K;else if((K=this.program_pmt_map_[M])==null)return;K.pcr_pid=(31&_[8])<<8|_[9];for(var Y=(15&_[10])<<8|_[11],J=12+Y,X=I-9-Y-4,ee=J;ee<J+X;){var oe=_[ee],me=(31&_[ee+1])<<8|_[ee+2],de=(15&_[ee+3])<<8|_[ee+4];K.pid_stream_type[me]=oe;var Te=K.common_pids.h264||K.common_pids.h265,Ee=K.common_pids.adts_aac||K.common_pids.loas_aac||K.common_pids.ac3||K.common_pids.eac3||K.common_pids.opus||K.common_pids.mp3;if(oe!==T.kH264||Te)if(oe!==T.kH265||Te)if(oe!==T.kADTSAAC||Ee)if(oe!==T.kLOASAAC||Ee)if(oe!==T.kAC3||Ee)if(oe!==T.kEAC3||Ee)if(oe!==T.kMPEG1Audio&&oe!==T.kMPEG2Audio||Ee)if(oe===T.kPESPrivateData){if(K.pes_private_data_pids[me]=!0,de>0){for(var _e=ee+5;_e<ee+5+de;){var Ne=_[_e+0],Ve=_[_e+1];if(Ne===5){var Ae=String.fromCharCode.apply(String,Array.from(_.subarray(_e+2,_e+2+Ve)));Ae==="VANC"?K.smpte2038_pids[me]=!0:Ae==="AV01"?K.common_pids.av1=me:Ae==="Opus"?K.common_pids.opus=me:Ae==="KLVA"&&(K.asynchronous_klv_pids[me]=!0)}else if(Ne===127){if(me===K.common_pids.opus){var De=null;if(_[_e+2]===128&&(De=_[_e+3]),De==null){o.a.e(this.TAG,"Not Supported Opus channel count.");continue}var je={codec:"opus",channel_count:15&De?15&De:2,channel_config_code:De,sample_rate:48e3},Me={codec:"opus",meta:je};this.audio_init_segment_dispatched_==0?(this.audio_metadata_=je,this.dispatchAudioInitSegment(Me)):this.detectAudioMetadataChange(Me)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(Me))}}else Ne===128&&me===K.common_pids.av1&&(this.video_metadata_.av1c=_.subarray(_e+2,_e+2+Ve));_e+=2+Ve}var Be=_.subarray(ee+5,ee+5+de);this.dispatchPESPrivateDataDescriptor(me,oe,Be)}}else if(oe===T.kMetadata){if(de>0)for(_e=ee+5;_e<ee+5+de;){Ne=_[_e+0];var Ye=_[_e+1];if(Ne===38){var it=_[_e+2]<<8|_[_e+3]<<0,Fe=null;it===65535&&(Fe=String.fromCharCode.apply(String,Array.from(_.subarray(_e+4,_e+4+4))));var He=null;if(_[_e+4+(it===65535?4:0)]===255){var rt=4+(it===65535?4:0)+1;He=String.fromCharCode.apply(String,Array.from(_.subarray(_e+rt,_e+rt+4)))}Fe==="ID3 "&&He==="ID3 "?K.timed_id3_pids[me]=!0:He==="KLVA"&&(K.synchronous_klv_pids[me]=!0)}_e+=2+Ye}}else oe===T.kSCTE35&&(K.scte_35_pids[me]=!0);else K.common_pids.mp3=me;else K.common_pids.eac3=me;else K.common_pids.ac3=me;else K.common_pids.loas_aac=me;else K.common_pids.adts_aac=me;else K.common_pids.h265=me;else K.common_pids.h264=me;ee+=5+de}M===this.current_program_&&(this.pmt_==null&&o.a.v(this.TAG,"Parsed first PMT: ".concat(JSON.stringify(K))),this.pmt_=K,(K.common_pids.h264||K.common_pids.h265||K.common_pids.av1)&&(this.has_video_=!0),(K.common_pids.adts_aac||K.common_pids.loas_aac||K.common_pids.ac3||K.common_pids.opus||K.common_pids.mp3)&&(this.has_audio_=!0))}else o.a.e(this.TAG,"parsePMT: table_id ".concat(p," is not corresponded to PMT!"))},y.prototype.parseSCTE35=function(_){var p=as(_);if(p.pts!=null){var I=Math.floor(p.pts/this.timescale_);p.pts=I}else p.nearest_pts=this.getNearestTimestampMilliseconds();this.onSCTE35Metadata&&this.onSCTE35Metadata(p)},y.prototype.parseAV1Payload=function(_,p,I,M,P){for(var B=new gr(_),W=null,K=[],Y=0,J=!1,X=null;(W=B.readNextOBUPayload())!=null;){if((X=b.parseOBUs(W,this.video_metadata_.details))&&X.keyframe===!0)if(this.video_init_segment_dispatched_){if(this.detectVideoMetadataChange(null,X)===!0){var ee;this.video_metadata_changed_=!0,this.dispatchVideoMediaSegment(),(ee=new Uint8Array(new ArrayBuffer(this.video_metadata_.av1c.byteLength+X.sequence_header_data.byteLength))).set(this.video_metadata_.av1c,0),ee.set(X.sequence_header_data,this.video_metadata_.av1c.byteLength),X.av1c=ee,this.dispatchVideoInitSegment()}}else(ee=new Uint8Array(new ArrayBuffer(this.video_metadata_.av1c.byteLength+X.sequence_header_data.byteLength))).set(this.video_metadata_.av1c,0),ee.set(X.sequence_header_data,this.video_metadata_.av1c.byteLength),X.av1c=ee,this.video_metadata_.details=X,this.dispatchVideoInitSegment();this.video_metadata_.details=X,J||(J=X.keyframe),K.push({data:W}),Y+=W.byteLength}var oe=Math.floor(p/this.timescale_),me=Math.floor(I/this.timescale_);if(K.length){var de=this.video_track_,Te={units:K,length:Y,isKeyframe:J,dts:me,pts:oe,cts:oe-me,file_position:M};de.samples.push(Te),de.length+=Y}},y.prototype.parseH264Payload=function(_,p,I,M,P){for(var B=new fe(_),W=null,K=[],Y=0,J=!1;(W=B.readNextNaluPayload())!=null;){var X=new Q(W);if(X.type===Z.kSliceSPS){var ee=E.parseSPS(W.data);this.video_init_segment_dispatched_?this.detectVideoMetadataChange(X,ee)===!0&&(o.a.v(this.TAG,"H264: Critical h264 metadata has been changed, attempt to re-generate InitSegment"),this.video_metadata_changed_=!0,this.video_metadata_={vps:void 0,sps:X,pps:void 0,av1c:void 0,details:ee}):(this.video_metadata_.sps=X,this.video_metadata_.details=ee)}else X.type===Z.kSlicePPS?this.video_init_segment_dispatched_&&!this.video_metadata_changed_||(this.video_metadata_.pps=X,this.video_metadata_.sps&&this.video_metadata_.pps&&(this.video_metadata_changed_&&this.dispatchVideoMediaSegment(),this.dispatchVideoInitSegment())):(X.type===Z.kSliceIDR||X.type===Z.kSliceNonIDR&&P===1)&&(J=!0);this.video_init_segment_dispatched_&&(K.push(X),Y+=X.data.byteLength)}var oe=Math.floor(p/this.timescale_),me=Math.floor(I/this.timescale_);if(K.length){var de=this.video_track_,Te={units:K,length:Y,isKeyframe:J,dts:me,pts:oe,cts:oe-me,file_position:M};de.samples.push(Te),de.length+=Y}},y.prototype.parseH265Payload=function(_,p,I,M,P){for(var B=new ls(_),W=null,K=[],Y=0,J=!1;(W=B.readNextNaluPayload())!=null;){var X=new Ui(W);if(X.type===Oe.kSliceVPS){if(!this.video_init_segment_dispatched_){var ee=k.parseVPS(W.data);this.video_metadata_.vps=X,this.video_metadata_.details=Zn(Zn({},this.video_metadata_.details),ee)}}else X.type===Oe.kSliceSPS?(ee=k.parseSPS(W.data),this.video_init_segment_dispatched_?this.detectVideoMetadataChange(X,ee)===!0&&(o.a.v(this.TAG,"H265: Critical h265 metadata has been changed, attempt to re-generate InitSegment"),this.video_metadata_changed_=!0,this.video_metadata_={vps:void 0,sps:X,pps:void 0,av1c:void 0,details:ee}):(this.video_metadata_.sps=X,this.video_metadata_.details=Zn(Zn({},this.video_metadata_.details),ee))):X.type===Oe.kSlicePPS?(!this.video_init_segment_dispatched_||this.video_metadata_changed_)&&(ee=k.parsePPS(W.data),this.video_metadata_.pps=X,this.video_metadata_.details=Zn(Zn({},this.video_metadata_.details),ee),this.video_metadata_.vps&&this.video_metadata_.sps&&this.video_metadata_.pps&&(this.video_metadata_changed_&&this.dispatchVideoMediaSegment(),this.dispatchVideoInitSegment())):X.type!==Oe.kSliceIDR_W_RADL&&X.type!==Oe.kSliceIDR_N_LP&&X.type!==Oe.kSliceCRA_NUT||(J=!0);this.video_init_segment_dispatched_&&(K.push(X),Y+=X.data.byteLength)}var oe=Math.floor(p/this.timescale_),me=Math.floor(I/this.timescale_);if(K.length){var de=this.video_track_,Te={units:K,length:Y,isKeyframe:J,dts:me,pts:oe,cts:oe-me,file_position:M};de.samples.push(Te),de.length+=Y}},y.prototype.detectVideoMetadataChange=function(_,p){if(p.codec_mimetype!==this.video_metadata_.details.codec_mimetype)return o.a.v(this.TAG,"Video: Codec mimeType changed from "+"".concat(this.video_metadata_.details.codec_mimetype," to ").concat(p.codec_mimetype)),!0;if(p.codec_size.width!==this.video_metadata_.details.codec_size.width||p.codec_size.height!==this.video_metadata_.details.codec_size.height){var I=this.video_metadata_.details.codec_size,M=p.codec_size;return o.a.v(this.TAG,"Video: Coded Resolution changed from "+"".concat(I.width,"x").concat(I.height," to ").concat(M.width,"x").concat(M.height)),!0}return p.present_size.width!==this.video_metadata_.details.present_size.width&&(o.a.v(this.TAG,"Video: Present resolution width changed from "+"".concat(this.video_metadata_.details.present_size.width," to ").concat(p.present_size.width)),!0)},y.prototype.isInitSegmentDispatched=function(){return this.has_video_&&this.has_audio_?this.video_init_segment_dispatched_&&this.audio_init_segment_dispatched_:this.has_video_&&!this.has_audio_?this.video_init_segment_dispatched_:!(this.has_video_||!this.has_audio_)&&this.audio_init_segment_dispatched_},y.prototype.dispatchVideoInitSegment=function(){var _=this.video_metadata_.details,p={type:"video"};p.id=this.video_track_.id,p.timescale=1e3,p.duration=this.duration_,p.codecWidth=_.codec_size.width,p.codecHeight=_.codec_size.height,p.presentWidth=_.present_size.width,p.presentHeight=_.present_size.height,p.profile=_.profile_string,p.level=_.level_string,p.bitDepth=_.bit_depth,p.chromaFormat=_.chroma_format,p.sarRatio=_.sar_ratio,p.frameRate=_.frame_rate;var I=p.frameRate.fps_den,M=p.frameRate.fps_num;if(p.refSampleDuration=I/M*1e3,p.codec=_.codec_mimetype,this.video_metadata_.av1c)p.av1c=this.video_metadata_.av1c,this.video_init_segment_dispatched_==0&&o.a.v(this.TAG,"Generated first AV1 for mimeType: ".concat(p.codec));else if(this.video_metadata_.vps){var P=this.video_metadata_.vps.data.subarray(4),B=this.video_metadata_.sps.data.subarray(4),W=this.video_metadata_.pps.data.subarray(4),K=new Ol(P,B,W,_);p.hvcc=K.getData(),this.video_init_segment_dispatched_==0&&o.a.v(this.TAG,"Generated first HEVCDecoderConfigurationRecord for mimeType: ".concat(p.codec))}else{B=this.video_metadata_.sps.data.subarray(4),W=this.video_metadata_.pps.data.subarray(4);var Y=new ve(B,W,_);p.avcc=Y.getData(),this.video_init_segment_dispatched_==0&&o.a.v(this.TAG,"Generated first AVCDecoderConfigurationRecord for mimeType: ".concat(p.codec))}this.onTrackMetadata("video",p),this.video_init_segment_dispatched_=!0,this.video_metadata_changed_=!1;var J=this.media_info_;J.hasVideo=!0,J.width=p.codecWidth,J.height=p.codecHeight,J.fps=p.frameRate.fps,J.profile=p.profile,J.level=p.level,J.refFrames=_.ref_frames,J.chromaFormat=_.chroma_format_string,J.sarNum=p.sarRatio.width,J.sarDen=p.sarRatio.height,J.videoCodec=p.codec,J.hasAudio&&J.audioCodec?J.mimeType='video/mp2t; codecs="'.concat(J.videoCodec,",").concat(J.audioCodec,'"'):J.mimeType='video/mp2t; codecs="'.concat(J.videoCodec,'"'),J.isComplete()&&this.onMediaInfo(J)},y.prototype.dispatchVideoMediaSegment=function(){this.isInitSegmentDispatched()&&this.video_track_.length&&this.onDataAvailable(null,this.video_track_)},y.prototype.dispatchAudioMediaSegment=function(){this.isInitSegmentDispatched()&&this.audio_track_.length&&this.onDataAvailable(this.audio_track_,null)},y.prototype.dispatchAudioVideoMediaSegment=function(){this.isInitSegmentDispatched()&&(this.audio_track_.length||this.video_track_.length)&&this.onDataAvailable(this.audio_track_,this.video_track_)},y.prototype.parseADTSAACPayload=function(_,p){if(!this.has_video_||this.video_init_segment_dispatched_){if(this.aac_last_incomplete_data_){var I=new Uint8Array(_.byteLength+this.aac_last_incomplete_data_.byteLength);I.set(this.aac_last_incomplete_data_,0),I.set(_,this.aac_last_incomplete_data_.byteLength),_=I}var M,P;if(p!=null&&(P=p/this.timescale_),this.audio_metadata_.codec==="aac"){if(p==null&&this.audio_last_sample_pts_!=null)M=1024/this.audio_metadata_.sampling_frequency*1e3,P=this.audio_last_sample_pts_+M;else if(p==null)return void o.a.w(this.TAG,"AAC: Unknown pts");if(this.aac_last_incomplete_data_&&this.audio_last_sample_pts_){M=1024/this.audio_metadata_.sampling_frequency*1e3;var B=this.audio_last_sample_pts_+M;Math.abs(B-P)>1&&(o.a.w(this.TAG,"AAC: Detected pts overlapped, "+"expected: ".concat(B,"ms, PES pts: ").concat(P,"ms")),P=B)}}for(var W,K=new ke(_),Y=null,J=P;(Y=K.readNextAACFrame())!=null;){M=1024/Y.sampling_frequency*1e3;var X={codec:"aac",data:Y};this.audio_init_segment_dispatched_==0?(this.audio_metadata_={codec:"aac",audio_object_type:Y.audio_object_type,sampling_freq_index:Y.sampling_freq_index,sampling_frequency:Y.sampling_frequency,channel_config:Y.channel_config},this.dispatchAudioInitSegment(X)):this.detectAudioMetadataChange(X)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(X)),W=J;var ee=Math.floor(J),oe={unit:Y.data,length:Y.data.byteLength,pts:ee,dts:ee};this.audio_track_.samples.push(oe),this.audio_track_.length+=Y.data.byteLength,J+=M}K.hasIncompleteData()&&(this.aac_last_incomplete_data_=K.getIncompleteData()),W&&(this.audio_last_sample_pts_=W)}},y.prototype.parseLOASAACPayload=function(_,p){var I;if(!this.has_video_||this.video_init_segment_dispatched_){if(this.aac_last_incomplete_data_){var M=new Uint8Array(_.byteLength+this.aac_last_incomplete_data_.byteLength);M.set(this.aac_last_incomplete_data_,0),M.set(_,this.aac_last_incomplete_data_.byteLength),_=M}var P,B;if(p!=null&&(B=p/this.timescale_),this.audio_metadata_.codec==="aac"){if(p==null&&this.audio_last_sample_pts_!=null)P=1024/this.audio_metadata_.sampling_frequency*1e3,B=this.audio_last_sample_pts_+P;else if(p==null)return void o.a.w(this.TAG,"AAC: Unknown pts");if(this.aac_last_incomplete_data_&&this.audio_last_sample_pts_){P=1024/this.audio_metadata_.sampling_frequency*1e3;var W=this.audio_last_sample_pts_+P;Math.abs(W-B)>1&&(o.a.w(this.TAG,"AAC: Detected pts overlapped, "+"expected: ".concat(W,"ms, PES pts: ").concat(B,"ms")),B=W)}}for(var K,Y=new ze(_),J=null,X=B;(J=Y.readNextAACFrame((I=this.loas_previous_frame)!==null&&I!==void 0?I:void 0))!=null;){this.loas_previous_frame=J,P=1024/J.sampling_frequency*1e3;var ee={codec:"aac",data:J};this.audio_init_segment_dispatched_==0?(this.audio_metadata_={codec:"aac",audio_object_type:J.audio_object_type,sampling_freq_index:J.sampling_freq_index,sampling_frequency:J.sampling_frequency,channel_config:J.channel_config},this.dispatchAudioInitSegment(ee)):this.detectAudioMetadataChange(ee)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(ee)),K=X;var oe=Math.floor(X),me={unit:J.data,length:J.data.byteLength,pts:oe,dts:oe};this.audio_track_.samples.push(me),this.audio_track_.length+=J.data.byteLength,X+=P}Y.hasIncompleteData()&&(this.aac_last_incomplete_data_=Y.getIncompleteData()),K&&(this.audio_last_sample_pts_=K)}},y.prototype.parseAC3Payload=function(_,p){if(!this.has_video_||this.video_init_segment_dispatched_){var I,M;if(p!=null&&(M=p/this.timescale_),this.audio_metadata_.codec==="ac-3"){if(p==null&&this.audio_last_sample_pts_!=null)I=1536/this.audio_metadata_.sampling_frequency*1e3,M=this.audio_last_sample_pts_+I;else if(p==null)return void o.a.w(this.TAG,"AC3: Unknown pts")}for(var P,B=new Xa(_),W=null,K=M;(W=B.readNextAC3Frame())!=null;){I=1536/W.sampling_frequency*1e3;var Y={codec:"ac-3",data:W};this.audio_init_segment_dispatched_==0?(this.audio_metadata_={codec:"ac-3",sampling_frequency:W.sampling_frequency,bit_stream_identification:W.bit_stream_identification,bit_stream_mode:W.bit_stream_mode,low_frequency_effects_channel_on:W.low_frequency_effects_channel_on,channel_mode:W.channel_mode},this.dispatchAudioInitSegment(Y)):this.detectAudioMetadataChange(Y)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(Y)),P=K;var J=Math.floor(K),X={unit:W.data,length:W.data.byteLength,pts:J,dts:J};this.audio_track_.samples.push(X),this.audio_track_.length+=W.data.byteLength,K+=I}P&&(this.audio_last_sample_pts_=P)}},y.prototype.parseEAC3Payload=function(_,p){if(!this.has_video_||this.video_init_segment_dispatched_){var I,M;if(p!=null&&(M=p/this.timescale_),this.audio_metadata_.codec==="ec-3"){if(p==null&&this.audio_last_sample_pts_!=null)I=256*this.audio_metadata_.num_blks/this.audio_metadata_.sampling_frequency*1e3,M=this.audio_last_sample_pts_+I;else if(p==null)return void o.a.w(this.TAG,"EAC3: Unknown pts")}for(var P,B=new cs(_),W=null,K=M;(W=B.readNextEAC3Frame())!=null;){I=1536/W.sampling_frequency*1e3;var Y={codec:"ec-3",data:W};this.audio_init_segment_dispatched_==0?(this.audio_metadata_={codec:"ec-3",sampling_frequency:W.sampling_frequency,bit_stream_identification:W.bit_stream_identification,low_frequency_effects_channel_on:W.low_frequency_effects_channel_on,num_blks:W.num_blks,channel_mode:W.channel_mode},this.dispatchAudioInitSegment(Y)):this.detectAudioMetadataChange(Y)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(Y)),P=K;var J=Math.floor(K),X={unit:W.data,length:W.data.byteLength,pts:J,dts:J};this.audio_track_.samples.push(X),this.audio_track_.length+=W.data.byteLength,K+=I}P&&(this.audio_last_sample_pts_=P)}},y.prototype.parseOpusPayload=function(_,p){if(!this.has_video_||this.video_init_segment_dispatched_){var I,M;if(p!=null&&(M=p/this.timescale_),this.audio_metadata_.codec==="opus"){if(p==null&&this.audio_last_sample_pts_!=null)I=20,M=this.audio_last_sample_pts_+I;else if(p==null)return void o.a.w(this.TAG,"Opus: Unknown pts")}for(var P,B=M,W=0;W<_.length;){I=20;for(var K=(16&_[W+1])!=0,Y=(8&_[W+1])!=0,J=W+2,X=0;_[J]===255;)X+=255,J+=1;X+=_[J],J+=1,J+=K?2:0,J+=Y?2:0,P=B;var ee=Math.floor(B),oe=_.slice(J,J+X),me={unit:oe,length:oe.byteLength,pts:ee,dts:ee};this.audio_track_.samples.push(me),this.audio_track_.length+=oe.byteLength,B+=I,W=J+X}P&&(this.audio_last_sample_pts_=P)}},y.prototype.parseMP3Payload=function(_,p){if(!this.has_video_||this.video_init_segment_dispatched_){var I=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],M=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],P=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],B=_[1]>>>3&3,W=(6&_[1])>>1,K=(240&_[2])>>>4,Y=(12&_[2])>>>2,J=(_[3]>>>6&3)!==3?2:1,X=0,ee=34;switch(B){case 0:X=[11025,12e3,8e3,0][Y];break;case 2:X=[22050,24e3,16e3,0][Y];break;case 3:X=[44100,48e3,32e3,0][Y]}switch(W){case 1:ee=34,K<P.length&&P[K];break;case 2:ee=33,K<M.length&&M[K];break;case 3:ee=32,K<I.length&&I[K]}var oe=new Ya;oe.object_type=ee,oe.sample_rate=X,oe.channel_count=J,oe.data=_;var me={codec:"mp3",data:oe};this.audio_init_segment_dispatched_==0?(this.audio_metadata_={codec:"mp3",object_type:ee,sample_rate:X,channel_count:J},this.dispatchAudioInitSegment(me)):this.detectAudioMetadataChange(me)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(me));var de={unit:_,length:_.byteLength,pts:p/this.timescale_,dts:p/this.timescale_};this.audio_track_.samples.push(de),this.audio_track_.length+=_.byteLength}},y.prototype.detectAudioMetadataChange=function(_){if(_.codec!==this.audio_metadata_.codec)return o.a.v(this.TAG,"Audio: Audio Codecs changed from "+"".concat(this.audio_metadata_.codec," to ").concat(_.codec)),!0;if(_.codec==="aac"&&this.audio_metadata_.codec==="aac"){if((p=_.data).audio_object_type!==this.audio_metadata_.audio_object_type)return o.a.v(this.TAG,"AAC: AudioObjectType changed from "+"".concat(this.audio_metadata_.audio_object_type," to ").concat(p.audio_object_type)),!0;if(p.sampling_freq_index!==this.audio_metadata_.sampling_freq_index)return o.a.v(this.TAG,"AAC: SamplingFrequencyIndex changed from "+"".concat(this.audio_metadata_.sampling_freq_index," to ").concat(p.sampling_freq_index)),!0;if(p.channel_config!==this.audio_metadata_.channel_config)return o.a.v(this.TAG,"AAC: Channel configuration changed from "+"".concat(this.audio_metadata_.channel_config," to ").concat(p.channel_config)),!0}else if(_.codec==="ac-3"&&this.audio_metadata_.codec==="ac-3"){var p;if((p=_.data).sampling_frequency!==this.audio_metadata_.sampling_frequency)return o.a.v(this.TAG,"AC3: Sampling Frequency changed from "+"".concat(this.audio_metadata_.sampling_frequency," to ").concat(p.sampling_frequency)),!0;if(p.bit_stream_identification!==this.audio_metadata_.bit_stream_identification)return o.a.v(this.TAG,"AC3: Bit Stream Identification changed from "+"".concat(this.audio_metadata_.bit_stream_identification," to ").concat(p.bit_stream_identification)),!0;if(p.bit_stream_mode!==this.audio_metadata_.bit_stream_mode)return o.a.v(this.TAG,"AC3: BitStream Mode changed from "+"".concat(this.audio_metadata_.bit_stream_mode," to ").concat(p.bit_stream_mode)),!0;if(p.channel_mode!==this.audio_metadata_.channel_mode)return o.a.v(this.TAG,"AC3: Channel Mode changed from "+"".concat(this.audio_metadata_.channel_mode," to ").concat(p.channel_mode)),!0;if(p.low_frequency_effects_channel_on!==this.audio_metadata_.low_frequency_effects_channel_on)return o.a.v(this.TAG,"AC3: Low Frequency Effects Channel On changed from "+"".concat(this.audio_metadata_.low_frequency_effects_channel_on," to ").concat(p.low_frequency_effects_channel_on)),!0}else if(_.codec==="opus"&&this.audio_metadata_.codec==="opus"){if((I=_.meta).sample_rate!==this.audio_metadata_.sample_rate)return o.a.v(this.TAG,"Opus: SamplingFrequencyIndex changed from "+"".concat(this.audio_metadata_.sample_rate," to ").concat(I.sample_rate)),!0;if(I.channel_count!==this.audio_metadata_.channel_count)return o.a.v(this.TAG,"Opus: Channel count changed from "+"".concat(this.audio_metadata_.channel_count," to ").concat(I.channel_count)),!0}else if(_.codec==="mp3"&&this.audio_metadata_.codec==="mp3"){var I;if((I=_.data).object_type!==this.audio_metadata_.object_type)return o.a.v(this.TAG,"MP3: AudioObjectType changed from "+"".concat(this.audio_metadata_.object_type," to ").concat(I.object_type)),!0;if(I.sample_rate!==this.audio_metadata_.sample_rate)return o.a.v(this.TAG,"MP3: SamplingFrequencyIndex changed from "+"".concat(this.audio_metadata_.sample_rate," to ").concat(I.sample_rate)),!0;if(I.channel_count!==this.audio_metadata_.channel_count)return o.a.v(this.TAG,"MP3: Channel count changed from "+"".concat(this.audio_metadata_.channel_count," to ").concat(I.channel_count)),!0}return!1},y.prototype.dispatchAudioInitSegment=function(_){var p={type:"audio"};if(p.id=this.audio_track_.id,p.timescale=1e3,p.duration=this.duration_,this.audio_metadata_.codec==="aac"){var I=_.codec==="aac"?_.data:null,M=new ft(I);p.audioSampleRate=M.sampling_rate,p.channelCount=M.channel_count,p.codec=M.codec_mimetype,p.originalCodec=M.original_codec_mimetype,p.config=M.config,p.refSampleDuration=1024/p.audioSampleRate*p.timescale}else if(this.audio_metadata_.codec==="ac-3"){var P=_.codec==="ac-3"?_.data:null,B=new Nl(P);p.audioSampleRate=B.sampling_rate,p.channelCount=B.channel_count,p.codec=B.codec_mimetype,p.originalCodec=B.original_codec_mimetype,p.config=B.config,p.refSampleDuration=1536/p.audioSampleRate*p.timescale}else if(this.audio_metadata_.codec==="ec-3"){var W=_.codec==="ec-3"?_.data:null,K=new Qa(W);p.audioSampleRate=K.sampling_rate,p.channelCount=K.channel_count,p.codec=K.codec_mimetype,p.originalCodec=K.original_codec_mimetype,p.config=K.config,p.refSampleDuration=256*K.num_blks/p.audioSampleRate*p.timescale}else this.audio_metadata_.codec==="opus"?(p.audioSampleRate=this.audio_metadata_.sample_rate,p.channelCount=this.audio_metadata_.channel_count,p.channelConfigCode=this.audio_metadata_.channel_config_code,p.codec="opus",p.originalCodec="opus",p.config=void 0,p.refSampleDuration=20):this.audio_metadata_.codec==="mp3"&&(p.audioSampleRate=this.audio_metadata_.sample_rate,p.channelCount=this.audio_metadata_.channel_count,p.codec="mp3",p.originalCodec="mp3",p.config=void 0);this.audio_init_segment_dispatched_==0&&o.a.v(this.TAG,"Generated first AudioSpecificConfig for mimeType: ".concat(p.codec)),this.onTrackMetadata("audio",p),this.audio_init_segment_dispatched_=!0,this.video_metadata_changed_=!1;var Y=this.media_info_;Y.hasAudio=!0,Y.audioCodec=p.originalCodec,Y.audioSampleRate=p.audioSampleRate,Y.audioChannelCount=p.channelCount,Y.hasVideo&&Y.videoCodec?Y.mimeType='video/mp2t; codecs="'.concat(Y.videoCodec,",").concat(Y.audioCodec,'"'):Y.mimeType='video/mp2t; codecs="'.concat(Y.audioCodec,'"'),Y.isComplete()&&this.onMediaInfo(Y)},y.prototype.dispatchPESPrivateDataDescriptor=function(_,p,I){var M=new dn;M.pid=_,M.stream_type=p,M.descriptor=I,this.onPESPrivateDataDescriptor&&this.onPESPrivateDataDescriptor(M)},y.prototype.parsePESPrivateDataPayload=function(_,p,I,M,P){var B=new gt;if(B.pid=M,B.stream_id=P,B.len=_.byteLength,B.data=_,p!=null){var W=Math.floor(p/this.timescale_);B.pts=W}else B.nearest_pts=this.getNearestTimestampMilliseconds();if(I!=null){var K=Math.floor(I/this.timescale_);B.dts=K}this.onPESPrivateData&&this.onPESPrivateData(B)},y.prototype.parseTimedID3MetadataPayload=function(_,p,I,M,P){var B=new gt;if(B.pid=M,B.stream_id=P,B.len=_.byteLength,B.data=_,p!=null){var W=Math.floor(p/this.timescale_);B.pts=W}if(I!=null){var K=Math.floor(I/this.timescale_);B.dts=K}this.onTimedID3Metadata&&this.onTimedID3Metadata(B)},y.prototype.parseSynchronousKLVMetadataPayload=function(_,p,I,M,P){var B=new Ja;if(B.pid=M,B.stream_id=P,B.len=_.byteLength,B.data=_,p!=null){var W=Math.floor(p/this.timescale_);B.pts=W}if(I!=null){var K=Math.floor(I/this.timescale_);B.dts=K}B.access_units=function(Y){for(var J=[],X=0;X+5<Y.byteLength;){var ee=Y[X+0],oe=Y[X+1],me=Y[X+2],de=Y[X+3]<<8|Y[X+4]<<0,Te=Y.slice(X+5,X+5+de);J.push({service_id:ee,sequence_number:oe,flags:me,data:Te}),X+=5+de}return J}(_),this.onSynchronousKLVMetadata&&this.onSynchronousKLVMetadata(B)},y.prototype.parseAsynchronousKLVMetadataPayload=function(_,p,I){var M=new gt;M.pid=p,M.stream_id=I,M.len=_.byteLength,M.data=_,this.onAsynchronousKLVMetadata&&this.onAsynchronousKLVMetadata(M)},y.prototype.parseSMPTE2038MetadataPayload=function(_,p,I,M,P){var B=new Ml;if(B.pid=M,B.stream_id=P,B.len=_.byteLength,B.data=_,p!=null){var W=Math.floor(p/this.timescale_);B.pts=W}if(B.nearest_pts=this.getNearestTimestampMilliseconds(),I!=null){var K=Math.floor(I/this.timescale_);B.dts=K}B.ancillaries=function(Y){for(var J=new x(Y),X=0,ee=[];X+=6,J.readBits(6)===0;){var oe=J.readBool();X+=1;var me=J.readBits(11);X+=11;var de=J.readBits(12);X+=12;var Te=255&J.readBits(10);X+=10;var Ee=255&J.readBits(10);X+=10;var _e=255&J.readBits(10);X+=10;for(var Ne=new Uint8Array(_e),Ve=0;Ve<_e;Ve++){var Ae=255&J.readBits(10);X+=10,Ne[Ve]=Ae}J.readBits(10),X+=10;var De="User Defined";Te===65?Ee===7&&(De="SCTE-104"):Te===95?Ee===220?De="ARIB STD-B37 (1SEG)":Ee===221?De="ARIB STD-B37 (ANALOG)":Ee===222?De="ARIB STD-B37 (SD)":Ee===223&&(De="ARIB STD-B37 (HD)"):Te===97&&(Ee===1?De="EIA-708":Ee===2&&(De="EIA-608")),ee.push({yc_indicator:oe,line_number:me,horizontal_offset:de,did:Te,sdid:Ee,user_data:Ne,description:De,information:{}}),J.readBits(8-(X-Math.floor(X/8))%8),X+=(8-(X-Math.floor(X/8)))%8}return J.destroy(),J=null,ee}(_),this.onSMPTE2038Metadata&&this.onSMPTE2038Metadata(B)},y.prototype.getNearestTimestampMilliseconds=function(){return this.audio_last_sample_pts_!=null?Math.floor(this.audio_last_sample_pts_):this.last_pcr_!=null?Math.floor(this.last_pcr_/300/this.timescale_):void 0},y.prototype.getPcrBase=function(_){var p=33554432*_[6]+131072*_[7]+512*_[8]+2*_[9]+(128&_[10])/128+this.timestamp_offset_;return p+4294967296<this.last_pcr_base_&&(p+=8589934592,this.timestamp_offset_+=8589934592),this.last_pcr_base_=p,p},y.prototype.getTimestamp=function(_,p){var I=536870912*(14&_[p])+4194304*(255&_[p+1])+16384*(254&_[p+2])+128*(255&_[p+3])+(254&_[p+4])/2+this.timestamp_offset_;return I+4294967296<this.last_pcr_base_&&(I+=8589934592),I},y}(F),_r=function(A,y,_){for(var p,I=0,M=y.length;I<M;I++)!p&&I in y||(p||(p=Array.prototype.slice.call(y,0,I)),p[I]=y[I]);return A.concat(p||Array.prototype.slice.call(y))},eo=function(){function A(){}return A.init=function(){for(var y in A.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],hvc1:[],hvcC:[],av01:[],av1C:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[],Opus:[],dOps:[],"ac-3":[],dac3:[],"ec-3":[],dec3:[],fLaC:[],dfLa:[]},A.types)A.types.hasOwnProperty(y)&&(A.types[y]=[y.charCodeAt(0),y.charCodeAt(1),y.charCodeAt(2),y.charCodeAt(3)]);var _=A.constants={};_.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),_.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),_.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),_.STSC=_.STCO=_.STTS,_.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),_.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),_.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),_.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),_.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),_.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])},A.box=function(y){for(var _=8,p=null,I=Array.prototype.slice.call(arguments,1),M=I.length,P=0;P<M;P++)_+=I[P].byteLength;(p=new Uint8Array(_))[0]=_>>>24&255,p[1]=_>>>16&255,p[2]=_>>>8&255,p[3]=255&_,p.set(y,4);var B=8;for(P=0;P<M;P++)p.set(I[P],B),B+=I[P].byteLength;return p},A.generateInitSegment=function(y){var _=A.box(A.types.ftyp,A.constants.FTYP),p=A.moov(y),I=new Uint8Array(_.byteLength+p.byteLength);return I.set(_,0),I.set(p,_.byteLength),I},A.moov=function(y){var _=A.mvhd(y.timescale,y.duration),p=A.trak(y),I=A.mvex(y);return A.box(A.types.moov,_,p,I)},A.mvhd=function(y,_){return A.box(A.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,y>>>24&255,y>>>16&255,y>>>8&255,255&y,_>>>24&255,_>>>16&255,_>>>8&255,255&_,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))},A.trak=function(y){return A.box(A.types.trak,A.tkhd(y),A.mdia(y))},A.tkhd=function(y){var _=y.id,p=y.duration,I=y.presentWidth,M=y.presentHeight;return A.box(A.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,_>>>24&255,_>>>16&255,_>>>8&255,255&_,0,0,0,0,p>>>24&255,p>>>16&255,p>>>8&255,255&p,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,I>>>8&255,255&I,0,0,M>>>8&255,255&M,0,0]))},A.mdia=function(y){return A.box(A.types.mdia,A.mdhd(y),A.hdlr(y),A.minf(y))},A.mdhd=function(y){var _=y.timescale,p=y.duration;return A.box(A.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,_>>>24&255,_>>>16&255,_>>>8&255,255&_,p>>>24&255,p>>>16&255,p>>>8&255,255&p,85,196,0,0]))},A.hdlr=function(y){var _=null;return _=y.type==="audio"?A.constants.HDLR_AUDIO:A.constants.HDLR_VIDEO,A.box(A.types.hdlr,_)},A.minf=function(y){var _=null;return _=y.type==="audio"?A.box(A.types.smhd,A.constants.SMHD):A.box(A.types.vmhd,A.constants.VMHD),A.box(A.types.minf,_,A.dinf(),A.stbl(y))},A.dinf=function(){return A.box(A.types.dinf,A.box(A.types.dref,A.constants.DREF))},A.stbl=function(y){return A.box(A.types.stbl,A.stsd(y),A.box(A.types.stts,A.constants.STTS),A.box(A.types.stsc,A.constants.STSC),A.box(A.types.stsz,A.constants.STSZ),A.box(A.types.stco,A.constants.STCO))},A.stsd=function(y){return y.type==="audio"?y.codec==="mp3"?A.box(A.types.stsd,A.constants.STSD_PREFIX,A.mp3(y)):y.codec==="ac-3"?A.box(A.types.stsd,A.constants.STSD_PREFIX,A.ac3(y)):y.codec==="ec-3"?A.box(A.types.stsd,A.constants.STSD_PREFIX,A.ec3(y)):y.codec==="opus"?A.box(A.types.stsd,A.constants.STSD_PREFIX,A.Opus(y)):y.codec=="flac"?A.box(A.types.stsd,A.constants.STSD_PREFIX,A.fLaC(y)):A.box(A.types.stsd,A.constants.STSD_PREFIX,A.mp4a(y)):y.type==="video"&&y.codec.startsWith("hvc1")?A.box(A.types.stsd,A.constants.STSD_PREFIX,A.hvc1(y)):y.type==="video"&&y.codec.startsWith("av01")?A.box(A.types.stsd,A.constants.STSD_PREFIX,A.av01(y)):A.box(A.types.stsd,A.constants.STSD_PREFIX,A.avc1(y))},A.mp3=function(y){var _=y.channelCount,p=y.audioSampleRate,I=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,_,0,16,0,0,0,0,p>>>8&255,255&p,0,0]);return A.box(A.types[".mp3"],I)},A.mp4a=function(y){var _=y.channelCount,p=y.audioSampleRate,I=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,_,0,16,0,0,0,0,p>>>8&255,255&p,0,0]);return A.box(A.types.mp4a,I,A.esds(y))},A.ac3=function(y){var _=y.channelCount,p=y.audioSampleRate,I=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,_,0,16,0,0,0,0,p>>>8&255,255&p,0,0]);return A.box(A.types["ac-3"],I,A.box(A.types.dac3,new Uint8Array(y.config)))},A.ec3=function(y){var _=y.channelCount,p=y.audioSampleRate,I=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,_,0,16,0,0,0,0,p>>>8&255,255&p,0,0]);return A.box(A.types["ec-3"],I,A.box(A.types.dec3,new Uint8Array(y.config)))},A.esds=function(y){var _=y.config||[],p=_.length,I=new Uint8Array([0,0,0,0,3,23+p,0,1,0,4,15+p,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([p]).concat(_).concat([6,1,2]));return A.box(A.types.esds,I)},A.Opus=function(y){var _=y.channelCount,p=y.audioSampleRate,I=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,_,0,16,0,0,0,0,p>>>8&255,255&p,0,0]);return A.box(A.types.Opus,I,A.dOps(y))},A.dOps=function(y){var _=y.channelCount,p=y.channelConfigCode,I=y.audioSampleRate;if(y.config)return A.box(A.types.dOps,y.config);var M=[];switch(p){case 1:case 2:M=[0];break;case 0:M=[255,1,1,0,1];break;case 128:M=[255,2,0,0,1];break;case 3:M=[1,2,1,0,2,1];break;case 4:M=[1,2,2,0,1,2,3];break;case 5:M=[1,3,2,0,4,1,2,3];break;case 6:M=[1,4,2,0,4,1,2,3,5];break;case 7:M=[1,4,2,0,4,1,2,3,5,6];break;case 8:M=[1,5,3,0,6,1,2,3,4,5,7];break;case 130:M=[1,1,2,0,1];break;case 131:M=[1,1,3,0,1,2];break;case 132:M=[1,1,4,0,1,2,3];break;case 133:M=[1,1,5,0,1,2,3,4];break;case 134:M=[1,1,6,0,1,2,3,4,5];break;case 135:M=[1,1,7,0,1,2,3,4,5,6];break;case 136:M=[1,1,8,0,1,2,3,4,5,6,7]}var P=new Uint8Array(_r([0,_,0,0,I>>>24&255,I>>>17&255,I>>>8&255,I>>>0&255,0,0],M));return A.box(A.types.dOps,P)},A.fLaC=function(y){var _=y.channelCount,p=Math.min(y.audioSampleRate,65535),I=y.sampleSize,M=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,_,0,I,0,0,0,0,p>>>8&255,255&p,0,0]);return A.box(A.types.fLaC,M,A.dfLa(y))},A.dfLa=function(y){var _=new Uint8Array(_r([0,0,0,0],y.config));return A.box(A.types.dfLa,_)},A.avc1=function(y){var _=y.avcc,p=y.codecWidth,I=y.codecHeight,M=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,p>>>8&255,255&p,I>>>8&255,255&I,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return A.box(A.types.avc1,M,A.box(A.types.avcC,_))},A.hvc1=function(y){var _=y.hvcc,p=y.codecWidth,I=y.codecHeight,M=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,p>>>8&255,255&p,I>>>8&255,255&I,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return A.box(A.types.hvc1,M,A.box(A.types.hvcC,_))},A.av01=function(y){var _=y.av1c,p=y.codecWidth||192,I=y.codecHeight||108,M=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,p>>>8&255,255&p,I>>>8&255,255&I,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return A.box(A.types.av01,M,A.box(A.types.av1C,_))},A.mvex=function(y){return A.box(A.types.mvex,A.trex(y))},A.trex=function(y){var _=y.id,p=new Uint8Array([0,0,0,0,_>>>24&255,_>>>16&255,_>>>8&255,255&_,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return A.box(A.types.trex,p)},A.moof=function(y,_){return A.box(A.types.moof,A.mfhd(y.sequenceNumber),A.traf(y,_))},A.mfhd=function(y){var _=new Uint8Array([0,0,0,0,y>>>24&255,y>>>16&255,y>>>8&255,255&y]);return A.box(A.types.mfhd,_)},A.traf=function(y,_){var p=y.id,I=A.box(A.types.tfhd,new Uint8Array([0,0,0,0,p>>>24&255,p>>>16&255,p>>>8&255,255&p])),M=A.box(A.types.tfdt,new Uint8Array([0,0,0,0,_>>>24&255,_>>>16&255,_>>>8&255,255&_])),P=A.sdtp(y),B=A.trun(y,P.byteLength+16+16+8+16+8+8);return A.box(A.types.traf,I,M,B,P)},A.sdtp=function(y){for(var _=y.samples||[],p=_.length,I=new Uint8Array(4+p),M=0;M<p;M++){var P=_[M].flags;I[M+4]=P.isLeading<<6|P.dependsOn<<4|P.isDependedOn<<2|P.hasRedundancy}return A.box(A.types.sdtp,I)},A.trun=function(y,_){var p=y.samples||[],I=p.length,M=12+16*I,P=new Uint8Array(M);_+=8+M,P.set([0,0,15,1,I>>>24&255,I>>>16&255,I>>>8&255,255&I,_>>>24&255,_>>>16&255,_>>>8&255,255&_],0);for(var B=0;B<I;B++){var W=p[B].duration,K=p[B].size,Y=p[B].flags,J=p[B].cts;P.set([W>>>24&255,W>>>16&255,W>>>8&255,255&W,K>>>24&255,K>>>16&255,K>>>8&255,255&K,Y.isLeading<<2|Y.dependsOn,Y.isDependedOn<<6|Y.hasRedundancy<<4|Y.isNonSync,0,0,J>>>24&255,J>>>16&255,J>>>8&255,255&J],12+16*B)}return A.box(A.types.trun,P)},A.mdat=function(y){return A.box(A.types.mdat,y)},A}();eo.init();var Rt=eo,to=function(){function A(){}return A.getSilentFrame=function(y,_){if(y==="mp4a.40.2"){if(_===1)return new Uint8Array([0,200,0,128,35,128]);if(_===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(_===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(_===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(_===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(_===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(_===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(_===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(_===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},A}(),hn=r(11),yr=function(){function A(y){this.TAG="MP4Remuxer",this._config=y,this._isLive=y.isLive===!0,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new hn.c("audio"),this._videoSegmentInfoList=new hn.c("video"),this._onInitSegment=null,this._onMediaSegment=null,this._forceFirstIDR=!(!l.a.chrome||!(l.a.version.major<50||l.a.version.major===50&&l.a.version.build<2661)),this._fillSilentAfterSeek=l.a.msedge||l.a.msie,this._mp3UseMpegAudio=!l.a.firefox,this._fillAudioTimestampGap=this._config.fixAudioTimestampGap}return A.prototype.destroy=function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null},A.prototype.bindDataSource=function(y){return y.onDataAvailable=this.remux.bind(this),y.onTrackMetadata=this._onTrackMetadataReceived.bind(this),this},Object.defineProperty(A.prototype,"onInitSegment",{get:function(){return this._onInitSegment},set:function(y){this._onInitSegment=y},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"onMediaSegment",{get:function(){return this._onMediaSegment},set:function(y){this._onMediaSegment=y},enumerable:!1,configurable:!0}),A.prototype.insertDiscontinuity=function(){this._audioNextDts=this._videoNextDts=void 0},A.prototype.seek=function(y){this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._videoSegmentInfoList.clear(),this._audioSegmentInfoList.clear()},A.prototype.remux=function(y,_){if(!this._onMediaSegment)throw new m.a("MP4Remuxer: onMediaSegment callback must be specificed!");this._dtsBaseInited||this._calculateDtsBase(y,_),_&&this._remuxVideo(_),y&&this._remuxAudio(y)},A.prototype._onTrackMetadataReceived=function(y,_){var p=null,I="mp4",M=_.codec;if(y==="audio")this._audioMeta=_,_.codec==="mp3"&&this._mp3UseMpegAudio?(I="mpeg",M="",p=new Uint8Array):p=Rt.generateInitSegment(_);else{if(y!=="video")return;this._videoMeta=_,p=Rt.generateInitSegment(_)}if(!this._onInitSegment)throw new m.a("MP4Remuxer: onInitSegment callback must be specified!");this._onInitSegment(y,{type:y,data:p.buffer,codec:M,container:"".concat(y,"/").concat(I),mediaDuration:_.duration})},A.prototype._calculateDtsBase=function(y,_){this._dtsBaseInited||(y&&y.samples&&y.samples.length&&(this._audioDtsBase=y.samples[0].dts),_&&_.samples&&_.samples.length&&(this._videoDtsBase=_.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)},A.prototype.getTimestampBase=function(){if(this._dtsBaseInited)return this._dtsBase},A.prototype.flushStashedSamples=function(){var y=this._videoStashedLastSample,_=this._audioStashedLastSample,p={type:"video",id:1,sequenceNumber:0,samples:[],length:0};y!=null&&(p.samples.push(y),p.length=y.length);var I={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};_!=null&&(I.samples.push(_),I.length=_.length),this._videoStashedLastSample=null,this._audioStashedLastSample=null,this._remuxVideo(p,!0),this._remuxAudio(I,!0)},A.prototype._remuxAudio=function(y,_){if(this._audioMeta!=null){var p,I=y,M=I.samples,P=void 0,B=-1,W=this._audioMeta.refSampleDuration,K=this._audioMeta.codec==="mp3"&&this._mp3UseMpegAudio,Y=this._dtsBaseInited&&this._audioNextDts===void 0,J=!1;if(M&&M.length!==0&&(M.length!==1||_)){var X=0,ee=null,oe=0;K?(X=0,oe=I.length):(X=8,oe=8+I.length);var me=null;if(M.length>1&&(oe-=(me=M.pop()).length),this._audioStashedLastSample!=null){var de=this._audioStashedLastSample;this._audioStashedLastSample=null,M.unshift(de),oe+=de.length}me!=null&&(this._audioStashedLastSample=me);var Te=M[0].dts-this._dtsBase;if(this._audioNextDts)P=Te-this._audioNextDts;else if(this._audioSegmentInfoList.isEmpty())P=0,this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()&&this._audioMeta.originalCodec!=="mp3"&&(J=!0);else{var Ee=this._audioSegmentInfoList.getLastSampleBefore(Te);if(Ee!=null){var _e=Te-(Ee.originalDts+Ee.duration);_e<=3&&(_e=0),P=Te-(Ee.dts+Ee.duration+_e)}else P=0}if(J){var Ne=Te-P,Ve=this._videoSegmentInfoList.getLastSegmentBefore(Te);if(Ve!=null&&Ve.beginDts<Ne){if(Lt=to.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount)){var Ae=Ve.beginDts,De=Ne-Ve.beginDts;o.a.v(this.TAG,"InsertPrefixSilentAudio: dts: ".concat(Ae,", duration: ").concat(De)),M.unshift({unit:Lt,dts:Ae,pts:Ae}),oe+=Lt.byteLength}}else J=!1}for(var je=[],Me=0;Me<M.length;Me++){var Be=(de=M[Me]).unit,Ye=de.dts-this._dtsBase,it=(Ae=Ye,!1),Fe=null,He=0;if(!(Ye<-.001)){if(this._audioMeta.codec!=="mp3"&&W!=null){var rt=Ye;if(this._audioNextDts&&(rt=this._audioNextDts),(P=Ye-rt)<=-3*W){o.a.w(this.TAG,"Dropping 1 audio frame (originalDts: ".concat(Ye," ms ,curRefDts: ").concat(rt," ms)  due to dtsCorrection: ").concat(P," ms overlap."));continue}if(P>=3*W&&this._fillAudioTimestampGap&&!l.a.safari){it=!0;var Lt,jt=Math.floor(P/W);o.a.w(this.TAG,`Large audio timestamp gap detected, may cause AV sync to drift. Silent frames will be generated to avoid unsync.
`+"originalDts: ".concat(Ye," ms, curRefDts: ").concat(rt," ms, ")+"dtsCorrection: ".concat(Math.round(P)," ms, generate: ").concat(jt," frames")),Ae=Math.floor(rt),He=Math.floor(rt+W)-Ae,(Lt=to.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount))==null&&(o.a.w(this.TAG,"Unable to generate silent frame for "+"".concat(this._audioMeta.originalCodec," with ").concat(this._audioMeta.channelCount," channels, repeat last frame")),Lt=Be),Fe=[];for(var pt=0;pt<jt;pt++){rt+=W;var Yt=Math.floor(rt),Nt=Math.floor(rt+W)-Yt,Gt={dts:Yt,pts:Yt,cts:0,unit:Lt,size:Lt.byteLength,duration:Nt,originalDts:Ye,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};Fe.push(Gt),oe+=Gt.size}this._audioNextDts=rt+W}else Ae=Math.floor(rt),He=Math.floor(rt+W)-Ae,this._audioNextDts=rt+W}else Ae=Ye-P,Me!==M.length-1?He=M[Me+1].dts-this._dtsBase-P-Ae:me!=null?He=me.dts-this._dtsBase-P-Ae:He=je.length>=1?je[je.length-1].duration:Math.floor(W),this._audioNextDts=Ae+He;B===-1&&(B=Ae),je.push({dts:Ae,pts:Ae,cts:0,unit:de.unit,size:de.unit.byteLength,duration:He,originalDts:Ye,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}),it&&je.push.apply(je,Fe)}}if(je.length===0)return I.samples=[],void(I.length=0);for(K?ee=new Uint8Array(oe):((ee=new Uint8Array(oe))[0]=oe>>>24&255,ee[1]=oe>>>16&255,ee[2]=oe>>>8&255,ee[3]=255&oe,ee.set(Rt.types.mdat,4)),Me=0;Me<je.length;Me++)Be=je[Me].unit,ee.set(Be,X),X+=Be.byteLength;var Ke=je[je.length-1];p=Ke.dts+Ke.duration;var Xe=new hn.b;Xe.beginDts=B,Xe.endDts=p,Xe.beginPts=B,Xe.endPts=p,Xe.originalBeginDts=je[0].originalDts,Xe.originalEndDts=Ke.originalDts+Ke.duration,Xe.firstSample=new hn.d(je[0].dts,je[0].pts,je[0].duration,je[0].originalDts,!1),Xe.lastSample=new hn.d(Ke.dts,Ke.pts,Ke.duration,Ke.originalDts,!1),this._isLive||this._audioSegmentInfoList.append(Xe),I.samples=je,I.sequenceNumber++;var fn=null;fn=K?new Uint8Array:Rt.moof(I,B),I.samples=[],I.length=0;var pn={type:"audio",data:this._mergeBoxes(fn,ee).buffer,sampleCount:je.length,info:Xe};K&&Y&&(pn.timestampOffset=B),this._onMediaSegment("audio",pn)}}},A.prototype._remuxVideo=function(y,_){if(this._videoMeta!=null){var p,I,M=y,P=M.samples,B=void 0,W=-1,K=-1;if(P&&P.length!==0&&(P.length!==1||_)){var Y=8,J=null,X=8+y.length,ee=null;if(P.length>1&&(X-=(ee=P.pop()).length),this._videoStashedLastSample!=null){var oe=this._videoStashedLastSample;this._videoStashedLastSample=null,P.unshift(oe),X+=oe.length}ee!=null&&(this._videoStashedLastSample=ee);var me=P[0].dts-this._dtsBase;if(this._videoNextDts)B=me-this._videoNextDts;else if(this._videoSegmentInfoList.isEmpty())B=0;else{var de=this._videoSegmentInfoList.getLastSampleBefore(me);if(de!=null){var Te=me-(de.originalDts+de.duration);Te<=3&&(Te=0),B=me-(de.dts+de.duration+Te)}else B=0}for(var Ee=new hn.b,_e=[],Ne=0;Ne<P.length;Ne++){var Ve=(oe=P[Ne]).dts-this._dtsBase,Ae=oe.isKeyframe,De=Ve-B,je=oe.cts,Me=De+je;W===-1&&(W=De,K=Me);var Be=0;if(Ne!==P.length-1?Be=P[Ne+1].dts-this._dtsBase-B-De:ee!=null?Be=ee.dts-this._dtsBase-B-De:Be=_e.length>=1?_e[_e.length-1].duration:Math.floor(this._videoMeta.refSampleDuration),Ae){var Ye=new hn.d(De,Me,Be,oe.dts,!0);Ye.fileposition=oe.fileposition,Ee.appendSyncPoint(Ye)}_e.push({dts:De,pts:Me,cts:je,units:oe.units,size:oe.length,isKeyframe:Ae,duration:Be,originalDts:Ve,flags:{isLeading:0,dependsOn:Ae?2:1,isDependedOn:Ae?1:0,hasRedundancy:0,isNonSync:Ae?0:1}})}for((J=new Uint8Array(X))[0]=X>>>24&255,J[1]=X>>>16&255,J[2]=X>>>8&255,J[3]=255&X,J.set(Rt.types.mdat,4),Ne=0;Ne<_e.length;Ne++)for(var it=_e[Ne].units;it.length;){var Fe=it.shift().data;J.set(Fe,Y),Y+=Fe.byteLength}var He=_e[_e.length-1];if(p=He.dts+He.duration,I=He.pts+He.duration,this._videoNextDts=p,Ee.beginDts=W,Ee.endDts=p,Ee.beginPts=K,Ee.endPts=I,Ee.originalBeginDts=_e[0].originalDts,Ee.originalEndDts=He.originalDts+He.duration,Ee.firstSample=new hn.d(_e[0].dts,_e[0].pts,_e[0].duration,_e[0].originalDts,_e[0].isKeyframe),Ee.lastSample=new hn.d(He.dts,He.pts,He.duration,He.originalDts,He.isKeyframe),this._isLive||this._videoSegmentInfoList.append(Ee),M.samples=_e,M.sequenceNumber++,this._forceFirstIDR){var rt=_e[0].flags;rt.dependsOn=2,rt.isNonSync=0}var Lt=Rt.moof(M,W);M.samples=[],M.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(Lt,J).buffer,sampleCount:_e.length,info:Ee})}}},A.prototype._mergeBoxes=function(y,_){var p=new Uint8Array(y.byteLength+_.byteLength);return p.set(y,0),p.set(_,y.byteLength),p},A}(),Td=r(14),Dt=r(1),vr=(r(2),function(){function A(y,_){this.TAG="TransmuxingController",this._emitter=new a.a,this._config=_,y.segments||(y.segments=[{duration:y.duration,filesize:y.filesize,url:y.url}]),typeof y.cors!="boolean"&&(y.cors=!0),typeof y.withCredentials!="boolean"&&(y.withCredentials=!1),this._mediaDataSource=y,this._currentSegmentIndex=0;var p=0;this._mediaDataSource.segments.forEach(function(I){I.timestampBase=p,p+=I.duration,I.cors=y.cors,I.withCredentials=y.withCredentials,_.referrerPolicy&&(I.referrerPolicy=_.referrerPolicy)}),isNaN(p)||this._mediaDataSource.duration===p||(this._mediaDataSource.duration=p),this._mediaInfo=null,this._demuxer=null,this._remuxer=null,this._ioctl=null,this._pendingSeekTime=null,this._pendingResolveSeekPoint=null,this._statisticsReporter=null}return A.prototype.destroy=function(){this._mediaInfo=null,this._mediaDataSource=null,this._statisticsReporter&&this._disableStatisticsReporter(),this._ioctl&&(this._ioctl.destroy(),this._ioctl=null),this._demuxer&&(this._demuxer.destroy(),this._demuxer=null),this._remuxer&&(this._remuxer.destroy(),this._remuxer=null),this._emitter.removeAllListeners(),this._emitter=null},A.prototype.on=function(y,_){this._emitter.addListener(y,_)},A.prototype.off=function(y,_){this._emitter.removeListener(y,_)},A.prototype.start=function(){this._loadSegment(0),this._enableStatisticsReporter()},A.prototype._loadSegment=function(y,_){this._currentSegmentIndex=y;var p=this._mediaDataSource.segments[y],I=this._ioctl=new Td.a(p,this._config,y);I.onError=this._onIOException.bind(this),I.onSeeked=this._onIOSeeked.bind(this),I.onComplete=this._onIOComplete.bind(this),I.onRedirect=this._onIORedirect.bind(this),I.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this),_?this._demuxer.bindDataSource(this._ioctl):I.onDataArrival=this._onInitChunkArrival.bind(this),I.open(_)},A.prototype.stop=function(){this._internalAbort(),this._disableStatisticsReporter()},A.prototype._internalAbort=function(){this._ioctl&&(this._ioctl.destroy(),this._ioctl=null)},A.prototype.pause=function(){this._ioctl&&this._ioctl.isWorking()&&(this._ioctl.pause(),this._disableStatisticsReporter())},A.prototype.resume=function(){this._ioctl&&this._ioctl.isPaused()&&(this._ioctl.resume(),this._enableStatisticsReporter())},A.prototype.seek=function(y){if(this._mediaInfo!=null&&this._mediaInfo.isSeekable()){var _=this._searchSegmentIndexContains(y);if(_===this._currentSegmentIndex){var p=this._mediaInfo.segments[_];if(p==null)this._pendingSeekTime=y;else{var I=p.getNearestKeyframe(y);this._remuxer.seek(I.milliseconds),this._ioctl.seek(I.fileposition),this._pendingResolveSeekPoint=I.milliseconds}}else{var M=this._mediaInfo.segments[_];M==null?(this._pendingSeekTime=y,this._internalAbort(),this._remuxer.seek(),this._remuxer.insertDiscontinuity(),this._loadSegment(_)):(I=M.getNearestKeyframe(y),this._internalAbort(),this._remuxer.seek(y),this._remuxer.insertDiscontinuity(),this._demuxer.resetMediaInfo(),this._demuxer.timestampBase=this._mediaDataSource.segments[_].timestampBase,this._loadSegment(_,I.fileposition),this._pendingResolveSeekPoint=I.milliseconds,this._reportSegmentMediaInfo(_))}this._enableStatisticsReporter()}},A.prototype._searchSegmentIndexContains=function(y){for(var _=this._mediaDataSource.segments,p=_.length-1,I=0;I<_.length;I++)if(y<_[I].timestampBase){p=I-1;break}return p},A.prototype._onInitChunkArrival=function(y,_){var p=this,I=0;if(_>0)this._demuxer.bindDataSource(this._ioctl),this._demuxer.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase,I=this._demuxer.parseChunks(y,_);else{var M=null;(M=L.probe(y)).match&&(this._setupFLVDemuxerRemuxer(M),I=this._demuxer.parseChunks(y,_)),M.match||M.needMoreData||(M=Za.probe(y)).match&&(this._setupTSDemuxerRemuxer(M),I=this._demuxer.parseChunks(y,_)),M.match||M.needMoreData||(M=null,o.a.e(this.TAG,"Non MPEG-TS/FLV, Unsupported media type!"),Promise.resolve().then(function(){p._internalAbort()}),this._emitter.emit(Dt.a.DEMUX_ERROR,R.a.FORMAT_UNSUPPORTED,"Non MPEG-TS/FLV, Unsupported media type!"))}return I},A.prototype._setupFLVDemuxerRemuxer=function(y){this._demuxer=new L(y,this._config),this._remuxer||(this._remuxer=new yr(this._config));var _=this._mediaDataSource;_.duration==null||isNaN(_.duration)||(this._demuxer.overridedDuration=_.duration),typeof _.hasAudio=="boolean"&&(this._demuxer.overridedHasAudio=_.hasAudio),typeof _.hasVideo=="boolean"&&(this._demuxer.overridedHasVideo=_.hasVideo),this._demuxer.timestampBase=_.segments[this._currentSegmentIndex].timestampBase,this._demuxer.onError=this._onDemuxException.bind(this),this._demuxer.onMediaInfo=this._onMediaInfo.bind(this),this._demuxer.onMetaDataArrived=this._onMetaDataArrived.bind(this),this._demuxer.onScriptDataArrived=this._onScriptDataArrived.bind(this),this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl)),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this)},A.prototype._setupTSDemuxerRemuxer=function(y){var _=this._demuxer=new Za(y,this._config);this._remuxer||(this._remuxer=new yr(this._config)),_.onError=this._onDemuxException.bind(this),_.onMediaInfo=this._onMediaInfo.bind(this),_.onMetaDataArrived=this._onMetaDataArrived.bind(this),_.onTimedID3Metadata=this._onTimedID3Metadata.bind(this),_.onSynchronousKLVMetadata=this._onSynchronousKLVMetadata.bind(this),_.onAsynchronousKLVMetadata=this._onAsynchronousKLVMetadata.bind(this),_.onSMPTE2038Metadata=this._onSMPTE2038Metadata.bind(this),_.onSCTE35Metadata=this._onSCTE35Metadata.bind(this),_.onPESPrivateDataDescriptor=this._onPESPrivateDataDescriptor.bind(this),_.onPESPrivateData=this._onPESPrivateData.bind(this),this._remuxer.bindDataSource(this._demuxer),this._demuxer.bindDataSource(this._ioctl),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this)},A.prototype._onMediaInfo=function(y){var _=this;this._mediaInfo==null&&(this._mediaInfo=Object.assign({},y),this._mediaInfo.keyframesIndex=null,this._mediaInfo.segments=[],this._mediaInfo.segmentCount=this._mediaDataSource.segments.length,Object.setPrototypeOf(this._mediaInfo,c.a.prototype));var p=Object.assign({},y);Object.setPrototypeOf(p,c.a.prototype),this._mediaInfo.segments[this._currentSegmentIndex]=p,this._reportSegmentMediaInfo(this._currentSegmentIndex),this._pendingSeekTime!=null&&Promise.resolve().then(function(){var I=_._pendingSeekTime;_._pendingSeekTime=null,_.seek(I)})},A.prototype._onMetaDataArrived=function(y){this._emitter.emit(Dt.a.METADATA_ARRIVED,y)},A.prototype._onScriptDataArrived=function(y){this._emitter.emit(Dt.a.SCRIPTDATA_ARRIVED,y)},A.prototype._onTimedID3Metadata=function(y){var _=this._remuxer.getTimestampBase();_!=null&&(y.pts!=null&&(y.pts-=_),y.dts!=null&&(y.dts-=_),this._emitter.emit(Dt.a.TIMED_ID3_METADATA_ARRIVED,y))},A.prototype._onSynchronousKLVMetadata=function(y){var _=this._remuxer.getTimestampBase();_!=null&&(y.pts!=null&&(y.pts-=_),y.dts!=null&&(y.dts-=_),this._emitter.emit(Dt.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,y))},A.prototype._onAsynchronousKLVMetadata=function(y){this._emitter.emit(Dt.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,y)},A.prototype._onSMPTE2038Metadata=function(y){var _=this._remuxer.getTimestampBase();_!=null&&(y.pts!=null&&(y.pts-=_),y.dts!=null&&(y.dts-=_),y.nearest_pts!=null&&(y.nearest_pts-=_),this._emitter.emit(Dt.a.SMPTE2038_METADATA_ARRIVED,y))},A.prototype._onSCTE35Metadata=function(y){var _=this._remuxer.getTimestampBase();_!=null&&(y.pts!=null&&(y.pts-=_),y.nearest_pts!=null&&(y.nearest_pts-=_),this._emitter.emit(Dt.a.SCTE35_METADATA_ARRIVED,y))},A.prototype._onPESPrivateDataDescriptor=function(y){this._emitter.emit(Dt.a.PES_PRIVATE_DATA_DESCRIPTOR,y)},A.prototype._onPESPrivateData=function(y){var _=this._remuxer.getTimestampBase();_!=null&&(y.pts!=null&&(y.pts-=_),y.nearest_pts!=null&&(y.nearest_pts-=_),y.dts!=null&&(y.dts-=_),this._emitter.emit(Dt.a.PES_PRIVATE_DATA_ARRIVED,y))},A.prototype._onIOSeeked=function(){this._remuxer.insertDiscontinuity()},A.prototype._onIOComplete=function(y){var _=y+1;_<this._mediaDataSource.segments.length?(this._internalAbort(),this._remuxer&&this._remuxer.flushStashedSamples(),this._loadSegment(_)):(this._remuxer&&this._remuxer.flushStashedSamples(),this._emitter.emit(Dt.a.LOADING_COMPLETE),this._disableStatisticsReporter())},A.prototype._onIORedirect=function(y){var _=this._ioctl.extraData;this._mediaDataSource.segments[_].redirectedURL=y},A.prototype._onIORecoveredEarlyEof=function(){this._emitter.emit(Dt.a.RECOVERED_EARLY_EOF)},A.prototype._onIOException=function(y,_){o.a.e(this.TAG,"IOException: type = ".concat(y,", code = ").concat(_.code,", msg = ").concat(_.msg)),this._emitter.emit(Dt.a.IO_ERROR,y,_),this._disableStatisticsReporter()},A.prototype._onDemuxException=function(y,_){o.a.e(this.TAG,"DemuxException: type = ".concat(y,", info = ").concat(_)),this._emitter.emit(Dt.a.DEMUX_ERROR,y,_)},A.prototype._onRemuxerInitSegmentArrival=function(y,_){this._emitter.emit(Dt.a.INIT_SEGMENT,y,_)},A.prototype._onRemuxerMediaSegmentArrival=function(y,_){if(this._pendingSeekTime==null&&(this._emitter.emit(Dt.a.MEDIA_SEGMENT,y,_),this._pendingResolveSeekPoint!=null&&y==="video")){var p=_.info.syncPoints,I=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null,l.a.safari&&p.length>0&&p[0].originalDts===I&&(I=p[0].pts),this._emitter.emit(Dt.a.RECOMMEND_SEEKPOINT,I)}},A.prototype._enableStatisticsReporter=function(){this._statisticsReporter==null&&(this._statisticsReporter=self.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval))},A.prototype._disableStatisticsReporter=function(){this._statisticsReporter&&(self.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},A.prototype._reportSegmentMediaInfo=function(y){var _=this._mediaInfo.segments[y],p=Object.assign({},_);p.duration=this._mediaInfo.duration,p.segmentCount=this._mediaInfo.segmentCount,delete p.segments,delete p.keyframesIndex,this._emitter.emit(Dt.a.MEDIA_INFO,p)},A.prototype._reportStatisticsInfo=function(){var y={};y.url=this._ioctl.currentURL,y.hasRedirect=this._ioctl.hasRedirect,y.hasRedirect&&(y.redirectedURL=this._ioctl.currentRedirectedURL),y.speed=this._ioctl.currentSpeed,y.loaderType=this._ioctl.loaderType,y.currentSegmentIndex=this._currentSegmentIndex,y.totalSegmentCount=this._mediaDataSource.segments.length,this._emitter.emit(Dt.a.STATISTICS_INFO,y)},A}());i.a=vr},function(t,i,r){var s,a=r(0),o=function(){function C(){this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now}return C.prototype.reset=function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0},C.prototype.addBytes=function(S){this._firstCheckpoint===0?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=S,this._totalBytes+=S):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=S,this._totalBytes+=S):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=S,this._totalBytes+=S,this._lastCheckpoint=this._now())},Object.defineProperty(C.prototype,"currentKBps",{get:function(){this.addBytes(0);var S=(this._now()-this._lastCheckpoint)/1e3;return S==0&&(S=1),this._intervalBytes/S/1024},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"lastSecondKBps",{get:function(){return this.addBytes(0),this._lastSecondBytes!==0?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"averageKBps",{get:function(){var S=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/S/1024},enumerable:!1,configurable:!0}),C}(),l=r(2),c=r(5),u=r(3),d=(s=function(C,S){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,T){b.__proto__=T}||function(b,T){for(var L in T)Object.prototype.hasOwnProperty.call(T,L)&&(b[L]=T[L])})(C,S)},function(C,S){if(typeof S!="function"&&S!==null)throw new TypeError("Class extends value "+String(S)+" is not a constructor or null");function b(){this.constructor=C}s(C,S),C.prototype=S===null?Object.create(S):(b.prototype=S.prototype,new b)}),h=function(C){function S(b,T){var L=C.call(this,"fetch-stream-loader")||this;return L.TAG="FetchStreamLoader",L._seekHandler=b,L._config=T,L._needStash=!0,L._requestAbort=!1,L._abortController=null,L._contentLength=null,L._receivedLength=0,L}return d(S,C),S.isSupported=function(){try{var b=c.a.msedge&&c.a.version.minor>=15048,T=!c.a.msedge||b;return self.fetch&&self.ReadableStream&&T}catch{return!1}},S.prototype.destroy=function(){this.isWorking()&&this.abort(),C.prototype.destroy.call(this)},S.prototype.open=function(b,T){var L=this;this._dataSource=b,this._range=T;var F=b.url;this._config.reuseRedirectedURL&&b.redirectedURL!=null&&(F=b.redirectedURL);var U=this._seekHandler.getConfig(F,T),Z=new self.Headers;if(typeof U.headers=="object"){var ie=U.headers;for(var le in ie)ie.hasOwnProperty(le)&&Z.append(le,ie[le])}var ge={method:"GET",headers:Z,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};if(typeof this._config.headers=="object")for(var le in this._config.headers)Z.append(le,this._config.headers[le]);b.cors===!1&&(ge.mode="same-origin"),b.withCredentials&&(ge.credentials="include"),b.referrerPolicy&&(ge.referrerPolicy=b.referrerPolicy),self.AbortController&&(this._abortController=new self.AbortController,ge.signal=this._abortController.signal),this._status=l.c.kConnecting,self.fetch(U.url,ge).then(function(te){if(L._requestAbort)return L._status=l.c.kIdle,void te.body.cancel();if(te.ok&&te.status>=200&&te.status<=299){if(te.url!==U.url&&L._onURLRedirect){var j=L._seekHandler.removeURLParameters(te.url);L._onURLRedirect(j)}var $=te.headers.get("Content-Length");return $!=null&&(L._contentLength=parseInt($),L._contentLength!==0&&L._onContentLengthKnown&&L._onContentLengthKnown(L._contentLength)),L._pump.call(L,te.body.getReader())}if(L._status=l.c.kError,!L._onError)throw new u.d("FetchStreamLoader: Http code invalid, "+te.status+" "+te.statusText);L._onError(l.b.HTTP_STATUS_CODE_INVALID,{code:te.status,msg:te.statusText})}).catch(function(te){if(!L._abortController||!L._abortController.signal.aborted){if(L._status=l.c.kError,!L._onError)throw te;L._onError(l.b.EXCEPTION,{code:-1,msg:te.message})}})},S.prototype.abort=function(){if(this._requestAbort=!0,(this._status!==l.c.kBuffering||!c.a.chrome)&&this._abortController)try{this._abortController.abort()}catch{}},S.prototype._pump=function(b){var T=this;return b.read().then(function(L){if(L.done)if(T._contentLength!==null&&T._receivedLength<T._contentLength){T._status=l.c.kError;var F=l.b.EARLY_EOF,U={code:-1,msg:"Fetch stream meet Early-EOF"};if(!T._onError)throw new u.d(U.msg);T._onError(F,U)}else T._status=l.c.kComplete,T._onComplete&&T._onComplete(T._range.from,T._range.from+T._receivedLength-1);else{if(T._abortController&&T._abortController.signal.aborted)return void(T._status=l.c.kComplete);if(T._requestAbort===!0)return T._status=l.c.kComplete,b.cancel();T._status=l.c.kBuffering;var Z=L.value.buffer,ie=T._range.from+T._receivedLength;T._receivedLength+=Z.byteLength,T._onDataArrival&&T._onDataArrival(Z,ie,T._receivedLength),T._pump(b)}}).catch(function(L){if(T._abortController&&T._abortController.signal.aborted)T._status=l.c.kComplete;else if(L.code!==11||!c.a.msedge){T._status=l.c.kError;var F=0,U=null;if(L.code!==19&&L.message!=="network error"||!(T._contentLength===null||T._contentLength!==null&&T._receivedLength<T._contentLength)?(F=l.b.EXCEPTION,U={code:L.code,msg:L.message}):(F=l.b.EARLY_EOF,U={code:L.code,msg:"Fetch stream meet Early-EOF"}),!T._onError)throw new u.d(U.msg);T._onError(F,U)}})},S}(l.a),m=function(){var C=function(S,b){return(C=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(T,L){T.__proto__=L}||function(T,L){for(var F in L)Object.prototype.hasOwnProperty.call(L,F)&&(T[F]=L[F])})(S,b)};return function(S,b){if(typeof b!="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function T(){this.constructor=S}C(S,b),S.prototype=b===null?Object.create(b):(T.prototype=b.prototype,new T)}}(),g=function(C){function S(b,T){var L=C.call(this,"xhr-moz-chunked-loader")||this;return L.TAG="MozChunkedLoader",L._seekHandler=b,L._config=T,L._needStash=!0,L._xhr=null,L._requestAbort=!1,L._contentLength=null,L._receivedLength=0,L}return m(S,C),S.isSupported=function(){try{var b=new XMLHttpRequest;return b.open("GET","https://example.com",!0),b.responseType="moz-chunked-arraybuffer",b.responseType==="moz-chunked-arraybuffer"}catch(T){return a.a.w("MozChunkedLoader",T.message),!1}},S.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onloadend=null,this._xhr.onerror=null,this._xhr=null),C.prototype.destroy.call(this)},S.prototype.open=function(b,T){this._dataSource=b,this._range=T;var L=b.url;this._config.reuseRedirectedURL&&b.redirectedURL!=null&&(L=b.redirectedURL);var F=this._seekHandler.getConfig(L,T);this._requestURL=F.url;var U=this._xhr=new XMLHttpRequest;if(U.open("GET",F.url,!0),U.responseType="moz-chunked-arraybuffer",U.onreadystatechange=this._onReadyStateChange.bind(this),U.onprogress=this._onProgress.bind(this),U.onloadend=this._onLoadEnd.bind(this),U.onerror=this._onXhrError.bind(this),b.withCredentials&&(U.withCredentials=!0),typeof F.headers=="object"){var Z=F.headers;for(var ie in Z)Z.hasOwnProperty(ie)&&U.setRequestHeader(ie,Z[ie])}if(typeof this._config.headers=="object"){Z=this._config.headers;for(var ie in Z)Z.hasOwnProperty(ie)&&U.setRequestHeader(ie,Z[ie])}this._status=l.c.kConnecting,U.send()},S.prototype.abort=function(){this._requestAbort=!0,this._xhr&&this._xhr.abort(),this._status=l.c.kComplete},S.prototype._onReadyStateChange=function(b){var T=b.target;if(T.readyState===2){if(T.responseURL!=null&&T.responseURL!==this._requestURL&&this._onURLRedirect){var L=this._seekHandler.removeURLParameters(T.responseURL);this._onURLRedirect(L)}if(T.status!==0&&(T.status<200||T.status>299)){if(this._status=l.c.kError,!this._onError)throw new u.d("MozChunkedLoader: Http code invalid, "+T.status+" "+T.statusText);this._onError(l.b.HTTP_STATUS_CODE_INVALID,{code:T.status,msg:T.statusText})}else this._status=l.c.kBuffering}},S.prototype._onProgress=function(b){if(this._status!==l.c.kError){this._contentLength===null&&b.total!==null&&b.total!==0&&(this._contentLength=b.total,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength));var T=b.target.response,L=this._range.from+this._receivedLength;this._receivedLength+=T.byteLength,this._onDataArrival&&this._onDataArrival(T,L,this._receivedLength)}},S.prototype._onLoadEnd=function(b){this._requestAbort!==!0?this._status!==l.c.kError&&(this._status=l.c.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1)):this._requestAbort=!1},S.prototype._onXhrError=function(b){this._status=l.c.kError;var T=0,L=null;if(this._contentLength&&b.loaded<this._contentLength?(T=l.b.EARLY_EOF,L={code:-1,msg:"Moz-Chunked stream meet Early-Eof"}):(T=l.b.EXCEPTION,L={code:-1,msg:b.constructor.name+" "+b.type}),!this._onError)throw new u.d(L.msg);this._onError(T,L)},S}(l.a),v=function(){var C=function(S,b){return(C=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(T,L){T.__proto__=L}||function(T,L){for(var F in L)Object.prototype.hasOwnProperty.call(L,F)&&(T[F]=L[F])})(S,b)};return function(S,b){if(typeof b!="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function T(){this.constructor=S}C(S,b),S.prototype=b===null?Object.create(b):(T.prototype=b.prototype,new T)}}(),x=(function(C){function S(b,T){var L=C.call(this,"xhr-msstream-loader")||this;return L.TAG="MSStreamLoader",L._seekHandler=b,L._config=T,L._needStash=!0,L._xhr=null,L._reader=null,L._totalRange=null,L._currentRange=null,L._currentRequestURL=null,L._currentRedirectedURL=null,L._contentLength=null,L._receivedLength=0,L._bufferLimit=16777216,L._lastTimeBufferSize=0,L._isReconnecting=!1,L}v(S,C),S.isSupported=function(){try{if(self.MSStream===void 0||self.MSStreamReader===void 0)return!1;var b=new XMLHttpRequest;return b.open("GET","https://example.com",!0),b.responseType="ms-stream",b.responseType==="ms-stream"}catch(T){return a.a.w("MSStreamLoader",T.message),!1}},S.prototype.destroy=function(){this.isWorking()&&this.abort(),this._reader&&(this._reader.onprogress=null,this._reader.onload=null,this._reader.onerror=null,this._reader=null),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr=null),C.prototype.destroy.call(this)},S.prototype.open=function(b,T){this._internalOpen(b,T,!1)},S.prototype._internalOpen=function(b,T,L){this._dataSource=b,L?this._currentRange=T:this._totalRange=T;var F=b.url;this._config.reuseRedirectedURL&&(this._currentRedirectedURL!=null?F=this._currentRedirectedURL:b.redirectedURL!=null&&(F=b.redirectedURL));var U=this._seekHandler.getConfig(F,T);this._currentRequestURL=U.url;var Z=this._reader=new self.MSStreamReader;Z.onprogress=this._msrOnProgress.bind(this),Z.onload=this._msrOnLoad.bind(this),Z.onerror=this._msrOnError.bind(this);var ie=this._xhr=new XMLHttpRequest;if(ie.open("GET",U.url,!0),ie.responseType="ms-stream",ie.onreadystatechange=this._xhrOnReadyStateChange.bind(this),ie.onerror=this._xhrOnError.bind(this),b.withCredentials&&(ie.withCredentials=!0),typeof U.headers=="object"){var le=U.headers;for(var ge in le)le.hasOwnProperty(ge)&&ie.setRequestHeader(ge,le[ge])}if(typeof this._config.headers=="object"){le=this._config.headers;for(var ge in le)le.hasOwnProperty(ge)&&ie.setRequestHeader(ge,le[ge])}this._isReconnecting?this._isReconnecting=!1:this._status=l.c.kConnecting,ie.send()},S.prototype.abort=function(){this._internalAbort(),this._status=l.c.kComplete},S.prototype._internalAbort=function(){this._reader&&(this._reader.readyState===1&&this._reader.abort(),this._reader.onprogress=null,this._reader.onload=null,this._reader.onerror=null,this._reader=null),this._xhr&&(this._xhr.abort(),this._xhr.onreadystatechange=null,this._xhr=null)},S.prototype._xhrOnReadyStateChange=function(b){var T=b.target;if(T.readyState===2)if(T.status>=200&&T.status<=299){if(this._status=l.c.kBuffering,T.responseURL!=null){var L=this._seekHandler.removeURLParameters(T.responseURL);T.responseURL!==this._currentRequestURL&&L!==this._currentRedirectedURL&&(this._currentRedirectedURL=L,this._onURLRedirect&&this._onURLRedirect(L))}var F=T.getResponseHeader("Content-Length");if(F!=null&&this._contentLength==null){var U=parseInt(F);U>0&&(this._contentLength=U,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength))}}else{if(this._status=l.c.kError,!this._onError)throw new u.d("MSStreamLoader: Http code invalid, "+T.status+" "+T.statusText);this._onError(l.b.HTTP_STATUS_CODE_INVALID,{code:T.status,msg:T.statusText})}else if(T.readyState===3&&T.status>=200&&T.status<=299){this._status=l.c.kBuffering;var Z=T.response;this._reader.readAsArrayBuffer(Z)}},S.prototype._xhrOnError=function(b){this._status=l.c.kError;var T=l.b.EXCEPTION,L={code:-1,msg:b.constructor.name+" "+b.type};if(!this._onError)throw new u.d(L.msg);this._onError(T,L)},S.prototype._msrOnProgress=function(b){var T=b.target.result;if(T!=null){var L=T.slice(this._lastTimeBufferSize);this._lastTimeBufferSize=T.byteLength;var F=this._totalRange.from+this._receivedLength;this._receivedLength+=L.byteLength,this._onDataArrival&&this._onDataArrival(L,F,this._receivedLength),T.byteLength>=this._bufferLimit&&(a.a.v(this.TAG,"MSStream buffer exceeded max size near ".concat(F+L.byteLength,", reconnecting...")),this._doReconnectIfNeeded())}else this._doReconnectIfNeeded()},S.prototype._doReconnectIfNeeded=function(){if(this._contentLength==null||this._receivedLength<this._contentLength){this._isReconnecting=!0,this._lastTimeBufferSize=0,this._internalAbort();var b={from:this._totalRange.from+this._receivedLength,to:-1};this._internalOpen(this._dataSource,b,!0)}},S.prototype._msrOnLoad=function(b){this._status=l.c.kComplete,this._onComplete&&this._onComplete(this._totalRange.from,this._totalRange.from+this._receivedLength-1)},S.prototype._msrOnError=function(b){this._status=l.c.kError;var T=0,L=null;if(this._contentLength&&this._receivedLength<this._contentLength?(T=l.b.EARLY_EOF,L={code:-1,msg:"MSStream meet Early-Eof"}):(T=l.b.EARLY_EOF,L={code:-1,msg:b.constructor.name+" "+b.type}),!this._onError)throw new u.d(L.msg);this._onError(T,L)}}(l.a),function(){var C=function(S,b){return(C=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(T,L){T.__proto__=L}||function(T,L){for(var F in L)Object.prototype.hasOwnProperty.call(L,F)&&(T[F]=L[F])})(S,b)};return function(S,b){if(typeof b!="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function T(){this.constructor=S}C(S,b),S.prototype=b===null?Object.create(b):(T.prototype=b.prototype,new T)}}()),E=function(C){function S(b,T){var L=C.call(this,"xhr-range-loader")||this;return L.TAG="RangeLoader",L._seekHandler=b,L._config=T,L._needStash=!1,L._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192],L._currentChunkSizeKB=384,L._currentSpeedNormalized=0,L._zeroSpeedChunkCount=0,L._xhr=null,L._speedSampler=new o,L._requestAbort=!1,L._waitForTotalLength=!1,L._totalLengthReceived=!1,L._currentRequestURL=null,L._currentRedirectedURL=null,L._currentRequestRange=null,L._totalLength=null,L._contentLength=null,L._receivedLength=0,L._lastTimeLoaded=0,L}return x(S,C),S.isSupported=function(){try{var b=new XMLHttpRequest;return b.open("GET","https://example.com",!0),b.responseType="arraybuffer",b.responseType==="arraybuffer"}catch(T){return a.a.w("RangeLoader",T.message),!1}},S.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr=null),C.prototype.destroy.call(this)},Object.defineProperty(S.prototype,"currentSpeed",{get:function(){return this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),S.prototype.open=function(b,T){this._dataSource=b,this._range=T,this._status=l.c.kConnecting;var L=!1;this._dataSource.filesize!=null&&this._dataSource.filesize!==0&&(L=!0,this._totalLength=this._dataSource.filesize),this._totalLengthReceived||L?this._openSubRange():(this._waitForTotalLength=!0,this._internalOpen(this._dataSource,{from:0,to:-1}))},S.prototype._openSubRange=function(){var b=1024*this._currentChunkSizeKB,T=this._range.from+this._receivedLength,L=T+b;this._contentLength!=null&&L-this._range.from>=this._contentLength&&(L=this._range.from+this._contentLength-1),this._currentRequestRange={from:T,to:L},this._internalOpen(this._dataSource,this._currentRequestRange)},S.prototype._internalOpen=function(b,T){this._lastTimeLoaded=0;var L=b.url;this._config.reuseRedirectedURL&&(this._currentRedirectedURL!=null?L=this._currentRedirectedURL:b.redirectedURL!=null&&(L=b.redirectedURL));var F=this._seekHandler.getConfig(L,T);this._currentRequestURL=F.url;var U=this._xhr=new XMLHttpRequest;if(U.open("GET",F.url,!0),U.responseType="arraybuffer",U.onreadystatechange=this._onReadyStateChange.bind(this),U.onprogress=this._onProgress.bind(this),U.onload=this._onLoad.bind(this),U.onerror=this._onXhrError.bind(this),b.withCredentials&&(U.withCredentials=!0),typeof F.headers=="object"){var Z=F.headers;for(var ie in Z)Z.hasOwnProperty(ie)&&U.setRequestHeader(ie,Z[ie])}if(typeof this._config.headers=="object"){Z=this._config.headers;for(var ie in Z)Z.hasOwnProperty(ie)&&U.setRequestHeader(ie,Z[ie])}U.send()},S.prototype.abort=function(){this._requestAbort=!0,this._internalAbort(),this._status=l.c.kComplete},S.prototype._internalAbort=function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)},S.prototype._onReadyStateChange=function(b){var T=b.target;if(T.readyState===2){if(T.responseURL!=null){var L=this._seekHandler.removeURLParameters(T.responseURL);T.responseURL!==this._currentRequestURL&&L!==this._currentRedirectedURL&&(this._currentRedirectedURL=L,this._onURLRedirect&&this._onURLRedirect(L))}if(T.status>=200&&T.status<=299){if(this._waitForTotalLength)return;this._status=l.c.kBuffering}else{if(this._status=l.c.kError,!this._onError)throw new u.d("RangeLoader: Http code invalid, "+T.status+" "+T.statusText);this._onError(l.b.HTTP_STATUS_CODE_INVALID,{code:T.status,msg:T.statusText})}}},S.prototype._onProgress=function(b){if(this._status!==l.c.kError){if(this._contentLength===null){var T=!1;if(this._waitForTotalLength){this._waitForTotalLength=!1,this._totalLengthReceived=!0,T=!0;var L=b.total;this._internalAbort(),L!=null&L!==0&&(this._totalLength=L)}if(this._range.to===-1?this._contentLength=this._totalLength-this._range.from:this._contentLength=this._range.to-this._range.from+1,T)return void this._openSubRange();this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength)}var F=b.loaded-this._lastTimeLoaded;this._lastTimeLoaded=b.loaded,this._speedSampler.addBytes(F)}},S.prototype._normalizeSpeed=function(b){var T=this._chunkSizeKBList,L=T.length-1,F=0,U=0,Z=L;if(b<T[0])return T[0];for(;U<=Z;){if((F=U+Math.floor((Z-U)/2))===L||b>=T[F]&&b<T[F+1])return T[F];T[F]<b?U=F+1:Z=F-1}},S.prototype._onLoad=function(b){if(this._status!==l.c.kError)if(this._waitForTotalLength)this._waitForTotalLength=!1;else{this._lastTimeLoaded=0;var T=this._speedSampler.lastSecondKBps;if(T===0&&(this._zeroSpeedChunkCount++,this._zeroSpeedChunkCount>=3&&(T=this._speedSampler.currentKBps)),T!==0){var L=this._normalizeSpeed(T);this._currentSpeedNormalized!==L&&(this._currentSpeedNormalized=L,this._currentChunkSizeKB=L)}var F=b.target.response,U=this._range.from+this._receivedLength;this._receivedLength+=F.byteLength;var Z=!1;this._contentLength!=null&&this._receivedLength<this._contentLength?this._openSubRange():Z=!0,this._onDataArrival&&this._onDataArrival(F,U,this._receivedLength),Z&&(this._status=l.c.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}},S.prototype._onXhrError=function(b){this._status=l.c.kError;var T=0,L=null;if(this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength?(T=l.b.EARLY_EOF,L={code:-1,msg:"RangeLoader meet Early-Eof"}):(T=l.b.EXCEPTION,L={code:-1,msg:b.constructor.name+" "+b.type}),!this._onError)throw new u.d(L.msg);this._onError(T,L)},S}(l.a),R=function(){var C=function(S,b){return(C=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(T,L){T.__proto__=L}||function(T,L){for(var F in L)Object.prototype.hasOwnProperty.call(L,F)&&(T[F]=L[F])})(S,b)};return function(S,b){if(typeof b!="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function T(){this.constructor=S}C(S,b),S.prototype=b===null?Object.create(b):(T.prototype=b.prototype,new T)}}(),k=function(C){function S(){var b=C.call(this,"websocket-loader")||this;return b.TAG="WebSocketLoader",b._needStash=!0,b._ws=null,b._requestAbort=!1,b._receivedLength=0,b}return R(S,C),S.isSupported=function(){try{return self.WebSocket!==void 0}catch{return!1}},S.prototype.destroy=function(){this._ws&&this.abort(),C.prototype.destroy.call(this)},S.prototype.open=function(b){try{var T=this._ws=new self.WebSocket(b.url);T.binaryType="arraybuffer",T.onopen=this._onWebSocketOpen.bind(this),T.onclose=this._onWebSocketClose.bind(this),T.onmessage=this._onWebSocketMessage.bind(this),T.onerror=this._onWebSocketError.bind(this),this._status=l.c.kConnecting}catch(F){this._status=l.c.kError;var L={code:F.code,msg:F.message};if(!this._onError)throw new u.d(L.msg);this._onError(l.b.EXCEPTION,L)}},S.prototype.abort=function(){var b=this._ws;!b||b.readyState!==0&&b.readyState!==1||(this._requestAbort=!0,b.close()),this._ws=null,this._status=l.c.kComplete},S.prototype._onWebSocketOpen=function(b){this._status=l.c.kBuffering},S.prototype._onWebSocketClose=function(b){this._requestAbort!==!0?(this._status=l.c.kComplete,this._onComplete&&this._onComplete(0,this._receivedLength-1)):this._requestAbort=!1},S.prototype._onWebSocketMessage=function(b){var T=this;if(b.data instanceof ArrayBuffer)this._dispatchArrayBuffer(b.data);else if(b.data instanceof Blob){var L=new FileReader;L.onload=function(){T._dispatchArrayBuffer(L.result)},L.readAsArrayBuffer(b.data)}else{this._status=l.c.kError;var F={code:-1,msg:"Unsupported WebSocket message type: "+b.data.constructor.name};if(!this._onError)throw new u.d(F.msg);this._onError(l.b.EXCEPTION,F)}},S.prototype._dispatchArrayBuffer=function(b){var T=b,L=this._receivedLength;this._receivedLength+=T.byteLength,this._onDataArrival&&this._onDataArrival(T,L,this._receivedLength)},S.prototype._onWebSocketError=function(b){this._status=l.c.kError;var T={code:b.code,msg:b.message};if(!this._onError)throw new u.d(T.msg);this._onError(l.b.EXCEPTION,T)},S}(l.a),D=function(){function C(S){this._zeroStart=S||!1}return C.prototype.getConfig=function(S,b){var T={};if(b.from!==0||b.to!==-1){var L=void 0;L=b.to!==-1?"bytes=".concat(b.from.toString(),"-").concat(b.to.toString()):"bytes=".concat(b.from.toString(),"-"),T.Range=L}else this._zeroStart&&(T.Range="bytes=0-");return{url:S,headers:T}},C.prototype.removeURLParameters=function(S){return S},C}(),V=function(){function C(S,b){this._startName=S,this._endName=b}return C.prototype.getConfig=function(S,b){var T=S;if(b.from!==0||b.to!==-1){var L=!0;T.indexOf("?")===-1&&(T+="?",L=!1),L&&(T+="&"),T+="".concat(this._startName,"=").concat(b.from.toString()),b.to!==-1&&(T+="&".concat(this._endName,"=").concat(b.to.toString()))}return{url:T,headers:{}}},C.prototype.removeURLParameters=function(S){var b=S.split("?")[0],T=void 0,L=S.indexOf("?");L!==-1&&(T=S.substring(L+1));var F="";if(T!=null&&T.length>0)for(var U=T.split("&"),Z=0;Z<U.length;Z++){var ie=U[Z].split("="),le=Z>0;ie[0]!==this._startName&&ie[0]!==this._endName&&(le&&(F+="&"),F+=U[Z])}return F.length===0?b:b+"?"+F},C}(),H=function(){function C(S,b,T){this.TAG="IOController",this._config=b,this._extraData=T,this._stashInitialSize=65536,b.stashInitialSize!=null&&b.stashInitialSize>0&&(this._stashInitialSize=b.stashInitialSize),this._stashUsed=0,this._stashSize=this._stashInitialSize,this._bufferSize=Math.max(this._stashSize,3145728),this._stashBuffer=new ArrayBuffer(this._bufferSize),this._stashByteStart=0,this._enableStash=!0,b.enableStashBuffer===!1&&(this._enableStash=!1),this._loader=null,this._loaderClass=null,this._seekHandler=null,this._dataSource=S,this._isWebSocketURL=/wss?:\/\/(.+?)/.test(S.url),this._refTotalLength=S.filesize?S.filesize:null,this._totalLength=this._refTotalLength,this._fullRequestFlag=!1,this._currentRange=null,this._redirectedURL=null,this._speedNormalized=0,this._speedSampler=new o,this._speedNormalizeList=[32,64,96,128,192,256,384,512,768,1024,1536,2048,3072,4096],this._isEarlyEofReconnecting=!1,this._paused=!1,this._resumeFrom=0,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._selectSeekHandler(),this._selectLoader(),this._createLoader()}return C.prototype.destroy=function(){this._loader.isWorking()&&this._loader.abort(),this._loader.destroy(),this._loader=null,this._loaderClass=null,this._dataSource=null,this._stashBuffer=null,this._stashUsed=this._stashSize=this._bufferSize=this._stashByteStart=0,this._currentRange=null,this._speedSampler=null,this._isEarlyEofReconnecting=!1,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._extraData=null},C.prototype.isWorking=function(){return this._loader&&this._loader.isWorking()&&!this._paused},C.prototype.isPaused=function(){return this._paused},Object.defineProperty(C.prototype,"status",{get:function(){return this._loader.status},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"extraData",{get:function(){return this._extraData},set:function(S){this._extraData=S},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(S){this._onDataArrival=S},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"onSeeked",{get:function(){return this._onSeeked},set:function(S){this._onSeeked=S},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"onError",{get:function(){return this._onError},set:function(S){this._onError=S},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"onComplete",{get:function(){return this._onComplete},set:function(S){this._onComplete=S},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"onRedirect",{get:function(){return this._onRedirect},set:function(S){this._onRedirect=S},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"onRecoveredEarlyEof",{get:function(){return this._onRecoveredEarlyEof},set:function(S){this._onRecoveredEarlyEof=S},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"currentURL",{get:function(){return this._dataSource.url},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"hasRedirect",{get:function(){return this._redirectedURL!=null||this._dataSource.redirectedURL!=null},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"currentRedirectedURL",{get:function(){return this._redirectedURL||this._dataSource.redirectedURL},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"currentSpeed",{get:function(){return this._loaderClass===E?this._loader.currentSpeed:this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"loaderType",{get:function(){return this._loader.type},enumerable:!1,configurable:!0}),C.prototype._selectSeekHandler=function(){var S=this._config;if(S.seekType==="range")this._seekHandler=new D(this._config.rangeLoadZeroStart);else if(S.seekType==="param"){var b=S.seekParamStart||"bstart",T=S.seekParamEnd||"bend";this._seekHandler=new V(b,T)}else{if(S.seekType!=="custom")throw new u.b("Invalid seekType in config: ".concat(S.seekType));if(typeof S.customSeekHandler!="function")throw new u.b("Custom seekType specified in config but invalid customSeekHandler!");this._seekHandler=new S.customSeekHandler}},C.prototype._selectLoader=function(){if(this._config.customLoader!=null)this._loaderClass=this._config.customLoader;else if(this._isWebSocketURL)this._loaderClass=k;else if(h.isSupported())this._loaderClass=h;else if(g.isSupported())this._loaderClass=g;else{if(!E.isSupported())throw new u.d("Your browser doesn't support xhr with arraybuffer responseType!");this._loaderClass=E}},C.prototype._createLoader=function(){this._loader=new this._loaderClass(this._seekHandler,this._config),this._loader.needStashBuffer===!1&&(this._enableStash=!1),this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this),this._loader.onURLRedirect=this._onURLRedirect.bind(this),this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this),this._loader.onComplete=this._onLoaderComplete.bind(this),this._loader.onError=this._onLoaderError.bind(this)},C.prototype.open=function(S){this._currentRange={from:0,to:-1},S&&(this._currentRange.from=S),this._speedSampler.reset(),S||(this._fullRequestFlag=!0),this._loader.open(this._dataSource,Object.assign({},this._currentRange))},C.prototype.abort=function(){this._loader.abort(),this._paused&&(this._paused=!1,this._resumeFrom=0)},C.prototype.pause=function(){this.isWorking()&&(this._loader.abort(),this._stashUsed!==0?(this._resumeFrom=this._stashByteStart,this._currentRange.to=this._stashByteStart-1):this._resumeFrom=this._currentRange.to+1,this._stashUsed=0,this._stashByteStart=0,this._paused=!0)},C.prototype.resume=function(){if(this._paused){this._paused=!1;var S=this._resumeFrom;this._resumeFrom=0,this._internalSeek(S,!0)}},C.prototype.seek=function(S){this._paused=!1,this._stashUsed=0,this._stashByteStart=0,this._internalSeek(S,!0)},C.prototype._internalSeek=function(S,b){this._loader.isWorking()&&this._loader.abort(),this._flushStashBuffer(b),this._loader.destroy(),this._loader=null;var T={from:S,to:-1};this._currentRange={from:T.from,to:-1},this._speedSampler.reset(),this._stashSize=this._stashInitialSize,this._createLoader(),this._loader.open(this._dataSource,T),this._onSeeked&&this._onSeeked()},C.prototype.updateUrl=function(S){if(!S||typeof S!="string"||S.length===0)throw new u.b("Url must be a non-empty string!");this._dataSource.url=S},C.prototype._expandBuffer=function(S){for(var b=this._stashSize;b+1048576<S;)b*=2;if((b+=1048576)!==this._bufferSize){var T=new ArrayBuffer(b);if(this._stashUsed>0){var L=new Uint8Array(this._stashBuffer,0,this._stashUsed);new Uint8Array(T,0,b).set(L,0)}this._stashBuffer=T,this._bufferSize=b}},C.prototype._normalizeSpeed=function(S){var b=this._speedNormalizeList,T=b.length-1,L=0,F=0,U=T;if(S<b[0])return b[0];for(;F<=U;){if((L=F+Math.floor((U-F)/2))===T||S>=b[L]&&S<b[L+1])return b[L];b[L]<S?F=L+1:U=L-1}},C.prototype._adjustStashSize=function(S){var b=0;(b=this._config.isLive?S/8:S<512?S:S>=512&&S<=1024?Math.floor(1.5*S):2*S)>8192&&(b=8192);var T=1024*b+1048576;this._bufferSize<T&&this._expandBuffer(T),this._stashSize=1024*b},C.prototype._dispatchChunks=function(S,b){return this._currentRange.to=b+S.byteLength-1,this._onDataArrival(S,b)},C.prototype._onURLRedirect=function(S){this._redirectedURL=S,this._onRedirect&&this._onRedirect(S)},C.prototype._onContentLengthKnown=function(S){S&&this._fullRequestFlag&&(this._totalLength=S,this._fullRequestFlag=!1)},C.prototype._onLoaderChunkArrival=function(S,b,T){if(!this._onDataArrival)throw new u.a("IOController: No existing consumer (onDataArrival) callback!");if(!this._paused){this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,this._onRecoveredEarlyEof&&this._onRecoveredEarlyEof()),this._speedSampler.addBytes(S.byteLength);var L=this._speedSampler.lastSecondKBps;if(L!==0){var F=this._normalizeSpeed(L);this._speedNormalized!==F&&(this._speedNormalized=F,this._adjustStashSize(F))}if(this._enableStash)if(this._stashUsed===0&&this._stashByteStart===0&&(this._stashByteStart=b),this._stashUsed+S.byteLength<=this._stashSize)(ie=new Uint8Array(this._stashBuffer,0,this._stashSize)).set(new Uint8Array(S),this._stashUsed),this._stashUsed+=S.byteLength;else if(ie=new Uint8Array(this._stashBuffer,0,this._bufferSize),this._stashUsed>0){var U=this._stashBuffer.slice(0,this._stashUsed);(le=this._dispatchChunks(U,this._stashByteStart))<U.byteLength?le>0&&(ge=new Uint8Array(U,le),ie.set(ge,0),this._stashUsed=ge.byteLength,this._stashByteStart+=le):(this._stashUsed=0,this._stashByteStart+=le),this._stashUsed+S.byteLength>this._bufferSize&&(this._expandBuffer(this._stashUsed+S.byteLength),ie=new Uint8Array(this._stashBuffer,0,this._bufferSize)),ie.set(new Uint8Array(S),this._stashUsed),this._stashUsed+=S.byteLength}else(le=this._dispatchChunks(S,b))<S.byteLength&&((Z=S.byteLength-le)>this._bufferSize&&(this._expandBuffer(Z),ie=new Uint8Array(this._stashBuffer,0,this._bufferSize)),ie.set(new Uint8Array(S,le),0),this._stashUsed+=Z,this._stashByteStart=b+le);else if(this._stashUsed===0){var Z;(le=this._dispatchChunks(S,b))<S.byteLength&&((Z=S.byteLength-le)>this._bufferSize&&this._expandBuffer(Z),(ie=new Uint8Array(this._stashBuffer,0,this._bufferSize)).set(new Uint8Array(S,le),0),this._stashUsed+=Z,this._stashByteStart=b+le)}else{var ie,le;if(this._stashUsed+S.byteLength>this._bufferSize&&this._expandBuffer(this._stashUsed+S.byteLength),(ie=new Uint8Array(this._stashBuffer,0,this._bufferSize)).set(new Uint8Array(S),this._stashUsed),this._stashUsed+=S.byteLength,(le=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart))<this._stashUsed&&le>0){var ge=new Uint8Array(this._stashBuffer,le);ie.set(ge,0)}this._stashUsed-=le,this._stashByteStart+=le}}},C.prototype._flushStashBuffer=function(S){if(this._stashUsed>0){var b=this._stashBuffer.slice(0,this._stashUsed),T=this._dispatchChunks(b,this._stashByteStart),L=b.byteLength-T;if(T<b.byteLength){if(!S){if(T>0){var F=new Uint8Array(this._stashBuffer,0,this._bufferSize),U=new Uint8Array(b,T);F.set(U,0),this._stashUsed=U.byteLength,this._stashByteStart+=T}return 0}a.a.w(this.TAG,"".concat(L," bytes unconsumed data remain when flush buffer, dropped"))}return this._stashUsed=0,this._stashByteStart=0,L}return 0},C.prototype._onLoaderComplete=function(S,b){this._flushStashBuffer(!0),this._onComplete&&this._onComplete(this._extraData)},C.prototype._onLoaderError=function(S,b){switch(a.a.e(this.TAG,"Loader error, code = ".concat(b.code,", msg = ").concat(b.msg)),this._flushStashBuffer(!1),this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,S=l.b.UNRECOVERABLE_EARLY_EOF),S){case l.b.EARLY_EOF:if(!this._config.isLive&&this._totalLength){var T=this._currentRange.to+1;return void(T<this._totalLength&&(a.a.w(this.TAG,"Connection lost, trying reconnect..."),this._isEarlyEofReconnecting=!0,this._internalSeek(T,!1)))}S=l.b.UNRECOVERABLE_EARLY_EOF;break;case l.b.UNRECOVERABLE_EARLY_EOF:case l.b.CONNECTING_TIMEOUT:case l.b.HTTP_STATUS_CODE_INVALID:case l.b.EXCEPTION:}if(!this._onError)throw new u.d("IOException: "+b.msg);this._onError(S,b)},C}();i.a=H},function(t,i,r){var s=function(){function a(){}return a.install=function(){Object.setPrototypeOf=Object.setPrototypeOf||function(o,l){return o.__proto__=l,o},Object.assign=Object.assign||function(o){if(o==null)throw new TypeError("Cannot convert undefined or null to object");for(var l=Object(o),c=1;c<arguments.length;c++){var u=arguments[c];if(u!=null)for(var d in u)u.hasOwnProperty(d)&&(l[d]=u[d])}return l},String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{value:function(o,l){var c=l>0?0|l:0;return this.substring(c,c+o.length)===o}}),typeof self.Promise!="function"&&r(21).polyfill()},a}();s.install(),i.a=s},function(t,i,r){var s=r(9),a=r.n(s),o=r(0),l=r(5),c=r(7),u=r(3),d=function(){function h(m){this.TAG="MSEController",this._config=m,this._emitter=new a.a,this._config.isLive&&this._config.autoCleanupSourceBuffer==null&&(this._config.autoCleanupSourceBuffer=!0),this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onStartStreaming:this._onStartStreaming.bind(this),onEndStreaming:this._onEndStreaming.bind(this),onQualityChange:this._onQualityChange.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)},this._useManagedMediaSource="ManagedMediaSource"in self&&!("MediaSource"in self),this._mediaSource=null,this._mediaSourceObjectURL=null,this._mediaElementProxy=null,this._isBufferFull=!1,this._hasPendingEos=!1,this._requireSetMediaDuration=!1,this._pendingMediaDuration=0,this._pendingSourceBufferInit=[],this._mimeTypes={video:null,audio:null},this._sourceBuffers={video:null,audio:null},this._lastInitSegments={video:null,audio:null},this._pendingSegments={video:[],audio:[]},this._pendingRemoveRanges={video:[],audio:[]}}return h.prototype.destroy=function(){this._mediaSource&&this.shutdown(),this._mediaSourceObjectURL&&this.revokeObjectURL(),this.e=null,this._emitter.removeAllListeners(),this._emitter=null},h.prototype.on=function(m,g){this._emitter.addListener(m,g)},h.prototype.off=function(m,g){this._emitter.removeListener(m,g)},h.prototype.initialize=function(m){if(this._mediaSource)throw new u.a("MediaSource has been attached to an HTMLMediaElement!");this._useManagedMediaSource&&o.a.v(this.TAG,"Using ManagedMediaSource");var g=this._mediaSource=this._useManagedMediaSource?new self.ManagedMediaSource:new self.MediaSource;g.addEventListener("sourceopen",this.e.onSourceOpen),g.addEventListener("sourceended",this.e.onSourceEnded),g.addEventListener("sourceclose",this.e.onSourceClose),this._useManagedMediaSource&&(g.addEventListener("startstreaming",this.e.onStartStreaming),g.addEventListener("endstreaming",this.e.onEndStreaming),g.addEventListener("qualitychange",this.e.onQualityChange)),this._mediaElementProxy=m},h.prototype.shutdown=function(){if(this._mediaSource){var m=this._mediaSource;for(var g in this._sourceBuffers){var v=this._pendingSegments[g];v.splice(0,v.length),this._pendingSegments[g]=null,this._pendingRemoveRanges[g]=null,this._lastInitSegments[g]=null;var x=this._sourceBuffers[g];if(x){if(m.readyState!=="closed"){try{m.removeSourceBuffer(x)}catch(E){o.a.e(this.TAG,E.message)}x.removeEventListener("error",this.e.onSourceBufferError),x.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)}this._mimeTypes[g]=null,this._sourceBuffers[g]=null}}if(m.readyState==="open")try{m.endOfStream()}catch(E){o.a.e(this.TAG,E.message)}this._mediaElementProxy=null,m.removeEventListener("sourceopen",this.e.onSourceOpen),m.removeEventListener("sourceended",this.e.onSourceEnded),m.removeEventListener("sourceclose",this.e.onSourceClose),this._useManagedMediaSource&&(m.removeEventListener("startstreaming",this.e.onStartStreaming),m.removeEventListener("endstreaming",this.e.onEndStreaming),m.removeEventListener("qualitychange",this.e.onQualityChange)),this._pendingSourceBufferInit=[],this._isBufferFull=!1,this._mediaSource=null}},h.prototype.isManagedMediaSource=function(){return this._useManagedMediaSource},h.prototype.getObject=function(){if(!this._mediaSource)throw new u.a("MediaSource has not been initialized yet!");return this._mediaSource},h.prototype.getHandle=function(){if(!this._mediaSource)throw new u.a("MediaSource has not been initialized yet!");return this._mediaSource.handle},h.prototype.getObjectURL=function(){if(!this._mediaSource)throw new u.a("MediaSource has not been initialized yet!");return this._mediaSourceObjectURL==null&&(this._mediaSourceObjectURL=URL.createObjectURL(this._mediaSource)),this._mediaSourceObjectURL},h.prototype.revokeObjectURL=function(){this._mediaSourceObjectURL&&(URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)},h.prototype.appendInitSegment=function(m,g){if(g===void 0&&(g=void 0),!this._mediaSource||this._mediaSource.readyState!=="open"||this._mediaSource.streaming===!1)return this._pendingSourceBufferInit.push(m),void this._pendingSegments[m.type].push(m);var v=m,x="".concat(v.container);v.codec&&v.codec.length>0&&(v.codec==="opus"&&l.a.safari&&(v.codec="Opus"),x+=";codecs=".concat(v.codec));var E=!1;if(o.a.v(this.TAG,"Received Initialization Segment, mimeType: "+x),this._lastInitSegments[v.type]=v,x!==this._mimeTypes[v.type]){if(this._mimeTypes[v.type])o.a.v(this.TAG,"Notice: ".concat(v.type," mimeType changed, origin: ").concat(this._mimeTypes[v.type],", target: ").concat(x));else{E=!0;try{var R=this._sourceBuffers[v.type]=this._mediaSource.addSourceBuffer(x);R.addEventListener("error",this.e.onSourceBufferError),R.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)}catch(k){return o.a.e(this.TAG,k.message),void this._emitter.emit(c.a.ERROR,{code:k.code,msg:k.message})}}this._mimeTypes[v.type]=x}g||this._pendingSegments[v.type].push(v),E||this._sourceBuffers[v.type]&&!this._sourceBuffers[v.type].updating&&this._doAppendSegments(),l.a.safari&&v.container==="audio/mpeg"&&v.mediaDuration>0&&(this._requireSetMediaDuration=!0,this._pendingMediaDuration=v.mediaDuration/1e3,this._updateMediaSourceDuration())},h.prototype.appendMediaSegment=function(m){var g=m;this._pendingSegments[g.type].push(g),this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()&&this._doCleanupSourceBuffer();var v=this._sourceBuffers[g.type];!v||v.updating||this._hasPendingRemoveRanges()||this._doAppendSegments()},h.prototype.flush=function(){for(var m in this._sourceBuffers)if(this._sourceBuffers[m]){var g=this._sourceBuffers[m];if(this._mediaSource.readyState==="open")try{g.abort()}catch(D){o.a.e(this.TAG,D.message)}var v=this._pendingSegments[m];if(v.splice(0,v.length),this._mediaSource.readyState!=="closed"){for(var x=0;x<g.buffered.length;x++){var E=g.buffered.start(x),R=g.buffered.end(x);this._pendingRemoveRanges[m].push({start:E,end:R})}if(g.updating||this._doRemoveRanges(),l.a.safari){var k=this._lastInitSegments[m];k&&(this._pendingSegments[m].push(k),g.updating||this._doAppendSegments())}}}},h.prototype.endOfStream=function(){var m=this._mediaSource,g=this._sourceBuffers;m&&m.readyState==="open"?g.video&&g.video.updating||g.audio&&g.audio.updating?this._hasPendingEos=!0:(this._hasPendingEos=!1,m.endOfStream()):m&&m.readyState==="closed"&&this._hasPendingSegments()&&(this._hasPendingEos=!0)},h.prototype._needCleanupSourceBuffer=function(){if(!this._config.autoCleanupSourceBuffer)return!1;var m=this._mediaElementProxy.getCurrentTime();for(var g in this._sourceBuffers){var v=this._sourceBuffers[g];if(v){var x=v.buffered;if(x.length>=1&&m-x.start(0)>=this._config.autoCleanupMaxBackwardDuration)return!0}}return!1},h.prototype._doCleanupSourceBuffer=function(){var m=this._mediaElementProxy.getCurrentTime();for(var g in this._sourceBuffers){var v=this._sourceBuffers[g];if(v){for(var x=v.buffered,E=!1,R=0;R<x.length;R++){var k=x.start(R),D=x.end(R);if(k<=m&&m<D+3){if(m-k>=this._config.autoCleanupMaxBackwardDuration){E=!0;var V=m-this._config.autoCleanupMinBackwardDuration;this._pendingRemoveRanges[g].push({start:k,end:V})}}else D<m&&(E=!0,this._pendingRemoveRanges[g].push({start:k,end:D}))}E&&!v.updating&&this._doRemoveRanges()}}},h.prototype._updateMediaSourceDuration=function(){var m=this._sourceBuffers;if(this._mediaElementProxy.getReadyState()!==0&&this._mediaSource.readyState==="open"&&!(m.video&&m.video.updating||m.audio&&m.audio.updating)){var g=this._mediaSource.duration,v=this._pendingMediaDuration;v>0&&(isNaN(g)||v>g)&&(o.a.v(this.TAG,"Update MediaSource duration from ".concat(g," to ").concat(v)),this._mediaSource.duration=v),this._requireSetMediaDuration=!1,this._pendingMediaDuration=0}},h.prototype._doRemoveRanges=function(){for(var m in this._pendingRemoveRanges)if(this._sourceBuffers[m]&&!this._sourceBuffers[m].updating)for(var g=this._sourceBuffers[m],v=this._pendingRemoveRanges[m];v.length&&!g.updating;){var x=v.shift();g.remove(x.start,x.end)}},h.prototype._doAppendSegments=function(){var m=this._pendingSegments;for(var g in m)if(this._sourceBuffers[g]&&!this._sourceBuffers[g].updating&&this._mediaSource.streaming!==!1&&m[g].length>0){var v=m[g].shift();if(typeof v.timestampOffset=="number"&&isFinite(v.timestampOffset)){var x=this._sourceBuffers[g].timestampOffset,E=v.timestampOffset/1e3;Math.abs(x-E)>.1&&(o.a.v(this.TAG,"Update MPEG audio timestampOffset from ".concat(x," to ").concat(E)),this._sourceBuffers[g].timestampOffset=E),delete v.timestampOffset}if(!v.data||v.data.byteLength===0)continue;try{this._sourceBuffers[g].appendBuffer(v.data),this._isBufferFull=!1}catch(R){this._pendingSegments[g].unshift(v),R.code===22?(this._isBufferFull||this._emitter.emit(c.a.BUFFER_FULL),this._isBufferFull=!0):(o.a.e(this.TAG,R.message),this._emitter.emit(c.a.ERROR,{code:R.code,msg:R.message}))}}},h.prototype._onSourceOpen=function(){if(o.a.v(this.TAG,"MediaSource onSourceOpen"),this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._pendingSourceBufferInit.length>0)for(var m=this._pendingSourceBufferInit;m.length;){var g=m.shift();this.appendInitSegment(g,!0)}this._hasPendingSegments()&&this._doAppendSegments(),this._emitter.emit(c.a.SOURCE_OPEN)},h.prototype._onStartStreaming=function(){o.a.v(this.TAG,"ManagedMediaSource onStartStreaming"),this._emitter.emit(c.a.START_STREAMING)},h.prototype._onEndStreaming=function(){o.a.v(this.TAG,"ManagedMediaSource onEndStreaming"),this._emitter.emit(c.a.END_STREAMING)},h.prototype._onQualityChange=function(){o.a.v(this.TAG,"ManagedMediaSource onQualityChange")},h.prototype._onSourceEnded=function(){o.a.v(this.TAG,"MediaSource onSourceEnded")},h.prototype._onSourceClose=function(){o.a.v(this.TAG,"MediaSource onSourceClose"),this._mediaSource&&this.e!=null&&(this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this.e.onSourceClose),this._useManagedMediaSource&&(this._mediaSource.removeEventListener("startstreaming",this.e.onStartStreaming),this._mediaSource.removeEventListener("endstreaming",this.e.onEndStreaming),this._mediaSource.removeEventListener("qualitychange",this.e.onQualityChange)))},h.prototype._hasPendingSegments=function(){var m=this._pendingSegments;return m.video.length>0||m.audio.length>0},h.prototype._hasPendingRemoveRanges=function(){var m=this._pendingRemoveRanges;return m.video.length>0||m.audio.length>0},h.prototype._onSourceBufferUpdateEnd=function(){this._requireSetMediaDuration?this._updateMediaSourceDuration():this._hasPendingRemoveRanges()?this._doRemoveRanges():this._hasPendingSegments()?this._doAppendSegments():this._hasPendingEos&&this.endOfStream(),this._emitter.emit(c.a.UPDATE_END)},h.prototype._onSourceBufferError=function(m){o.a.e(this.TAG,"SourceBuffer Error: ".concat(m))},h}();i.a=d},function(t,i,r){var s=r(9),a=r.n(s),o=r(18),l=r.n(o),c=r(0),u=r(8),d=r(13),h=r(1),m=(r(19),r(12)),g=function(){function v(x,E){if(this.TAG="Transmuxer",this._emitter=new a.a,E.enableWorker&&typeof Worker<"u")try{this._worker=l()(19),this._workerDestroying=!1,this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",param:[x,E]}),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)},u.a.registerListener(this.e.onLoggingConfigChanged),this._worker.postMessage({cmd:"logging_config",param:u.a.getConfig()})}catch{c.a.e(this.TAG,"Error while initialize transmuxing worker, fallback to inline transmuxing"),this._worker=null,this._controller=new d.a(x,E)}else this._controller=new d.a(x,E);if(this._controller){var R=this._controller;R.on(h.a.IO_ERROR,this._onIOError.bind(this)),R.on(h.a.DEMUX_ERROR,this._onDemuxError.bind(this)),R.on(h.a.INIT_SEGMENT,this._onInitSegment.bind(this)),R.on(h.a.MEDIA_SEGMENT,this._onMediaSegment.bind(this)),R.on(h.a.LOADING_COMPLETE,this._onLoadingComplete.bind(this)),R.on(h.a.RECOVERED_EARLY_EOF,this._onRecoveredEarlyEof.bind(this)),R.on(h.a.MEDIA_INFO,this._onMediaInfo.bind(this)),R.on(h.a.METADATA_ARRIVED,this._onMetaDataArrived.bind(this)),R.on(h.a.SCRIPTDATA_ARRIVED,this._onScriptDataArrived.bind(this)),R.on(h.a.TIMED_ID3_METADATA_ARRIVED,this._onTimedID3MetadataArrived.bind(this)),R.on(h.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,this._onSynchronousKLVMetadataArrived.bind(this)),R.on(h.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,this._onAsynchronousKLVMetadataArrived.bind(this)),R.on(h.a.SMPTE2038_METADATA_ARRIVED,this._onSMPTE2038MetadataArrived.bind(this)),R.on(h.a.SCTE35_METADATA_ARRIVED,this._onSCTE35MetadataArrived.bind(this)),R.on(h.a.PES_PRIVATE_DATA_DESCRIPTOR,this._onPESPrivateDataDescriptor.bind(this)),R.on(h.a.PES_PRIVATE_DATA_ARRIVED,this._onPESPrivateDataArrived.bind(this)),R.on(h.a.STATISTICS_INFO,this._onStatisticsInfo.bind(this)),R.on(h.a.RECOMMEND_SEEKPOINT,this._onRecommendSeekpoint.bind(this))}}return v.prototype.destroy=function(){this._worker?this._workerDestroying||(this._workerDestroying=!0,this._worker.postMessage({cmd:"destroy"}),u.a.removeListener(this.e.onLoggingConfigChanged),this.e=null):(this._controller.destroy(),this._controller=null),this._emitter.removeAllListeners(),this._emitter=null},v.prototype.on=function(x,E){this._emitter.addListener(x,E)},v.prototype.off=function(x,E){this._emitter.removeListener(x,E)},v.prototype.hasWorker=function(){return this._worker!=null},v.prototype.open=function(){this._worker?this._worker.postMessage({cmd:"start"}):this._controller.start()},v.prototype.close=function(){this._worker?this._worker.postMessage({cmd:"stop"}):this._controller.stop()},v.prototype.seek=function(x){this._worker?this._worker.postMessage({cmd:"seek",param:x}):this._controller.seek(x)},v.prototype.pause=function(){this._worker?this._worker.postMessage({cmd:"pause"}):this._controller.pause()},v.prototype.resume=function(){this._worker?this._worker.postMessage({cmd:"resume"}):this._controller.resume()},v.prototype._onInitSegment=function(x,E){var R=this;Promise.resolve().then(function(){R._emitter.emit(h.a.INIT_SEGMENT,x,E)})},v.prototype._onMediaSegment=function(x,E){var R=this;Promise.resolve().then(function(){R._emitter.emit(h.a.MEDIA_SEGMENT,x,E)})},v.prototype._onLoadingComplete=function(){var x=this;Promise.resolve().then(function(){x._emitter.emit(h.a.LOADING_COMPLETE)})},v.prototype._onRecoveredEarlyEof=function(){var x=this;Promise.resolve().then(function(){x._emitter.emit(h.a.RECOVERED_EARLY_EOF)})},v.prototype._onMediaInfo=function(x){var E=this;Promise.resolve().then(function(){E._emitter.emit(h.a.MEDIA_INFO,x)})},v.prototype._onMetaDataArrived=function(x){var E=this;Promise.resolve().then(function(){E._emitter.emit(h.a.METADATA_ARRIVED,x)})},v.prototype._onScriptDataArrived=function(x){var E=this;Promise.resolve().then(function(){E._emitter.emit(h.a.SCRIPTDATA_ARRIVED,x)})},v.prototype._onTimedID3MetadataArrived=function(x){var E=this;Promise.resolve().then(function(){E._emitter.emit(h.a.TIMED_ID3_METADATA_ARRIVED,x)})},v.prototype._onSynchronousKLVMetadataArrived=function(x){var E=this;Promise.resolve().then(function(){E._emitter.emit(h.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,x)})},v.prototype._onAsynchronousKLVMetadataArrived=function(x){var E=this;Promise.resolve().then(function(){E._emitter.emit(h.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,x)})},v.prototype._onSMPTE2038MetadataArrived=function(x){var E=this;Promise.resolve().then(function(){E._emitter.emit(h.a.SMPTE2038_METADATA_ARRIVED,x)})},v.prototype._onSCTE35MetadataArrived=function(x){var E=this;Promise.resolve().then(function(){E._emitter.emit(h.a.SCTE35_METADATA_ARRIVED,x)})},v.prototype._onPESPrivateDataDescriptor=function(x){var E=this;Promise.resolve().then(function(){E._emitter.emit(h.a.PES_PRIVATE_DATA_DESCRIPTOR,x)})},v.prototype._onPESPrivateDataArrived=function(x){var E=this;Promise.resolve().then(function(){E._emitter.emit(h.a.PES_PRIVATE_DATA_ARRIVED,x)})},v.prototype._onStatisticsInfo=function(x){var E=this;Promise.resolve().then(function(){E._emitter.emit(h.a.STATISTICS_INFO,x)})},v.prototype._onIOError=function(x,E){var R=this;Promise.resolve().then(function(){R._emitter.emit(h.a.IO_ERROR,x,E)})},v.prototype._onDemuxError=function(x,E){var R=this;Promise.resolve().then(function(){R._emitter.emit(h.a.DEMUX_ERROR,x,E)})},v.prototype._onRecommendSeekpoint=function(x){var E=this;Promise.resolve().then(function(){E._emitter.emit(h.a.RECOMMEND_SEEKPOINT,x)})},v.prototype._onLoggingConfigChanged=function(x){this._worker&&this._worker.postMessage({cmd:"logging_config",param:x})},v.prototype._onWorkerMessage=function(x){var E=x.data,R=E.data;if(E.msg==="destroyed"||this._workerDestroying)return this._workerDestroying=!1,this._worker.terminate(),void(this._worker=null);switch(E.msg){case h.a.INIT_SEGMENT:case h.a.MEDIA_SEGMENT:this._emitter.emit(E.msg,R.type,R.data);break;case h.a.LOADING_COMPLETE:case h.a.RECOVERED_EARLY_EOF:this._emitter.emit(E.msg);break;case h.a.MEDIA_INFO:Object.setPrototypeOf(R,m.a.prototype),this._emitter.emit(E.msg,R);break;case h.a.METADATA_ARRIVED:case h.a.SCRIPTDATA_ARRIVED:case h.a.TIMED_ID3_METADATA_ARRIVED:case h.a.SYNCHRONOUS_KLV_METADATA_ARRIVED:case h.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED:case h.a.SMPTE2038_METADATA_ARRIVED:case h.a.SCTE35_METADATA_ARRIVED:case h.a.PES_PRIVATE_DATA_DESCRIPTOR:case h.a.PES_PRIVATE_DATA_ARRIVED:case h.a.STATISTICS_INFO:this._emitter.emit(E.msg,R);break;case h.a.IO_ERROR:case h.a.DEMUX_ERROR:this._emitter.emit(E.msg,R.type,R.info);break;case h.a.RECOMMEND_SEEKPOINT:this._emitter.emit(E.msg,R);break;case"logcat_callback":c.a.emitter.emit("log",R.type,R.logcat)}},v}();i.a=g},function(t,i,r){function s(c){var u={};function d(m){if(u[m])return u[m].exports;var g=u[m]={i:m,l:!1,exports:{}};return c[m].call(g.exports,g,g.exports,d),g.l=!0,g.exports}d.m=c,d.c=u,d.i=function(m){return m},d.d=function(m,g,v){d.o(m,g)||Object.defineProperty(m,g,{configurable:!1,enumerable:!0,get:v})},d.r=function(m){Object.defineProperty(m,"__esModule",{value:!0})},d.n=function(m){var g=m&&m.__esModule?function(){return m.default}:function(){return m};return d.d(g,"a",g),g},d.o=function(m,g){return Object.prototype.hasOwnProperty.call(m,g)},d.p="/",d.oe=function(m){throw console.error(m),m};var h=d(d.s=ENTRY_MODULE);return h.default||h}function a(c){return(c+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function o(c,u,d){var h={};h[d]=[];var m=u.toString(),g=m.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!g)return h;for(var v,x=g[1],E=new RegExp("(\\\\n|\\W)"+a(x)+"\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)","g");v=E.exec(m);)v[3]!=="dll-reference"&&h[d].push(v[3]);for(E=new RegExp("\\("+a(x)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)',"g");v=E.exec(m);)c[v[2]]||(h[d].push(v[1]),c[v[2]]=r(v[1]).m),h[v[2]]=h[v[2]]||[],h[v[2]].push(v[4]);for(var R,k=Object.keys(h),D=0;D<k.length;D++)for(var V=0;V<h[k[D]].length;V++)R=h[k[D]][V],isNaN(1*R)||(h[k[D]][V]=1*h[k[D]][V]);return h}function l(c){return Object.keys(c).reduce(function(u,d){return u||c[d].length>0},!1)}t.exports=function(c,u){u=u||{};var d={main:r.m},h=u.all?{main:Object.keys(d.main)}:function(E,R){for(var k={main:[R]},D={main:[]},V={main:{}};l(k);)for(var H=Object.keys(k),C=0;C<H.length;C++){var S=H[C],b=k[S].pop();if(V[S]=V[S]||{},!V[S][b]&&E[S][b]){V[S][b]=!0,D[S]=D[S]||[],D[S].push(b);for(var T=o(E,E[S][b],S),L=Object.keys(T),F=0;F<L.length;F++)k[L[F]]=k[L[F]]||[],k[L[F]]=k[L[F]].concat(T[L[F]])}}return D}(d,c),m="";Object.keys(h).filter(function(E){return E!=="main"}).forEach(function(E){for(var R=0;h[E][R];)R++;h[E].push(R),d[E][R]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",m=m+"var "+E+" = ("+s.toString().replace("ENTRY_MODULE",JSON.stringify(R))+")({"+h[E].map(function(k){return JSON.stringify(k)+": "+d[E][k].toString()}).join(",")+`});
`}),m=m+"new (("+s.toString().replace("ENTRY_MODULE",JSON.stringify(c))+")({"+h.main.map(function(E){return JSON.stringify(E)+": "+d.main[E].toString()}).join(",")+"}))(self);";var g=new self.Blob([m],{type:"text/javascript"});if(u.bare)return g;var v=(self.URL||self.webkitURL||self.mozURL||self.msURL).createObjectURL(g),x=new self.Worker(v);return x.objectURL=v,x}},function(t,i,r){r.r(i),r(0);var s=r(8),a=r(15),o=r(13),l=r(1);i.default=function(c){var u=null,d=(function(Z,ie){c.postMessage({msg:"logcat_callback",data:{type:Z,logcat:ie}})}).bind(this);function h(Z,ie){var le={msg:l.a.INIT_SEGMENT,data:{type:Z,data:ie}};c.postMessage(le,[ie.data])}function m(Z,ie){var le={msg:l.a.MEDIA_SEGMENT,data:{type:Z,data:ie}};c.postMessage(le,[ie.data])}function g(){var Z={msg:l.a.LOADING_COMPLETE};c.postMessage(Z)}function v(){var Z={msg:l.a.RECOVERED_EARLY_EOF};c.postMessage(Z)}function x(Z){var ie={msg:l.a.MEDIA_INFO,data:Z};c.postMessage(ie)}function E(Z){var ie={msg:l.a.METADATA_ARRIVED,data:Z};c.postMessage(ie)}function R(Z){var ie={msg:l.a.SCRIPTDATA_ARRIVED,data:Z};c.postMessage(ie)}function k(Z){var ie={msg:l.a.TIMED_ID3_METADATA_ARRIVED,data:Z};c.postMessage(ie)}function D(Z){var ie={msg:l.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,data:Z};c.postMessage(ie)}function V(Z){var ie={msg:l.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,data:Z};c.postMessage(ie)}function H(Z){var ie={msg:l.a.SMPTE2038_METADATA_ARRIVED,data:Z};c.postMessage(ie)}function C(Z){var ie={msg:l.a.SCTE35_METADATA_ARRIVED,data:Z};c.postMessage(ie)}function S(Z){var ie={msg:l.a.PES_PRIVATE_DATA_DESCRIPTOR,data:Z};c.postMessage(ie)}function b(Z){var ie={msg:l.a.PES_PRIVATE_DATA_ARRIVED,data:Z};c.postMessage(ie)}function T(Z){var ie={msg:l.a.STATISTICS_INFO,data:Z};c.postMessage(ie)}function L(Z,ie){c.postMessage({msg:l.a.IO_ERROR,data:{type:Z,info:ie}})}function F(Z,ie){c.postMessage({msg:l.a.DEMUX_ERROR,data:{type:Z,info:ie}})}function U(Z){c.postMessage({msg:l.a.RECOMMEND_SEEKPOINT,data:Z})}a.a.install(),c.addEventListener("message",function(Z){switch(Z.data.cmd){case"init":(u=new o.a(Z.data.param[0],Z.data.param[1])).on(l.a.IO_ERROR,L.bind(this)),u.on(l.a.DEMUX_ERROR,F.bind(this)),u.on(l.a.INIT_SEGMENT,h.bind(this)),u.on(l.a.MEDIA_SEGMENT,m.bind(this)),u.on(l.a.LOADING_COMPLETE,g.bind(this)),u.on(l.a.RECOVERED_EARLY_EOF,v.bind(this)),u.on(l.a.MEDIA_INFO,x.bind(this)),u.on(l.a.METADATA_ARRIVED,E.bind(this)),u.on(l.a.SCRIPTDATA_ARRIVED,R.bind(this)),u.on(l.a.TIMED_ID3_METADATA_ARRIVED,k.bind(this)),u.on(l.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,D.bind(this)),u.on(l.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,V.bind(this)),u.on(l.a.SMPTE2038_METADATA_ARRIVED,H.bind(this)),u.on(l.a.SCTE35_METADATA_ARRIVED,C.bind(this)),u.on(l.a.PES_PRIVATE_DATA_DESCRIPTOR,S.bind(this)),u.on(l.a.PES_PRIVATE_DATA_ARRIVED,b.bind(this)),u.on(l.a.STATISTICS_INFO,T.bind(this)),u.on(l.a.RECOMMEND_SEEKPOINT,U.bind(this));break;case"destroy":u&&(u.destroy(),u=null),c.postMessage({msg:"destroyed"});break;case"start":u.start();break;case"stop":u.stop();break;case"seek":u.seek(Z.data.param);break;case"pause":u.pause();break;case"resume":u.resume();break;case"logging_config":var ie=Z.data.param;s.a.applyConfig(ie),ie.enableCallback===!0?s.a.addLogListener(d):s.a.removeLogListener(d)}})}},function(t,i,r){t.exports=r(25).default},function(t,i,r){(function(s,a){/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */var o;o=function(){function l(ce){return typeof ce=="function"}var c=Array.isArray?Array.isArray:function(ce){return Object.prototype.toString.call(ce)==="[object Array]"},u=0,d=void 0,h=void 0,m=function(ce,pe){D[u]=ce,D[u+1]=pe,(u+=2)===2&&(h?h(V):T())},g=typeof window<"u"?window:void 0,v=g||{},x=v.MutationObserver||v.WebKitMutationObserver,E=typeof self>"u"&&s!==void 0&&{}.toString.call(s)==="[object process]",R=typeof Uint8ClampedArray<"u"&&typeof importScripts<"u"&&typeof MessageChannel<"u";function k(){var ce=setTimeout;return function(){return ce(V,1)}}var D=new Array(1e3);function V(){for(var ce=0;ce<u;ce+=2)(0,D[ce])(D[ce+1]),D[ce]=void 0,D[ce+1]=void 0;u=0}var H,C,S,b,T=void 0;function L(ce,pe){var Ie=this,Le=new this.constructor(Z);Le[U]===void 0&&ve(Le);var ke=Ie._state;if(ke){var ze=arguments[ke-1];m(function(){return Q(ke,Le,ze,Ie._result)})}else $(Ie,Le,ce,pe);return Le}function F(ce){if(ce&&typeof ce=="object"&&ce.constructor===this)return ce;var pe=new this(Z);return le(pe,ce),pe}E?T=function(){return s.nextTick(V)}:x?(C=0,S=new x(V),b=document.createTextNode(""),S.observe(b,{characterData:!0}),T=function(){b.data=C=++C%2}):R?((H=new MessageChannel).port1.onmessage=V,T=function(){return H.port2.postMessage(0)}):T=g===void 0?function(){try{var ce=Function("return this")().require("vertx");return(d=ce.runOnLoop||ce.runOnContext)!==void 0?function(){d(V)}:k()}catch{return k()}}():k();var U=Math.random().toString(36).substring(2);function Z(){}function ie(ce,pe,Ie){pe.constructor===ce.constructor&&Ie===L&&pe.constructor.resolve===F?function(Le,ke){ke._state===1?te(Le,ke._result):ke._state===2?j(Le,ke._result):$(ke,void 0,function(ze){return le(Le,ze)},function(ze){return j(Le,ze)})}(ce,pe):Ie===void 0?te(ce,pe):l(Ie)?function(Le,ke,ze){m(function(ft){var gt=!1,dn=function(Oe,Et,$t,Sn){try{Oe.call(Et,$t,Sn)}catch(Vt){return Vt}}(ze,ke,function(Oe){gt||(gt=!0,ke!==Oe?le(ft,Oe):te(ft,Oe))},function(Oe){gt||(gt=!0,j(ft,Oe))},ft._label);!gt&&dn&&(gt=!0,j(ft,dn))},Le)}(ce,pe,Ie):te(ce,pe)}function le(ce,pe){if(ce===pe)j(ce,new TypeError("You cannot resolve a promise with itself"));else if(ke=typeof(Le=pe),Le===null||ke!=="object"&&ke!=="function")te(ce,pe);else{var Ie=void 0;try{Ie=pe.then}catch(ze){return void j(ce,ze)}ie(ce,pe,Ie)}var Le,ke}function ge(ce){ce._onerror&&ce._onerror(ce._result),q(ce)}function te(ce,pe){ce._state===void 0&&(ce._result=pe,ce._state=1,ce._subscribers.length!==0&&m(q,ce))}function j(ce,pe){ce._state===void 0&&(ce._state=2,ce._result=pe,m(ge,ce))}function $(ce,pe,Ie,Le){var ke=ce._subscribers,ze=ke.length;ce._onerror=null,ke[ze]=pe,ke[ze+1]=Ie,ke[ze+2]=Le,ze===0&&ce._state&&m(q,ce)}function q(ce){var pe=ce._subscribers,Ie=ce._state;if(pe.length!==0){for(var Le=void 0,ke=void 0,ze=ce._result,ft=0;ft<pe.length;ft+=3)Le=pe[ft],ke=pe[ft+Ie],Le?Q(Ie,Le,ke,ze):ke(ze);ce._subscribers.length=0}}function Q(ce,pe,Ie,Le){var ke=l(Ie),ze=void 0,ft=void 0,gt=!0;if(ke){try{ze=Ie(Le)}catch(dn){gt=!1,ft=dn}if(pe===ze)return void j(pe,new TypeError("A promises callback cannot return that same promise."))}else ze=Le;pe._state!==void 0||(ke&&gt?le(pe,ze):gt===!1?j(pe,ft):ce===1?te(pe,ze):ce===2&&j(pe,ze))}var fe=0;function ve(ce){ce[U]=fe++,ce._state=void 0,ce._result=void 0,ce._subscribers=[]}var be=function(){function ce(pe,Ie){this._instanceConstructor=pe,this.promise=new pe(Z),this.promise[U]||ve(this.promise),c(Ie)?(this.length=Ie.length,this._remaining=Ie.length,this._result=new Array(this.length),this.length===0?te(this.promise,this._result):(this.length=this.length||0,this._enumerate(Ie),this._remaining===0&&te(this.promise,this._result))):j(this.promise,new Error("Array Methods must be provided an Array"))}return ce.prototype._enumerate=function(pe){for(var Ie=0;this._state===void 0&&Ie<pe.length;Ie++)this._eachEntry(pe[Ie],Ie)},ce.prototype._eachEntry=function(pe,Ie){var Le=this._instanceConstructor,ke=Le.resolve;if(ke===F){var ze=void 0,ft=void 0,gt=!1;try{ze=pe.then}catch(Oe){gt=!0,ft=Oe}if(ze===L&&pe._state!==void 0)this._settledAt(pe._state,Ie,pe._result);else if(typeof ze!="function")this._remaining--,this._result[Ie]=pe;else if(Le===xe){var dn=new Le(Z);gt?j(dn,ft):ie(dn,pe,ze),this._willSettleAt(dn,Ie)}else this._willSettleAt(new Le(function(Oe){return Oe(pe)}),Ie)}else this._willSettleAt(ke(pe),Ie)},ce.prototype._settledAt=function(pe,Ie,Le){var ke=this.promise;ke._state===void 0&&(this._remaining--,pe===2?j(ke,Le):this._result[Ie]=Le),this._remaining===0&&te(ke,this._result)},ce.prototype._willSettleAt=function(pe,Ie){var Le=this;$(pe,void 0,function(ke){return Le._settledAt(1,Ie,ke)},function(ke){return Le._settledAt(2,Ie,ke)})},ce}(),xe=function(){function ce(pe){this[U]=fe++,this._result=this._state=void 0,this._subscribers=[],Z!==pe&&(typeof pe!="function"&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof ce?function(Ie,Le){try{Le(function(ke){le(Ie,ke)},function(ke){j(Ie,ke)})}catch(ke){j(Ie,ke)}}(this,pe):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return ce.prototype.catch=function(pe){return this.then(null,pe)},ce.prototype.finally=function(pe){var Ie=this.constructor;return l(pe)?this.then(function(Le){return Ie.resolve(pe()).then(function(){return Le})},function(Le){return Ie.resolve(pe()).then(function(){throw Le})}):this.then(pe,pe)},ce}();return xe.prototype.then=L,xe.all=function(ce){return new be(this,ce).promise},xe.race=function(ce){var pe=this;return c(ce)?new pe(function(Ie,Le){for(var ke=ce.length,ze=0;ze<ke;ze++)pe.resolve(ce[ze]).then(Ie,Le)}):new pe(function(Ie,Le){return Le(new TypeError("You must pass an array to race."))})},xe.resolve=F,xe.reject=function(ce){var pe=new this(Z);return j(pe,ce),pe},xe._setScheduler=function(ce){h=ce},xe._setAsap=function(ce){m=ce},xe._asap=m,xe.polyfill=function(){var ce=void 0;if(a!==void 0)ce=a;else if(typeof self<"u")ce=self;else try{ce=Function("return this")()}catch{throw new Error("polyfill failed because global object is unavailable in this environment")}var pe=ce.Promise;if(pe){var Ie=null;try{Ie=Object.prototype.toString.call(pe.resolve())}catch{}if(Ie==="[object Promise]"&&!pe.cast)return}ce.Promise=xe},xe.Promise=xe,xe},t.exports=o()}).call(this,r(22),r(23))},function(t,i){var r,s,a=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function l(){throw new Error("clearTimeout has not been defined")}function c(R){if(r===setTimeout)return setTimeout(R,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(R,0);try{return r(R,0)}catch{try{return r.call(null,R,0)}catch{return r.call(this,R,0)}}}(function(){try{r=typeof setTimeout=="function"?setTimeout:o}catch{r=o}try{s=typeof clearTimeout=="function"?clearTimeout:l}catch{s=l}})();var u,d=[],h=!1,m=-1;function g(){h&&u&&(h=!1,u.length?d=u.concat(d):m=-1,d.length&&v())}function v(){if(!h){var R=c(g);h=!0;for(var k=d.length;k;){for(u=d,d=[];++m<k;)u&&u[m].run();m=-1,k=d.length}u=null,h=!1,function(D){if(s===clearTimeout)return clearTimeout(D);if((s===l||!s)&&clearTimeout)return s=clearTimeout,clearTimeout(D);try{s(D)}catch{try{return s.call(null,D)}catch{return s.call(this,D)}}}(R)}}function x(R,k){this.fun=R,this.array=k}function E(){}a.nextTick=function(R){var k=new Array(arguments.length-1);if(arguments.length>1)for(var D=1;D<arguments.length;D++)k[D-1]=arguments[D];d.push(new x(R,k)),d.length!==1||h||c(v)},x.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=E,a.addListener=E,a.once=E,a.off=E,a.removeListener=E,a.removeAllListeners=E,a.emit=E,a.prependListener=E,a.prependOnceListener=E,a.listeners=function(R){return[]},a.binding=function(R){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(R){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},function(t,i){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch{typeof window=="object"&&(r=window)}t.exports=r},function(t,i,r){r.r(i);var s=r(0),a=r(8),o=r(3),l=r(7),c=r(16),u=r(17),d=r(1),h=r(4),m=r(10);i.default=function(g){var v="PlayerEngineWorker",x=(function(j,$){g.postMessage({msg:"logcat_callback",type:j,logcat:$})}).bind(void 0),E=null,R=null,k=null,D=null,V=!1,H=!1,C=0,S=0,b=!1;function T(){k&&(k.shutdown(),k.destroy(),k=null)}function L(){if(E==null||R==null)throw new o.a("Worker not initialized");if(D)throw new o.a("Transmuxer has been initialized");H||(!R.deferLoadAfterSourceOpen||V?((D=new u.a(E,R)).on(d.a.INIT_SEGMENT,function(j,$){k.appendInitSegment($)}),D.on(d.a.MEDIA_SEGMENT,function(j,$){k.appendMediaSegment($),g.postMessage({msg:"buffered_position_changed",buffered_position_milliseconds:$.info.endDts})}),D.on(d.a.LOADING_COMPLETE,function(){k.endOfStream(),g.postMessage({msg:"player_event",event:h.a.LOADING_COMPLETE})}),D.on(d.a.RECOVERED_EARLY_EOF,function(){g.postMessage({msg:"player_event",event:h.a.RECOVERED_EARLY_EOF})}),D.on(d.a.IO_ERROR,function(j,$){g.postMessage({msg:"player_event",event:h.a.ERROR,error_type:m.b.NETWORK_ERROR,error_detail:j,info:$})}),D.on(d.a.DEMUX_ERROR,function(j,$){g.postMessage({msg:"player_event",event:h.a.ERROR,error_type:m.b.MEDIA_ERROR,error_detail:j,info:$})}),D.on(d.a.MEDIA_INFO,function(j){ge(d.a.MEDIA_INFO,j)}),D.on(d.a.STATISTICS_INFO,function(j){ge(d.a.STATISTICS_INFO,j)}),D.on(d.a.RECOMMEND_SEEKPOINT,function(j){(function($){g.postMessage({msg:"transmuxing_event",event:d.a.RECOMMEND_SEEKPOINT,milliseconds:$})})(j)}),D.on(d.a.METADATA_ARRIVED,function(j){te(h.a.METADATA_ARRIVED,j)}),D.on(d.a.SCRIPTDATA_ARRIVED,function(j){te(h.a.SCRIPTDATA_ARRIVED,j)}),D.on(d.a.TIMED_ID3_METADATA_ARRIVED,function(j){te(h.a.TIMED_ID3_METADATA_ARRIVED,j)}),D.on(d.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,function(j){te(h.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,j)}),D.on(d.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,function(j){te(h.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,j)}),D.on(d.a.SMPTE2038_METADATA_ARRIVED,function(j){te(h.a.SMPTE2038_METADATA_ARRIVED,j)}),D.on(d.a.SCTE35_METADATA_ARRIVED,function(j){te(h.a.SCTE35_METADATA_ARRIVED,j)}),D.on(d.a.PES_PRIVATE_DATA_DESCRIPTOR,function(j){te(h.a.PES_PRIVATE_DATA_DESCRIPTOR,j)}),D.on(d.a.PES_PRIVATE_DATA_ARRIVED,function(j){te(h.a.PES_PRIVATE_DATA_ARRIVED,j)}),D.open()):H=!0)}function F(){k&&k.flush(),D&&(D.close(),D.destroy(),D=null)}function U(){V=!0,H&&(H=!1,L())}function Z(){g.postMessage({msg:"mse_event",event:l.a.UPDATE_END})}function ie(){s.a.v(v,"MSE SourceBuffer is full, report to main thread"),g.postMessage({msg:"mse_event",event:l.a.BUFFER_FULL})}function le(j){g.postMessage({msg:"player_event",event:h.a.ERROR,error_type:m.b.MEDIA_ERROR,error_detail:m.b.MEDIA_MSE_ERROR,info:j})}function ge(j,$){g.postMessage({msg:"transmuxing_event",event:j,info:$})}function te(j,$){g.postMessage({msg:"player_event",event:j,extraData:$})}g.addEventListener("message",function(j){if(!b){var $=j.data;switch($.cmd){case"logging_config":var q=$;a.a.applyConfig(q.logging_config),q.logging_config.enableCallback===!0?a.a.addLogListener(x):a.a.removeLogListener(x);break;case"init":E=(q=$).media_data_source,R=q.config;break;case"destroy":(function(){D&&F(),k&&T(),b=!0,g.postMessage({msg:"destroyed"})})();break;case"initialize_mse":(function(){s.a.v(v,"Initializing MediaSource in DedicatedWorker"),(k=new c.a(R)).on(l.a.SOURCE_OPEN,U.bind(this)),k.on(l.a.UPDATE_END,Z.bind(this)),k.on(l.a.BUFFER_FULL,ie.bind(this)),k.on(l.a.ERROR,le.bind(this)),k.initialize({getCurrentTime:function(){return C},getReadyState:function(){return S}});var Q=k.getHandle();g.postMessage({msg:"mse_init",handle:Q},[Q])})();break;case"shutdown_mse":T();break;case"load":L();break;case"unload":F();break;case"unbuffered_seek":q=$,k.flush(),D.seek(q.milliseconds);break;case"timeupdate":C=(q=$).current_time;break;case"readystatechange":S=(q=$).ready_state;break;case"pause_transmuxer":D.pause();break;case"resume_transmuxer":D.resume()}}})}},function(t,i,r){r.r(i);var s=r(15),a=r(14),o={enableWorker:!1,enableWorkerForMSE:!1,enableStashBuffer:!0,stashInitialSize:void 0,isLive:!1,liveBufferLatencyChasing:!1,liveBufferLatencyChasingOnPaused:!1,liveBufferLatencyMaxLatency:1.5,liveBufferLatencyMinRemain:.5,liveSync:!1,liveSyncMaxLatency:1.2,liveSyncTargetLatency:.8,liveSyncPlaybackRate:1.2,lazyLoad:!0,lazyLoadMaxDuration:180,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:!0,autoCleanupMaxBackwardDuration:180,autoCleanupMinBackwardDuration:120,statisticsInfoReportInterval:600,fixAudioTimestampGap:!0,accurateSeek:!1,seekType:"range",seekParamStart:"bstart",seekParamEnd:"bend",rangeLoadZeroStart:!1,customSeekHandler:void 0,reuseRedirectedURL:!1,headers:void 0,customLoader:void 0};function l(){return Object.assign({},o)}var c=function(){function j(){}return j.supportMSEH264Playback=function(){var $=self.MediaSource&&self.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),q=self.ManagedMediaSource&&self.ManagedMediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"');return $||q},j.supportMSEH265Playback=function(){var $=self.MediaSource&&self.MediaSource.isTypeSupported('video/mp4; codecs="hvc1.1.6.L93.B0"'),q=self.ManagedMediaSource&&self.ManagedMediaSource.isTypeSupported('video/mp4; codecs="hvc1.1.6.L93.B0"');return $||q},j.supportNetworkStreamIO=function(){var $=new a.a({},l()),q=$.loaderType;return $.destroy(),q=="fetch-stream-loader"||q=="xhr-moz-chunked-loader"},j.getNetworkLoaderTypeName=function(){var $=new a.a({},l()),q=$.loaderType;return $.destroy(),q},j.supportNativeMediaPlayback=function($){j.videoElement==null&&(j.videoElement=window.document.createElement("video"));var q=j.videoElement.canPlayType($);return q==="probably"||q=="maybe"},j.getFeatureList=function(){var $={msePlayback:!1,mseLivePlayback:!1,mseH265Playback:!1,networkStreamIO:!1,networkLoaderName:"",nativeMP4H264Playback:!1,nativeMP4H265Playback:!1,nativeWebmVP8Playback:!1,nativeWebmVP9Playback:!1};return $.msePlayback=j.supportMSEH264Playback(),$.networkStreamIO=j.supportNetworkStreamIO(),$.networkLoaderName=j.getNetworkLoaderTypeName(),$.mseLivePlayback=$.msePlayback&&$.networkStreamIO,$.mseH265Playback=j.supportMSEH265Playback(),$.nativeMP4H264Playback=j.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"'),$.nativeMP4H265Playback=j.supportNativeMediaPlayback('video/mp4; codecs="hvc1.1.6.L93.B0"'),$.nativeWebmVP8Playback=j.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"'),$.nativeWebmVP9Playback=j.supportNativeMediaPlayback('video/webm; codecs="vp9"'),$},j}(),u=r(2),d=r(0),h=r(9),m=r.n(h),g=r(16),v=r(4),x=r(17),E=r(7),R=r(10),k=r(3),D=r(1),V=r(5),H=r(11),C=function(){function j($,q,Q){this.TAG="SeekingHandler",this._config=null,this._media_element=null,this._always_seek_keyframe=!1,this._on_unbuffered_seek=null,this._request_set_current_time=!1,this._seek_request_record_clocktime=null,this._idr_sample_list=new H.a,this.e=null,this._config=$,this._media_element=q,this._on_unbuffered_seek=Q,this.e={onMediaSeeking:this._onMediaSeeking.bind(this)};var fe=V.a.chrome&&(V.a.version.major<50||V.a.version.major===50&&V.a.version.build<2661);this._always_seek_keyframe=!!(fe||V.a.msedge||V.a.msie),this._always_seek_keyframe&&(this._config.accurateSeek=!1),this._media_element.addEventListener("seeking",this.e.onMediaSeeking)}return j.prototype.destroy=function(){this._idr_sample_list.clear(),this._idr_sample_list=null,this._media_element.removeEventListener("seeking",this.e.onMediaSeeking),this._media_element=null,this._on_unbuffered_seek=null},j.prototype.seek=function($){var q=this._isPositionBuffered($),Q=!1;if($<1&&this._media_element.buffered.length>0){var fe=this._media_element.buffered.start(0);(fe<1&&$<fe||V.a.safari)&&(Q=!0,$=V.a.safari?.1:fe)}if(Q)this.directSeek($);else if(q)if(this._always_seek_keyframe){var ve=this._getNearestKeyframe(Math.floor(1e3*$));ve!=null&&($=ve.dts/1e3),this.directSeek($)}else this.directSeek($);else this._idr_sample_list.clear(),this._on_unbuffered_seek(Math.floor(1e3*$)),this._config.accurateSeek&&this.directSeek($)},j.prototype.directSeek=function($){this._request_set_current_time=!0,this._media_element.currentTime=$},j.prototype.appendSyncPoints=function($){this._idr_sample_list.appendArray($)},j.prototype._onMediaSeeking=function($){if(this._request_set_current_time)this._request_set_current_time=!1;else{var q=this._media_element.currentTime,Q=this._media_element.buffered;if(q<1&&Q.length>0){var fe=Q.start(0);if(fe<1&&q<fe||V.a.safari){var ve=V.a.safari?.1:fe;return void this.directSeek(ve)}}if(this._isPositionBuffered(q)){if(this._always_seek_keyframe){var be=this._getNearestKeyframe(Math.floor(1e3*q));be!=null&&(q=be.dts/1e3,this.directSeek(q))}}else this._seek_request_record_clocktime=j._getClockTime(),window.setTimeout(this._pollAndApplyUnbufferedSeek.bind(this),50)}},j.prototype._pollAndApplyUnbufferedSeek=function(){if(this._seek_request_record_clocktime!=null)if(this._seek_request_record_clocktime<=j._getClockTime()-100){var $=this._media_element.currentTime;this._seek_request_record_clocktime=null,this._isPositionBuffered($)||(this._idr_sample_list.clear(),this._on_unbuffered_seek(Math.floor(1e3*$)),this._config.accurateSeek&&this.directSeek($))}else window.setTimeout(this._pollAndApplyUnbufferedSeek.bind(this),50)},j.prototype._isPositionBuffered=function($){for(var q=this._media_element.buffered,Q=0;Q<q.length;Q++){var fe=q.start(Q),ve=q.end(Q);if($>=fe&&$<ve)return!0}return!1},j.prototype._getNearestKeyframe=function($){return this._idr_sample_list.getLastSyncPointBeforeDts($)},j._getClockTime=function(){return self.performance&&self.performance.now?self.performance.now():Date.now()},j}(),S=function(){function j($,q,Q,fe){this.TAG="LoadingController",this._config=null,this._media_element=null,this._on_pause_transmuxer=null,this._on_resume_transmuxer=null,this._paused=!1,this.e=null,this._config=$,this._media_element=q,this._on_pause_transmuxer=Q,this._on_resume_transmuxer=fe,this.e={onMediaTimeUpdate:this._onMediaTimeUpdate.bind(this)}}return j.prototype.destroy=function(){this._media_element.removeEventListener("timeupdate",this.e.onMediaTimeUpdate),this.e=null,this._media_element=null,this._config=null,this._on_pause_transmuxer=null,this._on_resume_transmuxer=null},j.prototype.notifyBufferedPositionChanged=function($){!this._config.isLive&&this._config.lazyLoad&&($==null?this._suspendTransmuxerIfNeeded():this._suspendTransmuxerIfBufferedPositionExceeded($))},j.prototype._onMediaTimeUpdate=function($){this._paused&&this._resumeTransmuxerIfNeeded()},j.prototype._suspendTransmuxerIfNeeded=function(){for(var $=this._media_element.buffered,q=this._media_element.currentTime,Q=0,fe=0;fe<$.length;fe++){var ve=$.start(fe),be=$.end(fe);if(ve<=q&&q<be){Q=be;break}}Q>0&&this._suspendTransmuxerIfBufferedPositionExceeded(Q)},j.prototype._suspendTransmuxerIfBufferedPositionExceeded=function($){$>=this._media_element.currentTime+this._config.lazyLoadMaxDuration&&!this._paused&&(d.a.v(this.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),this.suspendTransmuxer(),this._media_element.addEventListener("timeupdate",this.e.onMediaTimeUpdate))},j.prototype.suspendTransmuxer=function(){this._paused=!0,this._on_pause_transmuxer()},j.prototype._resumeTransmuxerIfNeeded=function(){for(var $=this._media_element.buffered,q=this._media_element.currentTime,Q=this._config.lazyLoadRecoverDuration,fe=!1,ve=0;ve<$.length;ve++){var be=$.start(ve),xe=$.end(ve);if(q>=be&&q<xe){q>=xe-Q&&(fe=!0);break}}fe&&(d.a.v(this.TAG,"Continue loading from paused position"),this.resumeTransmuxer(),this._media_element.removeEventListener("timeupdate",this.e.onMediaTimeUpdate))},j.prototype.resumeTransmuxer=function(){this._paused=!1,this._on_resume_transmuxer()},j}(),b=function(){function j($,q){this.TAG="StartupStallJumper",this._media_element=null,this._on_direct_seek=null,this._canplay_received=!1,this.e=null,this._media_element=$,this._on_direct_seek=q,this.e={onMediaCanPlay:this._onMediaCanPlay.bind(this),onMediaStalled:this._onMediaStalled.bind(this),onMediaProgress:this._onMediaProgress.bind(this)},this._media_element.addEventListener("canplay",this.e.onMediaCanPlay),this._media_element.addEventListener("stalled",this.e.onMediaStalled),this._media_element.addEventListener("progress",this.e.onMediaProgress)}return j.prototype.destroy=function(){this._media_element.removeEventListener("canplay",this.e.onMediaCanPlay),this._media_element.removeEventListener("stalled",this.e.onMediaStalled),this._media_element.removeEventListener("progress",this.e.onMediaProgress),this._media_element=null,this._on_direct_seek=null},j.prototype._onMediaCanPlay=function($){this._canplay_received=!0,this._media_element.removeEventListener("canplay",this.e.onMediaCanPlay)},j.prototype._onMediaStalled=function($){this._detectAndFixStuckPlayback(!0)},j.prototype._onMediaProgress=function($){this._detectAndFixStuckPlayback()},j.prototype._detectAndFixStuckPlayback=function($){var q=this._media_element,Q=q.buffered;$||!this._canplay_received||q.readyState<2?Q.length>0&&q.currentTime<Q.start(0)&&(d.a.w(this.TAG,"Playback seems stuck at ".concat(q.currentTime,", seek to ").concat(Q.start(0))),this._on_direct_seek(Q.start(0)),this._media_element.removeEventListener("progress",this.e.onMediaProgress)):this._media_element.removeEventListener("progress",this.e.onMediaProgress)},j}(),T=function(){function j($,q,Q){this._config=null,this._media_element=null,this._on_direct_seek=null,this._config=$,this._media_element=q,this._on_direct_seek=Q}return j.prototype.destroy=function(){this._on_direct_seek=null,this._media_element=null,this._config=null},j.prototype.notifyBufferedRangeUpdate=function(){this._chaseLiveLatency()},j.prototype._chaseLiveLatency=function(){var $=this._media_element.buffered,q=this._media_element.currentTime,Q=this._media_element.paused;if(this._config.isLive&&this._config.liveBufferLatencyChasing&&$.length!=0&&(this._config.liveBufferLatencyChasingOnPaused||!Q)){var fe=$.end($.length-1);if(fe>this._config.liveBufferLatencyMaxLatency&&fe-q>this._config.liveBufferLatencyMaxLatency){var ve=fe-this._config.liveBufferLatencyMinRemain;this._on_direct_seek(ve)}}},j}(),L=function(){function j($,q){this._config=null,this._media_element=null,this.e=null,this._config=$,this._media_element=q,this.e={onMediaTimeUpdate:this._onMediaTimeUpdate.bind(this)},this._media_element.addEventListener("timeupdate",this.e.onMediaTimeUpdate)}return j.prototype.destroy=function(){this._media_element.removeEventListener("timeupdate",this.e.onMediaTimeUpdate),this._media_element=null,this._config=null},j.prototype._onMediaTimeUpdate=function($){if(this._config.isLive&&this._config.liveSync){var q=this._getCurrentLatency();if(q>this._config.liveSyncMaxLatency){var Q=Math.min(2,Math.max(1,this._config.liveSyncPlaybackRate));this._media_element.playbackRate=Q}else q>this._config.liveSyncTargetLatency||this._media_element.playbackRate!==1&&this._media_element.playbackRate!==0&&(this._media_element.playbackRate=1)}},j.prototype._getCurrentLatency=function(){if(!this._media_element)return 0;var $=this._media_element.buffered,q=this._media_element.currentTime;return $.length==0?0:$.end($.length-1)-q},j}(),F=function(){function j($,q){this.TAG="PlayerEngineMainThread",this._emitter=new h,this._media_element=null,this._mse_controller=null,this._transmuxer=null,this._pending_seek_time=null,this._seeking_handler=null,this._loading_controller=null,this._startup_stall_jumper=null,this._live_latency_chaser=null,this._live_latency_synchronizer=null,this._mse_source_opened=!1,this._has_pending_load=!1,this._loaded_metadata_received=!1,this._media_info=null,this._statistics_info=null,this.e=null,this._media_data_source=$,this._config=l(),typeof q=="object"&&Object.assign(this._config,q),$.isLive===!0&&(this._config.isLive=!0),this.e={onMediaLoadedMetadata:this._onMediaLoadedMetadata.bind(this)}}return j.prototype.destroy=function(){this._emitter.emit(v.a.DESTROYING),this._transmuxer&&this.unload(),this._media_element&&this.detachMediaElement(),this.e=null,this._media_data_source=null,this._emitter.removeAllListeners(),this._emitter=null},j.prototype.on=function($,q){var Q=this;this._emitter.addListener($,q),$===v.a.MEDIA_INFO&&this._media_info?Promise.resolve().then(function(){return Q._emitter.emit(v.a.MEDIA_INFO,Q.mediaInfo)}):$==v.a.STATISTICS_INFO&&this._statistics_info&&Promise.resolve().then(function(){return Q._emitter.emit(v.a.STATISTICS_INFO,Q.statisticsInfo)})},j.prototype.off=function($,q){this._emitter.removeListener($,q)},j.prototype.attachMediaElement=function($){var q=this;this._media_element=$,$.src="",$.removeAttribute("src"),$.srcObject=null,$.load(),$.addEventListener("loadedmetadata",this.e.onMediaLoadedMetadata),this._mse_controller=new g.a(this._config),this._mse_controller.on(E.a.UPDATE_END,this._onMSEUpdateEnd.bind(this)),this._mse_controller.on(E.a.BUFFER_FULL,this._onMSEBufferFull.bind(this)),this._mse_controller.on(E.a.SOURCE_OPEN,this._onMSESourceOpen.bind(this)),this._mse_controller.on(E.a.ERROR,this._onMSEError.bind(this)),this._mse_controller.on(E.a.START_STREAMING,this._onMSEStartStreaming.bind(this)),this._mse_controller.on(E.a.END_STREAMING,this._onMSEEndStreaming.bind(this)),this._mse_controller.initialize({getCurrentTime:function(){return q._media_element.currentTime},getReadyState:function(){return q._media_element.readyState}}),this._mse_controller.isManagedMediaSource()?($.disableRemotePlayback=!0,$.srcObject=this._mse_controller.getObject()):$.src=this._mse_controller.getObjectURL()},j.prototype.detachMediaElement=function(){this._media_element&&(this._mse_controller.shutdown(),this._media_element.removeEventListener("loadedmetadata",this.e.onMediaLoadedMetadata),this._media_element.src="",this._media_element.removeAttribute("src"),this._media_element.srcObject=null,this._media_element.load(),this._media_element=null,this._mse_controller.revokeObjectURL()),this._mse_controller&&(this._mse_controller.destroy(),this._mse_controller=null)},j.prototype.load=function(){var $=this;if(!this._media_element)throw new k.a("HTMLMediaElement must be attached before load()!");if(this._transmuxer)throw new k.a("load() has been called, please call unload() first!");this._has_pending_load||(!this._config.deferLoadAfterSourceOpen||this._mse_source_opened?(this._transmuxer=new x.a(this._media_data_source,this._config),this._transmuxer.on(D.a.INIT_SEGMENT,function(q,Q){$._mse_controller.appendInitSegment(Q)}),this._transmuxer.on(D.a.MEDIA_SEGMENT,function(q,Q){$._mse_controller.appendMediaSegment(Q),!$._config.isLive&&q==="video"&&Q.data&&Q.data.byteLength>0&&"info"in Q&&$._seeking_handler.appendSyncPoints(Q.info.syncPoints),$._loading_controller.notifyBufferedPositionChanged(Q.info.endDts/1e3)}),this._transmuxer.on(D.a.LOADING_COMPLETE,function(){$._mse_controller.endOfStream(),$._emitter.emit(v.a.LOADING_COMPLETE)}),this._transmuxer.on(D.a.RECOVERED_EARLY_EOF,function(){$._emitter.emit(v.a.RECOVERED_EARLY_EOF)}),this._transmuxer.on(D.a.IO_ERROR,function(q,Q){$._emitter.emit(v.a.ERROR,R.b.NETWORK_ERROR,q,Q)}),this._transmuxer.on(D.a.DEMUX_ERROR,function(q,Q){$._emitter.emit(v.a.ERROR,R.b.MEDIA_ERROR,q,Q)}),this._transmuxer.on(D.a.MEDIA_INFO,function(q){$._media_info=q,$._emitter.emit(v.a.MEDIA_INFO,Object.assign({},q))}),this._transmuxer.on(D.a.STATISTICS_INFO,function(q){$._statistics_info=$._fillStatisticsInfo(q),$._emitter.emit(v.a.STATISTICS_INFO,Object.assign({},q))}),this._transmuxer.on(D.a.RECOMMEND_SEEKPOINT,function(q){$._media_element&&!$._config.accurateSeek&&$._seeking_handler.directSeek(q/1e3)}),this._transmuxer.on(D.a.METADATA_ARRIVED,function(q){$._emitter.emit(v.a.METADATA_ARRIVED,q)}),this._transmuxer.on(D.a.SCRIPTDATA_ARRIVED,function(q){$._emitter.emit(v.a.SCRIPTDATA_ARRIVED,q)}),this._transmuxer.on(D.a.TIMED_ID3_METADATA_ARRIVED,function(q){$._emitter.emit(v.a.TIMED_ID3_METADATA_ARRIVED,q)}),this._transmuxer.on(D.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,function(q){$._emitter.emit(v.a.SYNCHRONOUS_KLV_METADATA_ARRIVED,q)}),this._transmuxer.on(D.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,function(q){$._emitter.emit(v.a.ASYNCHRONOUS_KLV_METADATA_ARRIVED,q)}),this._transmuxer.on(D.a.SMPTE2038_METADATA_ARRIVED,function(q){$._emitter.emit(v.a.SMPTE2038_METADATA_ARRIVED,q)}),this._transmuxer.on(D.a.SCTE35_METADATA_ARRIVED,function(q){$._emitter.emit(v.a.SCTE35_METADATA_ARRIVED,q)}),this._transmuxer.on(D.a.PES_PRIVATE_DATA_DESCRIPTOR,function(q){$._emitter.emit(v.a.PES_PRIVATE_DATA_DESCRIPTOR,q)}),this._transmuxer.on(D.a.PES_PRIVATE_DATA_ARRIVED,function(q){$._emitter.emit(v.a.PES_PRIVATE_DATA_ARRIVED,q)}),this._seeking_handler=new C(this._config,this._media_element,this._onRequiredUnbufferedSeek.bind(this)),this._loading_controller=new S(this._config,this._media_element,this._onRequestPauseTransmuxer.bind(this),this._onRequestResumeTransmuxer.bind(this)),this._startup_stall_jumper=new b(this._media_element,this._onRequestDirectSeek.bind(this)),this._config.isLive&&this._config.liveBufferLatencyChasing&&(this._live_latency_chaser=new T(this._config,this._media_element,this._onRequestDirectSeek.bind(this))),this._config.isLive&&this._config.liveSync&&(this._live_latency_synchronizer=new L(this._config,this._media_element)),this._media_element.readyState>0&&this._seeking_handler.directSeek(0),this._transmuxer.open()):this._has_pending_load=!0)},j.prototype.unload=function(){var $,q,Q,fe,ve,be,xe,ce,pe;($=this._media_element)===null||$===void 0||$.pause(),(q=this._live_latency_synchronizer)===null||q===void 0||q.destroy(),this._live_latency_synchronizer=null,(Q=this._live_latency_chaser)===null||Q===void 0||Q.destroy(),this._live_latency_chaser=null,(fe=this._startup_stall_jumper)===null||fe===void 0||fe.destroy(),this._startup_stall_jumper=null,(ve=this._loading_controller)===null||ve===void 0||ve.destroy(),this._loading_controller=null,(be=this._seeking_handler)===null||be===void 0||be.destroy(),this._seeking_handler=null,(xe=this._mse_controller)===null||xe===void 0||xe.flush(),(ce=this._transmuxer)===null||ce===void 0||ce.close(),(pe=this._transmuxer)===null||pe===void 0||pe.destroy(),this._transmuxer=null},j.prototype.play=function(){return this._media_element.play()},j.prototype.pause=function(){this._media_element.pause()},j.prototype.seek=function($){this._media_element&&this._seeking_handler?this._seeking_handler.seek($):this._pending_seek_time=$},Object.defineProperty(j.prototype,"mediaInfo",{get:function(){return Object.assign({},this._media_info)},enumerable:!1,configurable:!0}),Object.defineProperty(j.prototype,"statisticsInfo",{get:function(){return Object.assign({},this._statistics_info)},enumerable:!1,configurable:!0}),j.prototype._onMSESourceOpen=function(){this._mse_source_opened=!0,this._has_pending_load&&(this._has_pending_load=!1,this.load())},j.prototype._onMSEUpdateEnd=function(){this._config.isLive&&this._config.liveBufferLatencyChasing&&this._live_latency_chaser&&this._live_latency_chaser.notifyBufferedRangeUpdate(),this._loading_controller.notifyBufferedPositionChanged()},j.prototype._onMSEBufferFull=function(){d.a.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),this._loading_controller.suspendTransmuxer()},j.prototype._onMSEError=function($){this._emitter.emit(v.a.ERROR,R.b.MEDIA_ERROR,R.a.MEDIA_MSE_ERROR,$)},j.prototype._onMSEStartStreaming=function(){this._loaded_metadata_received&&(this._config.isLive||(d.a.v(this.TAG,"Resume transmuxing task due to ManagedMediaSource onStartStreaming"),this._loading_controller.resumeTransmuxer()))},j.prototype._onMSEEndStreaming=function(){this._config.isLive||(d.a.v(this.TAG,"Suspend transmuxing task due to ManagedMediaSource onEndStreaming"),this._loading_controller.suspendTransmuxer())},j.prototype._onMediaLoadedMetadata=function($){this._loaded_metadata_received=!0,this._pending_seek_time!=null&&(this._seeking_handler.seek(this._pending_seek_time),this._pending_seek_time=null)},j.prototype._onRequestDirectSeek=function($){this._seeking_handler.directSeek($)},j.prototype._onRequiredUnbufferedSeek=function($){this._mse_controller.flush(),this._transmuxer.seek($)},j.prototype._onRequestPauseTransmuxer=function(){this._transmuxer.pause()},j.prototype._onRequestResumeTransmuxer=function(){this._transmuxer.resume()},j.prototype._fillStatisticsInfo=function($){if($.playerType="MSEPlayer",!(this._media_element instanceof HTMLVideoElement))return $;var q=!0,Q=0,fe=0;if(this._media_element.getVideoPlaybackQuality){var ve=this._media_element.getVideoPlaybackQuality();Q=ve.totalVideoFrames,fe=ve.droppedVideoFrames}else this._media_element.webkitDecodedFrameCount!=null?(Q=this._media_element.webkitDecodedFrameCount,fe=this._media_element.webkitDroppedFrameCount):q=!1;return q&&($.decodedFrames=Q,$.droppedFrames=fe),$},j}(),U=r(18),Z=r(8),ie=function(){function j($,q){this.TAG="PlayerEngineDedicatedThread",this._emitter=new h,this._media_element=null,this._worker_destroying=!1,this._seeking_handler=null,this._loading_controller=null,this._startup_stall_jumper=null,this._live_latency_chaser=null,this._live_latency_synchronizer=null,this._pending_seek_time=null,this._media_info=null,this._statistics_info=null,this.e=null,this._media_data_source=$,this._config=l(),typeof q=="object"&&Object.assign(this._config,q),$.isLive===!0&&(this._config.isLive=!0),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this),onMediaLoadedMetadata:this._onMediaLoadedMetadata.bind(this),onMediaTimeUpdate:this._onMediaTimeUpdate.bind(this),onMediaReadyStateChanged:this._onMediaReadyStateChange.bind(this)},Z.a.registerListener(this.e.onLoggingConfigChanged),this._worker=U(24,{all:!0}),this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",media_data_source:this._media_data_source,config:this._config}),this._worker.postMessage({cmd:"logging_config",logging_config:Z.a.getConfig()})}return j.isSupported=function(){return!!self.Worker&&(!(!self.MediaSource||!("canConstructInDedicatedWorker"in self.MediaSource)||self.MediaSource.canConstructInDedicatedWorker!==!0)||!(!self.ManagedMediaSource||!("canConstructInDedicatedWorker"in self.ManagedMediaSource)||self.ManagedMediaSource.canConstructInDedicatedWorker!==!0))},j.prototype.destroy=function(){this._emitter.emit(v.a.DESTROYING),this.unload(),this.detachMediaElement(),this._worker_destroying=!0,this._worker.postMessage({cmd:"destroy"}),Z.a.removeListener(this.e.onLoggingConfigChanged),this.e=null,this._media_data_source=null,this._emitter.removeAllListeners(),this._emitter=null},j.prototype.on=function($,q){var Q=this;this._emitter.addListener($,q),$===v.a.MEDIA_INFO&&this._media_info?Promise.resolve().then(function(){return Q._emitter.emit(v.a.MEDIA_INFO,Q.mediaInfo)}):$==v.a.STATISTICS_INFO&&this._statistics_info&&Promise.resolve().then(function(){return Q._emitter.emit(v.a.STATISTICS_INFO,Q.statisticsInfo)})},j.prototype.off=function($,q){this._emitter.removeListener($,q)},j.prototype.attachMediaElement=function($){this._media_element=$,this._media_element.src="",this._media_element.removeAttribute("src"),this._media_element.srcObject=null,this._media_element.load(),this._media_element.addEventListener("loadedmetadata",this.e.onMediaLoadedMetadata),this._media_element.addEventListener("timeupdate",this.e.onMediaTimeUpdate),this._media_element.addEventListener("readystatechange",this.e.onMediaReadyStateChanged),this._worker.postMessage({cmd:"initialize_mse"})},j.prototype.detachMediaElement=function(){this._worker.postMessage({cmd:"shutdown_mse"}),this._media_element&&(this._media_element.removeEventListener("loadedmetadata",this.e.onMediaLoadedMetadata),this._media_element.removeEventListener("timeupdate",this.e.onMediaTimeUpdate),this._media_element.removeEventListener("readystatechange",this.e.onMediaReadyStateChanged),this._media_element.src="",this._media_element.removeAttribute("src"),this._media_element.srcObject=null,this._media_element.load(),this._media_element=null)},j.prototype.load=function(){this._worker.postMessage({cmd:"load"}),this._seeking_handler=new C(this._config,this._media_element,this._onRequiredUnbufferedSeek.bind(this)),this._loading_controller=new S(this._config,this._media_element,this._onRequestPauseTransmuxer.bind(this),this._onRequestResumeTransmuxer.bind(this)),this._startup_stall_jumper=new b(this._media_element,this._onRequestDirectSeek.bind(this)),this._config.isLive&&this._config.liveBufferLatencyChasing&&(this._live_latency_chaser=new T(this._config,this._media_element,this._onRequestDirectSeek.bind(this))),this._config.isLive&&this._config.liveSync&&(this._live_latency_synchronizer=new L(this._config,this._media_element)),this._media_element.readyState>0&&this._seeking_handler.directSeek(0)},j.prototype.unload=function(){var $,q,Q,fe,ve,be;($=this._media_element)===null||$===void 0||$.pause(),this._worker.postMessage({cmd:"unload"}),(q=this._live_latency_synchronizer)===null||q===void 0||q.destroy(),this._live_latency_synchronizer=null,(Q=this._live_latency_chaser)===null||Q===void 0||Q.destroy(),this._live_latency_chaser=null,(fe=this._startup_stall_jumper)===null||fe===void 0||fe.destroy(),this._startup_stall_jumper=null,(ve=this._loading_controller)===null||ve===void 0||ve.destroy(),this._loading_controller=null,(be=this._seeking_handler)===null||be===void 0||be.destroy(),this._seeking_handler=null},j.prototype.play=function(){return this._media_element.play()},j.prototype.pause=function(){this._media_element.pause()},j.prototype.seek=function($){this._media_element&&this._seeking_handler?this._seeking_handler.seek($):this._pending_seek_time=$},Object.defineProperty(j.prototype,"mediaInfo",{get:function(){return Object.assign({},this._media_info)},enumerable:!1,configurable:!0}),Object.defineProperty(j.prototype,"statisticsInfo",{get:function(){return Object.assign({},this._statistics_info)},enumerable:!1,configurable:!0}),j.prototype._onLoggingConfigChanged=function($){var q;(q=this._worker)===null||q===void 0||q.postMessage({cmd:"logging_config",logging_config:$})},j.prototype._onMSEUpdateEnd=function(){this._config.isLive&&this._config.liveBufferLatencyChasing&&this._live_latency_chaser&&this._live_latency_chaser.notifyBufferedRangeUpdate(),this._loading_controller.notifyBufferedPositionChanged()},j.prototype._onMSEBufferFull=function(){d.a.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),this._loading_controller.suspendTransmuxer()},j.prototype._onMediaLoadedMetadata=function($){this._pending_seek_time!=null&&(this._seeking_handler.seek(this._pending_seek_time),this._pending_seek_time=null)},j.prototype._onRequestDirectSeek=function($){this._seeking_handler.directSeek($)},j.prototype._onRequiredUnbufferedSeek=function($){this._worker.postMessage({cmd:"unbuffered_seek",milliseconds:$})},j.prototype._onRequestPauseTransmuxer=function(){this._worker.postMessage({cmd:"pause_transmuxer"})},j.prototype._onRequestResumeTransmuxer=function(){this._worker.postMessage({cmd:"resume_transmuxer"})},j.prototype._onMediaTimeUpdate=function($){this._worker.postMessage({cmd:"timeupdate",current_time:$.target.currentTime})},j.prototype._onMediaReadyStateChange=function($){this._worker.postMessage({cmd:"readystatechange",ready_state:$.target.readyState})},j.prototype._onWorkerMessage=function($){var q,Q=$.data,fe=Q.msg;if(fe=="destroyed"||this._worker_destroying)return this._worker_destroying=!1,(q=this._worker)===null||q===void 0||q.terminate(),void(this._worker=null);switch(fe){case"mse_init":var ve=Q;"ManagedMediaSource"in self&&!("MediaSource"in self)&&(this._media_element.disableRemotePlayback=!0),this._media_element.srcObject=ve.handle;break;case"mse_event":(ve=Q).event==E.a.UPDATE_END?this._onMSEUpdateEnd():ve.event==E.a.BUFFER_FULL&&this._onMSEBufferFull();break;case"transmuxing_event":if((ve=Q).event==D.a.MEDIA_INFO){var be=Q;this._media_info=be.info,this._emitter.emit(v.a.MEDIA_INFO,Object.assign({},be.info))}else if(ve.event==D.a.STATISTICS_INFO){var xe=Q;this._statistics_info=this._fillStatisticsInfo(xe.info),this._emitter.emit(v.a.STATISTICS_INFO,Object.assign({},xe.info))}else if(ve.event==D.a.RECOMMEND_SEEKPOINT){var ce=Q;this._media_element&&!this._config.accurateSeek&&this._seeking_handler.directSeek(ce.milliseconds/1e3)}break;case"player_event":if((ve=Q).event==v.a.ERROR){var pe=Q;this._emitter.emit(v.a.ERROR,pe.error_type,pe.error_detail,pe.info)}else if("extraData"in ve){var Ie=Q;this._emitter.emit(Ie.event,Ie.extraData)}break;case"logcat_callback":ve=Q,d.a.emitter.emit("log",ve.type,ve.logcat);break;case"buffered_position_changed":ve=Q,this._loading_controller.notifyBufferedPositionChanged(ve.buffered_position_milliseconds/1e3)}},j.prototype._fillStatisticsInfo=function($){if($.playerType="MSEPlayer",!(this._media_element instanceof HTMLVideoElement))return $;var q=!0,Q=0,fe=0;if(this._media_element.getVideoPlaybackQuality){var ve=this._media_element.getVideoPlaybackQuality();Q=ve.totalVideoFrames,fe=ve.droppedVideoFrames}else this._media_element.webkitDecodedFrameCount!=null?(Q=this._media_element.webkitDecodedFrameCount,fe=this._media_element.webkitDroppedFrameCount):q=!1;return q&&($.decodedFrames=Q,$.droppedFrames=fe),$},j}(),le=function(){function j($,q){this.TAG="MSEPlayer",this._type="MSEPlayer",this._media_element=null,this._player_engine=null;var Q=$.type.toLowerCase();if(Q!=="mse"&&Q!=="mpegts"&&Q!=="m2ts"&&Q!=="flv")throw new k.b("MSEPlayer requires an mpegts/m2ts/flv MediaDataSource input!");if(q&&q.enableWorkerForMSE&&ie.isSupported())try{this._player_engine=new ie($,q)}catch{d.a.e(this.TAG,"Error while initializing PlayerEngineDedicatedThread, fallback to PlayerEngineMainThread"),this._player_engine=new F($,q)}else this._player_engine=new F($,q)}return j.prototype.destroy=function(){this._player_engine.destroy(),this._player_engine=null,this._media_element=null},j.prototype.on=function($,q){this._player_engine.on($,q)},j.prototype.off=function($,q){this._player_engine.off($,q)},j.prototype.attachMediaElement=function($){this._media_element=$,this._player_engine.attachMediaElement($)},j.prototype.detachMediaElement=function(){this._media_element=null,this._player_engine.detachMediaElement()},j.prototype.load=function(){this._player_engine.load()},j.prototype.unload=function(){this._player_engine.unload()},j.prototype.play=function(){return this._player_engine.play()},j.prototype.pause=function(){this._player_engine.pause()},Object.defineProperty(j.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(j.prototype,"buffered",{get:function(){return this._media_element.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(j.prototype,"duration",{get:function(){return this._media_element.duration},enumerable:!1,configurable:!0}),Object.defineProperty(j.prototype,"volume",{get:function(){return this._media_element.volume},set:function($){this._media_element.volume=$},enumerable:!1,configurable:!0}),Object.defineProperty(j.prototype,"muted",{get:function(){return this._media_element.muted},set:function($){this._media_element.muted=$},enumerable:!1,configurable:!0}),Object.defineProperty(j.prototype,"currentTime",{get:function(){return this._media_element?this._media_element.currentTime:0},set:function($){this._player_engine.seek($)},enumerable:!1,configurable:!0}),Object.defineProperty(j.prototype,"mediaInfo",{get:function(){return this._player_engine.mediaInfo},enumerable:!1,configurable:!0}),Object.defineProperty(j.prototype,"statisticsInfo",{get:function(){return this._player_engine.statisticsInfo},enumerable:!1,configurable:!0}),j}(),ge=function(){function j($,q){this.TAG="NativePlayer",this._type="NativePlayer",this._emitter=new m.a,this._config=l(),typeof q=="object"&&Object.assign(this._config,q);var Q=$.type.toLowerCase();if(Q==="mse"||Q==="mpegts"||Q==="m2ts"||Q==="flv")throw new k.b("NativePlayer does't support mse/mpegts/m2ts/flv MediaDataSource input!");if($.hasOwnProperty("segments"))throw new k.b("NativePlayer(".concat($.type,") doesn't support multipart playback!"));this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this)},this._pendingSeekTime=null,this._statisticsReporter=null,this._mediaDataSource=$,this._mediaElement=null}return j.prototype.destroy=function(){this._emitter.emit(v.a.DESTROYING),this._mediaElement&&(this.unload(),this.detachMediaElement()),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},j.prototype.on=function($,q){var Q=this;$===v.a.MEDIA_INFO?this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then(function(){Q._emitter.emit(v.a.MEDIA_INFO,Q.mediaInfo)}):$===v.a.STATISTICS_INFO&&this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then(function(){Q._emitter.emit(v.a.STATISTICS_INFO,Q.statisticsInfo)}),this._emitter.addListener($,q)},j.prototype.off=function($,q){this._emitter.removeListener($,q)},j.prototype.attachMediaElement=function($){if(this._mediaElement=$,$.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._pendingSeekTime!=null)try{$.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch{}},j.prototype.detachMediaElement=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement=null),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},j.prototype.load=function(){if(!this._mediaElement)throw new k.a("HTMLMediaElement must be attached before load()!");this._mediaElement.src=this._mediaDataSource.url,this._mediaElement.readyState>0&&(this._mediaElement.currentTime=0),this._mediaElement.preload="auto",this._mediaElement.load(),this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval)},j.prototype.unload=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src")),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},j.prototype.play=function(){return this._mediaElement.play()},j.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(j.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(j.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(j.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(j.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function($){this._mediaElement.volume=$},enumerable:!1,configurable:!0}),Object.defineProperty(j.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function($){this._mediaElement.muted=$},enumerable:!1,configurable:!0}),Object.defineProperty(j.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function($){this._mediaElement?this._mediaElement.currentTime=$:this._pendingSeekTime=$},enumerable:!1,configurable:!0}),Object.defineProperty(j.prototype,"mediaInfo",{get:function(){var $={mimeType:(this._mediaElement instanceof HTMLAudioElement?"audio/":"video/")+this._mediaDataSource.type};return this._mediaElement&&($.duration=Math.floor(1e3*this._mediaElement.duration),this._mediaElement instanceof HTMLVideoElement&&($.width=this._mediaElement.videoWidth,$.height=this._mediaElement.videoHeight)),$},enumerable:!1,configurable:!0}),Object.defineProperty(j.prototype,"statisticsInfo",{get:function(){var $={playerType:this._type,url:this._mediaDataSource.url};if(!(this._mediaElement instanceof HTMLVideoElement))return $;var q=!0,Q=0,fe=0;if(this._mediaElement.getVideoPlaybackQuality){var ve=this._mediaElement.getVideoPlaybackQuality();Q=ve.totalVideoFrames,fe=ve.droppedVideoFrames}else this._mediaElement.webkitDecodedFrameCount!=null?(Q=this._mediaElement.webkitDecodedFrameCount,fe=this._mediaElement.webkitDroppedFrameCount):q=!1;return q&&($.decodedFrames=Q,$.droppedFrames=fe),$},enumerable:!1,configurable:!0}),j.prototype._onvLoadedMetadata=function($){this._pendingSeekTime!=null&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null),this._emitter.emit(v.a.MEDIA_INFO,this.mediaInfo)},j.prototype._reportStatisticsInfo=function(){this._emitter.emit(v.a.STATISTICS_INFO,this.statisticsInfo)},j}();s.a.install();var te={createPlayer:function(j,$){var q=j;if(q==null||typeof q!="object")throw new k.b("MediaDataSource must be an javascript object!");if(!q.hasOwnProperty("type"))throw new k.b("MediaDataSource must has type field to indicate video file type!");switch(q.type){case"mse":case"mpegts":case"m2ts":case"flv":return new le(q,$);default:return new ge(q,$)}},isSupported:function(){return c.supportMSEH264Playback()},getFeatureList:function(){return c.getFeatureList()}};te.BaseLoader=u.a,te.LoaderStatus=u.c,te.LoaderErrors=u.b,te.Events=v.a,te.ErrorTypes=R.b,te.ErrorDetails=R.a,te.MSEPlayer=le,te.NativePlayer=ge,te.LoggingControl=Z.a,Object.defineProperty(te,"version",{enumerable:!0,get:function(){return"1.8.0"}}),i.default=te}])})})(QT);var uN=QT.exports;const My=Uy(uN),dN=()=>{const{t:n}=sm(),[e,t]=ae.useState(null),[i,r]=ae.useState(!1),[s,a]=ae.useState(""),[o,l]=ae.useState("all"),[c,u]=ae.useState(!1),[d,h]=ae.useState(null),[m,g]=ae.useState(""),v=ae.useRef(null),x=ae.useRef(null),E=ae.useRef(null),R=T_.filter(L=>{const F=L.name.toLowerCase().includes(s.toLowerCase()),U=o==="all"||L.category===o;return F&&U}),k=()=>{x.current&&(x.current.destroy(),x.current=null),E.current&&(E.current.destroy(),E.current=null),v.current&&(v.current.pause(),v.current.removeAttribute("src"),v.current.load())},D=L=>L.includes(".m3u8")?"application/x-mpegURL":L.includes(".ts")?"video/mp2t":"video/mp4",V=L=>{const F=v.current;if(!F)return;const U=D(L);if(U==="application/x-mpegURL")if(Ri.isSupported()){const Z=new Ri({maxBufferLength:60,maxMaxBufferLength:120,liveSyncDuration:5,liveMaxLatencyDuration:10,maxBufferHole:3,fragLoadingTimeOut:6e4,manifestLoadingTimeOut:6e4});x.current=Z,Z.loadSource(L),Z.attachMedia(F),Z.on(Ri.Events.MANIFEST_PARSED,()=>{F.play().catch(console.error),r(!1)})}else F.canPlayType("application/vnd.apple.mpegurl")?(F.src=L,F.addEventListener("loadedmetadata",()=>{F.play().catch(console.error),r(!1)})):(h("HLS no soportado en este navegador"),r(!1));else if(U==="video/mp2t")if(My.getFeatureList().mseLivePlayback){const Z=My.createPlayer({type:"mpegts",isLive:!0,url:L});E.current=Z,Z.attachMediaElement(F),Z.load(),Z.play(),r(!1)}else h("MPEG-TS no soportado en este navegador"),r(!1);else F.src=L,F.play().catch(console.error),r(!1)},H=L=>{(e==null?void 0:e.name)!==L.name&&(k(),t(L),r(!0),h(null),V(L.url))},C=()=>{v.current&&(document.fullscreenElement?document.exitFullscreen():v.current.requestFullscreen())},S=()=>{v.current&&(v.current.muted=!v.current.muted,u(v.current.muted))},b=()=>{a(""),l("all"),t(null),h(null),k()},T=()=>{const L={online:navigator.onLine,userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,cookieEnabled:navigator.cookieEnabled,timestamp:new Date().toLocaleString()};g(JSON.stringify(L,null,2))};return z.jsxs("div",{className:"space-y-6",children:[z.jsxs("div",{className:"bg-gray-900 rounded-xl overflow-hidden",children:[z.jsxs("div",{className:"relative aspect-video bg-black",children:[z.jsx("video",{ref:v,className:"w-full h-full object-contain",controls:!0,playsInline:!0,muted:c,onError:()=>h(`Error al cargar ${(e==null?void 0:e.name)||""}`)}),!e&&z.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-white",children:[z.jsx("div",{className:"w-20 h-20 bg-blue-600 rounded-full flex items-center justify-center mb-4",children:z.jsx(xm,{size:32})}),z.jsx("h3",{className:"text-xl font-semibold mb-2",children:n("select-channel")}),z.jsx("p",{className:"text-gray-400",children:n("select-channel-desc")})]}),i&&z.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50",children:z.jsxs("div",{className:"flex flex-col items-center text-white",children:[z.jsx("div",{className:"w-8 h-8 border-2 border-white/30 border-t-white rounded-full animate-spin mb-2"}),z.jsx("p",{children:n("loading-channel")})]})}),d&&z.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50",children:z.jsxs("div",{className:"flex flex-col items-center text-white text-center p-4",children:[z.jsx("div",{className:"w-16 h-16 bg-red-600 rounded-full flex items-center justify-center mb-4",children:z.jsx("span",{className:"text-2xl",children:"⚠️"})}),z.jsx("p",{className:"text-red-400",children:d})]})})]}),e&&z.jsxs("div",{className:"p-4 bg-gray-800 flex items-center justify-between",children:[z.jsxs("div",{children:[z.jsx("h3",{className:"text-white font-semibold",children:e.name}),z.jsx("p",{className:"text-gray-400 text-sm capitalize",children:e.category}),e.description&&z.jsx("p",{className:"text-gray-500 text-xs mt-1",children:e.description})]}),z.jsxs("div",{className:"flex gap-2",children:[z.jsx("button",{onClick:S,className:"p-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-white",children:c?z.jsx(sk,{size:20}):z.jsx(rk,{size:20})}),z.jsx("button",{onClick:C,className:"p-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-white",children:z.jsx(XC,{size:20})})]})]})]}),z.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[z.jsxs("div",{className:"flex-1 relative",children:[z.jsx(TS,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),z.jsx("input",{type:"text",placeholder:n("search-channels"),value:s,onChange:L=>a(L.target.value),className:"w-full bg-gray-800 border border-gray-700 rounded-lg pl-10 pr-4 py-2 text-white"})]}),z.jsxs("div",{className:"relative",children:[z.jsx(GC,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),z.jsx("select",{value:o,onChange:L=>l(L.target.value),className:"bg-gray-800 border border-gray-700 rounded-lg pl-10 pr-8 py-2 text-white",children:uk.map(L=>z.jsx("option",{value:L.id,children:L.name},L.id))})]}),z.jsxs("button",{onClick:b,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg flex items-center gap-2",children:[z.jsx(ek,{size:20}),z.jsx("span",{className:"hidden sm:inline",children:n("refresh")})]}),z.jsxs("button",{onClick:T,className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg flex items-center gap-2",children:["💻 ",z.jsx("span",{className:"hidden sm:inline",children:n("system")})]})]}),z.jsx("div",{className:"text-gray-400 text-sm",children:n("channel-count").replace("{count}",R.length.toString()).replace("{total}",T_.length.toString())}),m&&z.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[z.jsx("h3",{className:"text-white font-semibold mb-2",children:n("system-info")}),z.jsx("pre",{className:"text-green-400 text-xs overflow-auto bg-gray-900 p-2 rounded",children:m})]}),z.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 gap-4",children:R.map(L=>z.jsx("button",{onClick:()=>H(L),className:`p-4 rounded-lg border-2 transition-all ${(e==null?void 0:e.name)===L.name?"border-blue-500 bg-blue-500/10":"border-gray-700 bg-gray-800 hover:border-gray-600 hover:bg-gray-700"}`,title:L.description||L.name,children:z.jsxs("div",{className:"text-center",children:[z.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center mx-auto mb-2",children:z.jsx(dk,{name:L.icon.replace("fas fa-",""),className:"text-white",size:24})}),z.jsx("h4",{className:"text-white text-sm font-medium mb-1",children:L.name}),z.jsx("p",{className:"text-gray-400 text-xs capitalize",children:L.category})]})},L.name))})]})},hN=({item:n,isOpen:e,onClose:t,onPlay:i})=>!e||!n?null:z.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm",children:z.jsxs("div",{className:"bg-gray-900 rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[z.jsxs("div",{className:"relative",children:[z.jsx("img",{src:n.image,alt:n.title,className:"w-full h-64 object-cover rounded-t-xl"}),z.jsx("button",{onClick:t,className:"absolute top-4 right-4 p-2 bg-black/50 rounded-full text-white hover:bg-black/70 transition-colors",children:z.jsx(bS,{size:20})})]}),z.jsxs("div",{className:"p-6",children:[z.jsxs("div",{className:"flex items-start justify-between mb-4",children:[z.jsxs("div",{children:[z.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:n.title}),z.jsxs("div",{className:"flex items-center gap-4 text-gray-400 text-sm",children:[z.jsxs("div",{className:"flex items-center gap-1",children:[z.jsx(FC,{size:16}),z.jsx("span",{children:n.year})]}),z.jsxs("div",{className:"flex items-center gap-1",children:[z.jsx(UC,{size:16}),z.jsx("span",{children:n.duration})]}),n.rating&&z.jsxs("div",{className:"flex items-center gap-1",children:[z.jsx(tk,{size:16,className:"text-yellow-500"}),z.jsxs("span",{children:[n.rating,"/10"]})]})]})]}),z.jsxs("button",{onClick:()=>i(n),className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors",children:[z.jsx(xm,{size:20}),"Reproducir"]})]}),z.jsx("div",{className:"mb-4",children:z.jsx("span",{className:"inline-block bg-gray-700 text-gray-300 px-3 py-1 rounded-full text-sm",children:n.genre})}),n.synopsis&&z.jsxs("div",{className:"mb-6",children:[z.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Sinopsis"}),z.jsx("p",{className:"text-gray-300 leading-relaxed",children:n.synopsis})]}),n.cast&&n.cast.length>0&&z.jsxs("div",{children:[z.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Reparto"}),z.jsx("div",{className:"flex flex-wrap gap-2",children:n.cast.map((r,s)=>z.jsx("span",{className:"bg-gray-800 text-gray-300 px-3 py-1 rounded-full text-sm",children:r},s))})]})]})]})}),fN=()=>{const{profiles:n,currentProfile:e,selectProfile:t,addProfile:i,deleteProfile:r,createDefaultProfiles:s}=_E(),{t:a}=sm(),[o,l]=ae.useState(!1),[c,u]=ae.useState(""),[d,h]=ae.useState("👤"),m=["👤","👶","👨‍👩‍👧‍👦","👨","👩","👴","👵","👨‍💻","👩‍💻","🎭","🎨","🎮","🏃‍♂️","🚴‍♀️"];Xy.useEffect(()=>{n.length===0&&s()},[n.length,s]);const g=()=>{c.trim()&&(i({name:c.trim(),avatar:d,isAdult:!0,isActive:!1,preferences:{language:"es",autoplay:!0,subtitles:!1,quality:"high"}}),u(""),h("👤"),l(!1))},v=x=>{window.confirm(a("delete-profile-confirm"))&&r(x)};return e?z.jsx("div",{className:"fixed inset-0 bg-black/90 flex items-center justify-center z-50",children:z.jsxs("div",{className:"text-center",children:[z.jsx("h1",{className:"text-4xl font-bold text-white mb-8",children:"SirNet"}),z.jsxs("div",{className:"mb-8",children:[z.jsx("div",{className:"text-6xl mb-4",children:e.avatar}),z.jsx("h2",{className:"text-2xl text-white mb-2",children:e.name}),z.jsx("p",{className:"text-gray-400",children:a("welcome")})]}),z.jsx("button",{onClick:()=>t(null),className:"px-8 py-3 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors",children:a("logout")})]})}):z.jsx("div",{className:"fixed inset-0 bg-black/90 flex items-center justify-center z-50",children:z.jsxs("div",{className:"text-center max-w-4xl mx-auto px-4",children:[z.jsx("h1",{className:"text-6xl font-bold text-white mb-12",children:"SirNet"}),z.jsx("h2",{className:"text-2xl text-white mb-8",children:a("select-profile")}),z.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-6 mb-8",children:[n.map(x=>z.jsxs("div",{className:"group cursor-pointer transition-transform hover:scale-105",onClick:()=>t(x),children:[z.jsxs("div",{className:"relative",children:[z.jsx("div",{className:"w-24 h-24 bg-gray-800 rounded-lg flex items-center justify-center text-4xl mb-3 group-hover:bg-gray-700 transition-colors",children:x.avatar}),z.jsx("button",{onClick:E=>{E.stopPropagation(),v(x.id)},className:"absolute -top-2 -right-2 w-6 h-6 bg-red-600 hover:bg-red-700 rounded-full flex items-center justify-center text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity",title:a("delete-profile"),children:z.jsx(nk,{size:12})})]}),z.jsx("p",{className:"text-white text-sm",children:x.name})]},x.id)),n.length<5&&z.jsxs("div",{className:"cursor-pointer transition-transform hover:scale-105",onClick:()=>l(!0),children:[z.jsx("div",{className:"w-24 h-24 bg-gray-800 rounded-lg flex items-center justify-center text-4xl mb-3 hover:bg-gray-700 transition-colors",children:z.jsx(JC,{size:32,className:"text-gray-400"})}),z.jsx("p",{className:"text-gray-400 text-sm",children:a("add-profile")})]})]}),o&&z.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50",children:z.jsxs("div",{className:"bg-gray-900 rounded-lg p-6 max-w-md w-full mx-4",children:[z.jsx("h3",{className:"text-xl text-white mb-4",children:a("add-profile")}),z.jsxs("div",{className:"mb-4",children:[z.jsx("label",{className:"block text-white text-sm mb-2",children:a("profile-avatar")}),z.jsx("div",{className:"grid grid-cols-7 gap-2",children:m.map(x=>z.jsx("button",{onClick:()=>h(x),className:`w-10 h-10 rounded-lg flex items-center justify-center text-xl transition-colors ${d===x?"bg-blue-600":"bg-gray-700 hover:bg-gray-600"}`,children:x},x))})]}),z.jsxs("div",{className:"mb-6",children:[z.jsx("label",{className:"block text-white text-sm mb-2",children:a("profile-name")}),z.jsx("input",{type:"text",value:c,onChange:x=>u(x.target.value),className:"w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-blue-500",placeholder:a("profile-name"),maxLength:20})]}),z.jsxs("div",{className:"flex gap-3",children:[z.jsx("button",{onClick:()=>l(!1),className:"flex-1 px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors",children:a("cancel")}),z.jsx("button",{onClick:g,disabled:!c.trim(),className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white rounded-lg transition-colors",children:a("save-profile")})]})]})})]})})},Ny=[{id:"Nadie 2",title:"Nadie 2",year:2025,genre:"Fantasía",image:"https://image.tmdb.org/t/p/w200/aYPlrLJWjVkixwrJXA0f4V3D7Ab.jpg",type:"movie",rating:6.8,synopsis:"Cuatro años después de enfrentarse involuntariamente a la mafia rusa, Hutch sigue manteniendo con la organización criminal una deuda de 30 millones de dólares que trata de saldar poco a poco con una serie interminable de golpes contra matones internacionales. Pese a disfrutar como siempre de la faceta más trepidante y física de su «trabajo», Hutch y su esposa Becca se sienten agotados y distanciados. Para intentar remediarlo, deciden llevarse a sus hijos de escapada al mismo lugar al que Hutch iba de vacaciones con su hermano Harry cuando eran pequeños.",duration:"Duración: 1h 29m",cast:["Elenco principal"],streamUrl:"https://smoothpre.com/stream/UVesUHt5rVQ_xjUxsC2Etg/hjkrhuihghfvu/1757045470/31179084/index-f2-v1-a1.m3u8"},{id:"1",title:"Película La hacienda: El regreso de los malditos (2025)",year:2025,genre:"Ciencia Ficción",image:"https://image.tmdb.org/t/p/w200/vXUfuM7tPvAL8HjjnsFO4yYbKUs.jpg",type:"movie",rating:7,synopsis:'"Un grupo de amigos regresa a su pueblo natal después de muchos años. El viaje es una excusa para rememorar viejos tiempos, pero se convierte en una pesadilla cuando desentierran sus recuerdos más oscuros.',duration:"Duración: 1h 10m",cast:["Sam Worthington","Zoe Saldana","Sigourney Weaver"],streamUrl:"https://861515134.tapecontent.net/radosgw/XYY4xGlbzwIDD0B/yexqQBKh65dw5Y3nRJiK2TEYqyKzROk54_R4RHpigPZP4SxBgTQ05469ErVaN-bzYXm0VnDVqo2Xp4Qm-RIa3M2xj-WEYYy6vE3g106gvZPtp8ZcxumUgOpPCSXmpu0U_r7bI_4n6QOVCckJfUUBOaQFlmJar5rlnTSJONwpDcs-wSVxj1PGHc1A9gCs_ujUDFuASKwB2SShNaDB9nBRPMoPuh_QjFOL6THFLRVJFxW9P4C0EOeYe47vYhKUN_KeCI5HM1rL687jwtS5P1L6k2gQ1D8yD4dSxFC1tQ/La+Hacienda.mp4?stream=1"},{id:"2",title:"Película ¿Y dónde está el policía? (2025)",year:2025,genre:"Acción",image:"https://image.tmdb.org/t/p/w200/y5BwdQlrFf9fEPDzXjdBEup5hcF.jpg",type:"movie",rating:8.7,synopsis:'"CSolo un hombre tiene las habilidades necesarias... ¡para liderar el Escuadrón de Policía y salvar el mundo!',duration:"2h 10min",cast:["Tom Cruise","Miles Teller","Jennifer Connelly"],streamUrl:"https://akm-cdn-play-web.onfilom.com/9d1c474c6f4b43da8ea1bc3f9823239a/80526e2a77fd4a63bae51ca607ab5ecb-0333dbd09a2e8c5e1ee710206eae620b-ld.m3u8?hdnts=exp=1755712044_acl=/9d1c474c6f4b43da8ea1bc3f9823239a/*_hmac=3295fce0c5a2b6ccec7b7150edd43515c4d4854415eb9d1591822b951470e056"},{id:"3",title:"Película Maa (2025)",year:1972,genre:"Película Maa (2025)",image:"https://image.tmdb.org/t/p/w200/kc5n7LJUmvBsVxzAla1ONN8kouP.jpg",type:"movie",rating:9.2,synopsis:"Una madre y su hija se encuentran con un demonio en un pueblo donde las niñas han estado desapareciendo.",duration:"Duración: 2h 13m",cast:["Letitia Wright","Angela Bassett","Tenoch Huerta"],streamUrl:"https://akm-cdn-play-web.onfilom.com/8035a583cca471efb4d85014c1ca0102/65974265e9544b9890bacd6ccee50e62-652dfdd118359d9f6f4070b275af4408-sd.m3u8?hdnts=exp=1755694678_acl=/8035a583cca471efb4d85014c1ca0102/*_hmac=4db616456ce89188dcdee48b9a5c1f0efe85fb59c3437e9aa8fd1dd1280fe290"},{id:"4",title:"Película Hallow Road (2025)",year:2021,genre:"Superhéroes",image:"https://image.tmdb.org/t/p/w200/dVsgV7ak6vR5xyXFggooJQinXBg.jpg",type:"movie",rating:7.3,synopsis:"Dos padres reciben una angustiosa llamada nocturna de su hija adolescente, quien acaba de atropellar accidentalmente a un peatón. Se suben a su coche a toda prisa para llegar antes de que alguien más se tope con la escena. A medida que avanza la noche, revelaciones inquietantes amenazan con destrozar a la familia, mientras enseguida se dan cuenta de que podrían no ser los únicos conduciendo por Hallow Road.",duration:"Duración: 1h 20m",cast:["Tom Holland","Zendaya","Benedict Cumberbatch"],streamUrl:"https://akm-cdn-play-web.onfilom.com/f0e536bf65fe71f0800b87c7361c0102/b1a83be851004a0ea2aaa99da1255e19-cac1c691bdae8e3f370454222ebe1f9c-sd.m3u8?hdnts=exp=1755710852_acl=/f0e536bf65fe71f0800b87c7361c0102/*_hmac=b17b41686a341c692fb39b25395190fd48e61e79f18e34ef3f2dc9e413a585eb"},{id:"5",title:"Película Shadow of God (2025)",year:2021,genre:"Ciencia Ficción",image:"https://image.tmdb.org/t/p/w200/vi6LF8rTdU4DeYrXTtUBqG9gFnX.jpg",type:"movie",rating:8,synopsis:"Mientras realiza un exorcismo no autorizado a su padre, un exorcista de élite sospecha que la entidad con la que está luchando podría ser un ser sagrado, tal vez incluso Dios.",duration:"Duración: 1h 27m",cast:["Timothée Chalamet","Rebecca Ferguson","Oscar Isaac"],streamUrl:"https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerMeltdowns.mp4"},{id:"6",title:"Película The Damned (2025)  ",year:2022,genre:"Acción",image:"https://image.tmdb.org/t/p/w200/23VdXxxHf9bWnmBWVB4rIsqDWuz.jpg",type:"movie",rating:7.8,synopsis:"una viuda del siglo XIX que debe tomar una decisión imposible cuando un barco se hunde frente a la costa de su aislado puesto de pesca en medio de un invierno especialmente cruel. Con las provisiones escaseando, Eva y su unida comunidad deben elegir entre rescatar a la tripulación naufragada o priorizar su propia supervivencia. Enfrentados a las consecuencias de su decisión y atormentados por la culpa, los habitantes luchan con una creciente sensación de pavor y comienzan a creer que todos están siendo castigados por sus decisiones.",duration:"Duración: 1h 29m",cast:["Robert Pattinson","Zoë Kravitz","Paul Dano"],streamUrl:"https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/SubaruOutbackOnStreetAndDirt.mp4"},{id:"7",title:"Película Leyendas de los héroes Cóndor: Los valientes (2025)",year:2025,genre:"Fantasía",image:"https://image.tmdb.org/t/p/w200/fAfbtF0OuHU5TnAU7w8qeO0cnr7.jpg",type:"movie",rating:6.8,synopsis:'Guo Jing abandonó su ciudad natal y adquirió un enorme poder en las artes marciales para cambiar su destino. Aunque era valorado por los maestros de kung fu que transmitieron las artes marciales sin parangón en el mundo "Manual de los Nueve Yin" y "Dieciocho Palmas Subyugadoras del Dragón", se formaron celos hacia él por parte de todos, convirtiéndose en el blanco de las críticas públicas. Guo Jing y Huang Rong cambiaron las tornas y protegieron la frontera de la dinastía Song del Sur en medio de la lluvia de flechas.',duration:"Duración: 2h 27m",cast:["Elenco principal"],streamUrl:"https://smoothpre.com/stream/UVesUHt5rVQ_xjUxsC2Etg/hjkrhuihghfvu/1757045470/31179084/index-f2-v1-a1.m3u8"},{id:"8",title:"Película Screamboat La Masacre Del Ratón (2025)",year:2025,genre:"Ciencia Ficción",image:"https://image.tmdb.org/t/p/w200/jWgeW8ZW5gDQIPgFYZ24bt4pW6W.jpg",type:"movie",rating:7,synopsis:'"Un travieso ratón acecha a un grupo de neoyorquinos en un viaje nocturno en ferry, desatando un caos asesino en un viaje relajante. ¿Podrá la variopinta tripulación del barco encontrar la manera de detener a esta criatura asesina?',duration:"Duración: 1h 42m",cast:["Sam Worthington","Zoe Saldana","Sigourney Weaver"],streamUrl:"https://smoothpre.com/stream/qRbxeR_yWIDMVdXpr0ac1A/hjkrhuihghfvu/1757046905/31291401/index-f2-v1-a1.m3u8"},{id:"9",title:"Película Molt lluny (2025)",year:2025,genre:"Acción",image:"https://image.tmdb.org/t/p/w200/oF3noXatzftfCltE0iEDnzU5WIi.jpg",type:"movie",rating:8.7,synopsis:'"Sergio, que ha viajado a Utrecht con su familia para asistir a un partido de fútbol, ​​sufre un ataque de pánico justo antes de tomar el vuelo de regreso a Barcelona.',duration:"Duración: 1h 40m",cast:["Tom Cruise","Miles Teller","Jennifer Connelly"],streamUrl:"https://akm-cdn-play-web.onfilom.com/9d1c474c6f4b43da8ea1bc3f9823239a/80526e2a77fd4a63bae51ca607ab5ecb-0333dbd09a2e8c5e1ee710206eae620b-ld.m3u8?hdnts=exp=1755712044_acl=/9d1c474c6f4b43da8ea1bc3f9823239a/*_hmac=3295fce0c5a2b6ccec7b7150edd43515c4d4854415eb9d1591822b951470e056"},{id:"10",title:"Película El último encargo (2025)",year:1972,genre:"Película El último encargo (2025)",image:"https://image.tmdb.org/t/p/w200/lbpyI9nwzSVDjS7OnE0uC41UciP.jpg",type:"movie",rating:9.2,synopsis:"Una recolección de dinero da un giro inesperado cuando dos incompatibles conductores de un camión blindado, Russell y Travis, son emboscados por unos delincuentes dirigidos por Zoe, una maestra del engaño. Al desatarse el caos, este extraño dúo debe lidiar con el peligro, sus personalidades opuestas, y un muy mal día que cada vez se sale más de control.",duration:"Duración: 1h 34m",cast:["Letitia Wright","Angela Bassett","Tenoch Huerta"],streamUrl:"https://akm-cdn-play-web.onfilom.com/8035a583cca471efb4d85014c1ca0102/65974265e9544b9890bacd6ccee50e62-652dfdd118359d9f6f4070b275af4408-sd.m3u8?hdnts=exp=1755694678_acl=/8035a583cca471efb4d85014c1ca0102/*_hmac=4db616456ce89188dcdee48b9a5c1f0efe85fb59c3437e9aa8fd1dd1280fe290"},{id:"11",title:"Película Hook (2025)",year:2021,genre:"Película Hook (2025)",image:"https://image.tmdb.org/t/p/w200/64lztqd6GBGTyjxKxjnXYndBHVf.jpg",type:"movie",rating:7.3,synopsis:"Impulsado por una droga alucinógena y un deseo de venganza, James Hook asesina a John Darling y pierde su mano a manos de Peter Pan. Dieciocho años después, Wendy, ahora casada con Peter, tiene una hija, Lily. Lily descubre que Hook es su padre biológico, lo que la lleva a un retiro de cumpleaños remoto. Hook escapa de la prisión y se embarca en una matanza, teniendo como blanco a Lily y sus amigos en la mansión.",duration:"Duración: 1h 18m",cast:["Tom Holland","Zendaya","Benedict Cumberbatch"],streamUrl:"https://akm-cdn-play-web.onfilom.com/f0e536bf65fe71f0800b87c7361c0102/b1a83be851004a0ea2aaa99da1255e19-cac1c691bdae8e3f370454222ebe1f9c-sd.m3u8?hdnts=exp=1755710852_acl=/f0e536bf65fe71f0800b87c7361c0102/*_hmac=b17b41686a341c692fb39b25395190fd48e61e79f18e34ef3f2dc9e413a585eb"},{id:"12",title:"Película Los tipos malos 2 (2025)",year:2021,genre:"Ciencia Ficción",image:"https://image.tmdb.org/t/p/w200/j0moebdCWDjjwS6bz1ohrsRp1Vp.jpg",type:"movie",rating:8,synopsis:'En está ocasión, los malos luchan por encontrar confianza y aceptación en sus nuevas vidas como buenos, cuando un escuadrón de criminales compuesto exclusivamente por mujeres las saca de su retiro y las obliga a hacer "un último trabajo".',duration:"Duración: 1h 44m",cast:["Timothée Chalamel","Rebecca Ferguson","Oscar Isaac"],streamUrl:"https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerMeltdowns.mp4"},{id:"13",title:"Película Nudus (2024)",year:2022,genre:"Acción",image:"https://image.tmdb.org/t/p/w200/e3E3V7TJkB2znDC2LLJuy1Um45Z.jpg",type:"movie",rating:7.8,synopsis:"Al despertar de un coma, una mujer se inquieta al descubrir todo lo que los doctores saben de ella, sin haberles dicho nada.",duration:"Duración: 1h 34m",cast:["Robert Pattinson","Zoë Kravitz","Paul Dano"],streamUrl:"https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/SubaruOutbackOnStreetAndDirt.mp4"},{id:"14",title:"Película Tiburones de cerca con Bertie Gregory (2025)",year:2025,genre:"Fantasía",image:"https://image.tmdb.org/t/p/w200/8zcrI1L3UJdaz1q1rOwl7igbHLx.jpg",type:"movie",rating:6.8,synopsis:"Bertie se dirige a Sudáfrica para emprender su misión más audaz hasta la fecha. Estas aguas albergan a uno de los depredadores más temidos y famosos del océano, el gran tiburón blanco. Bertie se sumergirá en las aguas poco profundas sin jaula de protección para filmar a los imponentes tiburones mientras cazan focas. En sus dominios descubrirá los desafíos a los que se enfrentan en el siempre cambiante hábitat.",duration:"Duración: 1h 29m",cast:["Elenco principal"],streamUrl:"https://smoothpre.com/stream/UVesUHt5rVQ_xjUxsC2Etg/hjkrhuihghfvu/1757045470/31179084/index-f2-v1-a1.m3u8"},{id:"15",title:"Película Superman (2025)",year:2025,genre:"Ciencia Ficción",image:"https://image.tmdb.org/t/p/w200/fvUJb08yatV2b3NUSwuYdQKYoFd.jpg",type:"movie",rating:7,synopsis:'"En sus primeros años, el joven reportero de Metrópolis y superhéroe se embarca en un viaje para reconciliar su herencia kryptoniana con su educación humana como Clark Kent.',duration:"Duración: 2h 10m",cast:["Sam Worthington","Zoe Saldana","Sigourney Weaver"],streamUrl:"https://smoothpre.com/stream/qRbxeR_yWIDMVdXpr0ac1A/hjkrhuihghfvu/1757046905/31291401/index-f2-v1-a1.m3u8"},{id:"16",title:"Película ZOMBIES 4: El origen de los vampiros (2025)",year:2025,genre:"Acción",image:"https://image.tmdb.org/t/p/w200/6EHx7lOm1jvNTr6lqRxiqmnFFDt.jpg",type:"movie",rating:8.7,synopsis:'"Zed y Addison descubren los mundos enfrentados de Sunnyside y Shadyside en un viaje de verano por carretera, en el que se encuentran con monstruos.',duration:"Duración: 1h 28m",cast:["Tom Cruise","Miles Teller","Jennifer Connelly"],streamUrl:"https://akm-cdn-play-web.onfilom.com/9d1c474c6f4b43da8ea1bc3f9823239a/80526e2a77fd4a63bae51ca607ab5ecb-0333dbd09a2e8c5e1ee710206eae620b-ld.m3u8?hdnts=exp=1755712044_acl=/9d1c474c6f4b43da8ea1bc3f9823239a/*_hmac=3295fce0c5a2b6ccec7b7150edd43515c4d4854415eb9d1591822b951470e056"},{id:"17",title:"Película Larga Distancia (2024)",year:1972,genre:"Película Larga Distancia (2024)",image:"https://image.tmdb.org/t/p/w200/reDAdPDDZs5diNTef6UNuRwHomW.jpg",type:"movie",rating:9.2,synopsis:"Tras un aterrizaje forzoso en un planeta alienígena, un minero de asteroides debe enfrentarse a los retos de su nuevo entorno, mientras atraviesa el duro terreno para llegar hasta la única superviviente: una mujer atrapada en su cápsula de escape.",duration:"Duración: 1h 27m",cast:["Letitia Wright","Angela Bassett","Tenoch Huerta"],streamUrl:"https://akm-cdn-play-web.onfilom.com/8035a583cca471efb4d85014c1ca0102/65974265e9544b9890bacd6ccee50e62-652dfdd118359d9f6f4070b275af4408-sd.m3u8?hdnts=exp=1755694678_acl=/8035a583cca471efb4d85014c1ca0102/*_hmac=4db616456ce89188dcdee48b9a5c1f0efe85fb59c3437e9aa8fd1dd1280fe290"},{id:"18",title:"Película Elio (2025)",year:2021,genre:"Superhéroes",image:"https://image.tmdb.org/t/p/w200/fGjwHlv8bCjZypi2bHbbSmyIGMV.jpg",type:"movie",rating:7.3,synopsis:"Elio, un niño fanático del espacio con una imaginación activa, se encuentra en una desventura cósmica en la que debe formar nuevos vínculos con excéntricas formas de vida alienígenas, navegar por una crisis de proporciones intergalácticas y, de alguna manera, descubrir quién está realmente destinado a ser.",duration:"Duración: 1h 39m",cast:["Tom Holland","Zendaya","Benedict Cumberbatch"],streamUrl:"https://akm-cdn-play-web.onfilom.com/f0e536bf65fe71f0800b87c7361c0102/b1a83be851004a0ea2aaa99da1255e19-cac1c691bdae8e3f370454222ebe1f9c-sd.m3u8?hdnts=exp=1755710852_acl=/f0e536bf65fe71f0800b87c7361c0102/*_hmac=b17b41686a341c692fb39b25395190fd48e61e79f18e34ef3f2dc9e413a585eb"},{id:"19",title:"Película Infiltrada en el búnker (2025)",year:2021,genre:"Ciencia Ficción",image:"https://image.tmdb.org/t/p/w200/1hmZfIhKl84b4z40Vl9F06p4eWd.jpg",type:"movie",rating:8,synopsis:'Esta es la historia de una investigadora encubierta que lo sacrificó todo y arriesgó su vida para mostrar al mundo la dura realidad que experimentó durante dos años en un laboratorio de experimentación con animales. Su investigación, a la que finalmente bautizó como "El Búnker", está capturada en cientos de horas de grabación con cámara oculta que revelan graves casos de maltrato animal. Infiltrada en el Búnker es un thriller que expone la infiltración más larga del mundo en un laboratorio farmacéutico y pone en perspectiva, a la vez que arroja luz sobre un debate social ineludible: el uso de animales en la experimentación científica.',duration:"Duración: 1h 36m",cast:["Timothée Chalamet","Rebecca Ferguson","Oscar Isaac"],streamUrl:"https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerMeltdowns.mp4"},{id:"20",title:"Película Exterminio: La evolución (2025)",year:2022,genre:"Acción",image:"https://image.tmdb.org/t/p/w200/cn4PNK6FQnaUDDqu1vhfqZAZd39.jpg",type:"movie",rating:7.8,synopsis:"Casi tres décadas desde que el virus de la ira escapó de un laboratorio de armas biológicas. Uno de los supervivientes abandona la pequeña isla en una misión hacía el oscuro corazón del continente, descubriendo secretos, maravillas y horrores que han mutado no sólo a los infectados, sino también a otros supervivientes.",duration:"Duración: 1h 55m",cast:["Robert Pattinson","Zoë Kravitz","Paul Dano"],streamUrl:"https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/SubaruOutbackOnStreetAndDirt.mp4"},{id:"21",title:"Película La Profecia del Guerrero (2025)",year:2025,genre:"Fantasía",image:"https://image.tmdb.org/t/p/w200/sV9vfQ6FneFt3x9FokKWAAqwWDq.jpg",type:"movie",rating:6.8,synopsis:"Un intrépido caballero se enfrenta a un reino mortal para salvar el alma de la Elegida. Enfrentándose a brujas, demonios y enemigos brutales, descubre que su regreso podría desatar el caos y condenar a la humanidad.",duration:"Duración: 1h 43m",cast:["Elenco principal"],streamUrl:"https://smoothpre.com/stream/UVesUHt5rVQ_xjUxsC2Etg/hjkrhuihghfvu/1757045470/31179084/index-f2-v1-a1.m3u8"},{id:"22",title:"Película La hacienda: El regreso de los malditos (2025)",year:2025,genre:"Ciencia Ficción",image:"https://image.tmdb.org/t/p/w200/vXUfuM7tPvAL8HjjnsFO4yYbKUs.jpg",type:"movie",rating:7,synopsis:'"Un grupo de amigos regresa a su pueblo natal después de muchos años. El viaje es una excusa para rememorar viejos tiempos, pero se convierte en una pesadilla cuando desentierran sus recuerdos más oscuros.',duration:"Duración: 1h 10m",cast:["Sam Worthington","Zoe Saldana","Sigourney Weaver"],streamUrl:"https://smoothpre.com/stream/qRbxeR_yWIDMVdXpr0ac1A/hjkrhuihghfvu/1757046905/31291401/index-f2-v1-a1.m3u8"},{id:"23",title:"Película ¿Y dónde está el policía? (2025)",year:2025,genre:"Acción",image:"https://image.tmdb.org/t/p/w200/y5BwdQlrFf9fEPDzXjdBEup5hcF.jpg",type:"movie",rating:8.7,synopsis:'"CSolo un hombre tiene las habilidades necesarias... ¡para liderar el Escuadrón de Policía y salvar el mundo!',duration:"2h 10min",cast:["Tom Cruise","Miles Teller","Jennifer Connelly"],streamUrl:"https://akm-cdn-play-web.onfilom.com/9d1c474c6f4b43da8ea1bc3f9823239a/80526e2a77fd4a63bae51ca607ab5ecb-0333dbd09a2e8c5e1ee710206eae620b-ld.m3u8?hdnts=exp=1755712044_acl=/9d1c474c6f4b43da8ea1bc3f9823239a/*_hmac=3295fce0c5a2b6ccec7b7150edd43515c4d4854415eb9d1591822b951470e056"},{id:"24",title:"Película Maa (2025)",year:1972,genre:"Película Maa (2025)",image:"https://image.tmdb.org/t/p/w200/kc5n7LJUmvBsVxzAla1ONN8kouP.jpg",type:"movie",rating:9.2,synopsis:"Una madre y su hija se encuentran con un demonio en un pueblo donde las niñas han estado desapareciendo.",duration:"Duración: 2h 13m",cast:["Letitia Wright","Angela Bassett","Tenoch Huerta"],streamUrl:"https://akm-cdn-play-web.onfilom.com/8035a583cca471efb4d85014c1ca0102/65974265e9544b9890bacd6ccee50e62-652dfdd118359d9f6f4070b275af4408-sd.m3u8?hdnts=exp=1755694678_acl=/8035a583cca471efb4d85014c1ca0102/*_hmac=4db616456ce89188dcdee48b9a5c1f0efe85fb59c3437e9aa8fd1dd1280fe290"},{id:"25",title:"Película Hallow Road (2025)",year:2021,genre:"Superhéroes",image:"https://image.tmdb.org/t/p/w200/dVsgV7ak6vR5xyXFggooJQinXBg.jpg",type:"movie",rating:7.3,synopsis:"Dos padres reciben una angustiosa llamada nocturna de su hija adolescente, quien acaba de atropellar accidentalmente a un peatón. Se suben a su coche a toda prisa para llegar antes de que alguien más se tope con la escena. A medida que avanza la noche, revelaciones inquietantes amenazan con destrozar a la familia, mientras enseguida se dan cuenta de que podrían no ser los únicos conduciendo por Hallow Road.",duration:"Duración: 1h 20m",cast:["Tom Holland","Zendaya","Benedict Cumberbatch"],streamUrl:"https://akm-cdn-play-web.onfilom.com/f0e536bf65fe71f0800b87c7361c0102/b1a83be851004a0ea2aaa99da1255e19-cac1c691bdae8e3f370454222ebe1f9c-sd.m3u8?hdnts=exp=1755710852_acl=/f0e536bf65fe71f0800b87c7361c0102/*_hmac=b17b41686a341c692fb39b25395190fd48e61e79f18e34ef3f2dc9e413a585eb"},{id:"26",title:"Película Shadow of God (2025)",year:2021,genre:"Ciencia Ficción",image:"https://image.tmdb.org/t/p/w200/vi6LF8rTdU4DeYrXTtUBqG9gFnX.jpg",type:"movie",rating:8,synopsis:"Mientras realiza un exorcismo no autorizado a su padre, un exorcista de élite sospecha que la entidad con la que está luchando podría ser un ser sagrado, tal vez incluso Dios.",duration:"Duración: 1h 27m",cast:["Timothée Chalamet","Rebecca Ferguson","Oscar Isaac"],streamUrl:"https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerMeltdowns.mp4"},{id:"27",title:"Película The Damned (2025)  ",year:2022,genre:"Acción",image:"https://image.tmdb.org/t/p/w200/23VdXxxHf9bWnmBWVB4rIsqDWuz.jpg",type:"movie",rating:7.8,synopsis:"una viuda del siglo XIX que debe tomar una decisión imposible cuando un barco se hunde frente a la costa de su aislado puesto de pesca en medio de un invierno especialmente cruel. Con las provisiones escaseando, Eva y su unida comunidad deben elegir entre rescatar a la tripulación naufragada o priorizar su propia supervivencia. Enfrentados a las consecuencias de su decisión y atormentados por la culpa, los habitantes luchan con una creciente sensación de pavor y comienzan a creer que todos están siendo castigados por sus decisiones.",duration:"Duración: 1h 29m",cast:["Robert Pattinson","Zoë Kravitz","Paul Dano"],streamUrl:"https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/SubaruOutbackOnStreetAndDirt.mp4"},{id:"28",title:"Nadie 2",year:2025,genre:"Fantasía",image:"https://image.tmdb.org/t/p/w200/aYPlrLJWjVkixwrJXA0f4V3D7Ab.jpg",type:"movie",rating:6.8,synopsis:"Cuatro años después de enfrentarse involuntariamente a la mafia rusa, Hutch sigue manteniendo con la organización criminal una deuda de 30 millones de dólares que trata de saldar poco a poco con una serie interminable de golpes contra matones internacionales. Pese a disfrutar como siempre de la faceta más trepidante y física de su «trabajo», Hutch y su esposa Becca se sienten agotados y distanciados. Para intentar remediarlo, deciden llevarse a sus hijos de escapada al mismo lugar al que Hutch iba de vacaciones con su hermano Harry cuando eran pequeños.",duration:"Duración: 1h 29m",cast:["Elenco principal"],streamUrl:"https://smoothpre.com/stream/UVesUHt5rVQ_xjUxsC2Etg/hjkrhuihghfvu/1757045470/31179084/index-f2-v1-a1.m3u8"},{id:"29",title:"Película La hacienda: El regreso de los malditos (2025)",year:2025,genre:"Ciencia Ficción",image:"https://image.tmdb.org/t/p/w200/vXUfuM7tPvAL8HjjnsFO4yYbKUs.jpg",type:"movie",rating:7,synopsis:'"Un grupo de amigos regresa a su pueblo natal después de muchos años. El viaje es una excusa para rememorar viejos tiempos, pero se convierte en una pesadilla cuando desentierran sus recuerdos más oscuros.',duration:"Duración: 1h 10m",cast:["Sam Worthington","Zoe Saldana","Sigourney Weaver"],streamUrl:"https://smoothpre.com/stream/qRbxeR_yWIDMVdXpr0ac1A/hjkrhuihghfvu/1757046905/31291401/index-f2-v1-a1.m3u8"},{id:"30",title:"Película ¿Y dónde está el policía? (2025)",year:2025,genre:"Acción",image:"https://image.tmdb.org/t/p/w200/y5BwdQlrFf9fEPDzXjdBEup5hcF.jpg",type:"movie",rating:8.7,synopsis:'"CSolo un hombre tiene las habilidades necesarias... ¡para liderar el Escuadrón de Policía y salvar el mundo!',duration:"2h 10min",cast:["Tom Cruise","Miles Teller","Jennifer Connelly"],streamUrl:"https://akm-cdn-play-web.onfilom.com/9d1c474c6f4b43da8ea1bc3f9823239a/80526e2a77fd4a63bae51ca607ab5ecb-0333dbd09a2e8c5e1ee710206eae620b-ld.m3u8?hdnts=exp=1755712044_acl=/9d1c474c6f4b43da8ea1bc3f9823239a/*_hmac=3295fce0c5a2b6ccec7b7150edd43515c4d4854415eb9d1591822b951470e056"},{id:"31",title:"Película Maa (2025)",year:1972,genre:"Película Maa (2025)",image:"https://image.tmdb.org/t/p/w200/kc5n7LJUmvBsVxzAla1ONN8kouP.jpg",type:"movie",rating:9.2,synopsis:"Una madre y su hija se encuentran con un demonio en un pueblo donde las niñas han estado desapareciendo.",duration:"Duración: 2h 13m",cast:["Letitia Wright","Angela Bassett","Tenoch Huerta"],streamUrl:"https://akm-cdn-play-web.onfilom.com/8035a583cca471efb4d85014c1ca0102/65974265e9544b9890bacd6ccee50e62-652dfdd118359d9f6f4070b275af4408-sd.m3u8?hdnts=exp=1755694678_acl=/8035a583cca471efb4d85014c1ca0102/*_hmac=4db616456ce89188dcdee48b9a5c1f0efe85fb59c3437e9aa8fd1dd1280fe290"},{id:"32",title:"Película Hallow Road (2025)",year:2021,genre:"Superhéroes",image:"https://image.tmdb.org/t/p/w200/dVsgV7ak6vR5xyXFggooJQinXBg.jpg",type:"movie",rating:7.3,synopsis:"Dos padres reciben una angustiosa llamada nocturna de su hija adolescente, quien acaba de atropellar accidentalmente a un peatón. Se suben a su coche a toda prisa para llegar antes de que alguien más se tope con la escena. A medida que avanza la noche, revelaciones inquietantes amenazan con destrozar a la familia, mientras enseguida se dan cuenta de que podrían no ser los únicos conduciendo por Hallow Road.",duration:"Duración: 1h 20m",cast:["Tom Holland","Zendaya","Benedict Cumberbatch"],streamUrl:"https://akm-cdn-play-web.onfilom.com/f0e536bf65fe71f0800b87c7361c0102/b1a83be851004a0ea2aaa99da1255e19-cac1c691bdae8e3f370454222ebe1f9c-sd.m3u8?hdnts=exp=1755710852_acl=/f0e536bf65fe71f0800b87c7361c0102/*_hmac=b17b41686a341c692fb39b25395190fd48e61e79f18e34ef3f2dc9e413a585eb"},{id:"33",title:"Película Shadow of God (2025)",year:2021,genre:"Ciencia Ficción",image:"https://image.tmdb.org/t/p/w200/vi6LF8rTdU4DeYrXTtUBqG9gFnX.jpg",type:"movie",rating:8,synopsis:"Mientras realiza un exorcismo no autorizado a su padre, un exorcista de élite sospecha que la entidad con la que está luchando podría ser un ser sagrado, tal vez incluso Dios.",duration:"Duración: 1h 27m",cast:["Timothée Chalamet","Rebecca Ferguson","Oscar Isaac"],streamUrl:"https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerMeltdowns.mp4"},{id:"34",title:"Película The Damned (2025)  ",year:2022,genre:"Acción",image:"https://image.tmdb.org/t/p/w200/23VdXxxHf9bWnmBWVB4rIsqDWuz.jpg",type:"movie",rating:7.8,synopsis:"una viuda del siglo XIX que debe tomar una decisión imposible cuando un barco se hunde frente a la costa de su aislado puesto de pesca en medio de un invierno especialmente cruel. Con las provisiones escaseando, Eva y su unida comunidad deben elegir entre rescatar a la tripulación naufragada o priorizar su propia supervivencia. Enfrentados a las consecuencias de su decisión y atormentados por la culpa, los habitantes luchan con una creciente sensación de pavor y comienzan a creer que todos están siendo castigados por sus decisiones.",duration:"Duración: 1h 29m",cast:["Robert Pattinson","Zoë Kravitz","Paul Dano"],streamUrl:"https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/SubaruOutbackOnStreetAndDirt.mp4"}],By=[{id:"s1",title:"Stranger Things",year:2022,genre:"Ciencia Ficción",image:"https://images.pexels.com/photos/1666779/pexels-photo-1666779.jpeg?auto=compress&cs=tinysrgb&w=400&h=600&fit=crop",type:"series",rating:8.7,synopsis:"Cuando un niño desaparece, su madre, un jefe de policía y sus amigos deben enfrentar fuerzas terroríficas para recuperarlo.",duration:"4 temporadas",cast:["Millie Bobby Brown","Finn Wolfhard","David Harbour"]},{id:"s2",title:"The Crown",year:2022,genre:"Drama",image:"https://images.pexels.com/photos/1666779/pexels-photo-1666779.jpeg?auto=compress&cs=tinysrgb&w=400&h=600&fit=crop",type:"series",rating:8.6,synopsis:"Sigue la vida política y los romances de la Reina Isabel II y los eventos que dieron forma a la segunda mitad del siglo XX.",duration:"6 temporadas",cast:["Imelda Staunton","Jonathan Pryce","Lesley Manville"]},{id:"s3",title:"Wednesday",year:2022,genre:"Comedia",image:"https://images.pexels.com/photos/1666779/pexels-photo-1666779.jpeg?auto=compress&cs=tinysrgb&w=400&h=600&fit=crop",type:"series",rating:8.1,synopsis:"Sigue a Wednesday Addams mientras navega por sus años como estudiante en la Academia Nevermore, intentando dominar su habilidad psíquica emergente.",duration:"1 temporada",cast:["Jenna Ortega","Emma Myers","Enid Sinclair"]},{id:"s4",title:"House of the Dragon",year:2022,genre:"Fantasía",image:"https://images.pexels.com/photos/1666779/pexels-photo-1666779.jpeg?auto=compress&cs=tinysrgb&w=400&h=600&fit=crop",type:"series",rating:8.5,synopsis:"Una precuela de Game of Thrones que se centra en la casa Targaryen 200 años antes de los eventos de la serie original.",duration:"1 temporada",cast:["Paddy Considine","Emma D'Arcy","Matt Smith"]}],Fy=[{id:"k1",title:"Encanto",year:2021,genre:"Animación",image:"https://images.pexels.com/photos/1666779/pexels-photo-1666779.jpeg?auto=compress&cs=tinysrgb&w=400&h=600&fit=crop",type:"movie",rating:7.2,synopsis:"Una niña colombiana puede ser la última esperanza de su familia cuando descubre que la magia que rodea el Encanto está en peligro.",duration:"1h 42min",cast:["Stephanie Beatriz","María Cecilia Botero","John Leguizamo"]},{id:"k2",title:"Turning Red",year:2022,genre:"Animación",image:"https://images.pexels.com/photos/1666779/pexels-photo-1666779.jpeg?auto=compress&cs=tinysrgb&w=400&h=600&fit=crop",type:"movie",rating:7,synopsis:"Una niña de 13 años se convierte en un panda rojo gigante cada vez que se emociona demasiado.",duration:"1h 40min",cast:["Rosalie Chiang","Sandra Oh","Ava Morse"]}],pN=[{id:"c1",title:"The Good Place",year:2020,genre:"Comedia",image:"https://images.pexels.com/photos/1666779/pexels-photo-1666779.jpeg?auto=compress&cs=tinysrgb&w=400&h=600&fit=crop",type:"series",rating:8.2,synopsis:'Una mujer lucha por ser una mejor persona después de descubrir que está en el "lugar bueno".',duration:"4 temporadas",cast:["Kristen Bell","Ted Danson","William Jackson Harper"]},{id:"c2",title:"Brooklyn Nine-Nine",year:2021,genre:"Comedia",image:"https://images.pexels.com/photos/1666779/pexels-photo-1666779.jpeg?auto=compress&cs=tinysrgb&w=400&h=600&fit=crop",type:"series",rating:8.4,synopsis:"Comedia sobre un grupo de detectives en una comisaría de Brooklyn.",duration:"8 temporadas",cast:["Andy Samberg","Stephanie Beatriz","Terry Crews"]}],mN=()=>{const{currentUser:n}=Am(),{t:e}=sm(),{currentProfile:t}=_E(),[i,r]=ae.useState("home"),[s,a]=ae.useState(!1),[o,l]=ae.useState(""),[c,u]=ae.useState(null),[d,h]=ae.useState(!1);if(!n)return z.jsx(ak,{});if(!t)return z.jsx(fN,{});const m=E=>{l(E)},g=E=>{console.log("Playing:",E.title)},v=E=>{u(E),h(!0)},x=()=>{switch(i){case"home":return z.jsxs("div",{className:"space-y-8",children:[z.jsx(ms,{title:e("popular-movies"),items:Ny,onPlay:g,onInfo:v}),z.jsx(ms,{title:e("trending-series"),items:By,onPlay:g,onInfo:v}),z.jsx(ms,{title:e("for-kids"),items:Fy,onPlay:g,onInfo:v})]});case"movies":return z.jsx(ms,{title:e("movies"),items:Ny,onPlay:g,onInfo:v});case"series":return z.jsx(ms,{title:e("series"),items:By,onPlay:g,onInfo:v});case"kids":return z.jsx(ms,{title:e("kids"),items:Fy,onPlay:g,onInfo:v});case"comedy":return z.jsx(ms,{title:e("comedy"),items:pN,onPlay:g,onInfo:v});case"live-tv":return z.jsx(dN,{});default:return z.jsxs("div",{className:"text-center py-20",children:[z.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:e("section-development")}),z.jsx("p",{className:"text-gray-400",children:e("coming-soon")})]})}};return z.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-black to-gray-900",children:[z.jsx(ok,{onSearch:m,onMenuToggle:()=>a(!s),isMenuOpen:s}),z.jsx(lk,{isOpen:s,activeSection:i,onSectionChange:E=>{r(E),a(!1)}}),z.jsx("main",{className:`transition-all duration-300 ${s?"ml-64":"ml-0"} pt-6`,children:z.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:x()})}),z.jsx(hN,{item:c,isOpen:d,onClose:()=>h(!1),onPlay:g}),s&&z.jsx("div",{className:"fixed inset-0 bg-black/50 z-30 lg:hidden",onClick:()=>a(!1)})]})};function gN(){return z.jsx(QI,{children:z.jsx(PC,{children:z.jsx(ZI,{children:z.jsx($I,{children:z.jsx(mN,{})})})})})}Nh.createRoot(document.getElementById("root")).render(z.jsx(Xy.StrictMode,{children:z.jsx(gN,{})}));
